"use strict";(globalThis["webpackChunkraiden_dapp"]=globalThis["webpackChunkraiden_dapp"]||[]).push([[672],{12315:(t,e,n)=>{n.d(e,{Z:()=>m});var i=n(23399),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("raiden-dialog",{staticClass:"error-dialog",attrs:{visible:t.showDialog},on:{close:t.dismiss}},[n(i.ZB,[n("error-message",{attrs:{error:t.error}})],1)],1)},r=[],a=n(59312),o=n(57102),c=n(7648),d=n(94813);let p=class extends o.w3{dismiss(){return!0}get showDialog(){return null!==this.error}};(0,a.__decorate)([(0,o.fI)({required:!0})],p.prototype,"error",void 0),(0,a.__decorate)([(0,o.y1)()],p.prototype,"dismiss",null),p=(0,a.__decorate)([(0,o.wA)({components:{RaidenDialog:c.Z,ErrorMessage:d.Z}})],p);const u=p,h=u;var l=n(79917),f=(0,l.Z)(h,s,r,!1,null,"3d377652",null);const m=f.exports},6846:(t,e,n)=>{n.r(e),n.d(e,{default:()=>dt});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"quick-pay"},[t.token?n("div",{staticClass:"quick-pay__transfer-information"},[n("span",{staticClass:"quick-pay__transfer-information__header"},[t._v(" "+t._s(t.$t("quick-pay.transfer-information.header"))+" ")]),n("token-information",{staticClass:"quick-pay__transfer-information__token",attrs:{token:t.token}}),n("address-display",{staticClass:"quick-pay__transfer-information__target",attrs:{label:t.$t("quick-pay.transfer-information.target-address"),address:t.targetAddress,"full-width":""}}),n("amount-display",{staticClass:"quick-pay__transfer-information__amount",attrs:{label:t.$t("quick-pay.transfer-information.token-amount"),amount:t.tokenAmount,token:t.token,"exact-amount":"","full-width":""}}),t.mediationTransferIsPossible?n("div",{staticClass:"quick-pay__transfer-information__mediation"},[n("amount-display",{staticClass:"quick-pay__transfer-information__mediation__pathfinding-service-price",attrs:{label:t.$t("quick-pay.transfer-information.pathfinding-service-price"),amount:t.pathfindingServicePrice,token:t.serviceToken,"exact-amount":"","full-width":""}},[t.pathfindingServicePrice?t._e():n("spinner",{attrs:{size:25,width:3,inline:""}})],1),n("amount-display",{staticClass:"quick-pay__transfer-information__mediation__fees",attrs:{label:"",amount:t.mediationFees,token:t.token,"exact-amount":"","full-width":""}},[t.showFetchMediationRouteButton?n("button",{staticClass:"quick-pay__transfer-information__mediation__button",attrs:{disabled:t.fetchMediationRouteDisabled},on:{click:t.fetchCheapestMediationRoute}},[t._v(" "+t._s(t.$t("quick-pay.transfer-information.fetch-route-trigger"))+" ")]):t._e(),t.fetchMediationRouteInProgress?n("spinner",{attrs:{size:25,width:3,inline:""}}):t._e(),t.showFetchMediationRouteError?n("span",{staticClass:"quick-pay__transfer-information__mediation__error"},[t._v(" "+t._s(t.fetchMediationRouteError)+" ")]):t._e()],1)],1):t._e()],1):t._e(),t.actionComponent?n("div",{staticClass:"quick-pay__action"},[t.actionHeader?n("span",{staticClass:"quick-pay__action__header"},[t._v(t._s(t.actionHeader))]):t._e(),n(t.actionComponent,{tag:"component",staticClass:"quick-pay__action__component",attrs:{"fixed-run-options":t.actionFixedRunOptions,"dialog-title":t.actionDialogTitle,"completion-delay-timeout":1500,"show-progress-in-dialog":""},on:{started:t.setActionInProgress,failed:t.setActionFailed,completed:t.redirect,dialogClosed:t.redirect},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.runAction,s=e.confirmButtonLabel;return[n("channel-action-form",{attrs:{"token-address":t.tokenAddress,"partner-address":t.targetAddress,"token-amount":t.formattedDepositAmount,"minimum-token-amount":t.depositAmount,"confirm-button-label":s,"autofocus-disabled":t.actionFormAutofocusDisabled,"run-action":i,"hide-token-address":"","hide-partner-address":"","token-amount-editable":!t.tokenAmountInputHidden,"hide-token-amount":t.tokenAmountInputHidden,"limit-to-token-balance":"","sticky-button":""},on:{inputsChanged:t.onActionFromInputsChanged}})]}}],null,!1,3641683095)}),n("i18n",{staticClass:"quick-pay__action__message",attrs:{path:t.actionMessagePath},scopedSlots:t._u([{key:"deposit",fn:function(){return[n("amount-display",{attrs:{amount:t.depositAmountInput,token:t.token,inline:""}})]},proxy:!0},{key:"payment",fn:function(){return[n("amount-display",{attrs:{amount:t.tokenAmount,token:t.token,inline:""}})]},proxy:!0}],null,!1,2530180478)})],1):t._e(),t.errorVisible?n("error-dialog",{attrs:{error:t.error},on:{dismiss:t.redirect}}):t._e()],1)},s=[],r=n(59312),a=n(3922),o=n(5733),c=n(57102),d=n(77382),p=n(31034),u=n(80300),h=n(1560),l=n(9226),f=n(40694),m=n(14987);const g={title:"channel-deposit-and-transfer-action.steps.deposit.title",description:"channel-deposit-and-transfer-action.steps.deposit.description",active:!1,completed:!1,failed:!1},k={title:"channel-deposit-and-transfer-action.steps.transfer.title",description:"channel-deposit-and-transfer-action.steps.transfer.description",active:!1,completed:!1,failed:!1};let v=class extends((0,c.Wr)(m.Z)){constructor(){super(...arguments),this.depositStep=Object.assign({},g),this.transferStep=Object.assign({},k)}get confirmButtonLabel(){return this.$t("channel-deposit-and-transfer-action.confirm-button-label")}get steps(){return[this.depositStep,this.transferStep]}resetStepsState(){this.depositStep=Object.assign({},g),this.transferStep=Object.assign({},k)}async handleAction(t){const{tokenAddress:e,partnerAddress:n,tokenAmount:i}=t,{transferTokenAmount:s,paymentIdentifier:r}=this.fixedRunOptions;this.depositStep.active=!0,await this.$raiden.deposit(e,n,i),await new Promise((t=>setTimeout(t,3e3))),this.depositStep.completed=!0,this.depositStep.active=!1,this.transferStep.active=!0,await this.$raiden.transfer(e,n,s,r),this.transferStep.completed=!0,this.transferStep.active=!1}};v=(0,r.__decorate)([c.wA],v);const _=v,y=_;var A,S,C=n(79917),b=(0,C.Z)(y,A,S,!1,null,null,null);const w=b.exports,R={title:"channel-open-and-transfer-action.steps.open.title",description:"channel-open-and-transfer-action.steps.open.description",active:!1,completed:!1,failed:!1},$={title:"channel-open-and-transfer-action.steps.deposit.title",description:"channel-open-and-transfer-action.steps.deposit.description",active:!1,completed:!1,failed:!1},T={title:"channel-open-and-transfer-action.steps.transfer.title",description:"channel-open-and-transfer-action.steps.transfer.description",active:!1,completed:!1,failed:!1};let q=class extends((0,c.Wr)(m.Z)){constructor(){super(...arguments),this.openStep=Object.assign({},R),this.depositStep=Object.assign({},$),this.transferStep=Object.assign({},T)}get confirmButtonLabel(){return this.$t("channel-open-and-transfer-action.confirm-button-label")}get steps(){return[this.openStep,this.depositStep,this.transferStep]}resetStepsState(){this.openStep=Object.assign({},R),this.depositStep=Object.assign({},$),this.transferStep=Object.assign({},T)}handleOpenEvents(t){switch(t.type){case p.GM.OPENED:this.openStep.completed=!0,this.openStep.active=!1,this.depositStep.active=!0;break;default:break}}async handleAction(t){const{tokenAddress:e,partnerAddress:n,tokenAmount:i}=t,{transferTokenAmount:s,paymentIdentifier:r}=this.fixedRunOptions;this.openStep.active=!0,await this.$raiden.openChannel(e,n,i,this.handleOpenEvents),await new Promise((t=>setTimeout(t,3e3))),this.depositStep.completed=!0,this.depositStep.active=!1,this.transferStep.active=!0,await this.$raiden.transfer(e,n,s,r),this.transferStep.completed=!0,this.transferStep.active=!1}};q=(0,r.__decorate)([c.wA],q);const I=q,O=I;var x,M,P=(0,C.Z)(O,x,M,!1,null,null,null);const E=P.exports;var F=n(12315),Z=n(54928),D=n(9125);const j={title:"direct-transfer-action.steps.transfer.title",description:"direct-transfer-action.steps.transfer.description",active:!1,completed:!1,failed:!1};let B=class extends((0,c.Wr)(m.Z)){constructor(){super(...arguments),this.transferStep=Object.assign({},j)}get confirmButtonLabel(){return this.$t("direct-transfer-action.confirm-button-label")}get steps(){return[this.transferStep]}resetStepsState(){this.transferStep=Object.assign({},j)}async handleAction(t){const{tokenAddress:e,partnerAddress:n}=t,{transferTokenAmount:i,paymentIdentifier:s}=this.fixedRunOptions;this.transferStep.active=!0;const r=await this.$raiden.directRoute(e,n,i);if(void 0===r)throw new Error(this.$t("direct-transfer-action.no-route-error"));await this.$raiden.transfer(e,n,i,s,r),this.transferStep.completed=!0,this.transferStep.active=!1}};B=(0,r.__decorate)([c.wA],B);const W=B,H=W;var L,Y,z=(0,C.Z)(H,L,Y,!1,null,null,null);const Q=z.exports,U={title:"mediated-transfer-action.steps.transfer.title",description:"mediated-transfer-action.steps.transfer.description",active:!1,completed:!1,failed:!1};let K=class extends((0,c.Wr)(m.Z)){constructor(){super(...arguments),this.transferStep=Object.assign({},U)}get confirmButtonLabel(){return this.$t("mediated-transfer-action.confirm-button-label")}get steps(){return[this.transferStep]}resetStepsState(){this.transferStep=Object.assign({},U)}async handleAction(t){const{tokenAddress:e,partnerAddress:n}=t,{transferTokenAmount:i,paymentIdentifier:s,route:r}=this.fixedRunOptions;this.transferStep.active=!0,await this.$raiden.transfer(e,n,i,s,[r]),this.transferStep.completed=!0,this.transferStep.active=!1}};K=(0,r.__decorate)([c.wA],K);const V=K,G=V;var N,J,X=(0,C.Z)(G,N,J,!1,null,null,null);const tt=X.exports;var et=n(55093),nt=n(55679),it=n(4768);const{mapState:st}=(0,d._p)("userDepositContract");let rt=class extends((0,c.Wr)(et.Z)){constructor(){super(...arguments),this.pathfindingService=null,this.serviceTokenCapacity=o._Y,this.fetchMediationRouteInProgress=!1,this.fetchMediationRouteFailed=!1,this.mediationRoute=null,this.depositAmountInput=o._Y,this.actionComponent=null,this.actionInProgress=!1,this.actionFailed=!1,this.error=null}get tokenAddress(){return(0,it.Kn)(this.$route.query.tokenAddress)}get token(){return this.getToken(this.tokenAddress)}get targetAddress(){return(0,it.Kn)(this.$route.query.targetAddress)}get tokenAmount(){const t=(0,it.Bg)(this.$route.query.amount);return t?a.O$.from(t):void 0}get depositAmount(){var t,e,n,i;switch(this.actionComponent){case w:let s=null===(t=this.tokenAmount)||void 0===t?void 0:t.sub(null!==(e=null===(n=this.directChannelWithTarget)||void 0===n?void 0:n.capacity)&&void 0!==e?e:o._Y);return null!==s&&void 0!==s&&s.gt(o._Y)?s:o._Y;case E:return null!==(i=this.tokenAmount)&&void 0!==i?i:o._Y;default:return o._Y}}get formattedDepositAmount(){var t,e;return nt.D.toUnits(this.depositAmount,null!==(t=null===(e=this.token)||void 0===e?void 0:e.decimals)&&void 0!==t?t:18)}get tokenAmountInputHidden(){return null===this.actionComponent||this.actionComponent===Q||this.actionComponent===tt}get paymentIdentifier(){return(0,it.ok)(this.$route.query.identifier)}get redirectionTarget(){return this.$route.query.redirectTo}get redirectionUrl(){let t=`${this.redirectionTarget}?identifier=${this.paymentIdentifier}`;return t+=this.actionFailed?"&failed=true":`&payerAddress=${this.$raiden.getAccount()}`,t}get anyRequiredQueryParameterInvalid(){return!(this.tokenAddress&&this.targetAddress&&this.tokenAmount&&this.paymentIdentifier)}get errorVisible(){return null!=this.error&&!this.actionInProgress&&!this.actionFailed}get directChannelWithTarget(){const t=this.getChannels(this.tokenAddress);return t.filter((t=>t.partner===this.targetAddress&&t.state===p.Dz.open))[0]}get directChannelHasEnoughCapacity(){var t,e;return!(null===(t=this.directChannelWithTarget)||void 0===t||!t.capacity.gte(null!==(e=this.tokenAmount)&&void 0!==e?e:o.PS))}get hasAnyChannelWithEnoughCapacity(){const t=this.getChannels(this.tokenAddress),e=t.filter((t=>{var e;return t.state===p.Dz.open&&t.capacity.gte(null!==(e=this.tokenAmount)&&void 0!==e?e:o.Bz)}));return e.length>0}get mediationTransferIsPossible(){return this.hasAnyChannelWithEnoughCapacity&&!this.directChannelHasEnoughCapacity}get pathfindingServicePrice(){var t;return null!==(t=this.pathfindingService)&&void 0!==t&&t.price?a.O$.from(this.pathfindingService.price):void 0}get pathfindingServiceTooExpensive(){return void 0!==this.pathfindingServicePrice&&this.pathfindingServicePrice.gt(this.serviceTokenCapacity)}get showFetchMediationRouteError(){return this.fetchMediationRouteFailed||this.pathfindingServiceTooExpensive}get fetchMediationRouteError(){return this.pathfindingServiceTooExpensive?this.$t("quick-pay.transfer-information.fetch-route-error-too-expensive"):this.fetchMediationRouteFailed?this.$t("quick-pay.transfer-information.fetch-route-error-no-route"):void 0}get showFetchMediationRouteButton(){return!this.mediationRoute&&!this.pathfindingServiceTooExpensive&&!this.fetchMediationRouteInProgress&&!this.fetchMediationRouteFailed}get fetchMediationRouteDisabled(){return null===this.pathfindingService||this.pathfindingServiceTooExpensive}get mediationFees(){var t;return null!==(t=this.mediationRoute)&&void 0!==t&&t.fee?a.O$.from(this.mediationRoute.fee):void 0}get actionHeader(){switch(this.actionComponent){case Q:case tt:return"";case w:return this.$t("quick-pay.action-titles.channel-deposit");case E:return this.$t("quick-pay.action-titles.channel-open");default:return""}}get actionFixedRunOptions(){return{transferTokenAmount:this.tokenAmount,paymentIdentifier:this.paymentIdentifier,route:this.mediationRoute}}get actionDialogTitle(){switch(this.actionComponent){case Q:case tt:return"";case w:return this.$t("quick-pay.action-titles.channel-deposit-and-transfer");case E:return this.$t("quick-pay.action-titles.channel-open-and-transfer");default:return""}}get actionMessagePath(){switch(this.actionComponent){case Q:return"quick-pay.action-messages.direct-transfer";case tt:return"quick-pay.action-messages.mediated-transfer";case w:return"quick-pay.action-messages.channel-deposit-and-transfer";case E:return"quick-pay.action-messages.channel-open-and-transfer";default:return""}}get actionFormAutofocusDisabled(){return this.hasAnyChannelWithEnoughCapacity}created(){this.fetchServiceTokenCapacity(),this.fetchCheapestPathfindingService()}async fetchServiceTokenCapacity(){this.serviceTokenCapacity=await this.$raiden.getUDCCapacity()}async fetchCheapestPathfindingService(){const t=await this.$raiden.fetchServices();this.pathfindingService=t[0]}async fetchCheapestMediationRoute(){try{this.fetchMediationRouteFailed=!1,this.fetchMediationRouteInProgress=!0;const t=await this.$raiden.findRoutes(this.tokenAddress,this.targetAddress,this.tokenAmount,this.pathfindingService);this.mediationRoute=t[0]}catch(t){this.fetchMediationRouteFailed=!0}finally{this.fetchMediationRouteInProgress=!1}}onRouteQueryChanged(){this.anyRequiredQueryParameterInvalid?this.error=new Error(this.$t("quick-pay.invalid-parameter-error")):(this.error=null,this.decideOnActionComponent())}onMediationRouteChanged(){this.decideOnActionComponent()}onActionFromInputsChanged(t){var e,n;this.depositAmountInput=nt.D.parse(t.tokenAmount,null!==(e=null===(n=this.token)||void 0===n?void 0:n.decimals)&&void 0!==e?e:18)}setActionInProgress(){this.actionInProgress=!0}setActionFailed(){this.actionFailed=!0}decideOnActionComponent(){this.actionInProgress||(this.actionComponent=this.mediationRoute?tt:this.directChannelHasEnoughCapacity?Q:this.directChannelWithTarget?w:E)}async redirect(){if(this.redirectionTarget){const t=this.redirectionUrl;await this.$raiden.disconnect(),window.location.replace(t)}else this.navigateToTransfer(this.tokenAddress)}};(0,r.__decorate)([(0,c.RL)("$route.query",{immediate:!0})],rt.prototype,"onRouteQueryChanged",null),(0,r.__decorate)([(0,c.RL)("mediationRoute")],rt.prototype,"onMediationRouteChanged",null),rt=(0,r.__decorate)([(0,c.wA)({components:{ActionButton:u.Z,AddressDisplay:h.Z,AmountDisplay:l.Z,ChannelActionForm:f.Z,ChannelDepositAndTransferAction:w,ChannelOpenAndTransferAction:E,ErrorDialog:F.Z,Spinner:Z.Z,TokenInformation:D.Z,DirectTransferAction:Q,MediatedTransferAction:tt},computed:{...(0,d.Se)({getChannels:"channels",getToken:"token"}),...st({serviceToken:"token"})}})],rt);const at=rt,ot=at;var ct=(0,C.Z)(ot,i,s,!1,null,"ba4a246c",null);const dt=ct.exports},4768:(t,e,n)=>{n.d(e,{Bg:()=>a,Kn:()=>o,ok:()=>r});var i=n(3922),s=n(28341);function r(t){try{return i.O$.from(t)}catch(e){return}}function a(t){let e="";return t&&"string"===typeof t&&/^\d*[.]?\d*$/.test(t)&&(e=t),e}function o(t){let e="";return t&&"string"===typeof t&&s.Z.isAddress(t)&&s.Z.checkAddressChecksum(t)&&(e=t),e}}}]);