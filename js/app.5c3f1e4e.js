(()=>{var e={80300:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var a=n(2138),i=n(97660),r=n(92208),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(a.Z,{staticClass:"text-capitalize action-button",class:{"action-button--sticky":e.sticky,"action-button--full-width":e.fullWidth,"action-button--angular":e.angular},style:{width:e.width,height:e.height},attrs:{type:"submit",disabled:!e.enabled,loading:e.loading,href:e.href,download:e.download,"data-cy":"action_button",depressed:"",large:""},on:{click:function(t){return e.click()}},scopedSlots:e._u([e.loadingText?{key:"loader",fn:function(){return[n("div",{staticClass:"action-button__loading"},[n("span",[e._v(e._s(e.loadingText))]),n(r.Z,{staticClass:"action-button__loading__indicator",attrs:{indeterminate:"",rounded:""}})],1)]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(e.text)+" "),e.arrow?n(i.Z,{attrs:{right:""}},[e._v("keyboard_arrow_right")]):e._e()],1)},s=[],c=n(59312),l=n(57102);let d=class extends l.w3{click(){return!0}};(0,c.__decorate)([(0,l.fI)({required:!0,type:Boolean})],d.prototype,"enabled",void 0),(0,c.__decorate)([(0,l.fI)({required:!0})],d.prototype,"text",void 0),(0,c.__decorate)([(0,l.fI)({type:Boolean,default:!1})],d.prototype,"loading",void 0),(0,c.__decorate)([(0,l.fI)({type:String})],d.prototype,"loadingText",void 0),(0,c.__decorate)([(0,l.fI)({type:Boolean,default:!1})],d.prototype,"sticky",void 0),(0,c.__decorate)([(0,l.fI)({type:Boolean,default:!1})],d.prototype,"arrow",void 0),(0,c.__decorate)([(0,l.fI)({type:String,default:"250px"})],d.prototype,"width",void 0),(0,c.__decorate)([(0,l.fI)({type:Boolean,default:!1})],d.prototype,"fullWidth",void 0),(0,c.__decorate)([(0,l.fI)({type:String,default:"40px"})],d.prototype,"height",void 0),(0,c.__decorate)([(0,l.fI)({type:Boolean,default:!1})],d.prototype,"angular",void 0),(0,c.__decorate)([(0,l.fI)({type:String})],d.prototype,"href",void 0),(0,c.__decorate)([(0,l.fI)({type:String})],d.prototype,"download",void 0),(0,c.__decorate)([(0,l.y1)()],d.prototype,"click",null),d=(0,c.__decorate)([(0,l.wA)({})],d);const p=d,u=p;var m=n(79917),y=(0,m.Z)(u,o,s,!1,null,"6773da48",null);const f=y.exports},73249:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var a=n(2138),i=n(28508),r=n(37553),o=n(55429),s=n(53892),c=function(){var e=this,t=e.$createElement,c=e._self._c||t;return c(r.Z,{staticClass:"header-content pa-0",attrs:{fluid:""}},[c(s.Z,{attrs:{align:"center","no-gutters":""}},[c(i.Z,{attrs:{cols:"2"}},[e.canNavigateBack?c(a.Z,{attrs:{"data-cy":"header-content_back-button",height:"36px",width:"36px",icon:""},on:{click:function(t){return e.navigateBack()}}},[c(o.Z,{attrs:{src:n(77828)}})],1):e._e()],1),c(i.Z,{staticClass:"header-content__title",attrs:{cols:"auto"}},[c("div",{staticClass:"header-content__title__route"},[c("span",{staticClass:"header-content__title__route__name"},[e._v(e._s(e.$route.meta.title))]),e.availableInfoOverlay&&!e.disableInfoButton?c(a.Z,{staticClass:"header-content__title__route__info",attrs:{icon:"","x-small":""}},[c(o.Z,{staticClass:"header-content__title__route__info__icon",attrs:{src:n(28095),width:"10px"},on:{click:function(t){return e.showInfo()}}})],1):e._e()],1),e.showNetwork?c("span",{staticClass:"header-content__title__network"},[e._v(e._s(e.network))]):e._e()]),c(i.Z,{attrs:{cols:"2"}},[e._t("default")],2)],1)],1)},l=[],d=n(59312),p=n(57102),u=n(77382);let m=class extends p.w3{showInfo(){}navigateBack(){}get availableInfoOverlay(){var e;return!(null===(e=this.$route.meta)||void 0===e||!e.infoOverlay)}get canNavigateBack(){var e;return!this.disableBackButton&&!(null!==(e=this.$route.meta)&&void 0!==e&&e.cannotNavigateBack)}};(0,d.__decorate)([(0,p.fI)({type:Boolean,default:!1})],m.prototype,"disableBackButton",void 0),(0,d.__decorate)([(0,p.fI)({type:Boolean,default:!1})],m.prototype,"showNetwork",void 0),(0,d.__decorate)([(0,p.fI)({type:Boolean,default:!1})],m.prototype,"disableInfoButton",void 0),(0,d.__decorate)([(0,p.y1)()],m.prototype,"showInfo",null),(0,d.__decorate)([(0,p.y1)()],m.prototype,"navigateBack",null),m=(0,d.__decorate)([(0,p.wA)({computed:{...(0,u.rn)(["isConnected"]),...(0,u.Se)(["network"])}})],m);const y=m,f=y;var h=n(79917),_=(0,h.Z)(f,c,l,!1,null,"c5165142",null);const g=_.exports},55532:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var a=n(55429),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header-identicon"},[n(a.Z,{class:{"header-identicon__blockie":e.defaultAccount,"header-identicon__blockie header-identicon__blockie__grayscale":!e.defaultAccount},attrs:{src:e.$blockie(e.defaultAccount),contain:"","aspect-ratio":"1"}})],1)},r=[],o=n(59312),s=n(57102),c=n(77382),l=n(31113);let d=class extends((0,s.Wr)(l.Z)){};d=(0,o.__decorate)([(0,s.wA)({computed:{...(0,c.rn)(["defaultAccount"])}})],d);const p=d,u=p;var m=n(79917),y=(0,m.Z)(u,i,r,!1,null,"d302227a",null);const f=y.exports},7648:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var a=n(2138),i=n(73834),r=n(93750),o=n(97660),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("blurred-overlay",{attrs:{show:e.visible,fullscreen:""}},[n(r.Z,{attrs:{value:e.visible,width:e.width,"hide-overlay":"",dark:"",persistent:e.hideClose},on:{"click:outside":function(t){return e.close()}}},[n(i.Z,{staticClass:"raiden-dialog",attrs:{"data-cy":"raiden_dialog"}},[e.hideClose?e._e():n(a.Z,{staticClass:"raiden-dialog__close",attrs:{icon:""},on:{click:function(t){return e.close()}}},[n(o.Z,[e._v("mdi-close")])],1),e._t("default")],2)],1)],1)},c=[],l=n(59312),d=n(57102),p=n(57888);let u=class extends d.w3{close(){return!0}};(0,l.__decorate)([(0,d.fI)({required:!0,default:!1,type:Boolean})],u.prototype,"visible",void 0),(0,l.__decorate)([(0,d.fI)({required:!1,default:!1,type:Boolean})],u.prototype,"hideClose",void 0),(0,l.__decorate)([(0,d.fI)({required:!1,default:"350",type:String})],u.prototype,"width",void 0),(0,l.__decorate)([(0,d.y1)()],u.prototype,"close",null),u=(0,l.__decorate)([(0,d.wA)({components:{BlurredOverlay:p.Z}})],u);const m=u,y=m;var f=n(79917),h=(0,f.Z)(y,s,c,!1,null,"46e7cf3b",null);const _=h.exports},54928:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spinner",class:{"spinner--blocking":!e.inline}},[n("div",{staticClass:"spinner__circle",style:e.style})])},i=[],r=n(59312),o=n(57102);let s=class extends o.w3{get style(){return{width:`${this.size}px`,height:`${this.size}px`,borderWidth:`${this.width}px`}}};(0,r.__decorate)([(0,o.fI)({type:Boolean,default:!1})],s.prototype,"inline",void 0),(0,r.__decorate)([(0,o.fI)({type:Number,default:120})],s.prototype,"size",void 0),(0,r.__decorate)([(0,o.fI)({type:Number,default:7})],s.prototype,"width",void 0),s=(0,r.__decorate)([(0,o.wA)({})],s);const c=s,l=c;var d=n(79917),p=(0,d.Z)(l,a,i,!1,null,"61eab46d",null);const u=p.exports},57888:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("div",{staticClass:"blurred-overlay",class:{fullscreen:e.fullscreen}},[e._t("default")],2):e._e()},i=[],r=n(59312),o=n(57102);let s=class extends o.w3{};(0,r.__decorate)([(0,o.fI)({type:Boolean,required:!0})],s.prototype,"show",void 0),(0,r.__decorate)([(0,o.fI)({required:!1,default:!1,type:Boolean})],s.prototype,"fullscreen",void 0),s=(0,r.__decorate)([(0,o.wA)({})],s);const c=s,l=c;var d=n(79917),p=(0,d.Z)(l,a,i,!1,null,"de732a60",null);const u=p.exports},35764:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var a=n(97660),i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"info-overlay"},[i("div",{staticClass:"info-overlay__content"},[i("div",{staticClass:"info-overlay__content__header"},[i("header-content",{attrs:{"disable-back-button":"","disable-info-button":""}})],1),i("div",{staticClass:"info-overlay__content__close-icon"},[i(a.Z,{attrs:{icon:""},on:{click:function(t){return e.closeOverlay()}}},[e._v("mdi-close")])],1),i("div",{staticClass:"info-overlay__content__image"},[i("img",{attrs:{src:n(8714)("./"+e.$route.meta.infoOverlay.headerImage)}})]),i("span",{staticClass:"info-overlay__content__title"},[e._v(e._s(e.$t(e.$route.meta.infoOverlay.header)))]),i("span",{staticClass:"info-overlay__content__body"},[e._v(e._s(e.$t(e.$route.meta.infoOverlay.body)))]),i("div",{staticClass:"info-overlay__content__button"},[i("action-button",{attrs:{enabled:"",text:e.$t("info-overlay.done")},on:{click:function(t){return e.closeOverlay()}}})],1)])])},r=[],o=n(59312),s=n(57102),c=n(80300),l=n(73249);let d=class extends s.w3{closeOverlay(){}};(0,o.__decorate)([(0,s.y1)()],d.prototype,"closeOverlay",null),d=(0,o.__decorate)([(0,s.wA)({components:{HeaderContent:l.Z,ActionButton:c.Z}})],d);const p=d,u=p;var m=n(79917),y=(0,m.Z)(u,i,r,!1,null,"21819c06",null);const f=y.exports},93840:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(98052),i=n.n(a),r=n(51908),o=n.n(r),s=n(26427),c=n(55679);class l{static truncate(e,t=12){if(!e)return"";const n="...";if(e.length<=t)return e;{const a=Math.floor(t/2);return e.substr(0,a)+n+e.substr(e.length-a)}}static decimals(e,t=3){return parseFloat(e).toFixed(t)}static upper(e){return e?e.toLocaleUpperCase():""}static displayFormat(e,t){const n=c.D.toUnits(e,null!==t&&void 0!==t?t:18),a=parseFloat(n);return 0===a?0===t?"0":"0.0":a<1e-6?"<0.000001":l.formatValue(n,t)}static formatValue(e,t){const[n,a]=o()(e,".");if(a&&a.length>6){const e=a.substring(0,6);return`≈${n}.${e}`}return 0===t?n:e}static capitalizeFirst(e){return i()(e)}static upperCase(e){return e.toUpperCase()}}l.toUnits=(e,t)=>c.D.toUnits(e,null!==t&&void 0!==t?t:18),l.formatDate=e=>`${new Intl.DateTimeFormat("en-US").format(e)} ${e.toLocaleTimeString("en-US")}`,s.ZP.filter("truncate",l.truncate),s.ZP.filter("decimals",l.decimals),s.ZP.filter("upper",l.upper),s.ZP.filter("displayFormat",l.displayFormat),s.ZP.filter("capitalizeFirst",l.capitalizeFirst),s.ZP.filter("upperCase",l.upperCase),s.ZP.filter("toUnits",l.toUnits),s.ZP.filter("formatDate",l.formatDate)},43257:(e,t,n)=>{"use strict";var a=n(91849);a.ZP.registerHooks(["beforeRouteEnter","beforeRouteLeave","beforeRouteUpdate"]);n(93840);a.ZP.registerHooks(["beforeRouteEnter","beforeRouteLeave","beforeRouteUpdate"]);var i=n(26427),r=n(82140),o=n.n(r);class s{constructor(){this.cache={}}getIdenticon(e){const t=this.cache[e];if(t)return t;{const t=o()(e);return this.cache[e]=t,t}}}function c(e,t){e.prototype.$identicon=new s}var l=n(68891),d=n(47595),p=n(13784),u=n.n(p),m=n(69238),y=n.n(m),f=n(78174),h=n.n(f),_=n(90104),g=n.n(_),b=n(56141),v=n.n(b),w=n(55807),T=n.n(w),k=n(34172),E=n.n(k),A=n(77382),N=n(81469),I=n(31034);const R=()=>({name:"",symbol:"",address:"",opening:0,open:0,closing:0,closed:0,settling:0,settled:0}),D={name:"",chainId:-1};var C;(function(e){e["DEPLOYMENT_INFO_PARSING_FAILED"]="deployment-info-parsing-failed",e["UNSUPPORTED_NETWORK"]="unsupported-network",e["SDK_INITIALIZATION_FAILED"]="sdk-initialization-failed",e["STATE_MIGRATION_FAILED"]="state-migration-failed"})(C||(C={}));var S=n(14498);function O(e,t){return t.id-e.id}const P={notifications:e=>Object.values(e.notifications).sort(O),notificationQueue:e=>Object.values(e.notifications).filter((e=>e.importance===S.N.HIGH&&!0===e.display)).sort(O)};var x=n(34498);function M(e){const t=Object.values(e).map((e=>e.id));return Math.max(...t,0)+1}const U={notificationDelete(e,t){const n={...e.notifications};delete n[t],e.notifications=n},notificationsViewed(e){e.newNotifications=!1},notificationAddOrReplace(e,t){var n,a,i,r,o,s;const{notifications:c}=e,l=Object.values(c).filter((({txHash:e})=>e&&e===t.txHash)),d=null!==(n=null===(a=l[0])||void 0===a?void 0:a.id)&&void 0!==n?n:M(c),p=null===(i=l[0])||void 0===i||!i.id,u={...t,id:d,received:new Date,display:p,context:null!==(r=t.context)&&void 0!==r?r:x.u.NONE,importance:null!==(o=t.importance)&&void 0!==o?o:S.N.LOW,duration:null!==(s=t.duration)&&void 0!==s?s:5e3};e.notifications={...c,[u.id]:u},e.newNotifications=!0},setNotificationShown(e,t){e.notifications[t].display=!1},clear(e){e.notifications=[]}},L=()=>({notifications:{},newNotifications:!1}),B=L(),F=B,W={namespaced:!0,mutations:U,state:F,getters:P},$={setTokenAddress(e,t){e.tokenAddress=t},setToken(e,t){e.token=t},setPlannedWithdrawal(e,t){e.plannedWithdrawal=t},clearPlannedWithdrawal(e){e.plannedWithdrawal=void 0}},V=()=>({tokenAddress:"",token:void 0,plannedWithdrawal:void 0}),H=V(),j=H,z={namespaced:!0,mutations:$,state:j},q={getEthereumProviderOptions:e=>t=>{var n;return null!==(n=e.ethereumProviderOptions[t])&&void 0!==n?n:{}}},K={enableRaidenAccount(e){e.useRaidenAccount=!0},disableRaidenAccount(e){e.useRaidenAccount=!1},saveEthereumProviderOptions(e,t){e.ethereumProviderOptions[t.providerName]=t.providerOptions}},Z=()=>({useRaidenAccount:!0,ethereumProviderOptions:{}}),G=Z(),Y=G,X={namespaced:!0,state:Y,getters:q,mutations:K};function Q(e=window.localStorage){const t=new N.Ew({key:"raiden_dapp_settings",storage:e,modules:["userSettings"]});return t.plugin}var J=n(13622);const ee="disclaimer";function te(e,t,n){return(0,J.Gu)(e)&&(0,J.Gu)(t)&&(0,J.qu)(e,t,n)}function ne(){return null===localStorage.getItem(ee)}const ae={correctVersionIsLoaded(e){if(ne()||e.updateInProgress)return!0;const{installedVersion:t,activeVersion:n}=e;return void 0===t?te(n,"2.0.1","<="):te(t,n,"=")},updateIsAvailable(e){return te(e.availableVersion,e.installedVersion,">")}},ie={setInstalledVersion(e,t){(0,J.Gu)(t)&&(e.installedVersion=t),e.updateInProgress=!1},setAvailableVersion(e,t){(0,J.Gu)(t)&&(e.availableVersion=t)},setUpdateIsMandatory(e){e.updateIsMandatory=!0},prepareUpdate(e){e.updateInProgress=!0}},re=()=>{var e;return{activeVersion:null!==(e="3.1.1")&&void 0!==e?e:"0.0.0",installedVersion:void 0,availableVersion:void 0,updateIsMandatory:!1,updateInProgress:!1}},oe=re(),se=oe,ce={namespaced:!0,state:se,getters:ae,mutations:ie};function le(e=window.localStorage){const t=new N.Ew({key:"raiden_dapp_versionInformation",storage:e,reducer:e=>({versionInformation:{installedVersion:e.versionInformation.installedVersion,updateInProgress:e.versionInformation.updateInProgress}}),filter:e=>["versionInformation/setInstalledVersion","versionInformation/prepareUpdate"].includes(e.type)});return t.plugin}i.ZP.use(A.ZP);const de={isConnected:!1,blockNumber:0,defaultAccount:"",accountBalance:"0.0",raidenAccountBalance:"",channels:{},tokens:{},transfers:{},presences:{},network:D,stateBackup:"",config:{},disclaimerAccepted:!1,stateBackupReminderDateMs:0,persistDisclaimerAcceptance:!1};function pe(){return u()(de)}const ue=(e,t)=>e.balance&&t.balance&&(!e.balance.isZero()||!t.balance.isZero()),me=new N.ZP({reducer:e=>({disclaimerAccepted:!!e.persistDisclaimerAcceptance&&e.disclaimerAccepted}),filter:e=>"acceptDisclaimer"===e.type,key:ee}),ye=new N.ZP({reducer:e=>({stateBackupReminderDateMs:e.stateBackupReminderDateMs}),filter:e=>"updateStateBackupReminderDate"===e.type,key:"backupReminder"}),fe={state:pe(),mutations:{setConnected(e){e.isConnected=!0},setDisconnected(e){e.isConnected=!1},account(e,t){e.defaultAccount=t},updateBlock(e,t){e.blockNumber=t},balance(e,t){e.accountBalance=t},raidenAccountBalance(e,t){e.raidenAccountBalance=t},updateChannels(e,t){e.channels=t},updateTokens(e,t){for(const[n,a]of Object.entries(t)){if(n in e.tokens&&v()(a,e.tokens[n]))continue;n in e.tokens?e.tokens[n]={...e.tokens[n],...a}:e.tokens={...e.tokens,[n]:a}}},updatePresence(e,t){e.presences={...e.presences,...t}},network(e,t){e.network=t},reset(e){const{disclaimerAccepted:t,stateBackup:n,stateBackupReminderDateMs:a}=e;Object.assign(e,{...pe(),disclaimerAccepted:t,stateBackup:n,stateBackupReminderDateMs:a})},updateTransfers(e,t){e.transfers={...e.transfers,[t.key]:t}},backupState(e,t){e.stateBackup=t},clearBackupState(e){e.stateBackup=""},updateConfig(e,t){e.config=t},acceptDisclaimer(e,t){e.disclaimerAccepted=!0,e.persistDisclaimerAcceptance=t},updateStateBackupReminderDate(e,t){e.stateBackupReminderDateMs=t}},actions:{},getters:{tokensWithChannels:function(e){const t={};for(const[n,a]of Object.entries(e.tokens))e.channels[n]&&(t[n]=a);return t},tokens:function(e){const t=(e,t)=>(e.address=t.token,e[t.state]+=1,e);return T()(y()(h()(e.channels),(e=>!g()(e))),(n=>{const a=E()(n,t,R()),i=e.tokens[a.address];return i&&(a.name=i.name||"",a.symbol=i.symbol||""),a}))},allTokens:e=>Object.values(e.tokens).sort(((e,t)=>ue(e,t)?t.balance.gt(e.balance)?1:-1:e.symbol&&t.symbol?e.symbol.localeCompare(t.symbol):0)),channels:e=>t=>{let n=[];const a=e.channels[t];return a&&!g()(a)&&(n=h()(a)),n},openChannels:e=>Object.keys(e.channels).length>0,token:e=>t=>t in e.tokens?e.tokens[t]:null,network:e=>(0,I.pp)(e.network),mainnet:e=>1===e.network.chainId,channelWithBiggestCapacity:(e,t)=>e=>{const n=t.channels(e),a=n.filter((e=>e.state===I.Dz.open)),i=a.sort(((e,t)=>{const n=e.capacity.sub(t.capacity);return n.lt(0)?1:n.gt(0)?-1:0}));return i[0]},pendingTransfers:({transfers:e})=>Object.keys(e).filter((t=>{const{completed:n}=e[t];return!n})).reduce(((t,n)=>(t[n]=e[n],t)),{}),transfer:e=>t=>Object.values(e.transfers).find((e=>e.paymentId.eq(t)))},plugins:[Q(),me.plugin,ye.plugin,le()],modules:{notifications:W,userDepositContract:z,userSettings:X,versionInformation:ce}},he=new A.ZP.Store(fe);var _e=n(91110);function ge(e,t,a){null===t.name?a({name:_e.n.HOME}):e.matched.length&&(e.matched[0].components.default=t.matched[0].components.default,e.matched[0].components.modal=()=>n.e(967).then(n.bind(n,31967))),a()}const be=[_e.n.ACCOUNT_ROOT,_e.n.ACCOUNT_BACKUP,_e.n.ACCOUNT_SETTINGS],ve=(e,t)=>{var n;const{isConnected:a}=t.state,i=be.includes(null!==(n=e.name)&&void 0!==n?n:""),r=e.name===_e.n.HOME;if(!i)return a||r?!a&&r?null:a&&r?{name:_e.n.TRANSFER}:void 0:{name:_e.n.HOME,query:{redirectTo:e.fullPath}}},we=(e,t)=>{const{disclaimerAccepted:n}=t.state,a=e.name===_e.n.DISCLAIMER;return n||a?!n&&a?null:n&&a?{name:_e.n.HOME}:void 0:{name:_e.n.DISCLAIMER,query:{redirectTo:e.fullPath}}};function Te(e,t,n){for(const a of this.children){const t=a(e,this.store);if(null===t)return void n();if(void 0!==t)return void n(t)}n({})}const ke=[_e.n.ACCOUNT_ROOT,_e.n.ACCOUNT_BACKUP,_e.n.ACCOUNT_RAIDEN,_e.n.ACCOUNT_SETTINGS,_e.n.ACCOUNT_WITHDRAWAL,_e.n.ACCOUNT_UDC],Ee=[_e.n.SELECT_TOKEN,_e.n.SELECT_HUB,_e.n.OPEN_CHANNEL],Ae=(e,t)=>{var n,a;const{tokensWithChannels:i}=t.getters,r=0===Object.keys(i).length,o=e.name===_e.n.NO_CONNECTED_TOKEN,s=e.name===_e.n.QUICK_PAY,c=ke.includes(null!==(n=e.name)&&void 0!==n?n:""),l=Ee.includes(null!==(a=e.name)&&void 0!==a?a:"");if(!c&&!s)return l?null:r&&!o?{name:_e.n.NO_CONNECTED_TOKEN}:r&&o?null:!r&&o?{name:_e.n.TRANSFER}:void 0};function Ne(e,t,a){null===t.name?a({name:_e.n.HOME}):e.matched.length&&(e.matched[0].components.default=t.matched[0].components.default,e.matched[0].components.notifications=()=>Promise.all([n.e(560),n.e(781)]).then(n.bind(n,51743))),a()}var Ie=n(15638),Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"disclaimer",attrs:{"data-cy":"disclaimer"}},[n("div",{staticClass:"disclaimer__content"},[n("div",{staticClass:"disclaimer__content__text"},[n("span",{staticClass:"disclaimer__content__text__header"},[e._v(" "+e._s(e.$t("disclaimer.user-info.header"))+" ")]),n("span",{staticClass:"disclaimer__content__text__body"},[e._v(e._s(e.$t("disclaimer.user-info.body")))]),n("div",e._l(e.$t("disclaimer.user-info.bullet-points"),(function(t,a){return n("ul",{key:a,staticClass:"disclaimer__content__text__bullet-points"},[n("li",[e._v(" "+e._s(t.text)+" "),n("a",{attrs:{href:e.disclaimerUrlMappings[a],target:"_blank"}},[e._v(" "+e._s(t.link)+" ")])])])})),0),e.imprint&&e.terms?n("span",{staticClass:"disclaimer__content__text__header, imprint_terms_header"},[e._v(" "+e._s(e.$t("disclaimer.terms.header"))+" ")]):e._e(),e.imprint&&e.terms?n("i18n",{staticClass:"disclaimer__content__text__imprint-terms-body",attrs:{path:"disclaimer.terms.body",tag:"span"}},[n("a",{attrs:{href:e.terms,target:"_blank"}},[e._v(" "+e._s(e.$t("disclaimer.terms.link-name-terms"))+" ")]),n("a",{attrs:{href:e.imprint,target:"_blank"}},[e._v(" "+e._s(e.$t("disclaimer.terms.link-name-policy"))+" ")])]):e._e(),n("span",{staticClass:"disclaimer__content__text__header"},[e._v(" "+e._s(e.$t("disclaimer.disclaimer.header"))+" ")]),n("span",{staticClass:"disclaimer__content__text__body"},[e._v(e._s(e.$t("disclaimer.disclaimer.body")))]),n("span",{staticClass:"disclaimer__content__text__header"},[e._v(" "+e._s(e.$t("disclaimer.privacy.header"))+" ")]),e._l(e.$t("disclaimer.privacy.body"),(function(t,a){return n("div",{key:a,staticClass:"disclaimer__content__text__body"},[n("span",[e._v(e._s(t))])])}))],2),n(Ie.Z,{staticClass:"disclaimer__content__accept-checkbox",attrs:{"data-cy":"disclaimer_accept_checkbox",label:e.$t("disclaimer.accept-checkbox"),dense:"","hide-details":""},model:{value:e.checkedAccept,callback:function(t){e.checkedAccept=t},expression:"checkedAccept"}}),n(Ie.Z,{staticClass:"disclaimer__content__persist-checkbox",attrs:{"data-cy":"disclaimer_persist_checkbox",label:e.$t("disclaimer.persist-checkbox"),dense:"","hide-details":""},model:{value:e.checkedPersist,callback:function(t){e.checkedPersist=t},expression:"checkedPersist"}})],1),n("action-button",{staticClass:"disclaimer__accept-button",attrs:{text:e.$t("disclaimer.accept-button"),"data-cy":"disclaimer_accept_button",enabled:e.checkedAccept,"full-width":"",sticky:""},on:{click:e.accept}})],1)},De=[],Ce=n(59312),Se=n(57102),Oe=n(80300);let Pe=class extends Se.w3{constructor(){super(...arguments),this.checkedAccept=!1,this.checkedPersist=!1,this.disclaimerUrlMappings={portal:"https://developer.raiden.network",docs:"https://docs.raiden.network",videos:"https://www.youtube.com/channel/UCoUP_hnjUddEvbxmtNCcApg",medium:"https://medium.com/@raiden_network"}}get imprint(){return"https://raiden.network/privacy.html"}get terms(){return"https://github.com/raiden-network/light-client/blob/master/TERMS.md"}get navigationTarget(){const e=this.$route.query.redirectTo;return e?{path:e}:{name:_e.n.HOME}}accept(){this.$store.commit("acceptDisclaimer",this.checkedPersist),this.$router.push(this.navigationTarget)}};Pe=(0,Ce.__decorate)([(0,Se.wA)({components:{ActionButton:Oe.Z}})],Pe);const xe=Pe,Me=xe;var Ue=n(79917),Le=(0,Ue.Z)(Me,Re,De,!1,null,"37e09807",null);const Be=Le.exports;var Fe=n(28508),We=n(55429),$e=n(53892),Ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home",attrs:{fluid:"","data-cy":"home"}},[a($e.Z,{attrs:{"no-gutters":""}},[a(Fe.Z,{attrs:{cols:"12"}},[a("div",{staticClass:"home__logo-container"},[a(We.Z,{staticClass:"home__logo-container__logo",attrs:{src:n(69574),"aspect-ratio":"1",contain:""}})],1)])],1),a($e.Z,{attrs:{"no-gutters":""}},[a(Fe.Z,{attrs:{cols:"12"}},[a("div",{staticClass:"home__app-welcome text-center"},[e._v(" "+e._s(e.$t("home.welcome"))+" ")])])],1),a($e.Z,{attrs:{"no-gutters":""}},[a(Fe.Z,{attrs:{cols:"12"}},[a("div",{staticClass:"home__disclaimer text-center font-weight-light"},[e._v(" "+e._s(e.$t("home.disclaimer"))+" ")]),a("i18n",{staticClass:"home__getting-started text-center font-weight-light",attrs:{path:"home.getting-started.description",tag:"div"}},[a("a",{attrs:{href:"https://github.com/raiden-network/light-client#try-out-the-raiden-dapp",target:"_blank"}},[e._v(" "+e._s(e.$t("home.getting-started.link-name"))+" ")])])],1)],1),a($e.Z,{attrs:{"no-gutters":""}},[a(Fe.Z,{staticClass:"mt-10",attrs:{cols:"12"}},[a("connection-manager")],1)],1)],1)},He=[],je=n(42664),ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"connection-manager"},[n(je.Z,{staticClass:"connection-manager__error-message font-weight-light",class:{"connection-manager__error-message--hidden":!e.errorCode},attrs:{color:"error",icon:"warning"}},[e._v(" "+e._s(e.translatedErrorCode)+" ")]),e.showProviderButtons?[e._l(e.providerList,(function(t,a){return[e.isProviderDisabled(a)?e._e():n("action-button",{key:"button_"+a,staticClass:"connection-manager__provider-dialog-button",attrs:{"data-cy":"connection-manager__provider-dialog-button__"+a,enabled:t.factory.isAvailable,text:e.$t(t.buttonText),width:"280px"},on:{click:function(t){return e.openProviderDialog(a)}}})]}))]:e._e(),e._l(e.providerList,(function(t,a){return[e.isProviderDialogVisible(a)?n(t.dialogComponent,{key:"dialog_"+a,tag:"component",on:{linkEstablished:e.onProviderLinkEstablished,cancel:function(t){return e.closeProviderDialog(a)}}}):e._e()]})),e.inProgress?[n("connection-pending-dialog",{on:{"reset-connection":e.resetConnection}})]:e._e()],2)},qe=[],Ke=n(23399),Ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("raiden-dialog",{attrs:{visible:!0,"hide-close":!0}},[n(Ke.EB,[e._v(" "+e._s(e.$t("connection-manager.dialogs.connection-pending.title"))+" ")]),n(Ke.ZB,[n("spinner"),e._v(" "+e._s(e.$t("connection-manager.dialogs.connection-pending.text"))+" ")],1),n(Ke.h7,[n("action-button",{attrs:{text:e.$t("connection-manager.dialogs.connection-pending.button"),enabled:!0},on:{click:e.resetConnection}})],1)],1)},Ge=[],Ye=n(7648),Xe=n(54928);let Qe=class extends Se.w3{resetConnection(){}};(0,Ce.__decorate)([(0,Se.y1)("reset-connection")],Qe.prototype,"resetConnection",null),Qe=(0,Ce.__decorate)([(0,Se.wA)({components:{ActionButton:Oe.Z,RaidenDialog:Ye.Z,Spinner:Xe.Z}})],Qe);const Je=Qe,et=Je;var tt=(0,Ue.Z)(et,Ze,Ge,!1,null,null,null);const nt=tt.exports;var at=n(90768),it=n(77801);function rt(e){return e instanceof at.Q?C.DEPLOYMENT_INFO_PARSING_FAILED:e.message&&e.message.includes("No deploy info provided")?C.UNSUPPORTED_NETWORK:e.message&&e.message.includes("Could not replace stored state")?C.STATE_MIGRATION_FAILED:C.SDK_INITIALIZATION_FAILED}const{mapState:ot}=(0,A._p)("userSettings"),st={[it.Ec.providerName]:{factory:it.Ec,buttonText:"connection-manager.dialogs.injected-provider.header",dialogComponent:()=>n.e(368).then(n.bind(n,82368))},[it.AX.providerName]:{factory:it.AX,buttonText:"connection-manager.dialogs.wallet-connect-provider.header",dialogComponent:()=>n.e(786).then(n.bind(n,37786))},[it.WG.providerName]:{factory:it.WG,buttonText:"connection-manager.dialogs.direct-rpc-provider.header",dialogComponent:()=>n.e(719).then(n.bind(n,34719))}};let ct=class extends Se.w3{constructor(){super(...arguments),this.inProgress=!1,this.errorCode=null,this.providerList=st,this.providerDialogOpenState=Object.fromEntries(Object.keys(this.providerList).map((e=>[e,!1]))),this.providerDisabledState=Object.fromEntries(Object.keys(this.providerList).map((e=>[e,!0])))}get showProviderButtons(){return!this.isConnected&&!this.inProgress}get translatedErrorCode(){if(this.errorCode){const e=`error-codes.${this.errorCode.toString()}`;return this.$t(e)}return""}isProviderDisabled(e){var t;return null===(t=this.providerDisabledState[e])||void 0===t||t}isProviderDialogVisible(e){var t;return null!==(t=this.providerDialogOpenState[e])&&void 0!==t&&t}openProviderDialog(e){this.providerDialogOpenState[e]=!0}closeProviderDialog(e){this.providerDialogOpenState[e]=!1}created(){this.checkForDisabledProviders()}async checkForDisabledProviders(){for(const[e,t]of Object.entries(this.providerList))t.factory.isDisabled().then((t=>{this.providerDisabledState[e]=t}))}closeAllProviderDialogs(){this.providerDialogOpenState=Object.fromEntries(Object.keys(this.providerDialogOpenState).map((e=>[e,!1])))}async onProviderLinkEstablished(e){this.closeAllProviderDialogs(),await this.connect(e)}async connect(e){if(this.isConnected||this.inProgress)throw new Error("Can only connect once!");this.inProgress=!0,this.errorCode=null,this.$store.commit("reset");const t=await at.i.configuration(),n=!!this.useRaidenAccount||void 0,a=await e.provider.getNetwork();a.chainId;try{await this.$raiden.connect(e.provider,e.account,this.stateBackup,t.per_network,n)}catch(i){return this.errorCode=rt(i),void(this.inProgress=!1)}this.$store.commit("setConnected"),this.$store.commit("clearBackupState")}resetConnection(){localStorage.removeItem("walletconnect"),window.location.replace(window.location.origin)}};ct=(0,Ce.__decorate)([(0,Se.wA)({computed:{...(0,A.rn)(["isConnected","stateBackup"]),...ot(["useRaidenAccount"])},components:{ActionButton:Oe.Z,ConnectionPendingDialog:nt}})],ct);const lt=ct,dt=lt;var pt=(0,Ue.Z)(dt,ze,qe,!1,null,"7294558e",null);const ut=pt.exports;let mt=class extends Se.w3{get navigationTarget(){const e=this.$route.query.redirectTo;return e?{path:e}:{name:_e.n.TRANSFER}}onConnectionEstablished(e){e&&this.$router.push(this.navigationTarget)}};(0,Ce.__decorate)([(0,Se.RL)("isConnected",{immediate:!0})],mt.prototype,"onConnectionEstablished",null),mt=(0,Ce.__decorate)([(0,Se.wA)({computed:{...(0,A.rn)(["isConnected"])},components:{ConnectionManager:ut}})],mt);const yt=mt,ft=yt;var ht=(0,Ue.Z)(ft,Ve,He,!1,null,"11491f22",null);const _t=ht.exports,gt=[{path:"/",name:_e.n.DISCLAIMER,meta:{title:"Disclaimer",cannotNavigateBack:!0},component:Be},{path:"*",redirect:"/"},{path:"/home",name:_e.n.HOME,meta:{title:"Raiden dApp",cannotNavigateBack:!0},component:_t},{path:"/no_connected_token",name:_e.n.NO_CONNECTED_TOKEN,meta:{title:"Connect",cannotNavigateBack:!0},component:()=>n.e(42).then(n.bind(n,79042))},{path:"/transfer/:token?",name:_e.n.TRANSFER,meta:{title:"Transfer",cannotNavigateBack:!0,infoOverlay:{headerImage:"transfer_info.svg",header:"info-overlay.transfer.header",body:"info-overlay.transfer.body"}},component:()=>Promise.all([n.e(560),n.e(336),n.e(950),n.e(865),n.e(870),n.e(826),n.e(957)]).then(n.bind(n,28889))},{path:"/transfer/:token/:target",name:_e.n.TRANSFER_STEPS,meta:{title:"Transfer",infoOverlay:{headerImage:"transfer_steps_info.svg",header:"info-overlay.transfer-steps.header",body:"info-overlay.transfer-steps.body"}},component:()=>Promise.all([n.e(560),n.e(336),n.e(950),n.e(826),n.e(678)]).then(n.bind(n,41678))},{path:"/quick_pay",name:_e.n.QUICK_PAY,meta:{title:"Quick Pay",cannotNavigateBack:!0},component:()=>Promise.all([n.e(560),n.e(336),n.e(865),n.e(870),n.e(672)]).then(n.bind(n,6846))},{path:"/connect",name:_e.n.SELECT_TOKEN,meta:{title:"Select Token"},component:()=>Promise.all([n.e(560),n.e(950),n.e(132)]).then(n.bind(n,64407))},{path:"/connect/:token",name:_e.n.SELECT_HUB,meta:{title:"Select Hub",infoOverlay:{headerImage:"select_hub_info.svg",header:"info-overlay.select-hub.header",body:"info-overlay.select-hub.body"}},component:()=>Promise.all([n.e(560),n.e(336),n.e(865),n.e(56)]).then(n.bind(n,60333))},{path:"/connect/:token/:partner",name:_e.n.OPEN_CHANNEL,meta:{title:"Open Channel",infoOverlay:{headerImage:"open_channel_info.svg",header:"info-overlay.open-channel.header",body:"info-overlay.open-channel.body"}},component:()=>Promise.all([n.e(560),n.e(336),n.e(865),n.e(870),n.e(43)]).then(n.bind(n,25378))},{path:"/channels/:token",name:_e.n.CHANNELS,meta:{title:"Channels",infoOverlay:{headerImage:"channels_info.svg",header:"info-overlay.channels.header",body:"info-overlay.channels.body"}},component:()=>Promise.all([n.e(560),n.e(336),n.e(950),n.e(865),n.e(870),n.e(768)]).then(n.bind(n,66461))},{path:"/notifications",name:_e.n.NOTIFICATIONS,beforeEnter:Ne},{path:"/account",beforeEnter:ge,children:[{path:"/",name:_e.n.ACCOUNT_ROOT,meta:{title:"Account"},component:()=>Promise.all([n.e(560),n.e(950),n.e(122)]).then(n.bind(n,15165))},{path:"backup",name:_e.n.ACCOUNT_BACKUP,meta:{title:"Backup State",infoOverlay:{headerImage:"backup_state_info.svg",header:"info-overlay.account-backup.header",body:"info-overlay.account-backup.body"}},component:()=>Promise.all([n.e(950),n.e(256)]).then(n.bind(n,37718))},{path:"raiden",name:_e.n.ACCOUNT_RAIDEN,meta:{title:"Raiden Account",infoOverlay:{headerImage:"transfer_eth_info.svg",header:"info-overlay.account-raiden.header",body:"info-overlay.account-raiden.body"}},component:()=>Promise.all([n.e(336),n.e(194)]).then(n.bind(n,23194))},{path:"settings",name:_e.n.ACCOUNT_SETTINGS,meta:{title:"Settings"},component:()=>Promise.all([n.e(950),n.e(945)]).then(n.bind(n,67717))},{path:"withdrawal",name:_e.n.ACCOUNT_WITHDRAWAL,meta:{title:"Withdrawal",infoOverlay:{headerImage:"withdraw_tokens_info.svg",header:"info-overlay.account-withdrawal.header",body:"info-overlay.account-withdrawal.body"}},component:()=>Promise.all([n.e(560),n.e(950),n.e(904)]).then(n.bind(n,37613))},{path:"udc",name:_e.n.ACCOUNT_UDC,meta:{title:"UDC",infoOverlay:{headerImage:"udc_info.svg",header:"info-overlay.account-udc.header",body:"info-overlay.account-udc.body"}},component:()=>Promise.all([n.e(336),n.e(467)]).then(n.bind(n,48467))}]}];function bt(e){const t=(0,l.parse)(window.location.search),n=(0,l.parse)(e);return{...t,...n}}i.ZP.use(d.Z);const vt=new d.Z({base:"/",mode:"hash",parseQuery:bt,routes:gt});vt.beforeEach(Te.bind({store:he,children:[we,ve,Ae]}));const wt=vt;var Tt=n(35763),kt=n(43535),Et=n(96883),At=n(16621),Nt=n(79682),It=n(16970);function Rt(){const e=n(3631),t={};return e.keys().forEach((n=>{const a=n.match(/([A-Za-z0-9-_]+)\./i);if(a&&a.length>1){const i=a[1];t[i]=e(n)}})),t}i.ZP.use(It.Z);const Dt=new It.Z({locale:"en",fallbackLocale:"en",messages:Rt()});var Ct=n(55679);function St(e){return void 0===e?Dt.t("notifications.tx-state-pending"):e?Dt.t("notifications.tx-state-confirmed"):""}class Ot{constructor(e,t){this._userDepositTokenAddress="",this.disconnect=async()=>{await this.raiden.stop(),window.onbeforeunload=null},this.getAccount=()=>this.raiden.address,this.getMainAccount=()=>this.raiden.mainAddress,this._raiden=void 0,this.store=e,this.router=t}static async createRaiden(e,t=0,a,i){let r={state:a};if("cordova-sqlite"==={VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_DB_ADAPTER){const{default:e}=await n.e(501).then(n.t.bind(n,13501,23));Et.Z.plugin(e);const t=Tt.dV.getPlatform();"android"===t?r={...r,adapter:"cordova-sqlite",location:"default"}:"ios"===t&&(r={...r,adapter:"cordova-sqlite",iosDatabaseLocation:"Library"})}const o=await at.i.contracts();try{var s;return await I.Nt.create(e,t,r,null!==(s={VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_UDC_ADDRESS)&&void 0!==s?s:o,{pfsSafetyMargin:1.1,...{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_PFS?{pfsMode:I.h6.onlyAdditional,additionalServices:[{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_PFS]}:{},matrixServer:{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_MATRIX_SERVER,matrixServerLookup:{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_MATRIX_LIST_URL,...{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_REVEAL_TIMEOUT&&+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_REVEAL_TIMEOUT?{revealTimeout:+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_REVEAL_TIMEOUT}:void 0,...{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_CONFIRMATION_BLOCKS&&+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_CONFIRMATION_BLOCKS?{confirmationBlocks:+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_CONFIRMATION_BLOCKS}:void 0,...{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_EXPIRY_FACTOR&&+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_EXPIRY_FACTOR?{expiryFactor:+{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_EXPIRY_FACTOR}:void 0},i,{VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"}.VUE_APP_SUBKEY_ORIGIN_URL)}catch(c){throw new xt(c.message)}}get raiden(){if(void 0===this._raiden)throw new Error("Raiden instance was not initialized");return this._raiden}async updateBalances(){this.store.commit("balance",await this.getBalance()),this.store.commit("raidenAccountBalance",await this.getBalance(this.raiden.address))}async fetchTokenList(){const e=await this.raiden.getTokenList(),t=[],n={};for(const a of e)t.push(a),n[a]={address:a};this.store.commit("updateTokens",n),await this.fetchAndUpdateTokenData(t)}get monitoringReward(){return this.raiden.config.monitoringReward}async ensResolve(e){try{return await this.raiden.resolveName(e)}catch(t){throw new Pt(t.message)}}async connect(e,t,n,a={},i){const r=await Ot.createRaiden(e,t,n,i);this._raiden=r,this.usingSubkey=null!==i&&void 0!==i&&i;const o=this.getAccount();this.store.commit("account",o),this._userDepositTokenAddress=await r.userDepositTokenAddress(),this.store.commit("userDepositContract/setTokenAddress",this._userDepositTokenAddress),await this.monitorPreSetTokens(a),r.events$.subscribe((e=>{"block/new"===e.type&&this.store.commit("updateBlock",e.payload.blockNumber)})),r.events$.pipe((0,At.h)((e=>"block/new"===e.type)),(0,Nt.z)((()=>this.updateUserDepositContractToken()))).subscribe(),r.events$.pipe((0,At.h)((e=>"raiden/shutdown"===e.type))).subscribe((()=>{this.store.commit("reset"),this.router.push({name:_e.n.HOME})})),r.config$.subscribe((async e=>{var t;this.store.commit("updateConfig",e),null!==(t=e.caps)&&void 0!==t&&t[I.Wi.RECEIVE]||await this.notifyNoReceive()})),r.events$.subscribe((async e=>{if("token/monitored"===e.type)this.store.commit("updateTokens",{[e.payload.token]:{address:e.payload.token}}),this.fetchAndUpdateTokenData([e.payload.token]);else if("matrix/presence/success"===e.type)this.store.commit("updatePresence",{[e.meta.address]:e.payload.available});else if("ms/balanceProof/sent"===e.type){if(!e.payload.confirmed)return;await this.notifyBalanceProofSend(e.payload.monitoringService,e.payload.partner,e.payload.reward,e.payload.txHash)}else if("udc/withdraw/success"===e.type){if(!e.payload.confirmed)return;await this.notifyWithdrawal(e.meta.amount,e.payload.withdrawal)}else"udc/withdraw/plan/failure"===e.type?await this.notifyWithdrawalFailure(e.payload.code,e.meta.amount,e.payload.message):"channel/settle/success"===e.type?e.payload.confirmed&&await this.notifyChannelSettleSuccess(e.meta.partner):"channel/settle/failure"===e.type?await this.notifyChannelSettleFailure(e.meta.partner):"channel/open/success"===e.type?await this.notifyChannelOpenSuccess(e.payload.txBlock,e.payload.txHash,e.payload.confirmed,e.meta.partner):"channel/open/failure"===e.type&&await this.notifyChannelOpenFailed(e.payload.message)})),r.events$.subscribe((e=>{this.updatePlannedUserDepositWithdrawals(e)})),r.channels$.subscribe((e=>{this.store.commit("updateChannels",e)})),r.transfers$.subscribe((e=>{this.store.commit("updateTransfers",e)})),this.store.commit("network",r.network),window.onbeforeunload=e=>(e.preventDefault(),""),await r.start(),this.store.commit("balance",await this.getBalance()),i&&this.store.commit("raidenAccountBalance",await this.getBalance(r.address))}async notifyNoReceive(){this.store.commit("notifications/notificationAddOrReplace",{icon:Dt.t("notifications.no-receive.icon"),title:Dt.t("notifications.no-receive.title"),description:Dt.t("notifications.no-receive.description"),importance:S.N.HIGH,context:x.u.WARNING})}async monitorPreSetTokens(e){var t,n;const{chainId:a}=this.raiden.network,i=null!==(t=null===(n=e[a])||void 0===n?void 0:n.monitored)&&void 0!==t?t:[];for(const r of i)await this.raiden.monitorToken(r)}async notifyWithdrawalFailure(e,t,n){var a;if(["UDC_PLAN_WITHDRAW_GT_ZERO","UDC_PLAN_WITHDRAW_EXCEEDS_AVAILABLE","UDC_PLAN_WITHDRAW_FAILED"].indexOf(e)>=0)return;const i=this.store.state.userDepositContract.token,r=null!==(a=i.decimals)&&void 0!==a?a:18,o=Ct.D.toUnits(t,r),s="string"===typeof e?Dt.t(`notifications.withdrawal.failure.descriptions.${e}`,{amount:o,symbol:i.symbol}):void 0,c=s||Dt.t("notifications.withdrawal.failure.description",{amount:o,symbol:i.symbol,message:n});this.store.commit("notifications/notificationAddOrReplace",{title:Dt.t("notifications.withdrawal.failure.title"),description:c,context:x.u.ERROR,importance:S.N.HIGH})}async notifyWithdrawal(e,t){var n;const a=this.store.state.userDepositContract.token,i=null!==(n=a.decimals)&&void 0!==n?n:18,r=Ct.D.toUnits(e,i),o=Ct.D.toUnits(t,i);let s={icon:Dt.t("notifications.withdrawn.icon"),title:Dt.t("notifications.withdrawn.title"),description:Dt.t("notifications.withdrawn.description",{plannedAmount:r,withdrawnAmount:o,symbol:a.symbol}),context:x.u.INFO,importance:S.N.HIGH};this.usingSubkey&&(s={...s,link:Dt.t("notifications.withdrawn.link"),dappRoute:_e.n.ACCOUNT_WITHDRAWAL}),this.store.commit("notifications/notificationAddOrReplace",s)}async notifyBalanceProofSend(e,t,n,a){var i;const r=this.store.state.userDepositContract.token,o=null!==(i=r.decimals)&&void 0!==i?i:18,s=Ct.D.toUnits(n,o);this.store.commit("notifications/notificationAddOrReplace",{title:Dt.t("notifications.ms-balance-proof.title"),description:Dt.t("notifications.ms-balance-proof.description",{monitoringService:e,partner:t,reward:s,symbol:r.symbol,txHash:a}),context:x.u.INFO,importance:S.N.HIGH})}async notifyChannelSettleSuccess(e){const t=Dt.t("notifications.settlement.success.description",{partner:e});this.store.commit("notifications/notificationAddOrReplace",{title:Dt.t("notifications.settlement.success.title"),description:t,icon:Dt.t("notifications.settlement.icon"),context:x.u.NONE,importance:S.N.HIGH})}async notifyChannelSettleFailure(e){this.store.commit("notifications/notificationAddOrReplace",{title:Dt.t("notifications.settlement.failure.title"),description:Dt.t("notifications.settlement.failure.description",{partner:e}),icon:Dt.t("notifications.settlement.icon"),context:x.u.NONE,importance:S.N.HIGH})}async notifyChannelOpenSuccess(e,t,n,a){var i,r;const o=null!==(i=null===(r=this.store.state.config)||void 0===r?void 0:r.confirmationBlocks)&&void 0!==i?i:0,s=e+o,c=Dt.t("notifications.channel-open.icon");let l="",d="";if(void 0===n||!0===n){l=Dt.t("notifications.channel-open.success.title");const e=St(n);d=Dt.t("notifications.channel-open.success.description",{partner:a,state:e})}else{const e=Dt.t("notifications.tx-reorged-failure-reason");l=Dt.t("notifications.channel-open.failure.title"),d=Dt.t("notifications.channel-open.failure.description",{reason:e})}const p={title:l,description:d,icon:c,txHash:t,txConfirmationBlock:s,importance:S.N.HIGH};this.store.commit("notifications/notificationAddOrReplace",p)}async notifyChannelOpenFailed(e){this.store.commit("notifications/notificationAddOrReplace",{title:Dt.t("notifications.channel-open.failure.title"),description:Dt.t("notifications.channel-open.failure.description",{reason:e}),icon:Dt.t("notifications.channel-open.icon"),importance:S.N.HIGH})}async updatePlannedUserDepositWithdrawals(e){"udc/withdraw/plan/success"===e.type?!1===e.payload.confirmed?this.store.commit("userDepositContract/clearPlannedWithdrawal"):this.store.commit("userDepositContract/setPlannedWithdrawal",{txHash:e.payload.txHash,txBlock:e.payload.txBlock,amount:e.meta.amount,withdrawableAfter:e.payload.withdrawableAfter,confirmed:e.payload.confirmed}):"udc/withdraw/success"===e.type&&e.payload.confirmed&&this.store.commit("userDepositContract/clearPlannedWithdrawal")}async getBalance(e){const t=await this.raiden.getBalance(e);return Ct.D.toEth(t)}async getToken(e){const t=this.raiden;try{const[n,{decimals:a,symbol:i,name:r}]=await Promise.all([t.getTokenBalance(e),t.getTokenInfo(e)]);return{name:r,symbol:i,balance:n,decimals:a,address:e}}catch(n){return null}}async openChannel(e,t,n,a){await this.raiden.openChannel(e,t,{deposit:n},a)}async closeChannel(e,t){await this.raiden.closeChannel(e,t)}async deposit(e,t,n){await this.raiden.depositChannel(e,t,n)}async withdraw(e,t,n){await this.raiden.withdrawChannel(e,t,n)}async settleChannel(e,t){await this.raiden.settleChannel(e,t)}async updateUserDepositContractToken(){const e=await this.getToken(this._userDepositTokenAddress);this.store.commit("userDepositContract/setToken",e)}async fetchAndUpdateTokenData(e=Object.values(this.store.state.tokens).map((e=>e.address))){await Promise.all(e.map((async e=>{const t=await this.getToken(e);t&&this.store.commit("updateTokens",{[e]:t})})))}async transfer(e,t,n,a,i){const r=await this.raiden.transfer(e,t,n,{paymentId:a,paths:i});await this.raiden.waitTransfer(r)}async findRoutes(e,t,n,a){return await this.raiden.findRoutes(e,t,n,{pfs:a})}async fetchServices(){return await this.raiden.findPFS()}async directRoute(e,t,n){return await this.raiden.directRoute(e,t,n)}async mint(e,t){return await this.raiden.mint(e,t)}async depositToUDC(e,t){await this.raiden.depositToUDC(e,(e=>e.type===I.GM.APPROVED?t():null))}async planUDCWithdraw(e){return this.raiden.planUDCWithdraw(e)}async getUDCCapacity(){return this.raiden.getUDCCapacity()}async getAvailability(e){try{const{available:t}=await this.raiden.getAvailability(e);return t}catch(t){this.store.commit("updatePresence",{[e]:!1})}return!1}async*getDatabaseDump(){yield*this._raiden.dumpDatabase()}async transferToRaidenAccount(e){await this.raiden.transferOnchainBalance(this.raiden.address,kt.fi(e)),await this.updateBalances()}async transferToMainAccount(e){const{mainAddress:t}=this.raiden;t&&(await this.raiden.transferOnchainBalance(t,kt.fi(e),{subkey:!0}),await this.updateBalances())}async transferOnChainTokens(e,t){const n=this.raiden.mainAddress;n&&await this.raiden.transferOnchainTokens(e,n,t,{subkey:!0})}async getRaidenAccountBalances(){const e=this.raiden;if(!e.mainAddress)return[];const t=await e.getTokenList(),n={};await Promise.all(t.map((async t=>{const a=await e.getTokenBalance(t,e.address);null!==a&&void 0!==a&&a.gt(0)&&(n[t]={address:t,balance:a})})));const a={};Object.keys(n).forEach((e=>{const t=this.store.state.tokens[e];t&&(a[e]={...t,...n[e]},delete n[e])}));const i=Object.keys(n);return await Promise.all(i.map((async t=>{const i=await e.getTokenInfo(t);a[t]={...i,...n[t]}}))),Object.values(a)}async monitorToken(e){await this.raiden.monitorToken(e)}async getTokenBalance(e,t){const n=await this.raiden.getTokenBalance(e,t);return n}async getSuggestedPartners(e){return await this.raiden.suggestPartners(e)}}class Pt extends Error{}class xt extends Error{}function Mt(e,t){e.prototype.$raiden=new Ot(he,wt)}var Ut,Lt,Bt=n(67425),Ft=n.n(Bt);(function(e){e["INSTALLED_VERSION"]="installed_version",e["INSTALLATION_ERROR"]="installation_error",e["RELOAD_WINDOW"]="reload_window",e["CACHE_IS_INVALID"]="cache_is_invalid",e["UPDATE"]="update",e["VERIFY_CACHE"]="verify_cache",e["UNKNOWN"]="unknown"})(Ut||(Ut={}));class Wt{encode(){return{type:this.type,...this.payload}}encodeOldFormat(){return this.type}}class $t extends Wt{constructor(e,t={}){super(),this.type=e,this.payload=t}}class Vt extends Wt{constructor(e){super(),this.event=e}get isInOldFormat(){return this.event.data&&"string"===typeof this.event.data}get isInNewFormat(){return this.event.data&&"object"===typeof this.event.data&&this.event.data.type&&"string"===typeof this.event.data.type}get isInUnknownFormat(){return!(this.isInOldFormat||this.isInNewFormat)}get type(){if(this.isInUnknownFormat)return Ut.UNKNOWN;const{data:e}=this.event,t=this.isInOldFormat?e:e.type;return this.mapRawTypeToMessageType(t)}get payload(){if(this.isInNewFormat){const{_type:e,...t}=this.event.data;return t}return{}}mapRawTypeToMessageType(e){for(const t of Object.values(Ut))if(e==t)return t;return Ut.UNKNOWN}}const Ht=(null!==(Lt="/")&&void 0!==Lt?Lt:"/")+"version.json";class jt{constructor(e,t=36e5,a=1e4,i){var r,o,s;this.handleInstalledVersionMessage=e=>{const{version:t}=e;if(!(0,J.Gu)(t))throw new Error(`Malformed installation version: ${t}`);this.store.commit("versionInformation/setInstalledVersion",t)},this.handleInstallationErrorMessage=e=>{this.console.error("Service worker failed during installation phase."),this.console.error(e.error),this.setUpdateIsMandatory()},this.handleCacheIsInvalidMessage=()=>{this.setUpdateIsMandatory()},this.handleReloadWindowMessage=()=>{this.reloadWindow()},this.store=e,this.serviceWorkerContainer=null!==(r=null===i||void 0===i?void 0:i.serviceWorkerContainer)&&void 0!==r?r:n.g.navigator.serviceWorker,this.window=null!==(o=null===i||void 0===i?void 0:i.window)&&void 0!==o?o:n.g.window,this.console=null!==(s=null===i||void 0===i?void 0:i.console)&&void 0!==s?s:n.g.console,this.messageHandlers={[Ut.INSTALLED_VERSION]:this.handleInstalledVersionMessage,[Ut.INSTALLATION_ERROR]:this.handleInstallationErrorMessage,[Ut.CACHE_IS_INVALID]:this.handleCacheIsInvalidMessage,[Ut.RELOAD_WINDOW]:this.handleReloadWindowMessage},this.serviceWorkerContainer&&(this.serviceWorkerContainer.addEventListener("message",this.onMessage.bind(this)),this.updateAvailableVersion(),setInterval(this.updateAvailableVersion.bind(this),t),setInterval(this.verifyCacheValidity.bind(this),a))}async update(){this.prepareUpdate(),await this.postMessage(Ut.UPDATE)}async verifyIfCorrectVersionGotLoaded(){!this.correctVersionIsLoaded&&await this.isAnyServiceWorkerRegistered()&&(this.console.error("Active version is not installed version."),await this.unregisterAllServiceWorker(),this.reloadWindow())}onMessage(e){var t;const n=new Vt(e);n.isInOldFormat||null===(t=this.messageHandlers[n.type])||void 0===t||t.call(this,n.payload)}async updateAvailableVersion(){try{const e=await this.window.fetch(Ht),t=await e.json(),n=t.version.version;this.setAvailableVersion(n)}catch(e){this.console.error("Failed to update available version"),this.console.error(e)}}verifyCacheValidity(){this.postMessage(Ut.VERIFY_CACHE)}async isAnyServiceWorkerRegistered(){var e,t;const n=null!==(e=await(null===(t=this.serviceWorkerContainer)||void 0===t?void 0:t.getRegistrations()))&&void 0!==e?e:[];return n.length>0}async postMessage(e,t={}){if(this.serviceWorkerContainer){var n;await this.serviceWorkerContainer.ready;const a=new $t(e,t);null===(n=this.serviceWorkerContainer.controller)||void 0===n||n.postMessage(a.encode())}}async unregisterAllServiceWorker(){var e,t;const n=null!==(e=await(null===(t=this.serviceWorkerContainer)||void 0===t?void 0:t.getRegistrations()))&&void 0!==e?e:[];await Promise.all(n.map((async e=>e.unregister())))}reloadWindow(){this.window.location.reload()}get correctVersionIsLoaded(){return this.store.getters["versionInformation/correctVersionIsLoaded"]}setAvailableVersion(e){if(!(0,J.Gu)(e))throw new Error(`Malformed available version: ${e}`);this.store.commit("versionInformation/setAvailableVersion",e)}setUpdateIsMandatory(){this.store.commit("versionInformation/setUpdateIsMandatory")}prepareUpdate(){this.store.commit("versionInformation/prepareUpdate")}}var zt;const qt=Ft().join(null!==(zt="/")&&void 0!==zt?zt:"/","service-worker.js");function Kt(){const e=!!navigator.serviceWorker.controller;e||navigator.serviceWorker.register(qt)}async function Zt(e,t){e.prototype.$serviceWorkerAssistant=new jt(he),"serviceWorker"in navigator&&(window.onload=Kt)}var Gt=n(79344);i.ZP.use(Gt.Z);const Yt=new Gt.Z({icons:{iconfont:"mdi"},theme:{options:{customProperties:!0},dark:!0,themes:{dark:{notification:"#ea6464",primary:"#28A5C8",secondary:"#0A6E87",pending:"#fdd327",success:"#1dc512",failed:"#ea6464"}}}});var Xt=n(79801),Qt=n(37553),Jt=n(19058),en=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(Xt.Z,{attrs:{dark:""}},[n("install-banner"),n("div",{attrs:{id:"application-wrapper"}},[n("router-view",{attrs:{name:"modal"}}),n("transition",{attrs:{name:"slide"}},[n("router-view",{attrs:{name:"notifications"}})],1),n("div",{attrs:{id:"application-content"}},[n("app-header"),n(Jt.Z,[n(Qt.Z,{staticClass:"application__container fill-height",attrs:{fluid:""}},[n("router-view")],1)],1)],1)],1),e.imprint&&e.terms?n("div",{staticClass:"imprint"},[n("a",{staticClass:"imprint__policy",attrs:{href:e.imprint,target:"_blank"}},[e._v(" "+e._s(e.$t("application.privacy-policy"))+" ")]),n("a",{staticClass:"imprint__terms",attrs:{href:e.terms,target:"_blank"}},[e._v(" "+e._s(e.$t("application.terms"))+" ")])]):e._e(),n("offline-snackbar"),n("version-snackbar"),n("receiving-ongoing-snackbar"),n("notification-snackbar")],1)},tn=[],nn=n(19957),an=n(2138),rn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-header"},[e.showInfoOverlay?a("info-overlay",{on:{"close-overlay":function(t){e.showInfoOverlay=!1}}}):e._e(),a("header-content",{staticClass:"app-header__content",attrs:{"show-network":!e.showTitleOnly},on:{"show-info":function(t){e.showInfoOverlay=!0},"navigate-back":function(t){return e.navigateBack()}}},[a("div",{staticClass:"app-header__content__icons"},[e.showTitleOnly?e._e():a(an.Z,{staticClass:"app-header__content__icons__notifications-button",attrs:{"data-cy":"app-header_content_icons_notifications-button",icon:"",height:"30px",width:"25px"},nativeOn:{click:function(t){return e.notificationPanel()}}},[e.newNotifications?a(nn.Z,{attrs:{color:"notification",overlap:"",bordered:"",dot:""}},[a(We.Z,{attrs:{height:"30px",width:"25px",src:n(38300)}})],1):a(We.Z,{attrs:{height:"30px",width:"25px",src:n(38300)}})],1),e.isDisclaimerRoute?e._e():a("header-identicon",{staticClass:"app-header__content__icons__identicon",attrs:{"data-cy":"app-header_content_icons_identicon"},nativeOn:{click:function(t){return e.accountMenu()}}})],1)])],1)},on=[],sn=n(73249),cn=n(55532),ln=n(35764),dn=n(55093);const{mapState:pn,mapMutations:un}=(0,A._p)("notifications");let mn=class extends((0,Se.Wr)(dn.Z)){constructor(){super(...arguments),this.showInfoOverlay=!1}get isDisclaimerRoute(){return this.$route.name===_e.n.DISCLAIMER}get showTitleOnly(){return this.isDisclaimerRoute||!this.isConnected}navigateBack(){this.onBackClicked()}notificationPanel(){this.notificationsViewed(),this.navigateToNotifications(),this.showInfoOverlay=!1}accountMenu(){this.navigateToAccount(),this.showInfoOverlay=!1}};mn=(0,Ce.__decorate)([(0,Se.wA)({components:{InfoOverlay:ln.Z,HeaderContent:sn.Z,HeaderIdenticon:cn.Z},computed:{...(0,A.rn)(["isConnected"]),...pn(["newNotifications"])},methods:{...un(["notificationsViewed"])}})],mn);const yn=mn,fn=yn;var hn=(0,Ue.Z)(fn,rn,on,!1,null,"ea324d9c",null);const _n=hn.exports;var gn=n(69702),bn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n(gn.Z,{staticClass:"install-banner",attrs:{color:"#1e1e1e","two-line":""},scopedSlots:e._u([{key:"actions",fn:function(t){var a=t.dismiss;return[n(an.Z,{staticClass:"install-banner__install-button",attrs:{dark:"",text:"",outlined:""},on:{click:e.install}},[e._v(" "+e._s(e.$t("install-banner.install"))+" ")]),n(an.Z,{staticClass:"install-banner__dismiss-button",attrs:{dark:"",text:"",outlined:""},on:{click:a}},[e._v(" "+e._s(e.$t("install-banner.dismiss"))+" ")])]}}],null,!1,3359785919)},[e.$vuetify.breakpoint.mobile?[e._v(" "+e._s(e.$t("install-banner.message-mobile"))+" ")]:[e._v(" "+e._s(e.$t("install-banner.message-desktop"))+" ")]],2):e._e()},vn=[];let wn=class extends Se.w3{constructor(){super(...arguments),this.visible=!1,this.installEvent=void 0}created(){window.addEventListener("beforeinstallprompt",this.onBeforeInstallPrompt)}onBeforeInstallPrompt(e){e.preventDefault(),this.installEvent=e,this.visible=!0}async install(){this.installEvent&&(this.visible=!1,await this.installEvent.prompt(),this.installEvent=void 0)}};wn=(0,Ce.__decorate)([Se.wA],wn);const Tn=wn,kn=Tn;var En=(0,Ue.Z)(kn,bn,vn,!1,null,null,null);const An=En.exports;var Nn=n(97660),In=n(76191),Rn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isVisible?a(In.Z,{staticClass:"notification-snackbar",attrs:{value:e.isVisible,timeout:e.notificationToShow.duration,app:"",rounded:"","max-width":"550px",color:"primary"},on:{input:e.dismiss},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.attrs;return[a(an.Z,e._b({attrs:{"data-cy":"notification-snackbar__dismiss-button",icon:"",left:""},on:{click:function(t){return e.dismiss()}}},"v-btn",n,!1),[a(Nn.Z,[e._v("mdi-close")])],1)]}}],null,!1,2634841300),model:{value:e.notificationToShow.display,callback:function(t){e.$set(e.notificationToShow,"display",t)},expression:"notificationToShow.display"}},[a("div",{staticClass:"notification-snackbar__area",on:{click:e.open}},[a("img",{attrs:{src:n(24209)}}),a("span",{staticClass:"notification-snackbar__area__title"},[e._v(" "+e._s(e.notificationToShow.title)+" ")])])]):e._e()},Dn=[];const{mapGetters:Cn,mapMutations:Sn}=(0,A._p)("notifications");let On=class extends((0,Se.Wr)(dn.Z)){get notificationToShow(){return this.notificationQueue[0]}get isVisible(){return void 0!==this.notificationToShow}dismiss(){this.notificationToShow&&this.setNotificationShown(this.notificationToShow.id)}open(){this.dismiss(),this.navigateToNotifications()}};On=(0,Ce.__decorate)([(0,Se.wA)({computed:{...Cn(["notificationQueue"])},methods:{...Sn(["setNotificationShown"])}})],On);const Pn=On,xn=Pn;var Mn=(0,Ue.Z)(xn,Rn,Dn,!1,null,"020e2213",null);const Un=Mn.exports;var Ln=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.offline?n("span",[n("blurred-overlay",{attrs:{show:e.offline,fullscreen:!0}}),n(In.Z,{attrs:{timeout:-1,color:"error"},model:{value:e.offline,callback:function(t){e.offline=t},expression:"offline"}},[e._v(" "+e._s(e.$t("general.offline"))+" "),n(Nn.Z,[e._v("mdi-alert")])],1)],1):e._e()},Bn=[],Fn=n(57888);let Wn=class extends Se.w3{constructor(){super(...arguments),this.offline=!1}handleOnline(){this.offline=!1}handleOffline(){this.offline=!0}mounted(){this.offline=!navigator.onLine,window.addEventListener("offline",this.handleOffline),window.addEventListener("online",this.handleOnline)}beforeDestroy(){window.removeEventListener("offline",this.handleOffline),window.removeEventListener("online",this.handleOnline)}};Wn=(0,Ce.__decorate)([(0,Se.wA)({components:{BlurredOverlay:Fn.Z}})],Wn);const $n=Wn,Vn=$n;var Hn=(0,Ue.Z)(Vn,Ln,Bn,!1,null,null,null);const jn=Hn.exports;var zn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("transition",{attrs:{name:"delay"}},[n(In.Z,{staticClass:"receiving-ongoing-snackbar",attrs:{timeout:"-1",color:"primary"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("span",{staticClass:"receiving-ongoing-snackbar__warning"},[e._v(" "+e._s(e.$t("transfer.receiving-transfer-snackbar"))+" ")])])],1):e._e()},qn=[];let Kn=class extends Se.w3{get pendingReceivedTransfers(){return Object.values(this.pendingTransfers).filter((e=>"received"===e.direction))}get show(){return Object.keys(this.pendingReceivedTransfers).length>0}};Kn=(0,Ce.__decorate)([(0,Se.wA)({computed:{...(0,A.Se)(["pendingTransfers"])}})],Kn);const Zn=Kn,Gn=Zn;var Yn=(0,Ue.Z)(Gn,zn,qn,!1,null,"4795eb56",null);const Xn=Yn.exports;var Qn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("span",[n("blurred-overlay",{attrs:{show:e.blocking,fullscreen:!0}}),n(In.Z,{staticClass:"version-snackbar",attrs:{timeout:-1,color:"primary"},model:{value:e.showMessage,callback:function(t){e.showMessage=t},expression:"showMessage"}},[n(Qt.Z,{staticClass:"d-flex align-center py-0"},[n("div",{staticClass:"version-snackbar__message"},[e._v(e._s(e.message))]),n(an.Z,{staticClass:"ml-5",attrs:{dark:"",text:"",loading:e.showProgressSpinner},on:{click:e.update}},[e._v(" "+e._s(e.$t("update.update"))+" ")])],1)],1)],1):e._e()},Jn=[];const{mapState:ea,mapGetters:ta}=(0,A._p)("versionInformation");let na=class extends Se.w3{constructor(){super(...arguments),this.showProgressSpinner=!1}get visible(){return!this.correctVersionIsLoaded||this.updateIsAvailable||this.updateIsMandatory||this.updateInProgress}get blocking(){return!this.correctVersionIsLoaded||this.updateIsMandatory||this.updateInProgress}get message(){return this.updateInProgress?this.$t("update.updateInProgress"):this.updateIsMandatory?this.$t("update.updateMandatory"):this.updateIsAvailable?this.$t("update.updateAvailable"):""}get showMessage(){return this.message.length>0}async update(){this.showProgressSpinner=!0,this.isConnected&&await this.$raiden.disconnect(),this.$serviceWorkerAssistant.update()}onUpdateInProgressChange(){this.showProgressSpinner=this.updateInProgress}};(0,Ce.__decorate)([(0,Se.RL)("updateInProgress",{immediate:!0})],na.prototype,"onUpdateInProgressChange",null),na=(0,Ce.__decorate)([(0,Se.wA)({components:{BlurredOverlay:Fn.Z},computed:{...(0,A.rn)(["isConnected"]),...ea(["updateIsMandatory","updateInProgress"]),...ta(["correctVersionIsLoaded","updateIsAvailable"])}})],na);const aa=na,ia=aa;var ra=(0,Ue.Z)(ia,Qn,Jn,!1,null,"b7210ec8",null);const oa=ra.exports;let sa=class extends((0,Se.Wr)(dn.Z)){get imprint(){return"https://raiden.network/privacy.html"}get terms(){return"https://github.com/raiden-network/light-client/blob/master/TERMS.md"}beforeCreate(){this.$serviceWorkerAssistant.verifyIfCorrectVersionGotLoaded()}destroyed(){this.$raiden.disconnect()}};sa=(0,Ce.__decorate)([(0,Se.wA)({components:{AppHeader:_n,OfflineSnackbar:jn,VersionSnackbar:oa,NotificationSnackbar:Un,ReceivingOngoingSnackbar:Xn,InstallBanner:An}})],sa);const ca=sa,la=ca;var da=(0,Ue.Z)(la,en,tn,!1,null,"272248e0",null);const pa=da.exports;var ua=n(48473);i.ZP.config.productionTip=!1,(0,ua.v)(),i.ZP.use(Mt),i.ZP.use(c),i.ZP.use(Zt),new i.ZP({vuetify:Yt,router:wt,store:he,i18n:Dt,render:e=>e(pa)}).$mount("#app")},31113:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(59312),i=n(57102);let r=class extends i.w3{$blockie(e){return e?this.$identicon.getIdenticon(e):this.$identicon.getIdenticon("0x000")}};r=(0,a.__decorate)([i.wA],r);const o=r},55093:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n(59312),i=n(57102),r=n(91110);let o=class extends i.w3{navigateToSelectHub(e){this.$router.push({name:r.n.SELECT_HUB,params:{token:e}})}navigateToHome(){this.$router.push({name:r.n.HOME})}navigateToTransfer(e){this.$router.push({name:r.n.TRANSFER,params:{token:e}})}navigateToOpenChannel(e,t){this.$router.push({name:r.n.OPEN_CHANNEL,params:{token:e,partner:t}})}navigateToChannels(e){this.$router.push({name:r.n.CHANNELS,params:{token:e}})}navigateToSelectTransferTarget(e,t,n){const a={name:r.n.TRANSFER,params:{token:e},query:{}};t&&n&&(a.query={target:t,amount:n}),this.$router.push(a)}navigateToTokenSelect(){this.$router.push({name:r.n.SELECT_TOKEN})}navigateToTransferSteps(e,t,n){this.$router.push({name:r.n.TRANSFER_STEPS,params:{token:e,target:t},query:{amount:n}})}navigateToNotifications(){this.$router.push({name:r.n.NOTIFICATIONS})}navigateToAccount(){this.$router.push({name:r.n.ACCOUNT_ROOT})}navigateToBackupState(){this.$router.push({name:r.n.ACCOUNT_BACKUP})}navigateToRaidenAccountTransfer(){this.$router.push({name:r.n.ACCOUNT_RAIDEN})}navigateToSettings(){this.$router.push({name:r.n.ACCOUNT_SETTINGS})}navigateToWithdrawal(){this.$router.push({name:r.n.ACCOUNT_WITHDRAWAL})}navigateToUDC(){this.$router.push({name:r.n.ACCOUNT_UDC})}onModalBackClicked(){this.$router.go(-1)}onBackClicked(){switch(this.$route.name){case r.n.TRANSFER_STEPS:this.navigateToSelectTransferTarget(this.$route.params.token,this.$route.params.target,this.$route.params.amount);break;case r.n.CHANNELS:this.navigateToTransfer(this.$route.params.token);break;case r.n.SELECT_TOKEN:case r.n.SELECT_HUB:case r.n.OPEN_CHANNEL:this.$router.go(-1);break;default:break}}};o=(0,a.__decorate)([i.wA],o);const s=o},91110:(e,t,n)=>{"use strict";var a;n.d(t,{n:()=>a}),function(e){e["DISCLAIMER"]="disclaimer",e["TRANSFER"]="transfer",e["TRANSFER_STEPS"]="transfer-steps",e["QUICK_PAY"]="quick-pay",e["SELECT_TOKEN"]="select-token",e["SELECT_HUB"]="select-hub",e["HOME"]="home",e["NO_CONNECTED_TOKEN"]="no-connected-token",e["CHANNELS"]="channels",e["OPEN_CHANNEL"]="open-channel",e["ACCOUNT_ROOT"]="account-root",e["ACCOUNT_BACKUP"]="account-backup",e["ACCOUNT_RAIDEN"]="account-raiden",e["ACCOUNT_SETTINGS"]="account-settings",e["ACCOUNT_WITHDRAWAL"]="account-withdrawal",e["ACCOUNT_UDC"]="account-udc",e["NOTIFICATIONS"]="notifications"}(a||(a={}))},90768:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i,i:()=>a});class a{static async contracts(){try{const{VUE_APP_DEPLOYMENT_INFO:e,VUE_APP_DEPLOYMENT_SERVICES_INFO:t}={VUE_APP_ALLOW_MAINNET:"true",VUE_APP_IMPRINT:"https://raiden.network/privacy.html",VUE_APP_TERMS:"https://github.com/raiden-network/light-client/blob/master/TERMS.md",VUE_APP_CONFIGURATION_URL:"config.production.json",NODE_ENV:"production",VUE_APP_I18N_LOCALE:"en",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_SERVICE_WORKER_DISABLED:"false",BASE_URL:"/"};if(e&&t){const[n,a]=await Promise.all([fetch(e),fetch(t)]),[i,r]=await Promise.all([n.json(),a.json()]);return{...i.contracts,...r.contracts}}return}catch(e){throw new i(e.message)}}static async configuration(){const e="config.production.json",t=await fetch(e);return await t.json()}}class i extends Error{}},77801:(e,t,n)=>{"use strict";n.d(t,{WG:()=>o,Ec:()=>c,AX:()=>p});var a=n(47510),i=n(90768);class r{constructor(){const e=this.constructor.isAvailable;if(!e)throw new Error("The provider is not available.")}static async isDisabled(){var e;const t=await i.i.configuration(),n=null!==(e=t.disabled_ethereum_providers)&&void 0!==e?e:[];return n.includes(this.providerName)}}r.isAvailable=!1;class o extends r{constructor(e,t){super(),this.provider=new a.r(e),this.account=t}static async link(e){return new this(e.rpcUrl,e.privateKey)}}o.providerName="direct_rpc_provider",o.isAvailable=!0;var s=n(19450);class c extends r{constructor(e){super(),this.account=0,this.provider=new s.Q(e)}static get isAvailable(){return!!window.ethereum||!!window.web3}static async link(){if(!c.isAvailable)throw new Error("No injected provider is available.");let e;return window.ethereum?(window.ethereum.autoRefreshOnNetworkChange=!1,await window.ethereum.request({method:"eth_requestAccounts"}),e=window.ethereum):e=window.web3.currentProvider,e.on("chainChanged",l),e.on("disconnect",l),new this(e)}}function l(){window.location.replace(window.location.origin)}c.providerName="injected_provider";var d=n(71435);class p extends r{constructor(e){super(),this.account=0,this.provider=new s.Q(e)}static async link(e){const t=(null===e||void 0===e?void 0:e.bridgeUrl)||void 0;let n;if(void 0===e.rpcUrl&&void 0===e.infuraId)throw new Error("One of the options RPC URL or Infura Id are required to link.");if(void 0!==e.rpcUrl&&void 0!==e.infuraId)throw new Error("Only one link option allowed. Either a RPC URL or a Infura Id.");return void 0!==e.rpcUrl?n=await u(e.rpcUrl,t):e.infuraId&&(n=m(e.infuraId,t)),await n.enable(),n.on("chainChanged",y),n.on("disconnect",y),new p(n)}}async function u(e,t){const n=new a.r(e),i=await n.getNetwork(),r={bride:t,rpc:{[i.chainId]:e}};return new d.Z(r)}function m(e,t){return new d.Z({bridge:t,infuraId:e})}function y(){window.location.replace(window.location.origin)}p.providerName="wallet_connect",p.isAvailable=!0},34498:(e,t,n)=>{"use strict";var a;n.d(t,{u:()=>a}),function(e){e["NONE"]="none",e["INFO"]="info",e["WARNING"]="warning",e["ERROR"]="error"}(a||(a={}))},14498:(e,t,n)=>{"use strict";var a;n.d(t,{N:()=>a}),function(e){e[e["LOW"]=0]="LOW",e[e["HIGH"]=1]="HIGH"}(a||(a={}))},55679:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var a=n(43535),i=n(5733);class r{static toEth(e){return a.dF(e)}static toUnits(e,t){const n=a.bM(e,t);return 0===t?n.split(".")[0]:n}static decimalsOverflow(e,t){let n;return n=e.indexOf(".")>0?e.split(".")[1]:"",n.length>t}static parse(e,t){try{return a.vz(e.endsWith(".")?e.substring(0,e.length-1):e,t)}catch{return i._Y}}}},48473:(e,t,n)=>{"use strict";n.d(t,{u:()=>g,v:()=>f});var a=n(21069),i=n(92084),r=n.n(i);const o="logs";let s,c;function l(e){const t=e.toString();return e.stack?e.stack.startsWith(t)?e.stack:`${t}\n${e.stack}`:t}function d(e){var t,n,a,i;if("%c prev state"===e[0])return;if(null!==(t=e[0])&&void 0!==t&&null!==(n=t.startsWith)&&void 0!==n&&n.call(t,"action %c"))return;if("—— log end ——"===e[0])return;const r=null===(a=e[2])||void 0===a||null===(i=a.payload)||void 0===i?void 0:i.blockNumber;if(!r)return e=e.map((e=>e instanceof Error?l(e):(null===e||void 0===e?void 0:e.payload)instanceof Error?{...e,payload:l(e.payload)}:e)),"string"===typeof e[1]&&e[1].startsWith("color:")&&e.splice(1,1),e;s=r}function p(e){if("string"===typeof e)return e;try{return JSON.stringify(e)}catch(t){try{return e.toString()}catch(t){return"<unserializable>"}}}async function u(e){var t;(null===(t=c)||void 0===t?void 0:t.name)!==e&&(c=await(0,a.X3)(e,1,{upgrade(e){const t=e.createObjectStore(o);t.createIndex("by-logger","logger"),t.createIndex("by-level","level")}}))}const m=/^raiden:(0x[0-9a-f]{40})$/i;async function y(e){m.test(e)&&await u(e)}async function f(e=["matrix"]){if("undefined"===typeof c){await u("raiden");for(const t of[r(),...e.map(r().getLogger)]){const n=t.methodFactory;function a(e,t,a){const i=n.call(this,e,t,a),r=a.toString();return y(r),(...t)=>{i.call(this,...t);const n=d(t);n&&c.put(o,{logger:r,level:e,message:n,...s?{block:s}:{}},Date.now()).catch((()=>c.put(o,{logger:r,level:e,message:t.map(p),...s?{block:s}:{}},Date.now())))}}a.allowOverwrite=!0,t.methodFactory=a}}}const h=[[/(\\?["']?access_?token\\?["']?\s*[=:]\s*\\?["']?)[\w-]+(\\?["']?)/gi,"$1<redacted>$2"],[/(\\?["']?secret\\?["']?\s*[=:]\s*)\[[^\]]+\]/gi,'$1["<redacted>"]'],[/(\\?["']?secret\\?["']?\s*[=:]\s*\\?["']?)\w+(\\?["']?)/gi,"$1<redacted>$2"]];function _(e){for(const[t,n]of h)e=e.replace(t,n);return e}async function g(){let e="",t=await c.transaction(o).store.openCursor(),n=Date.now(),a=!0;while(t){const{logger:i,level:r,message:o,block:s}=t.value,l=o.map((e=>"string"===typeof e?e:JSON.stringify(e))).join(" ");n=+t.key;const d=new Date(t.key).toISOString(),p=s?` #${s}`:"";let u;i!==c.name||a?(u=` @ ${i}`,a=!1):u="",e+=`${d}${p}${u} [${r}] \t=> ${l}\n`,t=await t.continue()}return e=_(e),[n,e]}},31034:(e,t,n)=>{"use strict";n.d(t,{Wi:()=>pe,Dz:()=>Nr,O6:()=>he,GM:()=>oc,h6:()=>ht,Nt:()=>ny,pp:()=>Pc});var a={};n.r(a),n.d(a,{matrixPresence:()=>Qn,matrixSetup:()=>Xn,rtcChannel:()=>Jn});var i={};n.r(i),n.d(i,{messageReceived:()=>da,messageSend:()=>ca,messageServiceSend:()=>la});var r={};n.r(r),n.d(r,{blockStale:()=>Ra,blockTime:()=>Ia,channelClose:()=>Ma,channelDeposit:()=>Pa,channelMonitored:()=>Oa,channelOpen:()=>Sa,channelSettle:()=>Ba,channelSettleable:()=>Ua,channelWithdrawn:()=>xa,contractSettleTimeout:()=>Da,newBlock:()=>Na,tokenMonitored:()=>Ca});var o={};n.r(o),n.d(o,{iouClear:()=>Hi,iouPersist:()=>Vi,msBalanceProofSent:()=>Zi,pathFind:()=>Wi,servicesValid:()=>$i,udcDeposit:()=>ji,udcWithdraw:()=>Ki,udcWithdrawPlan:()=>qi});var s={};n.r(s),n.d(s,{transfer:()=>Yi,transferClear:()=>sr,transferExpire:()=>rr,transferExpireProcessed:()=>or,transferLoad:()=>cr,transferProcessed:()=>Qi,transferSecret:()=>Ji,transferSecretRegister:()=>er,transferSecretRequest:()=>tr,transferSecretReveal:()=>nr,transferSigned:()=>Xi,transferUnlock:()=>ar,transferUnlockProcessed:()=>ir,withdraw:()=>pr,withdrawBusy:()=>mr,withdrawCompleted:()=>fr,withdrawExpire:()=>yr,withdrawMessage:()=>ur,withdrawResolve:()=>dr});var c={};n.r(c),n.d(c,{blockStaleEpic:()=>Il,blockTimeEpic:()=>Nl,channelAutoSettleEpic:()=>od,channelCloseEpic:()=>Sl,channelDepositEpic:()=>Fl,channelEventsEpic:()=>td,channelMonitoredEpic:()=>nd,channelOpenEpic:()=>id,channelSettleEpic:()=>dd,channelSettleableEpic:()=>rd,channelUnlockEpic:()=>pd,channelUpdateEpic:()=>Ol,confirmationEpic:()=>Cl,contractSettleTimeoutEpic:()=>Rl,initEpic:()=>El,initMonitorProviderEpic:()=>Zl,initNewBlockEpic:()=>Al,initTokensRegistryEpic:()=>Kl});var l={};n.r(l),n.d(l,{dbErrorsEpic:()=>ud});var d={};n.r(d),n.d(d,{monitorUdcBalanceEpic:()=>jd,msMonitorNewBPEpic:()=>_d,msMonitorRequestEpic:()=>hd,pfsCapacityUpdateEpic:()=>Wd,pfsFeeUpdateEpic:()=>$d,pfsRequestEpic:()=>Fd,pfsServiceRegistryMonitorEpic:()=>Vd,udcAutoWithdrawEpic:()=>Zd,udcDepositEpic:()=>qd,udcWithdrawEpic:()=>Gd,udcWithdrawPlanRequestEpic:()=>Kd});var p={};n.r(p),n.d(p,{coopSettleEpic:()=>np,coopSettleWithdrawReplyEpic:()=>tp,initQueuePendingEnvelopeMessagesEpic:()=>rp,initQueuePendingReceivedEpic:()=>op,initWithdrawMessagesEpic:()=>Vp,monitorSecretRegistryEpic:()=>Bp,transferAutoExpireEpic:()=>ip,transferAutoRegisterEpic:()=>Wp,transferClearCompletedEpic:()=>lp,transferGenerateAndSignEnvelopeMessageEpic:()=>Dp,transferMediateEpic:()=>Qd,transferProcessedReceivedEpic:()=>Cp,transferProcessedSendEpic:()=>Sp,transferRequestResolveEpic:()=>sp,transferRequestUnlockEpic:()=>Lp,transferRetryMessageEpic:()=>Op,transferSecretRegisterEpic:()=>$p,transferSecretRequestedEpic:()=>Pp,transferSecretRevealEpic:()=>Mp,transferSecretRevealedEpic:()=>Up,transferSuccessOnSecretRegisteredEpic:()=>Fp,withdrawAutoExpireEpic:()=>Zp,withdrawMessageProcessedEpic:()=>qp,withdrawResolveEpic:()=>Hp,withdrawSendExpireMessageEpic:()=>Gp,withdrawSendRequestMessageEpic:()=>jp,withdrawSendTxEpic:()=>zp});var u={};n.r(u),n.d(u,{deliveredEpic:()=>Xu,initMatrixEpic:()=>Mu,matrixLeaveUnknownRoomsEpic:()=>nm,matrixMessageReceivedEpic:()=>Yu,matrixMessageSendEpic:()=>Ku,matrixMessageServiceSendEpic:()=>Gu,matrixMonitorChannelPresenceEpic:()=>em,matrixMonitorPresenceEpic:()=>Ju,matrixShutdownEpic:()=>Uu,matrixUpdateCapsEpic:()=>tm,rtcConnectionManagerEpic:()=>Nu});n(84447),n(92382);var m=n(92084),y=n.n(m);let f=m.methodFactory;Object.defineProperty(y(),"methodFactory",{enumerable:!0,configurable:!0,get(){return f},set(e){e.allowOverwrite&&(f=e)}});var h=n(62802);let _;(0,h.wrapRequest)(((e,t,n)=>{var a;null!==(a=_)&&void 0!==a||(_="forever"in e?e.forever(void 0,void 0):e);const i=_(t,n),r=i.abort;return i.abort=function(){r.call(this),n(new Error("aborted!"),null,null)},i}));var g=n(3922),b=n(51210),v=n(5733),w=n(47510),T=n(19450),k=n(92465),E=n.n(k),A=n(16651),N=n.n(A),I=n(40015),R=n.n(I),D=n(37453),C=n(16415),S=n(29724),O=n(43941),P=n(77340),x=n(44688),M=n(55076),U=n(85791),L=n(85314),B=n(16093),F=n(20601),W=n(80598),$=n(16621),V=n(91971),H=n(61570),j=n(95910),z=n(39121),q=n(71556),K=n(38045),Z=n(43410),G=n(65772),Y=n(45980),X=n(40987),Q=n(83180),J=n.n(Q),ee=n(96001),te=n.n(ee),ne=n(34172),ae=n.n(ne),ie=n(32728),re=n(58540),oe=n(2677),se=n(43535);const ce=(0,re.$m)([],65),le=(0,oe.w)([]);var de,pe;(function(e){e["STOP"]="raidenStopped",e["ACCOUNT_CHANGED"]="providerAccountChanged",e["NETWORK_CHANGED"]="providerNetworkChanged"})(de||(de={})),function(e){e["DELIVERY"]="Delivery",e["RECEIVE"]="Receive",e["MEDIATE"]="Mediate",e["WEBRTC"]="webRTC",e["TO_DEVICE"]="toDevice",e["IMMUTABLE_METADATA"]="immutableMetadata"}(pe||(pe={}));const ue={[pe.DELIVERY]:1,[pe.RECEIVE]:1,[pe.MEDIATE]:1,[pe.WEBRTC]:0,[pe.TO_DEVICE]:1,[pe.IMMUTABLE_METADATA]:0},me="RAIDEN",ye=5,fe=5,he=(0,se.fi)("80"),_e=600,ge=2592e3,be=3;var ve=n(35897),we=n(30347),Te=n(21789),ke=n.n(Te);const Ee=JSON.parse('{"PFS_EMPTY_URL":"A registered Pathfinding Service returned an empty service URL.","PFS_INVALID_URL":"A registered Pathfinding Service returned an invalid service URL.","PFS_INVALID_INFO":"Could not find any valid Pathfinding service. Client and PFS versions are possibly out-of-sync.","PFS_TOO_EXPENSIVE":"Pathfinding Service price higher than pfsMaxFee.","PFS_NO_ROUTES_FOUND":"No valid routes found.","PFS_ERROR_RESPONSE":"Pathfinding Service request returned an error","PFS_DISABLED":"Pathfinding Service is disabled and no direct route is available.","PFS_UNKNOWN_TOKEN_NETWORK":"No open channels on this token network.","PFS_TARGET_OFFLINE":"The requested target is offline.","PFS_TARGET_NO_RECEIVE":"The requested target doesn\'t receive transfers.","PFS_LAST_IOU_REQUEST_FAILED":"The request for the last IOU has failed.","PFS_IOU_SIGNATURE_MISMATCH":"The signature of the last IOU did not match.","PFS_NO_ROUTES_BETWEEN_NODES":"No route between nodes found.","CNL_INVALID_STATE":"Invalid channel state.","CNL_NO_OPEN_CHANNEL_FOUND":"No open channel has been found.","CNL_NO_OPEN_OR_CLOSING_CHANNEL_FOUND":"No open or closing channel has been found.","CNL_NO_SETTLEABLE_OR_SETTLING_CHANNEL_FOUND":"No settleable or settling channel has been found.","CNL_OPENCHANNEL_FAILED":"TokenNetwork.openChannel transaction reverted.","CNL_SETTOTALDEPOSIT_FAILED":"TokenNetwork.setTotalDeposit transaction reverted.","CNL_CLOSECHANNEL_FAILED":"TokenNetwork.closeChannel transaction reverted.","CNL_SETTLE_INVALID_BALANCEHASH":"Could not find BalanceProof matching on-chain closing data. This client may have had its state cleared and can\'t settle.","CNL_SETTLE_FAILED":"TokenNetwork.settleChannel transaction reverted.","CNL_COOP_SETTLE_FAILED":"TokenNetwork.cooperativeSettle transaction reverted.","CNL_SETTLE_AUTO_ENABLED":"Interactive channel settlement disabled when config.autoSettle is enabled; request will be made automatically","CNL_UPDATE_NONCLOSING_BP_FAILED":"updateNonClosingBalanceProof transaction reverted.","CNL_ONCHAIN_UNLOCK_FAILED":"on-chain unlock transaction reverted.","CNL_WITHDRAW_PENDING":"There\'s already a withdraw request pending.","CNL_WITHDRAW_RETRY_CONFIRMATION":"Retrying pending WithdrawConfirmation. Confirm or try again later.","CNL_WITHDRAW_TRANSACTION_FAILED":"Withdraw transaction has failed.","CNL_WITHDRAW_EXPIRES_SOON":"Withdraw request expired or expires too soon.","CNL_WITHDRAW_EXPIRED":"Withdraw request expired.","CNL_WITHDRAW_AMOUNT_TOO_LOW":"Withdraw request contains an amount smaller than already withdrawn.","CNL_WITHDRAW_AMOUNT_TOO_HIGH":"Withdraw request contains an amount bigger than channel\'s liquidity.","CNL_COOP_SETTLE_NOT_POSSIBLE":"Can not create or answer channel cooperative settle request","XFER_EXPIRED":"Transfer expired.","XFER_CHANNEL_CLOSED_PREMATURELY":"Channel was closed before secret got reveiled or transfer unlocked.","XFER_REFUNDED":"Transfer has been refunded.","XFER_INVALID_SECRETREQUEST":"Invalid SecretRequest received","XFER_ALREADY_COMPLETED":"Not waiting for transfer, it\'s already completed.","XFER_REGISTERSECRET_TX_FAILED":"SecretRegistry.registerSecret transaction reverted","TRNS_NO_MATRIX_SERVERS":"Could not contact any Matrix servers.","TRNS_NO_VALID_USER":"Could not find a user with a valid signature.","TRNS_NO_SERVERNAME":"Could not get server name from Matrix server.","TRNS_MESSAGE_SIGNATURE_MISMATCH":"Unable to decode message due to signature mismatch.","RDN_GENERAL_ERROR":"An unknown error occured.","RDN_ASSERT_ERROR":"An unknown assertion failed.","RDN_MINT_FAILED":"Failed to mint tokens.","RDN_MINT_MAINNET":"Minting is only allowed on test networks.","RDN_REGISTER_TOKEN_FAILED":"Failed to register tokens.","RDN_REGISTER_TOKEN_MAINNET":"Registering a token is only allowed on test networks.","RDN_REGISTER_TOKEN_REGISTERED":"Token is already registered.","RDN_TRANSACTION_FAILED":"Contract transaction failed.","RDN_APPROVE_TRANSACTION_FAILED":"Token approve transaction has failed.","RDN_DEPOSIT_TRANSACTION_FAILED":"Deposit transaction has failed.","RDN_TRANSFER_ONCHAIN_BALANCE_FAILED":"Failed to transfer on-chain balance.","RDN_TRANSFER_ONCHAIN_TOKENS_FAILED":"Failed to transfer on-chain tokens.","RDN_UNRECOGNIZED_NETWORK":"No deploy info provided nor recognized network.","RDN_SIGNER_NOT_CONNECTED":"The signing account is not connected to the provider.","RDN_ACCOUNT_NOT_FOUND":"Account not found in provider.","RDN_STRING_ACCOUNT_INVALID":"String account must be either a 0x-encoded address or private key.","RDN_TRANSACTION_REORG":"Transaction has been mined but got removed by a reorg.","RDN_STATE_MIGRATION":"Could not replace stored state with older, provided state.","RDN_INSUFFICIENT_BALANCE":"Insufficient balance.","RDN_INSUFFICIENT_ALLOWANCE":"Requested allowance smaller than deposit.","RDN_NOT_A_TOKEN":"Not a token contract.","RDN_STATE_ADDRESS_MISMATCH":"Mismatch between provided account and loaded state.","RDN_STATE_NETWORK_MISMATCH":"Mismatch between network or registry address and loaded state","RDN_ALREADY_STARTED":"Already started or stopped!","RDN_UNKNOWN_TOKEN_NETWORK":"Unknown Tokennetwork","RDN_INVALID_SECRET":"Invalid provided secret.","RDN_INVALID_SECRETHASH":"Invalid provided secrethash.","RDN_SECRET_SECRETHASH_MISMATCH":"Provided secrethash must match the sha256 hash of provided secret.","RDN_UNKNOWN_TRANSFER":"Unknown transfer.","RDN_DATABASE_DELETED":"Database deleted!","DTA_NEGATIVE_NUMBER":"Encountered negative number while encoding to HEX string.","DTA_NUMBER_TOO_LARGE":"Encountered a number that is too large to be encoded.","DTA_ARRAY_LENGTH_DIFFERENCE":"Expected length of HEX string differs from integer array input.","DTA_UNENCODABLE_DATA":"Passed data is not a HEX string nor integer array.","DTA_NON_POSITIVE_NUMBER":"Number must be positive.","DTA_INVALID_ADDRESS":"Invalid address parameter.","DTA_INVALID_DEPOSIT":"Invalid deposit parameter.","DTA_INVALID_TIMEOUT":"Invalid timeout parameter.","DTA_INVALID_AMOUNT":"Invalid amount parameter.","DTA_INVALID_PAYMENT_ID":"Invalid payment identifier parameter.","DTA_INVALID_PATH":"Invalid path parameter.","DTA_INVALID_PFS":"Invalid path finding service parameter.","UDC_DEPOSIT_OUTDATED":"The UDC contains a target balance different than requested deposit","UDC_PLAN_WITHDRAW_FAILED":"An error occurred while planning to withdraw from the User Deposit contract.","UDC_PLAN_WITHDRAW_GT_ZERO":"The planned withdraw amount has to be greater than zero.","UDC_PLAN_WITHDRAW_EXCEEDS_AVAILABLE":"The planned withdraw amount exceeds the total amount available for withdrawing.","UDC_WITHDRAW_NO_BALANCE":"There is no balances left to withdraw from UDC.","UDC_WITHDRAW_FAILED":"An error occurred while withdrawing from the UDC.","UDC_WITHDRAW_AUTO_ENABLED":"Interactive UDC withdraw disabled when config.autoUDCWithdraw is enabled; request will be made automatically","UDC_WITHDRAW_NO_PLAN":"No plan currently registered; you must call Raiden.planUDCWithdraw first","UDC_WITHDRAW_TOO_LARGE":"Your current plan is not enough to withdraw the requested amount"}'),Ae=Ee;function Ne(e,t){const n=(e,t)=>{var a;let i;return i="string"===typeof e?(null===t||void 0===t?void 0:t.name)===e||(null===t||void 0===t||null===(a=t.message)||void 0===a?void 0:a.includes(e)):"number"===typeof e?(null===t||void 0===t?void 0:t.httpStatus)===e:Object.entries(e).every((([e,n])=>(null===t||void 0===t?void 0:t[e])===n)),!i&&t&&"error"in t&&(i=n(e,t.error)),i},a=Array.isArray(e)?t=>e.some((e=>n(e,t))):t=>n(e,t);return arguments.length<2?a:a(t)}function Ie(e){var t;let n=-1;const a=null!==(t=e.maxRetries)&&void 0!==t?t:10;return t=>{var i;n++;let r=!0;return a>=0&&r&&(r=n<a),e.onErrors&&r&&(r=Ne(e.onErrors,t)),e.neverOnErrors&&r&&(r=!Ne(e.neverOnErrors,t)),e.predicate&&r&&(r=!!e.predicate(t,n)),e.stopPredicate&&r&&(r=!e.stopPredicate(t,n)),null===(i=e.log)||void 0===i||i.call(e,r?"retrying":"giving up",{count:n,maxRetries:a},t),r}}const Re=["invalid response","missing response",{code:"TIMEOUT"},{code:"SERVER_ERROR"},{code:"NETWORK_ERROR"},{code:"ENOTFOUND"},429,500,502,503],De=["always failing transaction","cannot estimate gas",{code:"UNPREDICTABLE_GAS_LIMIT"}],Ce=["replacement fee too low","gas price supplied is too low","nonce is too low","nonce has already been used","already known","Transaction with the same hash was already imported"],Se=["execution failed due to an exception","transaction failed","execution reverted"],Oe=[...De,...Ce,...Re],Pe=[...Oe,...Se];class xe extends Error{constructor(e,t){super(e),this.details=t,this.name="RaidenError",Object.setPrototypeOf(this,xe.prototype)}get code(){var e;return null!==(e=ke()(Ae,(e=>e===this.message)))&&void 0!==e?e:"RDN_GENERAL_ERROR"}}function Me(e,t,n){if(!e)throw null===n||void 0===n||n("__assertion failed:",e,t),t instanceof Error?t:"function"===typeof t?t(e):Array.isArray(t)?new xe(...t):new xe(null!==t&&void 0!==t?t:Ae.RDN_ASSERT_ERROR,{condition:e})}const Ue=X.jV([X.dt({name:X.Z_}),X.r$({message:X.Z_,stack:X.Z_,details:X._4})]),Le=new X.Dy("Error",(e=>"object"===typeof e&&!!e&&"message"in e),(e=>(0,Y.pipe)(Ue.decode(e),(0,G.map)((e=>"details"in e?Object.assign(new xe(e.message,e.details),{name:e.name,stack:e.stack}):Object.assign(new Error(e.message),{name:e.name,stack:e.stack}))))),(e=>({name:e.name,message:e.message,stack:e.stack,..."details"in e?{details:e.details}:{}})));function Be(e){if((0,G.isLeft)(e))throw new Error(we.qq.report(e).join("\n"))}function Fe(e,t,n,a){try{const n=e.decode(t);return Be(n),n.right}catch(i){throw null===a||void 0===a||a("__decode failed:",e.name,e,t,i),n?n instanceof Error?Object.assign(n,{data:t}):new xe(n,{data:t}):Object.assign(i,{data:t})}}function We(e){return null!=e}const $e=new X.Dy("BigNumber",g.O$.isBigNumber,((e,t)=>{try{return X.Vp(g.O$.from(e))}catch(n){return X.Rn(e,t)}}),(e=>e.toString())),Ve=N()((function(e){return X.UQ(X.Z_,(t=>"string"===typeof t&&(e?(0,re.E1)(t)===e:(0,re.A7)(t))),"HexString")})),He=N()((function(e){const t=e?v._Y.sub(v.Py.pow(8*e-1)):void 0,n=e?v.Py.pow(8*e-1):void 0;return X.UQ($e,(e=>$e.is(e)&&(!t||!n||e.gte(t)&&e.lt(n))),"Int")})),je=N()((function(e){const t=e?v._Y:void 0,n=e?v.Py.pow(8*e):void 0;return X.UQ($e,(e=>$e.is(e)&&(!t||!n||e.gte(t)&&e.lt(n))),"UInt")})),ze=Ve(65),qe=Ve(32),Ke=Ve(32),Ze=Ve(32),Ge=Ve(65);function Ye(e){try{return(0,ve.Kn)(e)===e}catch(t){return!1}}const Xe=new X.Ez("Address",Ye,((e,t)=>{try{return X.Vp((0,ve.Kn)(e))}catch(n){return X.Rn(e,t)}}),X.yR,Ve(20),Ye),Qe=N()((e=>X.jV([e,X.OT(X.dt({ts:X.pk}))])));function Je(e,t=Date.now()){return{...e,ts:t}}function et(e){const{ts:t,...n}=e;return n}const tt=N()((e=>X.jV([e,X.OT(X.dt({signature:ze}))]))),nt=N()((e=>new X.Dy(`instanceOf(${e})`,(t=>{var n;return(null===t||void 0===t||null===(n=t.constructor)||void 0===n?void 0:n.name)===e}),((t,n)=>{var a;return(null===t||void 0===t||null===(a=t.constructor)||void 0===a?void 0:a.name)===e?X.Vp(t):X.Rn(t,n)}),X.yR)));function at(e){return e[e.length-1]}function it(...e){return e.reduce(((e,t)=>e.lt(t)?t:e))}function rt(e,t){const n="string"===typeof e?new RegExp(e):e,a=e=>n.test(e);return new X.Ez(null!==t&&void 0!==t?t:`TemplateLiteral<${n.source}>`,(e=>X.Z_.is(e)&&a(e)),((e,t)=>{const n=X.Z_.validate(e,t);if((0,G.isLeft)(n))return n;const i=n.right;return a(i)?X.Vp(i):X.Rn(i,t)}),X.Z_.encode,X.Z_,a)}rt(/^0x[0-9a-fA-F]{40}@0x[0-9a-fA-F]{40}$/);const ot=rt(/^0x[0-9a-fA-F]{40}@0x[0-9a-fA-F]{40}#\d+$/),st=X.jV([X.dt({amount:je(32),expiration:je(32),secrethash:qe}),X.r$({registered:X.i0(!0)})],"Lock"),ct=X.OT(X.dt({chainId:je(32),tokenNetworkAddress:Xe,channelId:je(32),nonce:je(8),transferredAmount:je(32),lockedAmount:je(32),locksroot:qe,additionalHash:qe})),lt=ct,dt={chainId:v._Y,tokenNetworkAddress:b.d,channelId:v._Y,nonce:v._Y,transferredAmount:v._Y,lockedAmount:v._Y,locksroot:le,additionalHash:ie.R,signature:ce};var pt=n(71482),ut=n.n(pt);const mt={PFS:"path_finding",MS:"monitoring"},yt=X.mM(ut()(mt)),ft={[mt.PFS]:"PATH_FINDING",[mt.MS]:"MONITORING"},ht={disabled:"disabled",auto:"auto",onlyAdditional:"onlyAdditional"},_t=X.mM(ut()(ht)),gt=X.Bk(Xe),bt=X.OT(X.dt({user_id:X.Z_,displayname:X.Z_,capabilities:X.Z_})),vt=bt,wt=X.OT(X.IM(X.Z_,vt)),Tt=e=>X.IX(Xe).is(Object.keys(e)),kt=new X.Ez("AddressMetadataMap",(e=>wt.is(e)&&Tt(e)),((e,t)=>{const n=wt.validate(e,t);if((0,G.isLeft)(n))return n;const a=n.right,i={};for(const[r,o]of Object.entries(a)){const e=Xe.validate(r,t);if((0,G.isLeft)(e))return e;i[e.right]=o}return X.Vp(i)}),wt.encode,wt,Tt),Et=X.r$({address_metadata:kt}),At=He(32),Nt=X.Bk(X.OT(X.jV([X.dt({path:gt,fee:At}),Et]))),It=X.Bk(X.OT(X.jV([X.G0([X.dt({route:gt}),X.dt({path:gt})]),X.G0([X.dt({fee:At}),X.dt({estimated_fee:At})]),Et]))),Rt=X.OT(X.dt({result:It})),Dt=X.OT(X.jV([X.dt({error_code:X.pk,errors:X.Z_}),X.r$({error_details:X.IM(X.Z_,X._4)})])),Ct=X.OT(X.dt({address:Xe,url:X.Z_,matrixServer:X.Z_,rtt:X.pk,price:je(32),token:Xe,validTill:X.pk})),St=X.OT(X.dt({sender:Xe,receiver:Xe,amount:je(32),claimable_until:je(32),one_to_n_address:Xe,chain_id:je(32)})),Ot=X.OT(X.dt({last_iou:tt(St)})),Pt=X.OT(X.dt({address:Xe,capacity:je(32),centrality:X.G0([X.pk,X.Z_]),score:X.G0([X.pk,X.Z_]),uptime:X.G0([X.pk,X.Z_])}),"SuggestedPartner"),xt=X.IX(Pt,"SuggestedPartners"),Mt=X.OT(X.IM(X.Z_,X.pk),"ServicesValidityMap");var Ut;(function(e){e["DELIVERED"]="Delivered",e["PROCESSED"]="Processed",e["SECRET_REQUEST"]="SecretRequest",e["SECRET_REVEAL"]="RevealSecret",e["LOCKED_TRANSFER"]="LockedTransfer",e["UNLOCK"]="Unlock",e["LOCK_EXPIRED"]="LockExpired",e["WITHDRAW_REQUEST"]="WithdrawRequest",e["WITHDRAW_CONFIRMATION"]="WithdrawConfirmation",e["WITHDRAW_EXPIRED"]="WithdrawExpired",e["PFS_CAPACITY_UPDATE"]="PFSCapacityUpdate",e["PFS_FEE_UPDATE"]="PFSFeeUpdate",e["MONITOR_REQUEST"]="RequestMonitoring"})(Ut||(Ut={}));const Lt=X.OT(X.dt({message_identifier:je(8)})),Bt=X.OT(X.dt({type:X.i0(Ut.DELIVERED),delivered_message_identifier:je(8)})),Ft=Bt,Wt=X.OT(X.jV([X.dt({type:X.i0(Ut.PROCESSED)}),Lt])),$t=Wt,Vt=X.OT(X.jV([X.dt({type:X.i0(Ut.SECRET_REQUEST),payment_identifier:je(8),secrethash:qe,amount:je(32),expiration:je(32)}),Lt])),Ht=Vt,jt=X.OT(X.jV([X.dt({type:X.i0(Ut.SECRET_REVEAL),secret:Ke}),Lt])),zt=jt,qt=X.OT(X.jV([X.dt({chain_id:je(32),token_network_address:Xe,channel_identifier:je(32),nonce:je(8),transferred_amount:je(32),locked_amount:je(32),locksroot:qe}),Lt])),Kt=X.OT(X.jV([X.dt({route:gt}),Et])),Zt=Kt,Gt=X.OT(X.dt({routes:X.Bk(Zt)})),Yt=Gt,Xt=X.OT(X.jV([X.dt({payment_identifier:je(8),token:Xe,recipient:Xe,lock:st,target:Xe,initiator:Xe,metadata:X._4}),qt])),Qt=X.OT(X.jV([X.dt({type:X.i0(Ut.LOCKED_TRANSFER)}),Xt])),Jt=Qt,en=X.OT(X.jV([X.dt({type:X.i0(Ut.UNLOCK),payment_identifier:je(8),secret:Ke}),qt])),tn=en,nn=X.OT(X.jV([X.dt({type:X.i0(Ut.LOCK_EXPIRED),recipient:Xe,secrethash:qe}),qt])),an=nn,rn=X.OT(X.dt({chain_id:je(32),token_network_address:Xe,channel_identifier:je(32),participant:Xe,total_withdraw:je(32),nonce:je(8),expiration:je(32)})),on=X.OT(X.jV([X.dt({type:X.i0(Ut.WITHDRAW_REQUEST)}),X.r$({coop_settle:X.O7}),rn,Lt])),sn=on,cn=X.OT(X.jV([X.dt({type:X.i0(Ut.WITHDRAW_CONFIRMATION)}),rn,Lt])),ln=cn,dn=X.OT(X.jV([X.dt({type:X.i0(Ut.WITHDRAW_EXPIRED)}),rn,Lt])),pn=dn,un=X.OT(X.dt({type:X.i0(Ut.PFS_CAPACITY_UPDATE),canonical_identifier:X.OT(X.dt({chain_identifier:je(32),token_network_address:Xe,channel_identifier:je(32)})),updating_participant:Xe,other_participant:Xe,updating_nonce:je(8),other_nonce:je(8),updating_capacity:je(32),other_capacity:je(32),reveal_timeout:je(32)})),mn=un,yn=X.OT(X.dt({type:X.i0(Ut.PFS_FEE_UPDATE),canonical_identifier:X.OT(X.dt({chain_identifier:je(32),token_network_address:Xe,channel_identifier:je(32)})),updating_participant:Xe,timestamp:X.Z_,fee_schedule:X.dt({cap_fees:X.O7,imbalance_penalty:X.G0([X.lB,X.Bk(X.OT(X.bc([je(32),je(32)])))]),proportional:At,flat:At})})),fn=yn,hn=X.OT(X.dt({type:X.i0(Ut.MONITOR_REQUEST),balance_proof:X.dt({chain_id:je(32),token_network_address:Xe,channel_identifier:je(32),nonce:je(8),balance_hash:qe,additional_hash:qe,signature:ze}),monitoring_service_contract_address:Xe,non_closing_participant:Xe,non_closing_signature:ze,reward_amount:je(32)})),_n=hn,gn=[Ft,$t,Ht,zt,Jt,tn,an,sn,ln,pn,mn,fn,_n],bn=gn,vn=X.G0(bn);var wn=n(40604),Tn=n(52822),kn=n(17137),En=n(23183),An=n(52079),Nn=n(55569),In=n(71563),Rn=n(5834),Dn=n.n(Rn),Cn=n(55954);function Sn(...e){const[t,n,a,i]=e,r=X.OT(X.dt({type:X.i0(t),...n?{payload:n}:null,...a?{meta:a}:null,...i?{error:X.i0(!0)}:null})),o=e=>(null===e||void 0===e?void 0:e["type"])===t;return Object.assign((function(e,r){return{type:t,...n?{payload:e}:{},...a?{meta:r}:{},...i?{error:i}:{}}}),{type:t,is:o,codec:r,error:i})}function On(e,...t){function n(e){return"function"===typeof this?this.is(e):Array.isArray(this)?this.some((t=>n.call(t,e))):"object"===typeof this&&n.call(Object.values(this),e)}return t.length>0?n.call(e,t[0]):n.bind(e)}function Pn(...e){var t;return{request:Sn(`${e[1]}/request`,e[2],e[0]),success:Sn(`${e[1]}/success`,e[3],e[0]),failure:Sn(`${e[1]}/failure`,null!==(t=e[4])&&void 0!==t?t:X._4,e[0],!0)}}function xn(e,...t){const n=t=>Dn()(t.meta,e,((e,t)=>$e.is(e)&&$e.is(t)?e.eq(t):void 0));return t.length?n(t[0]):n}function Mn(e,t,...n){const a=n=>On([e.success,e.failure],n)&&xn(t,n);return n.length?a(n[0]):a}function Un(e,t,...n){function a(e){var t;return"boolean"===typeof(null===e||void 0===e||null===(t=e["payload"])||void 0===t?void 0:t["confirmed"])}const i=n=>Mn(e,t,n)&&(e.failure.is(n)||a(n));return n.length?i(n[0]):i}async function Ln(e,t,n,a){return(0,M.z)(n.pipe((0,$.h)(a?Un(e,t):Mn(e,t)),(0,$.h)((t=>void 0===a||!e.success.is(t)||"confirmed"in t.payload)),(0,Cn.q)(1),(0,W.U)((t=>{var n;if(e.failure.is(t))throw t.payload;if(!1===(null===(n=t.payload)||void 0===n?void 0:n.confirmed))throw new xe(Ae.RDN_TRANSACTION_REORG,{transactionHash:t.payload.txHash});return t.payload}))),{defaultValue:void 0})}function Bn(e){function t(n){const a=(t=e,a)=>{const i=n[a.type];return i&&i[0].is(a)?i[1](t,a):t};function i(e,a){const i=Array.isArray(e)?e:[e];return Me(!i.some((e=>e.type in n)),"Already handled"),t(Object.assign({},n,...i.map((e=>({[e.type]:[e,a]})))))}return Object.assign(a,{handle:i})}return t({})}var Fn=n(77375),Wn=n.n(Fn);function $n(e,t){let n;if("boolean"===typeof e?e=e?v.fh:v._Y:"number"===typeof e&&(e=g.O$.from(e)),"string"!==typeof e||(0,re.A7)(e)||(e=(0,Tn.Y0)(e)),(0,re.Zq)(e)&&(e=(0,re.Dv)(e)),$e.is(e)){if(e.lt(0))throw new xe(Ae.DTA_NEGATIVE_NUMBER);if(e.gte(v.Py.pow(8*t)))throw new xe(Ae.DTA_NUMBER_TOO_LARGE);n=(0,re.$m)((0,re.Dv)(e),t)}else{if("string"!==typeof e)throw new xe(Ae.DTA_UNENCODABLE_DATA);if((0,re.E1)(e)!==t)throw new xe(Ae.DTA_ARRAY_LENGTH_DIFFERENCE);n=e}return n}const Vn=Wn()({storeAsString:!0}),Hn=Vn.parse,jn=Vn.stringify,zn=X.OT(X.dt({userId:X.Z_,accessToken:X.Z_,deviceId:X.Z_,displayName:X.Z_})),qn=X.r$({userId:X.Z_}),Kn=X.G0([X.Z_,X.pk,X.O7,X.lB],"CapsPrimitive"),Zn=X.G0([Kn,X.IX(Kn)],"CapsValue"),Gn=X.OT(X.IM(X.Z_,Zn),"Caps"),Yn=X.dt({address:Xe}),Xn=Sn("matrix/setup",X.dt({server:X.Z_,setup:zn})),Qn=Pn(Yn,"matrix/presence",void 0,X.jV([X.dt({userId:X.Z_,available:X.O7,ts:X.pk,pubkey:Ge}),X.r$({caps:Gn})])),Jn=Sn("rtc/channel",X.G0([X.S1,nt("RTCDataChannel")]),Yn),ea=/^@(0x[0-9a-f]{40})[.:]/i;function ta(e){let t;try{const n=ea.exec(e);n&&(t=(0,ve.Kn)(n[1]))}catch(n){}return t}function na(e){const t=new URL("mxc://raiden.network/cap"),n=(e,n)=>t.searchParams.append(e,n);for(const[a,i]of Object.entries(e))Array.isArray(i)?i.forEach(n.bind(null,a)):n(a,i);return t.href}function aa(e){if(!e)return;const t={};try{const n=new URL(e);return n.searchParams.forEach(((e,n)=>{let a=e;if(/^\d+$/.test(e))a=Hn(e);else{const t=e.toLowerCase();"none"===t||"null"===t?a=null:"false"===t?a=!1:"true"===t&&(a=!0)}let i=t[n];void 0===i?t[n]=a:(Array.isArray(i)||(t[n]=i=[i]),i.push(a))})),t}catch(n){}}function ia(e,t){var n;return null!==(n=null===e||void 0===e?void 0:e[t])&&void 0!==n?n:ue[t]}function ra(){const e={};return(0,An.z)((0,$.h)(Qn.success.is),(0,Nn.R)(((e,t)=>({...e,[t.payload.userId]:t})),e),(0,In.O)(e))}function oa(){const e={};return(0,An.z)((0,$.h)(On([Qn.success,Qn.failure])),(0,Nn.R)(((e,t)=>(Qn.success.is(t)&&t.payload.available?e[t.meta.address]=t:t.meta.address in e&&delete e[t.meta.address],e)),e),(0,In.O)(e))}function sa(e){return!!e&&!ia(e.payload.caps,pe.DELIVERY)}const ca=Pn(X.dt({address:Xe,msgId:X.Z_}),"message/send",X.jV([X.dt({message:X.G0([X.Z_,tt(vn)])}),X.r$({msgtype:X.Z_}),qn]),X.G0([X.S1,X.dt({via:X.Z_,tookMs:X.pk,retries:X.pk})])),la=Pn(X.dt({service:yt,msgId:X.Z_}),"message/service/send",X.dt({message:tt(vn)}),X.G0([X.S1,X.dt({via:X._4,tookMs:X.pk,retries:X.pk})])),da=Sn("message/received",X.jV([X.dt({text:X.Z_,ts:X.pk}),X.r$({message:X.G0([vn,tt(vn)]),userId:X.Z_,msgtype:X.Z_})]),X.dt({address:Xe})),pa={[Ut.DELIVERED]:12,[Ut.PROCESSED]:0,[Ut.SECRET_REQUEST]:3,[Ut.SECRET_REVEAL]:11,[Ut.LOCKED_TRANSFER]:7,[Ut.UNLOCK]:4,[Ut.LOCK_EXPIRED]:13,[Ut.WITHDRAW_REQUEST]:15,[Ut.WITHDRAW_CONFIRMATION]:16,[Ut.WITHDRAW_EXPIRED]:17,[Ut.PFS_CAPACITY_UPDATE]:-1,[Ut.PFS_FEE_UPDATE]:-1,[Ut.MONITOR_REQUEST]:-1};var ua;function ma(e){return(0,oe.w)((0,Tn.Y0)((0,En.M)(e)))}function ya({transferredAmount:e,lockedAmount:t,locksroot:n}){let a=ie.R;return e.isZero()&&t.isZero()&&(n===ie.R||n===le)||(a=(0,oe.w)((0,re.zo)([$n(e,32),$n(t,32),$n(n,32)]))),a}function fa(e){let t;switch(e.type){case Ut.LOCKED_TRANSFER:t=(0,oe.w)((0,re.zo)([$n(pa[e.type],1),$n(e.message_identifier,8),$n(e.payment_identifier,8),$n(e.lock.expiration,32),$n(e.token,20),$n(e.recipient,20),$n(e.target,20),$n(e.initiator,20),$n(e.lock.secrethash,32),$n(e.lock.amount,32),ma(e.metadata)]));break;case Ut.UNLOCK:t=(0,oe.w)((0,re.zo)([$n(pa[e.type],1),$n(e.message_identifier,8),$n(e.payment_identifier,8),$n(e.secret,32)]));break;case Ut.LOCK_EXPIRED:t=(0,oe.w)((0,re.zo)([$n(pa[e.type],1),$n(e.message_identifier,8),$n(e.recipient,20),$n(e.secrethash,32)]));break}return t}function ha(e){switch(e.type){case Ut.DELIVERED:return(0,re.Dv)((0,re.zo)([$n(pa[e.type],1),$n(0,3),$n(e.delivered_message_identifier,8)]));case Ut.PROCESSED:return(0,re.Dv)((0,re.zo)([$n(pa[e.type],1),$n(0,3),$n(e.message_identifier,8)]));case Ut.LOCKED_TRANSFER:case Ut.UNLOCK:case Ut.LOCK_EXPIRED:{const t=fa(e),n=ya({transferredAmount:e.transferred_amount,lockedAmount:e.locked_amount,locksroot:e.locksroot});return(0,re.Dv)((0,re.zo)([$n(e.token_network_address,20),$n(e.chain_id,32),$n(ua.BALANCE_PROOF,32),$n(e.channel_identifier,32),$n(n,32),$n(e.nonce,32),$n(t,32)]))}case Ut.SECRET_REQUEST:return(0,re.Dv)((0,re.zo)([$n(pa[e.type],1),$n(0,3),$n(e.message_identifier,8),$n(e.payment_identifier,8),$n(e.secrethash,32),$n(e.amount,32),$n(e.expiration,32)]));case Ut.SECRET_REVEAL:return(0,re.Dv)((0,re.zo)([$n(pa[e.type],1),$n(0,3),$n(e.message_identifier,8),$n(e.secret,32)]));case Ut.WITHDRAW_REQUEST:case Ut.WITHDRAW_CONFIRMATION:return(0,re.Dv)((0,re.zo)([$n(e.token_network_address,20),$n(e.chain_id,32),$n(ua.WITHDRAW,32),$n(e.channel_identifier,32),$n(e.participant,20),$n(e.total_withdraw,32),$n(e.expiration,32)]));case Ut.WITHDRAW_EXPIRED:return(0,re.Dv)((0,re.zo)([$n(pa[e.type],1),$n(0,3),$n(e.nonce,32),$n(e.message_identifier,8),$n(e.token_network_address,20),$n(e.chain_id,32),$n(ua.WITHDRAW,32),$n(e.channel_identifier,32),$n(e.participant,20),$n(e.total_withdraw,32),$n(e.expiration,32)]));case Ut.PFS_CAPACITY_UPDATE:return(0,re.Dv)((0,re.zo)([$n(e.canonical_identifier.chain_identifier,32),$n(e.canonical_identifier.token_network_address,20),$n(e.canonical_identifier.channel_identifier,32),$n(e.updating_participant,20),$n(e.other_participant,20),$n(e.updating_nonce,8),$n(e.other_nonce,8),$n(e.updating_capacity,32),$n(e.other_capacity,32),$n(e.reveal_timeout,32)]));case Ut.PFS_FEE_UPDATE:return(0,re.Dv)((0,re.zo)([$n(e.canonical_identifier.chain_identifier,32),$n(e.canonical_identifier.token_network_address,20),$n(e.canonical_identifier.channel_identifier,32),$n(e.updating_participant,20),$n(e.fee_schedule.cap_fees,1),$n(e.fee_schedule.flat,32),$n(e.fee_schedule.proportional,32),(0,wn.c)(e.fee_schedule.imbalance_penalty?e.fee_schedule.imbalance_penalty.map((e=>e.map((e=>e.isZero()?"0x":e.toHexString())))):"0x"),(0,Tn.Y0)(e.timestamp)]));case Ut.MONITOR_REQUEST:return(0,re.Dv)((0,re.zo)([$n(e.monitoring_service_contract_address,20),$n(e.balance_proof.chain_id,32),$n(ua.MS_REWARD,32),$n(e.balance_proof.token_network_address,20),$n(e.non_closing_participant,20),$n(e.non_closing_signature,65),$n(e.reward_amount,32)]))}}function _a(e){return ze.is(e.signature)}function ga(e,t){return!ia(t,pe.IMMUTABLE_METADATA)&&"metadata"in e&&(e={...e,metadata:Fe(Yt,e.metadata)}),(0,kn.n5)((0,re.lE)(ha(e)),e.signature)}function ba(e){return{chainId:e.chain_id,tokenNetworkAddress:e.token_network_address,channelId:e.channel_identifier,nonce:e.nonce,transferredAmount:e.transferred_amount,lockedAmount:e.locked_amount,locksroot:e.locksroot,additionalHash:fa(e),signature:e.signature}}function va(e){return jn("signature"in e?tt(vn).encode(e):vn.encode(e))}function wa(e){const t=Hn(e);return Me(t&&"object"===typeof t&&"type"in t&&Object.values(Ut).some((e=>e===t["type"])),`Invalid message type: ${null===t||void 0===t?void 0:t["type"]}`),Fe("signature"in t?tt(vn):vn,t)}async function Ta(e,t,{log:n}={log:y()}){if(_a(t))return t;n.debug(`Signing message "${t.type}"`,t);const a=await e.signMessage((0,re.lE)(ha(t)));return{...t,signature:a}}function ka(e){return t=>da.is(t)&&(Array.isArray(e)?e.some((e=>e.is(t.payload.message))):e.is(t.payload.message))}function Ea(e,t,{log:n}){if("string"===typeof e)try{const n=wa(e);if("signature"in n){const e=ga(n,t.payload.caps);Me(e===t.meta.address,[Ae.TRNS_MESSAGE_SIGNATURE_MISMATCH,{sender:t.meta.address,signer:e}])}return n}catch(a){n.warn(`Could not decode message: ${e}: ${a}`)}}(function(e){e[e["BALANCE_PROOF"]=1]="BALANCE_PROOF",e[e["BALANCE_PROOF_UPDATE"]=2]="BALANCE_PROOF_UPDATE",e[e["WITHDRAW"]=3]="WITHDRAW",e[e["COOP_SETTLE"]=4]="COOP_SETTLE",e[e["IOU"]=5]="IOU",e[e["MS_REWARD"]=6]="MS_REWARD"})(ua||(ua={}));const Aa=X.dt({tokenNetwork:Xe,partner:Xe}),Na=Sn("block/new",X.dt({blockNumber:X.pk})),Ia=Sn("block/time",X.dt({blockTime:X.pk})),Ra=Sn("block/stale",X.dt({stale:X.O7})),Da=Sn("contract/settleTimeout",X.pk),Ca=Sn("token/monitored",X.jV([X.dt({token:Xe,tokenNetwork:Xe}),X.r$({fromBlock:X.pk,toBlock:X.pk})])),Sa=Pn(Aa,"channel/open",X.r$({deposit:je(32)}),X.dt({id:X.pk,token:Xe,isFirstParticipant:X.O7,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),Oa=Sn("channel/monitored",X.dt({id:X.pk}),Aa),Pa=Pn(Aa,"channel/deposit",X.jV([X.G0([X.dt({deposit:je(32)}),X.dt({totalDeposit:je(32)})]),X.r$({waitOpen:X.i0(!0)})]),X.dt({id:X.pk,participant:Xe,totalDeposit:je(32),txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),xa=Sn("channel/withdraw/success",X.dt({id:X.pk,participant:Xe,totalWithdraw:je(32),txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])}),Aa),Ma=Pn(Aa,"channel/close",X.S1,X.dt({id:X.pk,participant:Xe,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),Ua=Sn("channel/settleable",X.dt({settleableBlock:X.pk}),Aa),La=X.bc([tt(sn),tt(ln)]),Ba=Pn(Aa,"channel/settle",X.G0([X.dt({coopSettle:X.bc([La,La])}),X.S1]),X.jV([X.dt({id:X.pk,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])}),X.r$({locks:X.Bk(st)})]));var Fa=n(25900),Wa=n(88482),$a=n(47860),Va=n(551),Ha=n.n(Va),ja=n(96313),za=n(66974),qa=n(97826),Ka=n(4534),Za=n(3184),Ga=n(90922),Ya=n(36005),Xa=n(93260),Qa=n(80855),Ja=n(23741),ei=n(89254),ti=n(36431),ni=n(7525),ai=n(16926),ii=n(35083),ri=n(41952),oi=n(83457);const si=(...e)=>(0,An.z)((0,H.j)(...e),(0,Ya.x)());function ci(e=((e,t)=>e===t)){return(0,An.z)((0,Ya.x)(),(0,q.z)((e=>Object.entries(e))),(0,Nn.R)((({acc:t},[n,a])=>e(t[n],a)?{acc:t}:{acc:{...t,[n]:a},changed:[n,a]}),{acc:{}}),(0,H.j)("changed"),(0,$.h)(We))}function li(e,t=3e4){return(0,An.z)((0,Xa.a)((e=>e.pipe((0,W.U)((()=>{if("number"===typeof t)return t;const e=t.next();return e.done?-1:e.value})),(0,Qa.o)((e=>e>=0)),(0,Ja.w)((e=>(0,ja.H)(e)))))),(0,ei.R)(e))}function di(e){return Symbol.iterator in e}function pi(e,t={}){let n,a;return t.log&&(t={...t,log:t.log.bind(null,"retryWhile")}),i=>(0,Wa.P)((()=>(n=void 0,a=Ie(t),(0,U.D)(i).pipe((0,ti.b)((()=>{n=void 0,a=Ie(t)})),(0,ni.a)((t=>t.pipe((0,q.z)((t=>{let i;if("number"===typeof e)i=e;else{n||(n=di(e)?e[Symbol.iterator]():e);const t=n.next();i=t.done?-1:t.value}if(i<=0||!a(t))throw t;return(0,ja.H)(i)})))))))))}function ui(e,...t){return(0,Wa.P)(e).pipe(pi(...t))}function mi(e,t=!1){return n=>{const a=new za.x;return e.pipe((0,W.U)((e=>t?!e:!!e)),(0,Ya.x)(),(0,ei.R)(a),(0,Ja.w)((e=>e?n.pipe((0,ti.b)({complete:()=>a.next(!0)})):L.E)))}}function yi(e,t){return(0,An.z)((0,ei.R)(e.pipe(fi(Ha()(void 0===t?(0,P.of)(0):(0,ja.H)(t))))))}function fi(e){return(0,An.z)((0,ai.Z)(void 0,null),(0,q.z)(e))}function hi(e){return t=>(0,qa.S)((0,ja.H)(e).pipe((0,ii.j)((0,Ka._)((()=>new Error("timeout waiting first"))))),t)}function _i(e,t=q.z){return(0,An.z)(t(((t,n)=>(0,U.D)(e(t,n)).pipe((0,W.U)((e=>[t,e]))))))}function gi(e,...t){e.log&&t.length&&(e={...e,log:e.log.bind(null,...t)});const n=Ie(e);return(0,An.z)((0,K.K)((e=>{if(!n(e))throw e;return L.E})))}function bi(e,t,n=!1,a=(e=>e)){return i=>(0,Wa.P)((()=>{const r=new za.x,o=new Map,s=(0,Wa.P)((()=>t((t=>{const s=a(t),c=o.get(s);if(c)return c;const l=new Za.t(1),d=i.pipe((0,$.h)(Mn(e,t.meta)),(0,W.U)((t=>{if(e.failure.is(t))throw t.payload;return t})),(0,Qa.o)((e=>n&&"confirmed"in e.payload&&void 0===e.payload.confirmed),!0)).subscribe(l);r.next(t);const p=l.pipe((0,ri.x)((()=>{d.unsubscribe(),o.delete(s)})));return o.set(s,p),p})))).pipe((0,ri.x)((()=>r.complete())));return(0,Fa.T)(r,s)}))}function vi(e,t){return n=>{const[a,i]=(0,Ga.u)(n.pipe((0,oi.B)()),e);return(0,Fa.T)(t(a),i)}}const wi={SENT:"sent",RECEIVED:"received"},Ti=X.mM(ut()(wi)),ki=X.OT(X.jV([X.dt({_id:X.Z_,channel:X.Z_,direction:Ti,secrethash:qe,expiration:X.pk,transfer:Qe(tt(Jt)),fee:At,partner:Xe,cleared:X.pk},"TransferStateBase"),X.r$({secret:Ke,secretRegistered:Qe(X.dt({txHash:qe,txBlock:X.pk})),transferProcessed:Qe(tt($t)),channelClosed:Qe(X.dt({txHash:qe,txBlock:X.pk})),channelSettled:Qe(X.dt({txHash:qe,txBlock:X.pk})),secretRequest:Qe(tt(Ht)),secretReveal:Qe(tt(zt)),unlock:Qe(tt(tn)),expired:Qe(tt(an)),unlockProcessed:Qe(tt($t)),expiredProcessed:Qe(tt($t))},"TransferStateOpts")])),Ei=ki;var Ai;(function(e){e["pending"]="PENDING",e["received"]="RECEIVED",e["closed"]="CLOSED",e["requested"]="REQUESTED",e["revealed"]="REVEALED",e["registered"]="REGISTERED",e["unlocking"]="UNLOCKING",e["expiring"]="EXPIRING",e["unlocked"]="UNLOCKED",e["expired"]="EXPIRED"})(Ai||(Ai={}));const Ni=X.jV([X.dt({secret:Ke,amount:je(32)}),X.r$({payment_identifier:je(8)})]);function*Ii(e=1e3,t=6e4,n=1.4){let a=e;while(1)yield a,a=Math.min(t,Math.ceil(a*n))}function Ri(e,t,n){return(0,Fa.T)(e.pipe((0,$.h)(n),(0,Cn.q)(1),(0,$a.l)()),(0,P.of)(t))}function Di(e,t,n,a=3e4){let i=!0;return(0,Wa.P)((()=>{if(i)i=!1;else if(e.payload.userId){const{userId:t,...n}=e.payload;e={...e,payload:n}}return Ri(t,e,Mn(ca,e.meta))})).pipe(li(n,a),yi(t))}function Ci(e,t){return n=>n.type===e&&(!t||n.expiration.eq(t.expiration)&&n.total_withdraw.eq("totalWithdraw"in t?t.totalWithdraw:t.total_withdraw))}function Si(e,t){return{tokenNetwork:t.tokenNetwork,partner:t.partner.address,direction:e.participant===t.partner.address?wi.RECEIVED:wi.SENT,expiration:e.expiration.toNumber(),totalWithdraw:e.total_withdraw}}const Oi=X.dt({urls:X.G0([X.Z_,X.IX(X.Z_)])}),Pi=X.OT(X.jV([X.dt({matrixServerLookup:X.Z_,revealTimeout:X.pk,expiryFactor:X.pk,httpTimeout:X.pk,additionalServices:X.Bk(X.G0([Xe,X.Z_])),pfsMode:_t,pfsSafetyMargin:X.G0([X.pk,X.bc([X.pk,X.pk])]),pfsMaxPaths:X.pk,pfsMaxFee:je(32),pfsIouTimeout:X.pk,confirmationBlocks:X.pk,monitoringReward:X.G0([X.lB,je(32)]),logger:X.mM({[""]:null,trace:null,debug:null,info:null,warn:null,error:null}),caps:X.G0([X.lB,Gn]),fallbackIceServers:X.IX(Oi),rateToSvt:X.IM(X.Z_,je(32)),pollingInterval:X.pk,minimumAllowance:je(32),autoSettle:X.O7,autoUDCWithdraw:X.O7,mediationFees:X._4,encryptSecret:X.O7}),X.r$({matrixServer:X.Z_,subkey:X.O7,gasPriceFactor:X.G0([X.pk,X.lB])})])),xi=X.OT(X.iG(X.r$({...Pi.type.types["0"].props,...Pi.type.types["1"].props}))),Mi=new Set([421611,42161]);function Ui({network:e},t){const n=1===e.chainId?"https://raw.githubusercontent.com/raiden-network/raiden-service-bundle/master/known_servers/known_servers-production-v1.2.0.json":"https://raw.githubusercontent.com/raiden-network/raiden-service-bundle/master/known_servers/known_servers-development-v1.2.0.json",a=null===(null===t||void 0===t?void 0:t.caps)?null:{[pe.DELIVERY]:0,[pe.MEDIATE]:0,[pe.TO_DEVICE]:1,[pe.IMMUTABLE_METADATA]:1,...null===t||void 0===t?void 0:t.caps};return{matrixServerLookup:n,revealTimeout:_e,expiryFactor:1.1,httpTimeout:3e4,additionalServices:[],pfsMode:ht.auto,pfsSafetyMargin:1,pfsMaxPaths:be,pfsMaxFee:(0,se.fi)("0.05"),pfsIouTimeout:ge,confirmationBlocks:Mi.has(e.chainId)?0:ye,monitoringReward:he,logger:"info",fallbackIceServers:[{urls:"stun:stun.l.google.com:19302"}],rateToSvt:{},pollingInterval:1e3*fe,minimumAllowance:v.Bz,autoSettle:!1,autoUDCWithdraw:!0,mediationFees:{},encryptSecret:!0,...t,caps:a}}function Li(e){const t={_iter:void 0,[Symbol.iterator](){return this._iter=void 0,this},next(){if(!this._iter){let t=5e3,n=6e4;e.pipe((0,Z.P)()).subscribe((({pollingInterval:e,httpTimeout:a})=>{t=e,n=2*a})),this._iter=Ii(t,n)}return this._iter.next()}};return t}const Bi=X.dt({tokenNetwork:Xe,target:Xe,value:je(32)}),Fi=X.dt({tokenNetwork:Xe,serviceAddress:Xe}),Wi=Pn(Bi,"path/find",X.r$({paths:It,pfs:X.G0([Ct,X.lB])}),X.dt({paths:Nt})),$i=Sn("services/valid",Mt),Vi=Sn("iou/persist",X.dt({iou:tt(St)}),Fi),Hi=Sn("iou/clear",void 0,Fi),ji=Pn(X.dt({totalDeposit:je(32)}),"udc/deposit",X.dt({deposit:je(32)}),X.G0([X.dt({balance:je(32)}),X.dt({balance:je(32),txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})])),zi=X.dt({amount:je(32)}),qi=Pn(zi,"udc/withdraw/plan",X.S1,X.jV([X.dt({withdrawableAfter:X.pk}),X.r$({txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})])),Ki=Pn(zi,"udc/withdraw",X.G0([X.S1,X.r$({subkey:X.O7})]),X.dt({withdrawal:je(32),beneficiary:Xe,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),Zi=Sn("ms/balanceProof/sent",X.dt({tokenNetwork:Xe,partner:Xe,id:X.pk,reward:je(32),nonce:je(8),monitoringService:Xe,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),Gi=X.dt({secrethash:qe,direction:Ti}),Yi=Pn(Gi,"transfer",X.jV([X.dt({tokenNetwork:Xe,target:Xe,value:je(32),paymentId:je(8)}),X.G0([X.jV([X.dt({resolved:X.i0(!1)}),X.r$({paths:It,pfs:X.G0([Ct,X.lB]),encryptSecret:X.O7})]),X.jV([X.dt({resolved:X.i0(!0),metadata:X._4,fee:At,partner:Xe}),qn])]),X.r$({secret:Ke,initiator:Xe}),X.G0([X.r$({expiration:X.pk}),X.r$({lockTimeout:X.pk})])]),X.r$({balanceProof:tt(lt)})),Xi=Sn("transfer/signed",X.jV([X.dt({message:tt(Jt),fee:At,partner:Xe}),qn]),Gi),Qi=Sn("transfer/processed",X.jV([X.dt({message:tt($t)}),qn]),Gi),Ji=Sn("transfer/secret",X.dt({secret:Ke}),Gi),er=Pn(Gi,"transfer/secret/register",X.dt({secret:Ke}),X.dt({secret:Ke,txTimestamp:X.pk,txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),tr=Sn("transfer/secret/request",X.jV([X.dt({message:tt(Ht)}),qn]),Gi),nr=Sn("transfer/secret/reveal",X.jV([X.dt({message:tt(zt)}),qn]),Gi),ar=Pn(Gi,"transfer/unlock",X.G0([X.S1,qn]),X.jV([X.dt({message:tt(tn),partner:Xe}),qn])),ir=Sn("transfer/unlock/processed",X.jV([X.dt({message:tt($t)}),qn]),Gi),rr=Pn(Gi,"transfer/expire",void 0,X.dt({message:tt(an),partner:Xe})),or=Sn("transfer/expire/processed",X.jV([X.dt({message:tt($t)}),qn]),Gi),sr=Sn("transfer/clear",X.S1,Gi),cr=Sn("transfer/load",Ei,Gi),lr=X.dt({direction:Ti,tokenNetwork:Xe,partner:Xe,totalWithdraw:je(32),expiration:X.pk}),dr=Sn("withdraw/resolve",X.G0([X.S1,X.dt({coopSettle:X.i0(!0)})]),lr),pr=Pn(lr,"withdraw",X.G0([X.S1,X.dt({coopSettle:X.O7})]),X.dt({txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})),ur=Pn(lr,"withdraw/message",X.dt({message:tt(sn)}),X.dt({message:tt(ln)})),mr=Sn("withdraw/busy",X.S1,lr),yr=Pn(lr,"withdraw/expire",X.S1,X.dt({message:tt(pn)})),fr=Sn("withdraw/completed",X.S1,lr),hr=Sn("raiden/shutdown",X.dt({reason:X.G0([X.i0(de.STOP),X.i0(de.ACCOUNT_CHANGED),X.i0(de.NETWORK_CHANGED),Le])})),_r=Sn("raiden/config/update",xi),gr=Sn("raiden/config/caps",X.dt({caps:X.G0([Gn,X.lB])})),br=Sn("raiden/started"),vr=Sn("raiden/synced",X.dt({tookMs:X.pk,initialBlock:X.pk,currentBlock:X.pk})),wr={raidenShutdown:hr,raidenConfigUpdate:_r,raidenConfigCaps:gr,raidenStarted:br,raidenSynced:vr,...r,...a,...i,...s,...o},Tr=[wr.raidenShutdown,wr.newBlock,wr.matrixPresence.success,wr.tokenMonitored,wr.udcWithdrawPlan.success,wr.udcWithdrawPlan.failure,wr.udcWithdraw.success,wr.udcWithdraw.failure,wr.msBalanceProofSent,wr.channelSettle.success,wr.channelSettle.failure,wr.channelOpen.success,wr.channelOpen.failure],kr=ae()(wr,((e,t)=>({...e,..."type"in t?{[t.type]:t}:J()(t,te()("type"))})),{}),Er=X.OT(X.dt({type:X.Z_,payload:X.dt({txHash:qe,txBlock:X.pk,confirmed:X.G0([X.S1,X.O7])})})),Ar=new X.Dy("ConfirmableAction",Er.is,((e,t)=>(0,Y.pipe)(Er.validate(e,t),(0,G.chain)((e=>{const n=e.type;return n in kr?kr[n].codec.validate(e,t):X.Rn(e,t)})))),(e=>kr[e.type].codec.encode(e)));var Nr;(function(e){e["open"]="open",e["closing"]="closing",e["closed"]="closed",e["settleable"]="settleable",e["settling"]="settling",e["settled"]="settled"})(Nr||(Nr={}));const Ir=X.OT(X.dt({address:Xe,deposit:je(32),withdraw:je(32),locks:X.Bk(st),balanceProof:tt(lt),pendingWithdraws:X.Bk(X.G0([tt(sn),tt(ln),tt(pn)])),nextNonce:je(8)}),"ChannelEnd"),Rr=Ir,Dr=X.jV([X.OT(X.dt({_id:ot,id:X.pk,token:Xe,tokenNetwork:Xe,isFirstParticipant:X.O7,openBlock:X.pk,own:Rr,partner:Rr}),"Channel"),X.G0([X.OT(X.dt({state:X.G0([X.i0(Nr.open),X.i0(Nr.closing)])}),"state[open|closing]"),X.jV([X.OT(X.dt({closeBlock:X.pk,closeParticipant:Xe}),"ChannelClosed"),X.G0([X.OT(X.dt({state:X.G0([X.i0(Nr.closed),X.i0(Nr.settleable),X.i0(Nr.settling)])}),"state[closed|settleable|settling]"),X.OT(X.dt({state:X.i0(Nr.settled),settleBlock:X.pk}),"state[settled]")])])])]);var Cr=n(77506),Sr=n(8443),Or=n(8167),Pr=n(86605),xr=n(25302),Mr=n(26868),Ur=n(67425),Lr=n.n(Ur),Br=n(79576),Fr=n(79682),Wr=n(6489),$r=n(94332),Vr=n(13017);const Hr=[{inputs:[{internalType:"address",name:"new_controller",type:"address"}],name:"changeController",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"controller",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}];class jr{static createInterface(){return new Vr.vU(Hr)}static connect(e,t){return new $r.CH(e,Hr,t)}}jr.abi=Hr;const zr=[{inputs:[{internalType:"uint256",name:"initial_supply",type:"uint256"},{internalType:"uint8",name:"decimal_units",type:"uint8"},{internalType:"string",name:"token_name",type:"string"},{internalType:"string",name:"token_symbol",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!0,internalType:"uint256",name:"_num",type:"uint256"}],name:"Minted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"_decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"remaining",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"decimals",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"num",type:"uint256"}],name:"mint",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"num",type:"uint256"},{internalType:"address",name:"target",type:"address"}],name:"mintFor",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"multiplier",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner_address",outputs:[{internalType:"address payable",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"supply",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"transferFunds",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];class qr{static createInterface(){return new Vr.vU(zr)}static connect(e,t){return new $r.CH(e,zr,t)}}qr.abi=zr;const Kr=[{inputs:[{internalType:"contract Token",name:"_token",type:"address"},{internalType:"uint256",name:"_release_at",type:"uint256"},{internalType:"address",name:"_withdrawer",type:"address"},{internalType:"contract ServiceRegistryConfigurableParameters",name:"_service_registry",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"token",outputs:[{internalType:"contract Token",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address payable",name:"_to",type:"address"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"withdrawable_after",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdrawer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}];class Zr{static createInterface(){return new Vr.vU(Kr)}static connect(e,t){return new $r.CH(e,Kr,t)}}Zr.abi=Kr;const Gr=[{inputs:[{internalType:"uint256",name:"_initialAmount",type:"uint256"},{internalType:"uint8",name:"_decimalUnits",type:"uint8"},{internalType:"string",name:"_tokenName",type:"string"},{internalType:"string",name:"_tokenSymbol",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"_decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"remaining",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"},{internalType:"bytes",name:"_extraData",type:"bytes"}],name:"approveAndCall",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"decimals",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"supply",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];class Yr{static createInterface(){return new Vr.vU(Gr)}static connect(e,t){return new $r.CH(e,Gr,t)}}Yr.abi=Gr;const Xr=[{inputs:[{internalType:"address",name:"_token_address",type:"address"},{internalType:"address",name:"_service_registry_address",type:"address"},{internalType:"address",name:"_udc_address",type:"address"},{internalType:"address",name:"_token_network_registry_address",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token_network_address",type:"address"},{indexed:!1,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!1,internalType:"uint256",name:"reward_amount",type:"uint256"},{indexed:!0,internalType:"uint256",name:"nonce",type:"uint256"},{indexed:!0,internalType:"address",name:"ms_address",type:"address"},{indexed:!0,internalType:"address",name:"raiden_node_address",type:"address"}],name:"NewBalanceProofReceived",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"ms_address",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"reward_identifier",type:"bytes32"}],name:"RewardClaimed",type:"event"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"token_network_address",type:"address"},{internalType:"address",name:"closing_participant",type:"address"},{internalType:"address",name:"non_closing_participant",type:"address"}],name:"claimReward",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"closed_at_timestamp",type:"uint256"},{internalType:"uint256",name:"settle_timeout",type:"uint256"},{internalType:"address",name:"participant1",type:"address"},{internalType:"address",name:"participant2",type:"address"},{internalType:"address",name:"monitoring_service_address",type:"address"}],name:"firstTimestampAllowedToMonitor",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract TokenNetwork",name:"token_network",type:"address"},{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"closing_participant",type:"address"},{internalType:"address",name:"non_closing_participant",type:"address"},{internalType:"address",name:"monitoring_service_address",type:"address"}],name:"firstTimestampAllowedToMonitorChannel",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"closing_participant",type:"address"},{internalType:"address",name:"non_closing_participant",type:"address"},{internalType:"bytes32",name:"balance_hash",type:"bytes32"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"bytes32",name:"additional_hash",type:"bytes32"},{internalType:"bytes",name:"closing_signature",type:"bytes"},{internalType:"bytes",name:"non_closing_signature",type:"bytes"},{internalType:"uint256",name:"reward_amount",type:"uint256"},{internalType:"address",name:"token_network_address",type:"address"},{internalType:"bytes",name:"reward_proof_signature",type:"bytes"}],name:"monitor",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"service_registry",outputs:[{internalType:"contract ServiceRegistry",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract Token",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"token_network_registry",outputs:[{internalType:"contract TokenNetworkRegistry",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"user_deposit",outputs:[{internalType:"contract UserDeposit",name:"",type:"address"}],stateMutability:"view",type:"function"}];class Qr{static createInterface(){return new Vr.vU(Xr)}static connect(e,t){return new $r.CH(e,Xr,t)}}Qr.abi=Xr;const Jr=[{inputs:[{internalType:"address",name:"_deposit_contract",type:"address"},{internalType:"uint256",name:"_chain_id",type:"uint256"},{internalType:"address",name:"_service_registry_contract",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!0,internalType:"address",name:"receiver",type:"address"},{indexed:!1,internalType:"uint256",name:"claimable_until",type:"uint256"},{indexed:!1,internalType:"uint256",name:"transferred",type:"uint256"}],name:"Claimed",type:"event"},{inputs:[{internalType:"address[]",name:"senders",type:"address[]"},{internalType:"address[]",name:"receivers",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"uint256[]",name:"claimable_until_list",type:"uint256[]"},{internalType:"bytes",name:"signatures",type:"bytes"}],name:"bulkClaim",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"chain_id",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"claimable_until",type:"uint256"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"claim",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"deposit_contract",outputs:[{internalType:"contract UserDeposit",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"service_registry_contract",outputs:[{internalType:"contract ServiceRegistry",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"settled_sessions",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];class eo{static createInterface(){return new Vr.vU(Jr)}static connect(e,t){return new $r.CH(e,Jr,t)}}eo.abi=Jr;const to=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"secrethash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"secret",type:"bytes32"}],name:"SecretRevealed",type:"event"},{inputs:[{internalType:"bytes32",name:"secrethash",type:"bytes32"}],name:"getSecretRevealBlockTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"secret",type:"bytes32"}],name:"registerSecret",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32[]",name:"secrets",type:"bytes32[]"}],name:"registerSecretBatch",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}];class no{static createInterface(){return new Vr.vU(to)}static connect(e,t){return new $r.CH(e,to,t)}}no.abi=to;const ao=[{inputs:[{internalType:"contract Token",name:"_token_for_registration",type:"address"},{internalType:"address",name:"_controller",type:"address"},{internalType:"uint256",name:"_initial_price",type:"uint256"},{internalType:"uint256",name:"_price_bump_numerator",type:"uint256"},{internalType:"uint256",name:"_price_bump_denominator",type:"uint256"},{internalType:"uint256",name:"_decay_constant",type:"uint256"},{internalType:"uint256",name:"_min_price",type:"uint256"},{internalType:"uint256",name:"_registration_duration",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"service",type:"address"},{indexed:!1,internalType:"uint256",name:"valid_till",type:"uint256"},{indexed:!1,internalType:"uint256",name:"deposit_amount",type:"uint256"},{indexed:!1,internalType:"contract Deposit",name:"deposit_contract",type:"address"}],name:"RegisteredService",type:"event"},{inputs:[{internalType:"address",name:"new_controller",type:"address"}],name:"changeController",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_price_bump_numerator",type:"uint256"},{internalType:"uint256",name:"_price_bump_denominator",type:"uint256"},{internalType:"uint256",name:"_decay_constant",type:"uint256"},{internalType:"uint256",name:"_min_price",type:"uint256"},{internalType:"uint256",name:"_registration_duration",type:"uint256"}],name:"changeParameters",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"controller",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decay_constant",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_set_price",type:"uint256"},{internalType:"uint256",name:"_seconds_passed",type:"uint256"}],name:"decayedPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_limit_amount",type:"uint256"}],name:"deposit",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"deprecated",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"everMadeDepositsLen",outputs:[{internalType:"uint256",name:"_len",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"ever_made_deposits",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"hasValidRegistration",outputs:[{internalType:"bool",name:"_has_registration",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"min_price",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"price_bump_denominator",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"price_bump_numerator",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"registration_duration",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"service_valid_till",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"setDeprecationSwitch",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"new_url",type:"string"}],name:"setURL",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"set_price",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"set_price_at",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract Token",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"urls",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];class io{static createInterface(){return new Vr.vU(ao)}static connect(e,t){return new $r.CH(e,ao,t)}}io.abi=ao;const ro=[{inputs:[{internalType:"address",name:"new_controller",type:"address"}],name:"changeController",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_price_bump_numerator",type:"uint256"},{internalType:"uint256",name:"_price_bump_denominator",type:"uint256"},{internalType:"uint256",name:"_decay_constant",type:"uint256"},{internalType:"uint256",name:"_min_price",type:"uint256"},{internalType:"uint256",name:"_registration_duration",type:"uint256"}],name:"changeParameters",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"controller",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decay_constant",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_set_price",type:"uint256"},{internalType:"uint256",name:"_seconds_passed",type:"uint256"}],name:"decayedPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"deprecated",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"min_price",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"price_bump_denominator",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"price_bump_numerator",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"registration_duration",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"setDeprecationSwitch",outputs:[{internalType:"bool",name:"_success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"set_price",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"set_price_at",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];class oo{static createInterface(){return new Vr.vU(ro)}static connect(e,t){return new $r.CH(e,ro,t)}}oo.abi=ro;const so=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"remaining",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"decimals",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"supply",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"}];class co{static createInterface(){return new Vr.vU(so)}static connect(e,t){return new $r.CH(e,so,t)}}co.abi=so;const lo=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"remaining",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"decimals",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"supply",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"}];class po{static createInterface(){return new Vr.vU(lo)}static connect(e,t){return new $r.CH(e,lo,t)}}po.abi=lo;const uo=[{inputs:[{internalType:"address",name:"_token_address",type:"address"},{internalType:"address",name:"_secret_registry",type:"address"},{internalType:"uint256",name:"_settle_timeout",type:"uint256"},{internalType:"address",name:"_controller",type:"address"},{internalType:"uint256",name:"_channel_participant_deposit_limit",type:"uint256"},{internalType:"uint256",name:"_token_network_deposit_limit",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"closing_participant",type:"address"},{indexed:!0,internalType:"uint256",name:"nonce",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"balance_hash",type:"bytes32"}],name:"ChannelClosed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"participant",type:"address"},{indexed:!1,internalType:"uint256",name:"total_deposit",type:"uint256"}],name:"ChannelNewDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"participant1",type:"address"},{indexed:!0,internalType:"address",name:"participant2",type:"address"}],name:"ChannelOpened",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!1,internalType:"address",name:"participant1",type:"address"},{indexed:!1,internalType:"uint256",name:"participant1_amount",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"participant1_locksroot",type:"bytes32"},{indexed:!1,internalType:"address",name:"participant2",type:"address"},{indexed:!1,internalType:"uint256",name:"participant2_amount",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"participant2_locksroot",type:"bytes32"}],name:"ChannelSettled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"receiver",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"bytes32",name:"locksroot",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"unlocked_amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"returned_tokens",type:"uint256"}],name:"ChannelUnlocked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"participant",type:"address"},{indexed:!1,internalType:"uint256",name:"total_withdraw",type:"uint256"}],name:"ChannelWithdraw",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bool",name:"new_value",type:"bool"}],name:"DeprecationSwitch",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"channel_identifier",type:"uint256"},{indexed:!0,internalType:"address",name:"closing_participant",type:"address"},{indexed:!0,internalType:"uint256",name:"nonce",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"balance_hash",type:"bytes32"}],name:"NonClosingBalanceProofUpdated",type:"event"},{inputs:[],name:"chain_id",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"new_controller",type:"address"}],name:"changeController",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"channel_counter",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"channel_participant_deposit_limit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"channels",outputs:[{internalType:"enum TokenNetwork.ChannelState",name:"state",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"non_closing_participant",type:"address"},{internalType:"address",name:"closing_participant",type:"address"},{internalType:"bytes32",name:"balance_hash",type:"bytes32"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"bytes32",name:"additional_hash",type:"bytes32"},{internalType:"bytes",name:"non_closing_signature",type:"bytes"},{internalType:"bytes",name:"closing_signature",type:"bytes"}],name:"closeChannel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"controller",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{components:[{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"total_withdraw",type:"uint256"},{internalType:"uint256",name:"withdrawable_until",type:"uint256"},{internalType:"bytes",name:"participant_signature",type:"bytes"},{internalType:"bytes",name:"partner_signature",type:"bytes"}],internalType:"struct TokenNetwork.WithdrawInput",name:"data1",type:"tuple"},{components:[{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"total_withdraw",type:"uint256"},{internalType:"uint256",name:"withdrawable_until",type:"uint256"},{internalType:"bytes",name:"participant_signature",type:"bytes"},{internalType:"bytes",name:"partner_signature",type:"bytes"}],internalType:"struct TokenNetwork.WithdrawInput",name:"data2",type:"tuple"}],name:"cooperativeSettle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"deprecate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"partner",type:"address"}],name:"getChannelIdentifier",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"partner",type:"address"}],name:"getChannelParticipantInfo",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bool",name:"",type:"bool"},{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"participant1",type:"address"},{internalType:"address",name:"participant2",type:"address"}],name:"getChannelState",outputs:[{internalType:"enum TokenNetwork.ChannelState",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"participant1_deposit",type:"uint256"},{internalType:"uint256",name:"participant1_withdrawn",type:"uint256"},{internalType:"uint256",name:"participant1_transferred",type:"uint256"},{internalType:"uint256",name:"participant1_locked",type:"uint256"},{internalType:"uint256",name:"participant2_transferred",type:"uint256"},{internalType:"uint256",name:"participant2_locked",type:"uint256"}],name:"getMaxPossibleReceivableAmount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"partner",type:"address"}],name:"getParticipantsHash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"receiver",type:"address"}],name:"getUnlockIdentifier",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"participant1",type:"address"},{internalType:"address",name:"participant2",type:"address"}],name:"openChannel",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"participant1",type:"address"},{internalType:"address",name:"participant2",type:"address"},{internalType:"uint256",name:"participant1_total_deposit",type:"uint256"}],name:"openChannelWithDeposit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"participants_hash_to_channel_identifier",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"removeLimits",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"safety_deprecation_switch",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"secret_registry",outputs:[{internalType:"contract SecretRegistry",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"total_deposit",type:"uint256"},{internalType:"address",name:"partner",type:"address"}],name:"setTotalDeposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"total_withdraw",type:"uint256"},{internalType:"uint256",name:"withdrawable_until",type:"uint256"},{internalType:"bytes",name:"participant_signature",type:"bytes"},{internalType:"bytes",name:"partner_signature",type:"bytes"}],name:"setTotalWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{components:[{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"total_withdraw",type:"uint256"},{internalType:"uint256",name:"withdrawable_until",type:"uint256"},{internalType:"bytes",name:"participant_signature",type:"bytes"},{internalType:"bytes",name:"partner_signature",type:"bytes"}],internalType:"struct TokenNetwork.WithdrawInput",name:"withdraw_data",type:"tuple"}],name:"setTotalWithdraw2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"participant1",type:"address"},{internalType:"uint256",name:"participant1_transferred_amount",type:"uint256"},{internalType:"uint256",name:"participant1_locked_amount",type:"uint256"},{internalType:"bytes32",name:"participant1_locksroot",type:"bytes32"},{internalType:"address",name:"participant2",type:"address"},{internalType:"uint256",name:"participant2_transferred_amount",type:"uint256"},{internalType:"uint256",name:"participant2_locked_amount",type:"uint256"},{internalType:"bytes32",name:"participant2_locksroot",type:"bytes32"}],name:"settleChannel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{components:[{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"transferred_amount",type:"uint256"},{internalType:"uint256",name:"locked_amount",type:"uint256"},{internalType:"bytes32",name:"locksroot",type:"bytes32"}],internalType:"struct TokenNetwork.SettleInput",name:"participant1_settlement",type:"tuple"},{components:[{internalType:"address",name:"participant",type:"address"},{internalType:"uint256",name:"transferred_amount",type:"uint256"},{internalType:"uint256",name:"locked_amount",type:"uint256"},{internalType:"bytes32",name:"locksroot",type:"bytes32"}],internalType:"struct TokenNetwork.SettleInput",name:"participant2_settlement",type:"tuple"}],name:"settleChannel2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"settle_timeout",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"settleable_after",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract Token",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"token_network_deposit_limit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"receiver",type:"address"},{internalType:"address",name:"sender",type:"address"},{internalType:"bytes",name:"locks",type:"bytes"}],name:"unlock",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"channel_identifier",type:"uint256"},{internalType:"address",name:"closing_participant",type:"address"},{internalType:"address",name:"non_closing_participant",type:"address"},{internalType:"bytes32",name:"balance_hash",type:"bytes32"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"bytes32",name:"additional_hash",type:"bytes32"},{internalType:"bytes",name:"closing_signature",type:"bytes"},{internalType:"bytes",name:"non_closing_signature",type:"bytes"}],name:"updateNonClosingBalanceProof",outputs:[],stateMutability:"nonpayable",type:"function"}];class mo{static createInterface(){return new Vr.vU(uo)}static connect(e,t){return new $r.CH(e,uo,t)}}mo.abi=uo;const yo=[{inputs:[{internalType:"address",name:"_secret_registry_address",type:"address"},{internalType:"uint256",name:"_settle_timeout",type:"uint256"},{internalType:"uint256",name:"_max_token_networks",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"token_address",type:"address"},{indexed:!0,internalType:"address",name:"token_network_address",type:"address"},{indexed:!1,internalType:"uint256",name:"settle_timeout",type:"uint256"}],name:"TokenNetworkCreated",type:"event"},{inputs:[{internalType:"address",name:"new_controller",type:"address"}],name:"changeController",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"controller",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_token_address",type:"address"},{internalType:"uint256",name:"_channel_participant_deposit_limit",type:"uint256"},{internalType:"uint256",name:"_token_network_deposit_limit",type:"uint256"}],name:"createERC20TokenNetwork",outputs:[{internalType:"address",name:"token_network_address",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_token_address",type:"address"}],name:"createERC20TokenNetworkWithoutLimits",outputs:[{internalType:"address",name:"token_network_address",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"max_token_networks",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"removeLimits",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"secret_registry_address",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"settle_timeout",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"token_network_created",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"token_to_token_networks",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}];class fo{static createInterface(){return new Vr.vU(yo)}static connect(e,t){return new $r.CH(e,yo,t)}}fo.abi=yo;const ho=[{inputs:[{internalType:"address",name:"udc_address",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"}];class _o{static createInterface(){return new Vr.vU(ho)}static connect(e,t){return new $r.CH(e,ho,t)}}_o.abi=ho;const go=[{inputs:[{internalType:"address",name:"_token_address",type:"address"},{internalType:"uint256",name:"_whole_balance_limit",type:"uint256"},{internalType:"uint256",name:"_withdraw_timeout",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint256",name:"newBalance",type:"uint256"}],name:"BalanceReduced",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"withdrawer",type:"address"},{indexed:!1,internalType:"uint256",name:"plannedBalance",type:"uint256"}],name:"WithdrawPlanned",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"beneficiary",type:"address"},{internalType:"uint256",name:"new_total_deposit",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"effectiveBalance",outputs:[{internalType:"uint256",name:"remaining_balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_msc_address",type:"address"},{internalType:"address",name:"_one_to_n_address",type:"address"}],name:"init",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"msc_address",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"one_to_n_address",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"planWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract Token",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"total_deposit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"whole_balance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"whole_balance_limit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"beneficiary",type:"address"}],name:"withdrawToBeneficiary",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"withdraw_plans",outputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"withdrawable_after",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdraw_timeout",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];class bo{static createInterface(){return new Vr.vU(go)}static connect(e,t){return new $r.CH(e,go,t)}}bo.abi=go;const vo=[{inputs:[{internalType:"address",name:"contract_address",type:"address"}],name:"contractExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_addition",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"failsafe_subtract",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"max",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"a",type:"uint256"},{internalType:"uint256",name:"b",type:"uint256"}],name:"min",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[],name:"signature_prefix",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];class wo{static createInterface(){return new Vr.vU(vo)}static connect(e,t){return new $r.CH(e,vo,t)}}wo.abi=vo;var To=n(89909),ko=n.n(To),Eo=n(96883),Ao=n(82),No=n(90010),Io=n(47156),Ro=n(62631),Do=n(30062),Co=n(90104),So=n.n(Co),Oo=n(92619),Po=n(46907),xo=n(50243),Mo=n(31091),Uo=n.n(Mo),Lo=n(52958),Bo=n(91044),Fo=n(25014);class Wo extends Map{constructor(e){super(),this.max=e}get(e){let t;return this.has(e)&&(t=super.get(e),this.delete(e),super.set(e,t)),t}set(e,t){this.get(e),super.set(e,t);while(this.size>this.max){const e=this.keys().next().value;this.delete(e)}return this}}const $o=N()((async(e,t)=>(0,M.z)(ui((async()=>e.callStatic.token()),t,{onErrors:Re})))),Vo=N()((async function(e,{serviceRegistryContract:t}){let n=e;return Xe.is(e)&&(n=await t.callStatic.urls(e)),jo(n)})),Ho=/^(?:https:\/\/)?[^\s\/$.?#&"']+\.[^\s\/$?#&"']+$/;function jo(e){return Me(e,Ae.PFS_EMPTY_URL),Me(Ho.test(e),[Ae.PFS_INVALID_URL,{url:e}]),e.match(/^https?:\/\//)||(e=`https://${e}`),e}const zo=new Wo(32);async function qo(e,{log:t,serviceRegistryContract:n,network:a,contractsInfo:i,provider:r,config$:o,latest$:s}){const{pfsMaxFee:c}=await(0,M.z)(o),{state:l}=await(0,M.z)(s),{services:d}=l,p=X.dt({matrix_server:X.Z_,network_info:X.dt({chain_id:X.i0(a.chainId),token_network_registry_address:X.i0(i.TokenNetworkRegistry.address)},"NetworkInfo"),payment_address:Xe,price_info:je(32)},"PfsInfo");try{var u;const t=await Vo(e,{serviceRegistryContract:n}),a=Date.now(),i=await fetch(t+"/api/v1/info",{mode:"cors"}),o=Date.now()-a,s=await i.text();Me(i.ok,[Ae.PFS_ERROR_RESPONSE,{text:s}]);const l=Fe(p,Hn(s)),{payment_address:m,price_info:y}=l;Me(y.lte(c),[Ae.PFS_TOO_EXPENSIVE,{price:y}]),zo.set(t,Promise.resolve(m));const f=null!==(u=d[m])&&void 0!==u?u:1e3*(await n.callStatic.service_valid_till(m)).toNumber();return{address:m,url:t,matrixServer:l.matrix_server,rtt:o,price:y,token:await $o(n,r.pollingInterval),validTill:f}}catch(m){throw t.warn("Error fetching PFS info:",e,m),m}}const Ko=Object.assign((async function(e,t){e=jo(e);let n=zo.get(e);return n||(n=qo(e,t).then((({address:e})=>e)),zo.set(e,n)),n}),{cache:zo});function Zo(e,t){return(0,U.D)(e).pipe((0,q.z)((e=>(0,Wa.P)((async()=>qo(e,t))).pipe((0,K.K)(Ha()(L.E)))),5),(0,V.q)(),(0,W.U)((t=>(Me(t.length||!e.length,Ae.PFS_INVALID_INFO),Uo()(t,"url").sort(((e,t)=>{const n=e.price.sub(t.price);return n.lt(0)?-1:n.gt(0)?1:e.rtt-t.rtt}))))))}function Go(e){const t=(0,Po.LO)((0,re.lE)((0,Oo.r)(e.user_id)),e.displayname),n=(0,xo.db)(t);return Qn.success({userId:e.user_id,available:!0,ts:Date.now(),caps:aa(e.capabilities),pubkey:t},{address:n})}function Yo(e,t,{log:n}={}){if(e)try{const n=Go(e);return Me(n.meta.address===t,["Wrong signature",{expected:t,recovered:n.meta.address}]),n}catch(a){null===n||void 0===n||n.warn("Invalid address metadata",{address:t,metadata:e,error:a})}}function Xo(e,t,n){return(0,Wa.P)((async()=>Vo(t,n))).pipe(_i((t=>(0,B.U)(`${t}/api/v1/address/${e}/metadata`).pipe((0,q.z)((async e=>e.json()))))),(0,W.U)((([t,a])=>{try{const t=Fe(vt,a),i=Yo(t,e,n);return Me(i,["Invalid metadata signature",{peer:e,presence:t}]),Me(i.payload.caps,["Invalid capabilities format",t.capabilities]),i}catch(i){try{const{errors:e,...n}=Fe(Dt,a);i=new xe(e,{...n,pfs:t})}catch(r){}throw i}})))}function Qo(e){return(0,re.zo)([$n(e.one_to_n_address,20),$n(e.chain_id,32),$n(ua.IOU,32),$n(e.sender,20),$n(e.receiver,20),$n(e.amount,32),$n(e.claimable_until,32)])}async function Jo(e,t){return e.signMessage(Qo(t)).then((e=>({...t,signature:e})))}function es(e,t,n=!1){const{log:a,config$:i,latest$:r,init$:o}=t;return i.pipe((0,Z.P)(),(0,q.z)((({pfsMode:a,additionalServices:i})=>{if(e)return(0,P.of)(e);if(Me(null!==e&&a!==ht.disabled,Ae.PFS_DISABLED),a===ht.onlyAdditional){let e;return(0,U.D)(i).pipe((0,j.b)((n=>(0,Wa.P)((async()=>qo(n,t))).pipe((0,K.K)((t=>{var n;return null!==(n=e)&&void 0!==n||(e=t),L.E}))))),(0,Lo.T)((()=>e)))}return r.pipe(si("state","services"),(0,W.U)((e=>[...i,...Object.keys(e)])),(0,ei.R)(o.pipe((0,ai.Z)(),(0,Bo.g)(10))),(0,Z.P)((e=>e.length>0)),(0,q.z)((e=>n?(0,U.D)(e).pipe((0,q.z)((e=>(0,Wa.P)((async()=>qo(e,t))).pipe((0,K.K)(Ha()(L.E)))))):Zo(e,t).pipe((0,Fo.J)()))))})),(0,Lo.T)(Ha()(new xe(Ae.PFS_INVALID_INFO))),(0,ti.b)((e=>{e.validTill<Date.now()&&a.warn("WARNING: PFS registration not valid! This service deposit may have expired and it may not receive network updates anymore.",e)})))}var ts=n(48764)["lW"];function ns(e){const t=[];for(const n of e)t.push($n(n.expiration,32),$n(n.amount,32),n.secrethash);return(0,oe.w)((0,re.zo)(t))}function as(e){return(0,xr.JQ)(e)}function is(e=32){return(0,re.Dv)((0,Ro.O)(e))}let rs=0;function os(){return g.O$.from(rs=Math.max(rs+1,Date.now()))}let ss=0;function cs(){return g.O$.from(ss=Math.max(ss+1,Date.now()))}function ls(e){return"_id"in e?e._id:`${e.direction}:${e.secrethash}`}const ds=new RegExp(`^(${Object.values(wi).join("|")}):(0x[a-f0-9]{64})$`,"i");function ps(e){const t=e.match(ds);Me(t,"Invalid transferKey format");const[,n,a]=t;return{direction:n,secrethash:a}}const us={[Ai.expired]:e=>{var t;return null===(t=e.expiredProcessed)||void 0===t?void 0:t.ts},[Ai.unlocked]:e=>{var t;return null===(t=e.unlockProcessed)||void 0===t?void 0:t.ts},[Ai.expiring]:e=>{var t;return null===(t=e.expired)||void 0===t?void 0:t.ts},[Ai.unlocking]:e=>{var t;return null===(t=e.unlock)||void 0===t?void 0:t.ts},[Ai.registered]:e=>{var t;return null===(t=e.secretRegistered)||void 0===t?void 0:t.ts},[Ai.revealed]:e=>{var t;return null===(t=e.secretReveal)||void 0===t?void 0:t.ts},[Ai.requested]:e=>{var t;return null===(t=e.secretRequest)||void 0===t?void 0:t.ts},[Ai.closed]:e=>{var t;return null===(t=e.channelClosed)||void 0===t?void 0:t.ts},[Ai.received]:e=>{var t;return null===(t=e.transferProcessed)||void 0===t?void 0:t.ts},[Ai.pending]:e=>e.transfer.ts};function ms(e){for(const[t,n]of Object.entries(us)){const a=n(e);if(void 0!==a)return t}return Ai.pending}function ys(e){return!!(e.unlockProcessed||e.expiredProcessed||e.secretRegistered||e.channelSettled)}function fs(e){const t=ms(e),n=new Date(e.transfer.ts),a=new Date(us[t](e)),i=e.transfer,r=e.direction,o=i.lock.amount.sub(e.fee),s=e.secretRequest&&e.secretRequest.amount.lt(o),c=!!(e.secretReveal||e.unlock||e.secretRegistered)||!(s||e.expired||e.channelClosed)&&void 0,l=ys(e);return{key:ls(e),secrethash:i.lock.secrethash,direction:r,status:t,initiator:i.initiator,partner:e.partner,target:i.target,metadata:i.metadata,paymentId:i.payment_identifier,chainId:i.chain_id.toNumber(),token:i.token,tokenNetwork:i.token_network_address,channelId:i.channel_identifier,value:o,fee:e.fee,amount:i.lock.amount,expiration:i.lock.expiration.toNumber(),startedAt:n,changedAt:a,success:c,completed:l,secret:e.secret}}function hs(e,t,n,a){return a===ie.R?(0,P.of)(dt):(0,Wa.P)((()=>e.find({selector:{channel:rl(t),direction:n}}))).pipe((0,q.z)((({docs:e})=>(0,U.D)(e))),(0,q.z)((e=>{const t=Fe(Ei,e);return(0,U.D)([t.transfer,t.unlock,t.expired])})),(0,$.h)(We),(0,W.U)(ba),(0,Z.P)((e=>ya(e)===a)))}async function _s(e,t,n){"string"!==typeof n&&(n=ls(n)),"address"in e||(e=await(0,M.z)(e));const a=e.transfers[n];return a||Fe(Ei,await t.get(n))}const gs=X.iG(X.dt({routes:X.IX(X.iG(X.dt({route:X.IX(X.Z_),address_metadata:X._4})))}));function bs(e,t){let n;try{n=Fe(gs,t)}catch(i){return t}const a=e.toLowerCase();return{...n,routes:n.routes.map((({route:e,...t})=>({...t,route:e.slice(e.findIndex((e=>e.toLowerCase()===a))+1)})))}}function vs(e,t,n){const a=e.map((({path:e,fee:t,address_metadata:n})=>({route:e,...n&&!So()(n)?{address_metadata:n}:{}}))),i=e[0];Me(i,"empty paths");const r=i.fee,o=i.path[1];let s,c;if(Me(o,"empty route"),o===t.meta.address)s=t.payload.userId,c=t.payload.caps;else{const e=ks(i.address_metadata,o);s=null===e||void 0===e?void 0:e.payload.userId,c=null===e||void 0===e?void 0:e.payload.caps}const l={userId:s};let d={routes:a};if(ia(c,pe.IMMUTABLE_METADATA)){if(n){const e=(0,re.Dv)((0,Do.HI)(t.payload.pubkey,ts.from(jn(Ni.encode(n)))));d={...d,secret:e}}}else d=bs(i.path[0],d);return{resolved:!0,metadata:d,fee:r,partner:o,...l}}const ws=X.dt({secret:Ve()});function Ts(e,[t,n,a],i){const r=i.privateKey;if(r)try{const i=Fe(ws,e).secret,o=(0,Do.pe)(r,ts.from((0,re.lE)(i))).toString(),s=Fe(Ni,Hn(o));return Me(n.gte(s.amount)&&as(s.secret)===t),Me(!a||!s.payment_identifier||a.eq(s.payment_identifier)),s.secret}catch(o){}}function ks(e,t){var n;const a=null!==(n=null===e||void 0===e?void 0:e[t])&&void 0!==n?n:null===e||void 0===e?void 0:e[t.toLowerCase()];if(a){const e=Yo(a,t);if(e)return e}}function Es(e,t){let n,a;try{a=Fe(Yt,e)}catch(r){}if(a&&t)for(const{address_metadata:o}of a.routes){var i;if(n=null===(i=ks(o,t))||void 0===i?void 0:i.payload.userId)return{userId:n}}}let As;async function Ns(){var e;if(As)return As;if(null!==(e=globalThis.location)&&void 0!==e&&e.href){const{default:e}=await Promise.all([n.e(598),n.e(370)]).then(n.bind(n,28370));Eo.Z.plugin(e),As="indexeddb"}else{const{default:e}=await Promise.all([n.e(598),n.e(856)]).then(n.bind(n,9856));Eo.Z.plugin(e),As="leveldb"}return As}const Is={1:async e=>"state.address"===e._id?[e,{_id:"state.services",value:{}}]:[e]},Rs=Is;Eo.Z.plugin(Ao.Z);const Ds="state.",Cs="channels.";function Ss(e,t=!1){const n=e,a=e+"￰";return t?{startkey:a,endkey:n,descending:t}:{startkey:n,endkey:a}}async function Os(e){await Promise.all([e.createIndex({index:{name:"byPartner",fields:["direction","partner"]}}),e.createIndex({index:{name:"bySecrethash",fields:["secrethash"]}}),e.createIndex({index:{name:"byChannel",fields:["channel"]}}),e.createIndex({index:{name:"byTransferTs",fields:["transfer.ts"]}})]);const t=new Set,n=await e.allDocs({startkey:"a",endkey:"z￰"});n.rows.forEach((({id:e})=>t.add(e)));const a=new No.X(!1);return Object.assign(e,{storageKeys:t,busy$:a})}async function Ps(e){const t=new this(e),n=await t.info();if(0!==n.doc_count||0!=n.update_seq)return Os(t);await t.destroy()}async function xs(e){const t=new this(e);return t.setMaxListeners(30),Os(t)}function Ms(e,t){return(0,Wa.P)((()=>{const n=e.changes(t);return(0,Fa.T)((0,Io.R)(n,"change"),(0,Io.R)(n,"error").pipe((0,q.z)((e=>{throw e})))).pipe((0,H.j)(0),(0,ei.R)((0,Io.R)(n,"complete")),(0,ri.x)((()=>n.cancel())))}))}async function Us(e){const{log:t}=e.constructor.__defaults,n={channels:{},oldChannels:{},transfers:{}},a=await e.allDocs({...Ss(Ds),include_docs:!0});for(const{id:o,doc:s}of a.rows)n[o.substring(Ds.length)]=s.value;const i=await e.allDocs({...Ss(Cs),include_docs:!0});for(const{id:o,doc:s}of i.rows)"settleBlock"in s?n.oldChannels[o]={...s,_id:o.substring(Cs.length)}:n.channels[il(s)]={...s,_id:o.substring(Cs.length)};const r=await e.find({selector:{cleared:0,direction:{$exists:!0}}});r.warning&&(null===t||void 0===t||t.debug(r.warning,"getRaidenState"));for(const o of r.docs)n.transfers[o._id]=o;if("address"in n)return n}async function Ls(e,t){const n=[];for(const[a,i]of Object.entries(t))if("channels"===a||"oldChannels"===a)for(const e of Object.values(i))n.push({...e,_id:Cs+e._id});else if("transfers"===a)for(const e of Object.values(i))n.push(e);else n.push({_id:Ds+a,value:i});await e.bulkDocs(n)}function Bs(e){return Object.keys(e).map((e=>+e)).sort()}function Fs(e=Rs){var t;return null!==(t=at(Bs(e)))&&void 0!==t?t:0}function Ws(e){return+e.name.match(/_(\d+)$/)[1]}async function $s(e={log:y()}){return e.log||(e.log=y()),e.adapter||(e.adapter=await Ns()),Eo.Z.defaults(e)}async function Vs(e,t=Rs,n=!1){const{log:a}=this.__defaults,i=Bs(t);let r,o=0;for(let c=i.length-1;c>=0;--c){const t=i[c],n=await Ps.call(this,`${e}_${t}`);if(n){o=t,r=n;break}}r||(r=await Ps.call(this,`${e}_${o}`)),r||(o=Fs(t),r=await xs.call(this,`${e}_${o}`));for(const c of i){if(c<=o)continue;const i=await xs.call(this,`${e}_${c}`);try{const e=/^[a-z]/i;await(0,x.n)(Ms(r,{since:0,include_docs:!0,filter:({_id:t})=>e.test(t)}).pipe((0,j.b)((e=>(0,Wa.P)((()=>t[c](e.doc,r))).pipe((0,q.z)((e=>(0,U.D)(e))),(0,j.b)((async e=>{const{_rev:t,...n}=e;return i.put(n)})))))))}catch(s){throw null===a||void 0===a||a.error("Error migrating db",{from:o,to:c},s),i.destroy(),s}null===a||void 0===a||a.info("Migrated db",{name:e,from:o,to:c}),n?await r.destroy():await r.close(),o=c,r=i}return Me(Ws(r)===Fs(t),"Not latest version"),r}async function Hs(e){return{_id:"_meta",version:Ws(e),network:(await e.get(Ds+"chainId")).value,udc:(await e.get(Ds+"contracts")).value.UserDeposit.address,address:(await e.get(Ds+"address")).value,blockNumber:(await e.get(Ds+"blockNumber")).value}}function js(e){return"function"===typeof e[Symbol.asyncIterator]}async function zs(e,t,n=Rs,a=!1){const{log:i}=this.__defaults,r=js(e)?e[Symbol.asyncIterator]():e[Symbol.iterator](),o=await r.next();Me(!o.done&&"_meta"===o.value._id,'first yielded value must be "_meta"');const s=o.value;for(let p=Fs(n);p>=s.version;--p){const e=`${t}_${p}`,n=await Ps.call(this,e);if(!n)continue;const a=await Hs(n);Me(s.version>=p&&s.blockNumber>=a.blockNumber,Ae.RDN_STATE_MIGRATION),Me(s.address===a.address,[Ae.RDN_STATE_ADDRESS_MISMATCH,{expected:a.address,received:s.address}],null===i||void 0===i?void 0:i.error),Me(s.udc===a.udc&&s.network===a.network,[Ae.RDN_STATE_NETWORK_MISMATCH,{expectedUdc:a.udc,receivedUdc:s.udc,expectedNetwork:a.network,receivedNetwork:s.network}],null===i||void 0===i?void 0:i.error),await n.destroy()}const c=`${t}_${s.version}`,l=await xs.call(this,c);let d=await r.next();while(!d.done){const e=d.value;"_rev"in e&&delete e["_rev"],[d]=await Promise.all([r.next(),l.put(e)])}return null===i||void 0===i||i.warn("Replaced/loaded database",{name:t,meta:s}),await l.close(),await Vs.call(this,t,n,a)}function qs(e){return e?e.slice(0,-1)+String.fromCharCode(e.slice(-1).charCodeAt(0)+1):""}async function*Ks(e,{batch:t=10}={}){let n;const a=e.changes({since:"now",live:!0});a.on("change",(({id:e})=>n=e)),await(0,M.z)(e.busy$.pipe((0,$.h)((e=>!e)))),e.busy$.next(!0);try{yield await Hs(e);let i="a";while(1){const a=await e.allDocs({startkey:i,endkey:"￰",limit:t,include_docs:!0});yield*a.rows.map((({doc:e})=>ko()(["_rev"],e))),Me(!n,["Database changed while dumping",{key:n}]);const r=at(a.rows);if(!r)break;i=qs(r.id)}}finally{e.busy$.next(!1),a.cancel()}}const Zs=["unlockProcessed","expiredProcessed","secretRegistered","channelSettled"];async function Gs(e,t,{offset:n,desc:a,...i}={}){var r;const o=[{"transfer.ts":{$gt:0}}];if(t){if(t.pending)for(const e of Zs)o.push({[e]:{$exists:!1}});else!1===t.pending&&o.push({$or:Zs.map((e=>({[e]:{$exists:!0}})))});"token"in t&&o.push({"transfer.token":t.token}),"partner"in t&&o.push({partner:t.partner}),"end"in t&&o.push({$or:[{"transfer.initiator":t.end},{"transfer.target":t.end}]})}const{docs:s,warning:c}=await e.find({selector:{$and:o},sort:[{"transfer.ts":a?"desc":"asc"}],skip:n,...i});return c&&(null===(r=e.__opts.log)||void 0===r||r.warn("db.getTransfers",c)),s.map((e=>fs(Fe(Ei,e))))}const Ys=JSON.parse('{"re":{"SecretRegistry":{"address":"0x68D28D8A32CdE93A5657D6d1f4280008052cCFfC","transaction_hash":"0x1643ed7976db81194047c26871ba2f02318c68a3125faa236033d3e398eba2d6","block_number":8569235,"gas_cost":2063630,"constructor_arguments":[]},"TokenNetworkRegistry":{"address":"0xa032980DC8c988Aec782A0bF7E8Fd5797b7145C2","transaction_hash":"0x039c4b67b907a67f7c6cf4bc0881499444618167221ac79174ee2c008a0e7e57","block_number":8569241,"gas_cost":37106276,"constructor_arguments":["0x68D28D8A32CdE93A5657D6d1f4280008052cCFfC",15000,2]}}}'),Xs=JSON.parse('{"re":{"SecretRegistry":{"address":"0x98F9481c690105d67A06eB01A9b71E5d48C6A63e","transaction_hash":"0xca34b56e68cdd1166dbf796e25083258c8afe2885fc87810a6bbb039a7c2a1db","block_number":6513384,"gas_cost":251774,"constructor_arguments":[]},"TokenNetworkRegistry":{"address":"0x925e74ccE36F5cA9b7848b78BB8A5ee286AA8d6d","transaction_hash":"0x03a681850eb4b1f18da127b641cb2ac8be773e8e38792f98113110333da9503f","block_number":6513385,"gas_cost":4407946,"constructor_arguments":["0x98F9481c690105d67A06eB01A9b71E5d48C6A63e",180,500000]}}}'),Qs=JSON.parse('{"re":{"SecretRegistry":{"address":"0xcE5bC70b441a0794fF3a6F52BB054F92500402F6","transaction_hash":"0xacd19d9d32d86f72ac71a18d6b54a75ddd15a8bd294bff04f5b9c01a1dbe2e96","block_number":10005808,"gas_cost":2059935,"constructor_arguments":[]},"TokenNetworkRegistry":{"address":"0xDDee3583d375b83FA8e4A9C5A439c25a28b205A8","transaction_hash":"0xf9237ca7c920245c3b8f39c9ba4e0593b36d88f1ff8f27c8fd6d15d397080861","block_number":10260565,"gas_cost":37109556,"constructor_arguments":["0xcE5bC70b441a0794fF3a6F52BB054F92500402F6",180,500000]}}}'),Js=JSON.parse('{"re":{"ServiceRegistry":{"address":"0x60181f168D012A874A59bc520277E4B26462E95e","transaction_hash":"0x46169f6bb848fb566fb190ab06da234f5c331cde1ea5926eb658032fa1ae0814","block_number":8569315,"gas_cost":16004482,"constructor_arguments":["0xfaD42A1bCB25901b8Da6F0cF0B3A263Ae614cd63","0xb6D070e600934503325B0969e7045405F439c3c7",1.66666666666667e+21,5,4,2836573,166666666666667000000,15552000]},"UserDeposit":{"address":"0xA6ec620845d7322DB26A6D8234A3e617b481886F","transaction_hash":"0xc3710f7fb68f6d6385a8b35f944a59a05004067281c4d93c6d87fd402cf5bfb3","block_number":8569322,"gas_cost":9364977,"constructor_arguments":["0xfaD42A1bCB25901b8Da6F0cF0B3A263Ae614cd63",1.66666666666667e+23,1500]},"MonitoringService":{"address":"0xc0Fd1906aE80504c8695BAf05AE6e7fCbA316DED","transaction_hash":"0x69c498ccbc7b5c00bf91d376894ea2c5cd48b40a5a944892638b496af82cb8dc","block_number":8569326,"gas_cost":12909068,"constructor_arguments":["0xfaD42A1bCB25901b8Da6F0cF0B3A263Ae614cd63","0x60181f168D012A874A59bc520277E4B26462E95e","0xA6ec620845d7322DB26A6D8234A3e617b481886F","0xa032980DC8c988Aec782A0bF7E8Fd5797b7145C2"]},"OneToN":{"address":"0xED480f2e31Bd74B61FFfC5710AAA320D0C86F3f4","transaction_hash":"0xa89e0ba98cf8339288d512526d0130d2494ccef208955e1a0f9703c06fa15d69","block_number":8569329,"gas_cost":7883401,"constructor_arguments":["0xA6ec620845d7322DB26A6D8234A3e617b481886F",42161,"0x60181f168D012A874A59bc520277E4B26462E95e"]}}}'),ec=JSON.parse('{"re":{"ServiceRegistry":{"address":"0x6678C47D3588a22a32Af728f8f7582ae5126FFCb","transaction_hash":"0x953a60d74288bc60fdac35c7b538a15105ce0fd84096ef05e8009b3ef0c471b3","block_number":6513390,"gas_cost":1672013,"constructor_arguments":["0x5d4D34EbEEe6f2cB0c5aa7c2F79063ADc6aA78c5","0x73cB9583dB007B3F71F5293cfe183d53F188Bbc0",2e+21,6,5,17280000,1000,15552000]},"UserDeposit":{"address":"0xA1e1fD9A4D8742D526B3ac108d74dAd4a8E9556A","transaction_hash":"0x23fa9f82c7535ecdafc9d881a0b1643e94c6673ca52fc73b591374f0ce7aa7bc","block_number":6513392,"gas_cost":1047434,"constructor_arguments":["0x5d4D34EbEEe6f2cB0c5aa7c2F79063ADc6aA78c5",1.157920892373162e+77,120]},"MonitoringService":{"address":"0x85F06Afc4987f2C3B1a2790186A28230825c7482","transaction_hash":"0xd342516d51d9ad871eee0dc9ea424979ef9b188eebd982c8dffe94bbac54149d","block_number":6513393,"gas_cost":1407329,"constructor_arguments":["0x5d4D34EbEEe6f2cB0c5aa7c2F79063ADc6aA78c5","0x6678C47D3588a22a32Af728f8f7582ae5126FFCb","0xA1e1fD9A4D8742D526B3ac108d74dAd4a8E9556A","0x925e74ccE36F5cA9b7848b78BB8A5ee286AA8d6d"]},"OneToN":{"address":"0xba8a9e3B14974960131c84883Dbed31bE10c0fC8","transaction_hash":"0xcdbdd0d1a578aaf1c62ab99c07389b873376e6a827c163f0da605501eeaf9747","block_number":6513394,"gas_cost":952388,"constructor_arguments":["0xA1e1fD9A4D8742D526B3ac108d74dAd4a8E9556A",5,"0x6678C47D3588a22a32Af728f8f7582ae5126FFCb"]}}}'),tc=JSON.parse('{"re":{"ServiceRegistry":{"address":"0xadbEB98cAb61107B0cAf8389DF928f2C451D2F07","transaction_hash":"0x2267c4a01f8f0dd7dbbb0fb7a835824dc370a611d7827ca4c57afb74d2c17f51","block_number":10260613,"gas_cost":15993235,"constructor_arguments":["0x85F06Afc4987f2C3B1a2790186A28230825c7482","0x73cB9583dB007B3F71F5293cfe183d53F188Bbc0",2e+21,6,5,17280000,1000,15552000]},"UserDeposit":{"address":"0xCa51a3e1F5AaF2569FB6B6a29DC4109832397321","transaction_hash":"0x22ea3c8c823e8a26b34679d7623f7c67d3ba2a8f6937c7a0a50c3e9dc65627ab","block_number":10260614,"gas_cost":9393803,"constructor_arguments":["0x85F06Afc4987f2C3B1a2790186A28230825c7482",1.157920892373162e+77,120]},"MonitoringService":{"address":"0x21Fd85FC5c84d19f58eFBF91FaF48d3CDFe96F6C","transaction_hash":"0xaa29b735d37039c4ac174e5b3a1695a03deb0701e6858b516bcaec94a11f4041","block_number":10260615,"gas_cost":12906048,"constructor_arguments":["0x85F06Afc4987f2C3B1a2790186A28230825c7482","0xadbEB98cAb61107B0cAf8389DF928f2C451D2F07","0xCa51a3e1F5AaF2569FB6B6a29DC4109832397321","0xDDee3583d375b83FA8e4A9C5A439c25a28b205A8"]},"OneToN":{"address":"0xB3fD588Cb74AB09F77ec2cB4e82A02Cf0aE8a24a","transaction_hash":"0x6bcf435bb02e1e6940bbc3d1881e3034f7bb8e1bc87d76797e71586263a983f6","block_number":10260619,"gas_cost":7883724,"constructor_arguments":["0xCa51a3e1F5AaF2569FB6B6a29DC4109832397321",421611,"0xadbEB98cAb61107B0cAf8389DF928f2C451D2F07"]}}}');var nc=n(45073);const ac=X.mM({TokenNetworkRegistry:null,ServiceRegistry:null,UserDeposit:null,SecretRegistry:null,MonitoringService:null,OneToN:null}),ic=X.OT(X.dt({address:Xe,block_number:X.pk})),rc=X.OT(X.IM(ac,ic));var oc;(function(e){e["OPENED"]="OPENED",e["APPROVED"]="APPROVED",e["DEPOSITED"]="DEPOSITED",e["CONFIRMED"]="CONFIRMED"})(oc||(oc={}));const sc=X.OT(X.dt({address:Xe,chainId:X.pk,contracts:rc,blockNumber:X.pk,config:xi,channels:X.OT(X.IM(X.Z_,Dr)),oldChannels:X.OT(X.IM(X.Z_,Dr)),tokens:X.OT(X.IM(X.Z_,Xe)),transport:X.OT(X.r$({server:X.Z_,setup:zn})),transfers:X.OT(X.IM(X.Z_,Ei)),iou:X.OT(X.IM(X.Z_,X.IM(X.Z_,tt(St)))),pendingTxs:X.Bk(Ar),services:Mt}),"RaidenState"),cc=sc;function lc({network:e,address:t,contractsInfo:n},a={}){return{address:t,chainId:e.chainId,contracts:n,blockNumber:n.TokenNetworkRegistry.block_number,channels:{},oldChannels:{},tokens:{},transport:{},transfers:{},iou:{},pendingTxs:[],services:{},config:{},...a}}const dc=lc({network:(0,nc.H)("unspecified"),address:b.d,contractsInfo:{TokenNetworkRegistry:{address:b.d,block_number:0},ServiceRegistry:{address:b.d,block_number:0},UserDeposit:{address:b.d,block_number:0},SecretRegistry:{address:b.d,block_number:0},MonitoringService:{address:b.d,block_number:0},OneToN:{address:b.d,block_number:0}}});var pc=n(29884);const uc=pc.Decimal.clone({precision:40,rounding:pc.Decimal.ROUND_HALF_EVEN}),mc=new uc(0),yc=new uc(1);function fc(e){const t=parseInt(e);return Me(void 0!==t&&t==e),t}function hc(e,[t,n]){return Me(e.gt(0),"no output channel capacity available"),a=>{const i=new uc(a.toHexString()),r=t(i),o=e=>r.add(n(e.neg())).sub(i).add(e);let s=mc,c=o(s);Me(c.lt(0),"input transfer not enough to pay minimum fees");let l=e,d=o(l);Me(d.gte(0),"output capacity not enough to mediate transfer");while(1){const e=l.add(s).div(2),t=o(e),n=t.sub(c).div(e.sub(s)),a=d.sub(t).div(l.sub(e));if(a.sub(n).abs().lt(1e-6))break;c.isNegative()!==t.isNegative()?(l=e,d=t):(s=e,c=t)}const p=s.sub(c.mul(l.sub(s)).div(d.sub(c)));return Fe(At,i.sub(p).toFixed(0,uc.ROUND_HALF_EVEN))}}const _c={name:"flat",emptySchedule:{flat:v._Y},decodeConfig(e,t){return Fe(At,null!==e&&void 0!==e?e:t).div(2)},channelFee(e){const t=new uc(e.toHexString());return()=>t},fee(e){const t=Fe(At,e.mul(2));return()=>t},schedule(e){return{flat:e}}},gc={name:"proportional",emptySchedule:{proportional:v._Y},decodeConfig(e,t){const n=new uc(fc(null!==e&&void 0!==e?e:t)).div(1e6),a=n.div(n.add(2)).mul(1e6);return a.toDecimalPlaces(0,uc.ROUND_HALF_EVEN).toNumber()},channelFee(e){const t=new uc(e).div(1e6);return e=>e.mul(t).abs()},fee(e){const t=new uc(e).div(1e6);return e=>{const n=new uc(e.toHexString()),a=n.mul(yc.sub(t).div(yc.add(t))),i=n.sub(a);return Fe(At,i.toFixed(0,uc.ROUND_HALF_EVEN))}},schedule(e){return{proportional:g.O$.from(e)}}};function bc(e,t,n){const a=t.sub(e);Me(n>=2&&a.gte(n-1),"invalid linspace params");const i=n-1,r=new uc(a.toString()).div(i),o=[e];for(let s=1;s<i;s++)o.push(e.add(r.mul(s).toFixed(0,uc.ROUND_HALF_EVEN)));return[...o,t]}function vc(e,t){Me(t.length>=2,"invalid linspace");const n=t[0][0],a=t[t.length-1][0];if(e.eq(a.toHexString()))return t.length-2;const i=new uc(a.sub(n).toHexString()),r=i.div(t.length-1);let o=Math.floor(e.sub(n.toHexString()).div(r).toNumber()),s=0;do{if(o<0)return-1;if(o>=t.length-1)return t.length-1;s=e.gte(t[o+1][0].toHexString())?-1:e.lt(t[o][0].toHexString())?1:0,o+=s}while(s);return o}function wc(e,[t,n],[a,i]){return e.sub(t.toHexString()).mul(i.sub(n).toHexString()).div(a.sub(t).toHexString()).add(n.toHexString())}function Tc(e,t){let n=vc(e,t);return n<0?n=0:n>=t.length-1&&(n=t.length-2),wc(e,t[n],t[n+1])}function kc(e,t){const n=21,a=new uc("0.1");Me(e.gt(0),"not enough capacity");const i=new uc(e.toHexString()),r=uc.min(n,i.add(1)).toNumber(),o=bc(v._Y,e,r);if(0===t)return[[v._Y,v._Y],[e,v._Y]];const s=new uc(t).div(1e6);Me(s.lte(a.div(2)),"Too high imbalance fee");const c=i.mul(s),l=a,d=c,p=i.div(2),u=uc.min(10,l.mul(p).div(d)),m=e=>g.O$.from(new uc(e.toHexString()).sub(p).abs().pow(u).mul(d).div(p.pow(u)).toFixed(0,uc.ROUND_HALF_EVEN));return o.map((e=>[e,m(e)]))}const Ec={name:"imbalance",emptySchedule:{imbalance_penalty:null},decodeConfig(e,t){const n=fc(null!==e&&void 0!==e?e:t);return Me(n>=0&&n<=5e4,"Too high imbalance fee"),n},channelFee(e,t){const{totalCapacity:n,ownCapacity:a}=ol(t);if(!e||!n.gt(0))return()=>mc;const i=kc(n,e),r=Tc(new uc(a.toHexString()),i);return e=>Tc(e.add(a.toHexString()),i).sub(r)},fee(e,t,n){const a=this.channelFee(e,t),i=this.channelFee(e,n),r=new uc(ol(n).ownCapacity.toHexString());return hc(r,[a,i])},schedule(e,t){const{totalCapacity:n}=ol(t);if(!e||!n.gt(0))return{imbalance_penalty:null};const a=kc(n,e);return{imbalance_penalty:a}}};function Ac(e){const t=Object.assign({cap_fees:!0},...Object.values(e).map((e=>e.emptySchedule))),n=X.G0([X.S1,X.IM(X.Z_,X.IM(X.Z_,X._4))]),a={name:"standard",emptySchedule:t,decodeConfig(t,a){const i={...Fe(n,t),...Fe(n,a)};for(const[n,o]of Object.entries(i)){var r;const t=Fe(Xe,n),a={cap:null===(r=o["cap"])||void 0===r||r};for(const[n,i]of Object.entries(e)){const e=n;e in o&&(a[e]=i.decodeConfig(o[n]))}i[t]=a}return i},channelFee(t,n){var a;const i=n.token,r=null!==(a=t[i])&&void 0!==a?a:t[b.d],o=Object.entries(e).map((([e,t])=>{const a=null===r||void 0===r?void 0:r[e];if(a)return t.channelFee(a,n)})).filter(We);return e=>o.reduce(((t,n)=>t.add(n(e))),mc)},fee(e,n,a){var i,r,o;const s=this.channelFee(e,n),c=this.channelFee(e,a),l=new uc(ol(a).ownCapacity.toHexString()),d=null!==(i=null===(r=null!==(o=e[n.token])&&void 0!==o?o:e[b.d])||void 0===r?void 0:r.cap)&&void 0!==i?i:t.cap_fees,p=hc(l,[s,c]);return e=>{let t=p(e);return d&&t.lt(0)&&(t=v._Y),t}},schedule(n,a){var i;const r=a.token,o=null!==(i=n[r])&&void 0!==i?i:n[b.d];return Object.assign({},t,void 0!==(null===o||void 0===o?void 0:o.cap)?{cap_fees:o.cap}:void 0,...Object.entries(e).map((([e,t])=>{const n=e,i=null===o||void 0===o?void 0:o[n];return i?t.schedule(i,a):{}})))}};return a}const Nc=Ac({flat:_c,proportional:gc,imbalance:Ec});var Ic=n(78523),Rc=n(31143),Dc=n(32384);function Cc(e,t,n=1e5,a=1e3){const{fromBlock:i,toBlock:r}=t;return(0,Wa.P)((()=>{let o=i,s=Math.min(n,r-i+1),c=5;return(0,Wa.P)((async()=>e.send("eth_getLogs",[{...t,fromBlock:(0,re.$P)(o),toBlock:(0,re.$P)(Math.min(o+s-1,r))}]))).pipe((0,W.U)((t=>(t.forEach((e=>{null==e.removed&&(e.removed=!1)})),Ic.Mb.arrayOf(e.formatter.filterLog.bind(e.formatter))(t)))),(0,ti.b)({complete:()=>o+=s,error:()=>{s=Math.round(s/2),s<a&&(s=a,c--)}}),(0,q.z)((e=>(0,U.D)(e))),(0,K.K)((t=>{if(c<0)throw t;return(0,ja.H)(e.pollingInterval).pipe((0,$a.l)())})),(0,Xa.a)((e=>e.pipe((0,Qa.o)((()=>o<=r))))))}))}function Sc(e,t,{fromBlock:n,confirmations:a,blockNumber$:i,onPastCompleted:r}={}){if("string"===typeof t||Array.isArray(t))return(0,Rc.R)((n=>e.on(t,n)),(n=>e.removeListener(t,n)));const o=a?"number"===typeof a?(0,P.of)(a):a:(0,P.of)(ye),s=[0];let c=Date.now();return o.pipe((0,Ya.x)(),_i((t=>{if(!n){let a=e._lastBlockNumber;const i=e.blockNumber;a=a&&a>t?a:i&&i>t?i:t+1,n=a-t}return s.splice(0,s.length,n),null!==i&&void 0!==i?i:Sc(e,"block")}),Ja.w),(0,Dc.b)(Math.ceil(e.pollingInterval/10)),(0,Fr.z)((([n,a])=>Cc(e,{...t,fromBlock:s[0],toBlock:a}).pipe((0,ti.b)({next:e=>{if(!e.blockNumber||e.blockNumber+n>a)return;const t=e.blockNumber+1;let i=s.findIndex((e=>e>t));i&&(i<0&&(i=s.length),s.splice(0,i,t))},complete:()=>{while(s.length&&s.length>=2*n)s.shift();r&&c&&(c=0,r(Date.now()-c)),s.push(a+1)}})))))}function Oc(e){return function(t){const n=e.interface.parseLog(t),a={...t,...n,removeListener:()=>{},getBlock:()=>e.provider.getBlock(t.blockHash),getTransaction:()=>e.provider.getTransaction(t.transactionHash),getTransactionReceipt:()=>e.provider.getTransactionReceipt(t.transactionHash)};return[...n.args,a]}}function Pc(e){let t=e.name;switch(e.name){case"homestead":t="mainnet";break;case"arbitrum-rinkeby":t="rinkeby-arbitrum";break;case"arbitrum":t="arbitrum-one";break;case"unknown":t=e.chainId.toString();break}return t}const xc=N()((async function(e,t){return t.getCode(e)}));async function Mc(e,{address:t,provider:n}){const a=await xc(t,n),i="63";return a.includes(i+e.substring(2))}function Uc(e,t){return(0,Wa.P)((async()=>{const n=e.interface.getSighash(t);return Me(await Mc(Fe(Ve(4),n,"signature hash not found"),e),["contract does not have method",{contract:e.address,method:t}]),!0}))}var Lc="/";function Bc(e){let t;switch(e.name){case"arbitrum-rinkeby":t={...Qs.re,...tc.re};break;case"arbitrum":t={...Ys.re,...Js.re};break;case"goerli":t={...Xs.re,...ec.re};break;default:try{t={...JSON.parse((0,Mr.readFileSync)(Lr().join(Lc,"deployment",`deployment_${Pc(e)}.json`),"utf-8")),...JSON.parse((0,Mr.readFileSync)(Lr().join(Lc,"deployment",`deployment_services_${Pc(e)}.json`),"utf-8"))}}catch(n){throw new xe(Ae.RDN_UNRECOGNIZED_NETWORK,{network:e})}}return Fe(rc,t)}async function Fc(e,t,n){var a,i;const r=null!==(a=null!==n&&void 0!==n?n:null===(i=globalThis.location)||void 0===i?void 0:i.origin)&&void 0!==a?a:"unknown",o=`=== RAIDEN SUBKEY GENERATION ===\n\nNetwork: ${Pc(e).toUpperCase()}\nRaiden dApp URL: ${r}\n\nWARNING: ensure this signature is being requested from Raiden dApp running at URL above by comparing it to your browser's url bar.\nSigning this message at any other address WILL give it FULL control of this subkey's funds, tokens and Raiden channels!`,s=await t.signMessage((0,Tn.Y0)(o)),c=(0,xr.JQ)(s),l=new kn.w5(c,t.provider);return{signer:l,address:l.address}}const Wc=async(e,t,n,a)=>{let i,r,o;if(Pr.E.isSigner(e)){if(e.provider===t)i=e;else{if(!(e instanceof kn.w5))throw new xe(Ae.RDN_SIGNER_NOT_CONNECTED,{account:e.toString(),provider:t.toString()});i=e.connect(t)}r=await i.getAddress()}else if("number"===typeof e)i=t.getSigner(e),r=await i.getAddress();else if(Xe.is(e)){const n=await t.listAccounts();if(!n.includes(e))throw new xe(Ae.RDN_ACCOUNT_NOT_FOUND,{account:e,accounts:JSON.stringify(n)});i=t.getSigner(e),r=e}else{if(!Ze.is(e))throw new xe(Ae.RDN_STRING_ACCOUNT_INVALID);i=new kn.w5(e,t),r=i.address}return n&&(o={signer:i,address:r},({signer:i,address:r}=await Fc(await t.getNetwork(),o.signer,a))),{signer:i,address:r,main:o}};function $c(e){return Ms(e,{since:0,live:!0,include_docs:!0,selector:{"transfer.ts":{$gt:0}}}).pipe((0,W.U)((({doc:e})=>fs(Fe(Ei,e)))))}const Vc=e=>Object.values(e).reduce(((e,t)=>{const n=ol(t),a={state:t.state,id:t.id,token:t.token,tokenNetwork:t.tokenNetwork,openBlock:t.openBlock,closeBlock:"closeBlock"in t?t.closeBlock:void 0,partner:t.partner.address,balance:n.ownBalance,capacity:n.ownCapacity,...n};return{...e,[t.token]:{...e[t.token],[t.partner.address]:a}}}),{});function Hc({signer:e,address:t,main:n},a){return n&&!a?n:{signer:e,address:t}}function jc(e,t){return e.signer===t?e:e.connect(t)}async function zc(e,{latest$:t,config$:n,provider:a},i){const r=e.blockNumber,o=e.transactionHash;return(0,M.z)(t.pipe(si("state","blockNumber"),(0,Sr.M)(n),(0,$.h)((([e,{confirmationBlocks:t}])=>r+(null!==i&&void 0!==i?i:t)<=e)),(0,Fr.z)((([e,{confirmationBlocks:t}])=>(0,Wa.P)((async()=>a.getTransactionReceipt(o))).pipe((0,W.U)((n=>{if(null!==n&&void 0!==n&&n.confirmations&&n.confirmations>=(null!==i&&void 0!==i?i:t))return n.blockNumber;if(r+2*(null!==i&&void 0!==i?i:t)<e)throw new xe(Ae.RDN_TRANSACTION_REORG,{transactionHash:o})}))))),(0,$.h)(We)))}async function qc(e,t,n){const a=bo.connect(t,e),i=await a.msc_address(),r=Qr.connect(i,e),o=await r.token_network_registry(),s=fo.connect(o,e),c=await s.secret_registry_address(),l=await r.service_registry(),d=await e.getBlockNumber(),p=n||await(0,M.z)(Cc(e,{...s.filters.TokenNetworkCreated(null,null),fromBlock:1,toBlock:d}).pipe((0,H.j)("blockNumber"),(0,$.h)(We)),{defaultValue:d}),u=await a.one_to_n_address();return{TokenNetworkRegistry:{address:o,block_number:p},ServiceRegistry:{address:l,block_number:p},UserDeposit:{address:t,block_number:p},SecretRegistry:{address:c,block_number:p},MonitoringService:{address:i,block_number:p},OneToN:{address:u,block_number:p}}}async function Kc(e){return(0,M.z)(e.pipe((0,H.j)("udcDeposit","balance"),(0,$.h)((e=>!!e&&e.lt(v.Bz)))))}function Zc(e){return(0,M.z)(e.pipe((0,Z.P)(On([vr,hr])),(0,W.U)((e=>{if(hr.is(e)){if(Object.values(de).some((t=>t===e.payload.reason)))return;throw e.payload}return e.payload}))))}function Gc({log:e,getTokenContract:t}){return N()((async function(n){Me(Xe.is(n),[Ae.DTA_INVALID_ADDRESS,{token:n}],e.info);const a=t(n),[i,r,o,s]=await Promise.all([a.callStatic.totalSupply(),a.callStatic.decimals(),a.callStatic.name().catch(Ha()(void 0)),a.callStatic.symbol().catch(Ha()(void 0))]);return{totalSupply:i,decimals:r,name:o,symbol:s}}))}function Yc(e,{address:t,network:n,udc:a}){var i,r,o,s,c;const l=e[0];Me("_meta"===(null===l||void 0===l?void 0:l._id),Ae.RDN_STATE_MIGRATION),Me(l.address===t,Ae.RDN_STATE_ADDRESS_MISMATCH),Me(l.udc===a,Ae.RDN_STATE_NETWORK_MISMATCH),Me(l.network===n.chainId,Ae.RDN_STATE_NETWORK_MISMATCH),Me((null===(i=e.find((e=>"state.address"===e._id)))||void 0===i?void 0:i.value)===t,Ae.RDN_STATE_ADDRESS_MISMATCH),Me((null===(r=e.find((e=>"state.chainId"===e._id)))||void 0===r?void 0:r.value)===n.chainId,Ae.RDN_STATE_NETWORK_MISMATCH),Me((null===(o=e.find((e=>"state.contracts"===e._id)))||void 0===o||null===(s=o.value)||void 0===s||null===(c=s.UserDeposit)||void 0===c?void 0:c.address)===a,Ae.RDN_STATE_NETWORK_MISMATCH)}function Xc(e){if("object"===typeof e)return[e.UserDeposit.address,e.UserDeposit.block_number];const t=e.match(/^(0x[0-9a-f]{40})(?::(\d+))?$/i);return Me(t&&Xe.is(t[1]),[Ae.DTA_INVALID_ADDRESS,{contractsOrUserDepositAddress:e}]),[t[1],t[2]?+t[2]:1]}async function Qc({provider:e,address:t,network:n,log:a},i=Bc(n),r={}){const[o,s]=Xc(i),c=["raiden",Pc(n),o,t].join("_");let l;const{state:d,...p}=r;let u=d;const m=await $s({...p,log:a});u?("string"===typeof u&&(u=Hn(u)),Yc(u,{address:t,network:n,udc:o}),l=await zs.call(m,u,c)):l=await Vs.call(m,c);let y=await Us(l);if(y)y=Fe(cc,y);else{let r=i;"string"===typeof r&&(a.warn("fetching contractsInfo from UDC entrypoint",{udc:o,fromBlock:s}),r=await qc(e,o,s)),y=lc({network:n,address:t,contractsInfo:r}),await Ls(l,y)}return{db:l,state:y}}const Jc=[Nr.settleable,Nr.settling],el=[Nr.closed,...Jc];function tl(e,t){return e.pipe((0,Z.P)(),(0,q.z)((({channels:n})=>{const a=n[il(t)];return Me(a&&el.includes(a.state),Ae.CNL_NO_SETTLEABLE_OR_SETTLING_CHANNEL_FOUND),e.pipe(si("channels",il(t)))})),(0,Z.P)((e=>Jc.includes(e.state))))}function nl(e,t=3){const n=new Wo(128);return function(a){let i=n.get(a);return i||(i=(0,Wa.P)((async()=>e.getBlock(a))).pipe((0,W.U)((({timestamp:e})=>(Me(e,["no timestamp in block",{block:a}]),e))),(0,ni.a)((n=>n.pipe((0,q.z)(((n,a)=>{if(a>=t)throw n;return(0,ja.H)(e.pollingInterval)}))))),(0,ti.b)({error:()=>n.delete(a)}),(0,Wr.d)({bufferSize:1,refCount:!1})),n.set(a,i)),i}}function al(e,t,{signer:n,contractsInfo:a,db:i,main:r}){var o,s,c,l,d;Me(n.provider&&n.provider instanceof w.r&&n.provider.network,"Signer must be connected to a JsonRpcProvider");const p=new Za.t(1),u=p.pipe(si("config")),m=fo.connect(a.TokenNetworkRegistry.address,null!==(o=null===r||void 0===r?void 0:r.signer)&&void 0!==o?o:n);return{latest$:p,config$:u,matrix$:new Br.c,signer:n,provider:n.provider,network:n.provider.network,address:e.address,log:y().getLogger(`raiden:${e.address}`),defaultConfig:Ui({network:n.provider.network},t),contractsInfo:a,registryContract:m,getTokenNetworkContract:N()((e=>{var t;return mo.connect(e,null!==(t=null===r||void 0===r?void 0:r.signer)&&void 0!==t?t:n)})),getTokenContract:N()((e=>{var t;return Yr.connect(e,null!==(t=null===r||void 0===r?void 0:r.signer)&&void 0!==t?t:n)})),serviceRegistryContract:io.connect(a.ServiceRegistry.address,null!==(s=null===r||void 0===r?void 0:r.signer)&&void 0!==s?s:n),userDepositContract:bo.connect(a.UserDeposit.address,null!==(c=null===r||void 0===r?void 0:r.signer)&&void 0!==c?c:n),secretRegistryContract:no.connect(a.SecretRegistry.address,null!==(l=null===r||void 0===r?void 0:r.signer)&&void 0!==l?l:n),monitoringServiceContract:Qr.connect(a.MonitoringService.address,null!==(d=null===r||void 0===r?void 0:r.signer)&&void 0!==d?d:n),main:r,db:i,init$:new Za.t,mediationFeeCalculator:Nc,getBlockTimestamp:nl(n.provider)}}function il({tokenNetwork:e,partner:t}){const n="string"===typeof t?t:t.address;return`${e}@${n}`}function rl(e){return"_id"in e&&e._id?e._id:`${il(e)}#${e.id.toString().padStart(9,"0")}`}function ol(e){const t=e.own.withdraw,n=e.partner.withdraw,a=e.own.balanceProof.transferredAmount,i=e.partner.balanceProof.transferredAmount,r=e.own.locks.filter((e=>e.registered)).reduce(((e,t)=>e.add(t.amount)),v._Y),o=e.partner.locks.filter((e=>e.registered)).reduce(((e,t)=>e.add(t.amount)),v._Y),s=a.add(r),c=i.add(o),l=e.own.balanceProof.lockedAmount.sub(r),d=e.partner.balanceProof.lockedAmount.sub(o),p=c.sub(s),u=s.sub(c),m=it(t,...e.own.pendingWithdraws.filter((e=>e.type===Ut.WITHDRAW_REQUEST)).map((e=>e.total_withdraw))),y=it(n,...e.partner.pendingWithdraws.filter((e=>e.type===Ut.WITHDRAW_REQUEST)).map((e=>e.total_withdraw))),f=e.own.deposit.sub(m).sub(l).add(p),h=e.partner.deposit.sub(y).sub(d).add(u),_=e.own.deposit.add(p).sub(l),g=_.sub(t),b=e.partner.deposit.add(u).sub(d),w=b.sub(n),T=e.own.deposit.sub(e.own.withdraw).add(e.partner.deposit).sub(e.partner.withdraw);return{ownDeposit:e.own.deposit,ownWithdraw:t,ownTransferred:a,ownLocked:l,ownBalance:p,ownCapacity:f,ownOnchainUnlocked:r,ownUnlocked:s,partnerDeposit:e.partner.deposit,partnerWithdraw:n,partnerTransferred:i,partnerLocked:d,partnerBalance:u,partnerCapacity:h,partnerOnchainUnlocked:o,partnerUnlocked:c,ownTotalWithdrawable:_,ownWithdrawable:g,partnerTotalWithdrawable:b,partnerWithdrawable:w,totalCapacity:T}}function sl(e,t,{log:n,provider:a}){return i=>i.pipe((0,ti.b)((t=>n.debug(`sent ${e} tx "${t.hash}" to "${t.to}"`))),(0,q.z)((e=>ui((()=>e.wait()),a.pollingInterval,{onErrors:Re}).pipe((0,W.U)((t=>[e,t]))))),(0,W.U)((([a,i])=>{var r,o,s;if(!i.status||!i.transactionHash||!i.blockNumber)throw new xe(t,{status:null!==(r=i.status)&&void 0!==r?r:null,transactionHash:null!==(o=i.transactionHash)&&void 0!==o?o:null,blockNumber:null!==(s=i.blockNumber)&&void 0!==s?s:null});return n.debug(`${e} tx "${i.transactionHash}" successfuly mined!`),[a,i]})))}function cl(){return e=>e.pipe((0,H.j)("channels"),ci(),(0,H.j)(1),(0,Cr.v)(rl,{connector:()=>new Za.t(1)}),(0,W.U)((t=>{const[n,a]=t.key.split("#"),i=+a;return t.pipe((0,ei.R)(e.pipe((0,$.h)((({channels:e})=>{var t;return(null===(t=e[n])||void 0===t?void 0:t.id)!==i})))))})))}const ll=new WeakMap,dl=Object.assign((function(e){const t=ll.get(e);if((null===t||void 0===t?void 0:t[0])===e.blockNumber)return t[1];const n=e.getFeeData().catch((t=>{throw ll.delete(e),t}));return ll.set(e,[e.blockNumber,n]),n}),{cache:ll});function pl(e,t,n,a,{subkey:i,error:r=Ae.RDN_TRANSACTION_FAILED}={}){const{provider:o,config$:s}=a;return(0,Wa.P)((async()=>dl(o))).pipe((0,Sr.M)(s),(0,q.z)((([r,{gasPriceFactor:o,subkey:s}])=>{let c;if(o&&1!==o)if(r.maxPriorityFeePerGas&&r.maxFeePerGas){const e=r.maxPriorityFeePerGas.mul(Math.round(1e6*(o-1))).div(1e6);c={maxPriorityFeePerGas:r.maxPriorityFeePerGas.add(e),maxFeePerGas:r.maxFeePerGas.add(e)}}else r.gasPrice&&(c={gasPrice:r.gasPrice.mul(Math.round(1e6*o)).div(1e6)});else c=void 0;let l=e;if(null!==i){const{signer:t}=Hc(a,null!==i&&void 0!==i?i:s);l=jc(e,t)}return(0,Wa.P)((async()=>l.estimateGas[t](...n))).pipe((0,q.z)((async e=>{let a;return e=e.add(e.mul(5).div(100)),a=n.length===l[t].length?n.slice(0,-1).concat({...at(n),...c,gasLimit:e}):n.concat({...c,gasLimit:e}),l[t](...a)})))})),sl(t,r,a))}function ul(e,t,n,a){const{config$:i}=a;return i.pipe((0,Z.P)(),(0,q.z)((async({subkey:n})=>{const{address:i}=Hc(a,n);return Promise.all([e.callStatic.balanceOf(i),e.callStatic.allowance(i,t)])})),(0,Sr.M)(i),(0,q.z)((([[i,r],{minimumAllowance:o}])=>{if(Me(i.gte(n),[Ae.RDN_INSUFFICIENT_BALANCE,{current:i,required:n}]),r.gte(n))return(0,P.of)(!0);let s=(0,P.of)(!0);return r.isZero()||(s=pl(e,"approve",[t,0],a,{error:Ae.RDN_APPROVE_TRANSACTION_FAILED}).pipe((0,Or.h)(!0))),s.pipe((0,ii.j)(pl(e,"approve",[t,it(o,n)],a,{error:Ae.RDN_APPROVE_TRANSACTION_FAILED})),(0,H.j)(1))})))}var ml=n(13296),yl=n(42289),fl=n.n(yl),hl=n(56141),_l=n.n(hl),gl=n(18646),bl=n(23360),vl=n(54312),wl=n(5563),Tl=n(52740),kl=n(31794);function El({},e,{init$:t}){return e.pipe((0,Z.P)(),(0,q.z)((({blockNumber:n})=>{const a=Date.now();return t.pipe((0,q.z)((e=>(0,bl.z)((0,P.of)(1),e.pipe((0,$a.l)(),(0,kl.l)(-1))))),(0,Nn.R)(((e,t)=>e+t),0),(0,Dc.b)(10),(0,Z.P)((e=>0===e)),(0,Sr.M)(e),(0,W.U)((([,{blockNumber:e}])=>vr({tookMs:Date.now()-a,initialBlock:n,currentBlock:e}))))})),yi(e),(0,ri.x)((()=>t.complete())))}function Al(e,{},{provider:t,init$:n}){return ui((()=>t.getBlockNumber()),t.pollingInterval).pipe((0,q.z)((e=>n.pipe(fi((()=>Sc(t,"block"))),(0,In.O)(e)))),(0,W.U)((e=>Na({blockNumber:e}))),yi(e))}function Nl(e,{},{log:t,getBlockTimestamp:n}){const a=20,i=5,r=[];return e.pipe((0,$.h)(Na.is),(0,H.j)("payload","blockNumber"),(0,$.h)((e=>!r.length||r[r.length-1]+a<=e)),(0,Fr.z)((e=>{let o;return o=r.length<i?Math.max(1,e-a*i):r[0],(0,gl.a)([n(e),n(o)]).pipe((0,$.h)((([e,t])=>t<e)),(0,W.U)((([t,n])=>(r.length>=i&&r.splice(0,1),r.push(e),1e3*(t-n)/(e-o)))),gi({log:t.warn}))})),(0,Ya.x)(),(0,W.U)((e=>Ia({blockTime:e}))))}function Il({},e,{latest$:t,config$:n,init$:a}){return e.pipe((0,wl.u)(a.pipe((0,ai.Z)())),si("blockNumber"),(0,Sr.M)(t,n),(0,W.U)((([,{blockTime:e},{httpTimeout:t}])=>Math.max(3*e,2*t))),(0,Ja.w)((t=>(0,bl.z)((0,P.of)(!1),(0,ja.H)(t).pipe((0,Or.h)(!0),yi(e))))),(0,Ya.x)(),(0,W.U)((e=>Ra({stale:e}))))}function Rl({},e,{log:t,registryContract:n,config$:a,init$:i}){let r;return(0,Wa.P)((async()=>(r=new Br.c,i.next(r),n.callStatic.settle_timeout()))).pipe((0,W.U)((e=>e.toNumber())),pi(Li(a)),(0,Sr.M)(e,a),(0,q.z)((function*([e,{config:n},{revealTimeout:a}]){yield Da(e),a<=e/2||("revealTimeout"in n?t.warn("Invalid `config.revealTimeout` - transfers may fail",{revealTimeout:a,maxRevealTimeout:e/2}):yield _r({revealTimeout:Math.floor(e/2)}))})),(0,ti.b)((()=>{r.next(null),r.complete()})))}function Dl(e,t,n,a){return ui((()=>t.getTransactionReceipt(e.payload.txHash)),t.pollingInterval).pipe((0,W.U)((t=>{var i;return void 0!==(null===t||void 0===t?void 0:t.confirmations)&&t.confirmations>=a&&t.status?{...e,payload:{...e.payload,txBlock:null!==(i=t.blockNumber)&&void 0!==i?i:e.payload.txBlock,confirmed:!0}}:e.payload.txBlock+2*a<n?{...e,payload:{...e.payload,confirmed:!1}}:void 0})),(0,$.h)(We))}function Cl({},e,{config$:t,provider:n,latest$:a}){return(0,gl.a)([e.pipe(si("blockNumber")),e.pipe((0,H.j)("pendingTxs")),t.pipe(si("confirmationBlocks"),yi(e))]).pipe((0,$.h)((([,e])=>e.length>0)),(0,Fr.z)((([e,t,i])=>(0,U.D)(t).pipe((0,$.h)((t=>t.payload.txBlock+i<e)),(0,j.b)((t=>Dl(t,n,e,i).pipe((0,ei.R)(a.pipe((0,$.h)((({state:e})=>!e.pendingTxs.some((e=>e.type===t.type&&e.payload.txHash===t.payload.txHash)))))))))))))}function Sl(e,t,n){const{log:a,signer:i,address:r,network:o,getTokenNetworkContract:s,config$:c}=n;return e.pipe((0,$.h)(On(Ma.request)),(0,Sr.M)(t),(0,q.z)((([t,l])=>{const{tokenNetwork:d,partner:p}=t.meta,u=l.channels[il(t.meta)];if((null===u||void 0===u?void 0:u.state)!==Nr.open&&(null===u||void 0===u?void 0:u.state)!==Nr.closing){const e=new xe(Ae.CNL_NO_OPEN_OR_CLOSING_CHANNEL_FOUND,t.meta);return(0,P.of)(Ma.failure(e,t.meta))}const m=u.partner.balanceProof,y=ya(m),f=m.nonce,h=m.additionalHash,_=m.signature,g=(0,re.zo)([$n(d,20),$n(o.chainId,32),$n(ua.BALANCE_PROOF,32),$n(u.id,32),$n(y,32),$n(f,32),$n(h,32),$n(_,65)]);return(0,U.D)(i.signMessage(g)).pipe((0,q.z)((t=>pl(s(d),"closeChannel",[u.id,p,r,y,f,h,_,t],n,{error:Ae.CNL_CLOSECHANNEL_FAILED}).pipe(pi(Li(c),{onErrors:Pe,log:a.info}),(0,ei.R)(e.pipe((0,$.h)(Ma.success.is),(0,$.h)((e=>e.meta.tokenNetwork===d&&e.meta.partner===p))))))),(0,$a.l)(),(0,K.K)((e=>(0,P.of)(Ma.failure(e,t.meta)))))})))}function Ol(e,t,n){const{log:a,signer:i,address:r,network:o,getTokenNetworkContract:s,config$:c}=n;return e.pipe((0,$.h)(On(Ma.success)),(0,$.h)((e=>!!e.payload.confirmed)),(0,Tl.j)((()=>e.pipe((0,$.h)(Na.is)))),(0,Sr.M)(t),(0,$.h)((([e,t])=>{const n=t.channels[il(e.meta)];return(null===n||void 0===n?void 0:n.state)===Nr.closed&&n.id===e.payload.id&&n.partner.balanceProof.transferredAmount.add(n.partner.balanceProof.lockedAmount).gt(v._Y)&&n.closeParticipant!==r})),(0,q.z)((([e,t])=>{const{tokenNetwork:l,partner:d}=e.meta,p=t.channels[il(e.meta)],u=ya(p.partner.balanceProof),m=p.partner.balanceProof.nonce,y=p.partner.balanceProof.additionalHash,f=p.partner.balanceProof.signature,h=(0,re.zo)([$n(l,20),$n(o.chainId,32),$n(ua.BALANCE_PROOF_UPDATE,32),$n(p.id,32),$n(u,32),$n(m,32),$n(y,32),$n(f,65)]);return(0,Wa.P)((()=>i.signMessage(h))).pipe((0,q.z)((e=>pl(s(l),"updateNonClosingBalanceProof",[p.id,d,r,u,m,y,f,e],n,{error:Ae.CNL_UPDATE_NONCLOSING_BP_FAILED}))),(0,ti.b)({next:e=>a.info("Updated channel",{channel:p,v:e}),error:e=>a.info("Error updating channel",{channel:p,error:e})}),pi(Li(c),{onErrors:Pe,log:a.info}),(0,$a.l)(),(0,K.K)((e=>(a.error("Error updating non-closing balance-proof, ignoring",e),L.E))))})))}var Pl=n(26177),xl=n(8634),Ml=n(3572);function Ul({meta:e},t,{latest$:n}){return n.pipe((0,H.j)("state","channels",il(e)),(0,$.h)(We),(0,Pl.Q)(t.pipe((0,$.h)(Sa.failure.is),(0,$.h)((t=>_l()(t.meta,e))),(0,W.U)((()=>{throw new xe(Ae.CNL_NO_OPEN_CHANNEL_FOUND,e)})))))}function Ll({payload:e},t){let n,a;return[n,a]=t?"totalDeposit"in e?[e.totalDeposit.sub(t.own.deposit),e.totalDeposit]:[e.deposit,t.own.deposit.add(e.deposit)]:"totalDeposit"in e?[e.totalDeposit,e.totalDeposit]:[e.deposit,e.deposit],Me(n.gt(0),Ae.DTA_INVALID_DEPOSIT),[n,a]}function Bl(e,t,[n,a],i){const{address:r,log:o,getTokenContract:s,getTokenNetworkContract:c,config$:l,latest$:d}=i,{tokenNetwork:p,partner:u}=e.meta;return d.pipe((0,Z.P)(),(0,q.z)((({state:e})=>{const t=ke()(e.tokens,(e=>e===p));return ul(s(t),p,n,i)})),(0,ii.j)(t),(0,q.z)((e=>pl(c(p),"setTotalDeposit",[e,r,a,u],i,{error:Ae.CNL_SETTOTALDEPOSIT_FAILED}))),pi(Li(l),{onErrors:Pe,log:o.info}))}function Fl(e,{},t){return e.pipe((0,$.h)(Pa.request.is),(0,Sr.M)(t.config$),(0,Cr.v)((([{meta:e},{minimumAllowance:t}])=>t.eq(v.Bz)?il(e):e.tokenNetwork)),(0,q.z)((n=>n.pipe((0,H.j)(0),(0,j.b)((n=>t.latest$.pipe((0,Z.P)(),(0,q.z)((({state:a})=>{const i=a.channels[il(n.meta)];Me(!i&&n.payload.waitOpen||(null===i||void 0===i?void 0:i.state)===Nr.open,[Ae.CNL_NO_OPEN_CHANNEL_FOUND,{state:null===i||void 0===i?void 0:i.state,id:null===i||void 0===i?void 0:i.id}]);const r=Ul(n,e,t),[o,s]=Ll(n,i);return r.pipe((0,xl.$)((a=>Bl(n,a.pipe((0,H.j)("id"),(0,Cn.q)(1)),[o,s],t).pipe((0,Ml.T)(e.pipe((0,$.h)(Un(Pa,n.meta)),(0,Z.P)((e=>!Pa.success.is(e)||e.payload.totalDeposit.gte(s))))),(0,ei.R)(a.pipe((0,$.h)((e=>e.own.deposit.gte(s))))))),{connector:()=>new Za.t(1)}),(0,$a.l)())})),(0,K.K)((e=>(0,P.of)(Pa.failure(e,n.meta)))))))))),yi(e))}var Wl=n(97725),$l=n(87755),Vl=n(95099),Hl=n.n(Vl),jl=n(45521);const zl=mo.createInterface();function ql({address:e,provider:t,registryContract:n,contractsInfo:a}){const i=Wl.$.encode(["address"],[e]);return Cc(t,Object.assign(n.filters.TokenNetworkCreated(),{fromBlock:a.TokenNetworkRegistry.block_number,toBlock:t.blockNumber})).pipe((0,W.U)(Oc(n)),(0,$.h)((([,e])=>!!e)),(0,V.q)(),(0,q.z)((e=>{const n=(0,U.D)(e.splice(0,2).map((([e,t,,n])=>Ca({token:e,tokenNetwork:t,fromBlock:n.blockNumber}))));let a=L.E;if(e.length){const n=at(e[0]).blockNumber,r=new Map(e.map((([e,t,,n])=>[t,[e,n]]))),o=Array.from(r.keys());a=(0,Fa.T)(Cc(t,{address:o,topics:[Yl.openTopic,null,i],fromBlock:n,toBlock:t.blockNumber}),Cc(t,{address:o,topics:[Yl.openTopic,null,null,i],fromBlock:n,toBlock:t.blockNumber})).pipe((0,jl.E)((e=>e.address)),(0,$.h)((e=>r.has(e.address))),(0,W.U)((e=>Ca({token:r.get(e.address)[0],tokenNetwork:e.address,fromBlock:e.blockNumber}))))}return(0,Fa.T)(n,a)})))}function Kl(e,t,n){return e.pipe((0,$.h)(Na.is),(0,Cn.q)(1),(0,Sr.M)(t),(0,q.z)((([,e])=>{const t=new Br.c;let a;return n.init$.next(t),a=So()(e.tokens)?ql(n):(0,U.D)(Object.entries(e.tokens).map((([e,t])=>Ca({token:e,tokenNetwork:t})))),a.pipe((0,ri.x)((()=>t.complete())))})))}function Zl(e,{},{address:t,main:n,network:a,provider:i}){var r;const o=null!==(r=null===n||void 0===n?void 0:n.address)&&void 0!==r?r:t;let s;return(0,ja.H)(0,i.pollingInterval).pipe(yi(e),(0,Fr.z)((async()=>{try{const[e,t]=await Promise.all([!1===s?Promise.resolve(null):i.listAccounts(),i.getNetwork()]);if(Me(t.chainId===a.chainId,"network changed"),void 0===s&&(s=null===e||void 0===e?void 0:e.includes(o)),s&&e&&!e.includes(o))return hr({reason:de.ACCOUNT_CHANGED})}catch(e){if(Le.is(e)&&e.message.includes("network changed"))return hr({reason:de.NETWORK_CHANGED});if(Ne(Re,e))return;throw e}})),(0,$.h)(We))}const Gl=$l.QV.fromString("ChannelSettled(uint256 indexed,uint256,bytes32,uint256,bytes32)"),Yl={openTopic:zl.getEventTopic("ChannelOpened"),depositTopic:zl.getEventTopic("ChannelNewDeposit"),withdrawTopic:zl.getEventTopic("ChannelWithdraw"),closedTopic:zl.getEventTopic("ChannelClosed"),settledTopic:zl.getEventTopic("ChannelSettled"),oldSettledTopic:zl.getEventTopic(Gl)};function Xl(e){if(e.topics[0]===Yl.oldSettledTopic){const t=zl.decodeEventLog(Gl,e.data,e.topics);e={...e,...zl.encodeEventLog(zl.getEvent("ChannelSettled"),[t[0],b.d,t[1],t[2],b.d,t[3],t[4]])}}return e}function Ql([e,t],{address:n,latest$:a}){const{openTopic:i,depositTopic:r,withdrawTopic:o,closedTopic:s,settledTopic:c}=Yl;return l=>l.pipe((0,Sr.M)(a),(0,W.U)((([a,{state:l,config:d}])=>{var p;const u=a[0].toNumber(),m=Object.values(l.channels).find((e=>e.tokenNetwork===t&&e.id===u)),y=at(a),f=null===(p=y.topics)||void 0===p?void 0:p[0],h=y.transactionHash,_=y.blockNumber,g=_+d.confirmationBlocks<=l.blockNumber||void 0;let b;switch(f){case i:{const[,i,r]=a;if((n===i||n===r)&&(!m||u>m.id)){const a=n==i?r:i;b=Sa.success({id:u,token:e,isFirstParticipant:n===i,txHash:h,txBlock:_,confirmed:g},{tokenNetwork:t,partner:a})}break}case r:{const[,e,n]=a;(null===m||void 0===m?void 0:m.id)===u&&n.gt(m[e===m.partner.address?"partner":"own"].deposit)&&(b=Pa.success({id:u,participant:e,totalDeposit:n,txHash:h,txBlock:_,confirmed:g},{tokenNetwork:t,partner:m.partner.address}));break}case o:{const[,e,n]=a;(null===m||void 0===m?void 0:m.id)===u&&n.gt(m[e===m.partner.address?"partner":"own"].withdraw)&&(b=xa({id:u,participant:e,totalWithdraw:n,txHash:h,txBlock:_,confirmed:g},{tokenNetwork:t,partner:m.partner.address}));break}case s:if((null===m||void 0===m?void 0:m.id)===u&&!("closeBlock"in m)){const[,e]=a;b=Ma.success({id:u,participant:e,txHash:h,txBlock:_,confirmed:g},{tokenNetwork:t,partner:m.partner.address})}break;case c:(null===m||void 0===m?void 0:m.id)===u&&(b=Ba.success({id:u,txHash:h,txBlock:_,confirmed:g,locks:m.partner.locks},{tokenNetwork:t,partner:m.partner.address}));break}return b})),(0,$.h)(We))}function Jl([e,t],[n,a],i){const{address:r,provider:o,latest$:s,getTokenNetworkContract:c}=i,l=c(a);return(0,Fa.T)(Cc(o,Object.assign(l.filters.ChannelOpened(null,r,null),{fromBlock:e,toBlock:t})),Cc(o,Object.assign(l.filters.ChannelOpened(null,null,r),{fromBlock:e,toBlock:t}))).pipe((0,W.U)(Oc(l)),(0,V.q)(),(0,Sr.M)(s),(0,q.z)((([n,{state:i}])=>{const s=n.filter((([e,t,n])=>{const o=r===t?n:t,s=e.toNumber(),c=il({tokenNetwork:a,partner:o}),l=i.channels[c];return!(rl({id:s,tokenNetwork:a,partner:o})in i.oldChannels||l&&s<l.id)})),c=[...s,...Object.values(i.channels).filter((e=>e.tokenNetwork===a)).map((e=>[e.id]))].map((([e])=>Wl.$.encode(["uint256"],[e])));if(0===c.length)return L.E;const d={address:a,topics:[Object.values(Yl).filter((e=>e!==Yl.openTopic)),c]};return Cc(o,Object.assign(d,{fromBlock:e,toBlock:t})).pipe((0,W.U)(Xl),(0,W.U)(Oc(l)),(0,V.q)(),(0,q.z)((e=>{const t=[...s,...e];return(0,U.D)(Hl()(t,[e=>at(e).blockNumber,e=>at(e).transactionIndex]))})))})),Ql([n,a],i))}function ed(e,[t,n],a){const{provider:i,getTokenNetworkContract:r,config$:o,latest$:s}=a,c=r(n),l=s.pipe(si("state","blockNumber")),d={address:n,topics:[Object.values(Yl)]};return Sc(i,d,{fromBlock:e,blockNumber$:l,confirmations:o.pipe((0,H.j)("confirmationBlocks"))}).pipe((0,W.U)(Xl),(0,W.U)(Oc(c)),Ql([t,n],a))}function td(e,{},t){const n=t.provider._lastBlockNumber;return e.pipe((0,$.h)(Na.is),(0,H.j)("payload","blockNumber"),(0,xl.$)((a=>e.pipe((0,$.h)(Ca.is),(0,jl.E)((e=>e.payload.tokenNetwork)),(0,Sr.M)(t.config$),(0,q.z)((([e,{confirmationBlocks:i}])=>{var r;const{token:o,tokenNetwork:s}=e.payload,c=null!==(r=e.payload.fromBlock)&&void 0!==r?r:n-i,l=new Br.c;return t.init$.next(l),a.pipe((0,Z.P)(),(0,q.z)((e=>(0,Fa.T)(Jl([c,e],[o,s],t).pipe((0,ri.x)((()=>{l.next(!0),l.complete()}))),ed(e+1,[o,s],t).pipe((0,Tl.j)((()=>l)))))))})))),{connector:()=>new Za.t(1)}),yi(e))}function nd({},e){return e.pipe(cl(),(0,q.z)((e=>e.pipe((0,Z.P)(),(0,W.U)((e=>Oa({id:e.id},{tokenNetwork:e.tokenNetwork,partner:e.partner.address})))))))}function ad(e,t,n){const{address:a,getTokenNetworkContract:i,log:r,config$:o}=n,s=i(t.meta.tokenNetwork);return Uc(s,"openChannelWithDeposit").pipe((0,K.K)(Ha()((0,P.of)(!1))),(0,q.z)((i=>{var c;let l;return l=null!==(c=t.payload.deposit)&&void 0!==c&&c.gt(0)&&i?pl(s,"openChannelWithDeposit",[a,t.meta.partner,t.payload.deposit],n,{subkey:null,error:Ae.CNL_OPENCHANNEL_FAILED}):pl(s,"openChannel",[a,t.meta.partner],n,{subkey:null,error:Ae.CNL_OPENCHANNEL_FAILED}),l.pipe(pi(Li(o),{onErrors:Pe,log:r.info}),(0,ei.R)(e.pipe((0,$.h)(Sa.success.is),(0,$.h)((e=>_l()(e.meta,t.meta))))),(0,Ml.T)(e.pipe((0,Z.P)(Un(Sa,t.meta)))),(0,$a.l)(),(0,K.K)((e=>(0,P.of)(Sa.failure(e,t.meta)))))})))}function id(e,t,n){return e.pipe((0,$.h)(Sa.request.is),(0,Sr.M)(n.config$),(0,Cr.v)((([{meta:e},{minimumAllowance:t}])=>t.eq(v.Bz)?il(e):e.tokenNetwork)),(0,q.z)((a=>a.pipe((0,H.j)(0),(0,Sr.M)(t),(0,q.z)((([t,a])=>{var i,r;const o=null===(i=a.channels[il(t.meta)])||void 0===i?void 0:i.state;if(o)return(0,P.of)(Sa.failure(new xe(Ae.CNL_INVALID_STATE,{state:o}),t.meta));let s=L.E;return null!==(r=t.payload.deposit)&&void 0!==r&&r.gt(0)&&(s=(0,P.of)(Pa.request({totalDeposit:t.payload.deposit,waitOpen:!0},t.meta))),(0,Fa.T)(s,ad(e,t,n))}))))))}function rd({},e,{getBlockTimestamp:t,latest$:n}){return e.pipe(cl(),(0,q.z)((a=>a.pipe((0,$.h)((e=>e.state===Nr.closed)),(0,Cn.q)(1),(0,Tl.j)((e=>t(e.closeBlock).pipe((0,Sr.M)(n),(0,q.z)((([e,{settleTimeout:t}])=>(0,ja.H)(new Date(1e3*(e+t)))))))),(0,Sr.M)(e),(0,W.U)((([e,{blockNumber:t}])=>Ua({settleableBlock:t+1},{tokenNetwork:e.tokenNetwork,partner:e.partner.address})))))))}function od(e,t,{address:n,config$:a}){return t.pipe(cl(),(0,Sr.M)(e.pipe(oa())),(0,q.z)((([e,t])=>e.pipe((0,$.h)((e=>e.state===Nr.settleable)),(0,Cn.q)(1),(0,Sr.M)(a),(0,Tl.j)((([e,{httpTimeout:a,revealTimeout:i}])=>{const r=sa(t[e.partner.address]);let o;return o=r&&e.closeParticipant===n?a:1e3*i,(0,ja.H)(o)})),(0,W.U)((([e])=>Ba.request(void 0,{tokenNetwork:e.tokenNetwork,partner:e.partner.address})))))),(0,j.b)((t=>Ri(e,t,Mn(Ba,t.meta)))),mi(a.pipe((0,H.j)("autoSettle"),yi(t))))}function sd([e,t],n,a){const{address:i,db:r,config$:o,log:s,getTokenNetworkContract:c}=a,{tokenNetwork:l,partner:d}=t.meta,p=c(l);return(0,Wa.P)((()=>Promise.all([p.callStatic.getChannelParticipantInfo(n.id,i,d),p.callStatic.getChannelParticipantInfo(n.id,d,i)]))).pipe(pi(Li(o),{onErrors:Re}),(0,q.z)((([{3:t},{3:c}])=>{let u,m;return u=t===ya(n.own.balanceProof)?(0,P.of)(n.own.balanceProof):hs(r,n,wi.SENT,t).pipe((0,K.K)((()=>{throw new xe(Ae.CNL_SETTLE_INVALID_BALANCEHASH,{address:i,ownBalanceHash:t})}))),m=c===ya(n.partner.balanceProof)?(0,P.of)(n.partner.balanceProof):hs(r,n,wi.RECEIVED,c).pipe((0,K.K)((()=>{throw new xe(Ae.CNL_SETTLE_INVALID_BALANCEHASH,{address:i,partnerBalanceHash:c})}))),(0,gl.a)([u,m]).pipe((0,W.U)((([e,t])=>t.transferredAmount.add(t.lockedAmount).lt(e.transferredAmount.add(e.lockedAmount))?[[d,t],[i,e]]:[[i,e],[d,t]])),(0,q.z)((([e,t])=>pl(p,"settleChannel",[n.id,e[0],e[1].transferredAmount,e[1].lockedAmount,e[1].locksroot,t[0],t[1].transferredAmount,t[1].lockedAmount,t[1].locksroot],a,{error:Ae.CNL_SETTLE_FAILED}))),pi(Li(o),{maxRetries:3,onErrors:Pe,log:s.info}),(0,ei.R)(e.pipe((0,$.h)(Ba.success.is),(0,$.h)((e=>e.meta.tokenNetwork===l&&e.meta.partner===d)))))})),(0,$a.l)(),(0,K.K)((e=>(0,P.of)(Ba.failure(e,t.meta)))))}function cd([e,t]){return{participant:e.participant,total_withdraw:e.total_withdraw,withdrawable_until:e.expiration,participant_signature:e.signature,partner_signature:t.signature}}function ld([e,t],n,a){const{config$:i,log:r,getTokenNetworkContract:o}=a,{tokenNetwork:s,partner:c}=t.meta,[l,d]=t.payload.coopSettle;return pl(o(s),"cooperativeSettle",[n.id,cd(l),cd(d)],a,{error:Ae.CNL_COOP_SETTLE_FAILED}).pipe(pi(Li(i),{maxRetries:3,onErrors:Pe,log:r.info}),(0,ei.R)(e.pipe((0,$.h)(Ba.success.is),(0,$.h)((e=>e.meta.tokenNetwork===s&&e.meta.partner===c)))),(0,$a.l)(),(0,K.K)((e=>(0,P.of)(Ba.failure(e,t.meta)))))}function dd(e,t,n){return e.pipe((0,$.h)(Ba.request.is),(0,Sr.M)(t),(0,q.z)((([t,a])=>{var i;const r=a.channels[il(t.meta)];return(null===r||void 0===r?void 0:r.state)===Nr.settleable||(null===r||void 0===r?void 0:r.state)===Nr.settling?sd([e,t],r,n):null===(i=t.payload)||void 0===i||!i.coopSettle||(null===r||void 0===r?void 0:r.state)!==Nr.open&&(null===r||void 0===r?void 0:r.state)!==Nr.closing?(0,P.of)(Ba.failure(new xe(Ae.CNL_NO_SETTLEABLE_OR_SETTLING_CHANNEL_FOUND,t.meta),t.meta)):ld([e,t],r,n)})))}function pd(e,t,n){const{log:a,address:i,getTokenNetworkContract:r,config$:o}=n;return e.pipe((0,$.h)(On(Ba.success)),(0,$.h)((e=>{var t;return!(!e.payload.confirmed||null===(t=e.payload.locks)||void 0===t||!t.length)})),(0,Sr.M)(t),(0,$.h)((([e,t])=>{var n;return(null===(n=t.channels[il(e.meta)])||void 0===n?void 0:n.id)!==e.payload.id})),(0,q.z)((([e])=>{const{tokenNetwork:t,partner:s}=e.meta,c=(0,re.zo)(e.payload.locks.reduce(((e,t)=>[...e,$n(t.expiration,32),$n(t.amount,32),t.secrethash]),[]));return pl(r(t),"unlock",[e.payload.id,i,s,c],n,{error:Ae.CNL_ONCHAIN_UNLOCK_FAILED}).pipe(pi(Li(o),{maxRetries:3,onErrors:Pe,log:a.info}),(0,$a.l)(),(0,K.K)((e=>(a.error("Error unlocking pending locks on-chain, ignoring",e),L.E))))})))}function ud(e,{},{db:t}){return t.busy$.pipe((0,$a.l)(),yi(e))}var md=n(64668),yd=n(38153);function fd(e,t,{address:n,log:a,network:i,signer:r,contractsInfo:o,latest$:s,config$:c}){const{partnerUnlocked:l}=ol(t);return l.isZero()?L.E:(0,gl.a)([s,c]).pipe((0,$.h)((([{udcDeposit:e},{monitoringReward:n,rateToSvt:a}])=>{var i;return!(null===n||void 0===n||!n.gt(v._Y))&&e.balance.gte(n)&&l.mul(null!==(i=a[t.token])&&void 0!==i?i:v.Bz).div(v.Ce).gt(n)})),(0,Cn.q)(1),yi(e,10),(0,q.z)((([,{monitoringReward:e}])=>{const s=t.partner.balanceProof,c=ya(s),l=(0,re.zo)([$n(t.tokenNetwork,20),$n(i.chainId,32),$n(ua.BALANCE_PROOF_UPDATE,32),$n(t.id,32),$n(c,32),$n(s.nonce,32),$n(s.additionalHash,32),$n(s.signature,65)]),d=cs().toString();return(0,U.D)(r.signMessage(l)).pipe((0,q.z)((i=>Ta(r,{type:Ut.MONITOR_REQUEST,balance_proof:{chain_id:s.chainId,token_network_address:s.tokenNetworkAddress,channel_identifier:g.O$.from(t.id),nonce:s.nonce,balance_hash:c,additional_hash:s.additionalHash,signature:s.signature},non_closing_participant:n,non_closing_signature:i,monitoring_service_contract_address:o.MonitoringService.address,reward_amount:e},{log:a}))),(0,W.U)((e=>la.request({message:e},{service:mt.MS,msgId:d}))))})),gi({log:a.warn},"Error trying to generate & sign MonitorRequest"))}function hd({},e,t){return e.pipe(cl(),(0,Sr.M)(t.config$),(0,q.z)((([n,{httpTimeout:a}])=>n.pipe((0,Ya.x)(((e,t)=>t.partner.balanceProof.transferredAmount.eq(e.partner.balanceProof.transferredAmount)&&t.partner.balanceProof.lockedAmount.eq(e.partner.balanceProof.lockedAmount)&&t.partner.locks===e.partner.locks)),(0,md.G)(),(0,yd.D)((([e,t])=>t.partner.locks.length>e.partner.locks.length?(0,ja.H)(a):(0,P.of)(1))),(0,Ja.w)((([,n])=>fd(e,n,t)))))))}function _d(e,t,{provider:n,monitoringServiceContract:a,address:i,config$:r,init$:o}){const s=new Br.c;return o.next(s),Sc(n,a.filters.NewBalanceProofReceived(null,null,null,null,null,i),{confirmations:r.pipe((0,H.j)("confirmationBlocks")),blockNumber$:e.pipe((0,$.h)(Na.is),(0,H.j)("payload","blockNumber")),onPastCompleted:()=>{s.next(null),s.complete()}}).pipe(yi(t),(0,W.U)(Oc(a)),(0,$.h)((([,,,,,e])=>e===i)),(0,Sr.M)(t,r),(0,W.U)((([[e,t,n,a,i,,r],o,{confirmationBlocks:s}])=>{const c=Object.values(o.channels).concat(Object.values(o.oldChannels)).find((n=>n.tokenNetwork===e&&t.eq(n.id))),l=r.blockNumber;if(c&&l)return Zi({tokenNetwork:e,partner:c.partner.address,id:c.id,reward:n,nonce:a,monitoringService:i,txHash:r.transactionHash,txBlock:l,confirmed:l+s<=o.blockNumber||void 0})})),(0,$.h)(We))}var gd=n(71975),bd=n.n(gd),vd=n(48159),wd=n.n(vd);function Td(e=new Date){return e.toISOString().substring(0,23)+"000"}function kd(e,t,{address:n,log:a,signer:i,network:r,contractsInfo:o,config$:s}){return(0,Wa.P)((()=>{const t=Td(),a=(0,re.zo)([n,e.address,(0,Tn.Y0)(t)]);return(0,U.D)(i.signMessage(a)).pipe((0,W.U)((a=>({sender:n,receiver:e.address,timestamp:t,signature:a}))))})).pipe((0,Sr.M)(s),(0,q.z)((([n,{httpTimeout:a}])=>(0,B.U)(`${e.url}/api/v1/${t}/payment/iou?${new URLSearchParams(n).toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}).pipe((0,z.V)(a),pi(Li(s),{onErrors:[...Re,"TimeoutError"]})))),(0,Sr.M)(s),(0,q.z)((async([t,{pfsIouTimeout:i}])=>{if(404===t.status){const t={sender:n,receiver:e.address,chain_id:g.O$.from(r.chainId),amount:v._Y,one_to_n_address:o.OneToN.address,claimable_until:g.O$.from(Math.round(Date.now()/1e3+i))};return a.warn("PFS: new IOU created",t),t}const s=await t.text();Me(t.ok,[Ae.PFS_LAST_IOU_REQUEST_FAILED,{responseStatus:t.status,responseText:s}]);const{last_iou:c}=Fe(Ot,Hn(s)),l=(0,kn.n5)(Qo(c),c.signature);return Me(l===n,[Ae.PFS_IOU_SIGNATURE_MISMATCH,{signer:l,address:n,lastIou:c}]),a.warn("PFS: fetched non-cached signed IOU from server",c),c})))}function Ed(e,t,n){return e.price.isZero()?(0,P.of)(void 0):n.latest$.pipe((0,Z.P)(),(0,q.z)((({state:a})=>{var i;const r=null===(i=a.iou[t])||void 0===i?void 0:i[e.address];return r?(0,P.of)(r):kd(e,t,n)})),(0,W.U)((t=>({...t,amount:t.amount.add(e.price)}))),(0,q.z)((e=>Jo(n.signer,e))))}function Ad(e,t){const n=e.partner.address;if(e.state!==Nr.open)return`path: channel with "${n}" in state "${e.state}" instead of "${Nr.open}"`;const{ownCapacity:a}=ol(e);return!a.lt(t)||`path: channel with "${n}" doesn't have enough capacity=${a.toString()}`}function Nd(e,t,n,a){return e?!1===(null===t||void 0===t?void 0:t.payload.available)?"path: partner not available in transport":n||ia(null===t||void 0===t?void 0:t.payload.caps,pe.MEDIATE)?Ad(e,a):"path: partner doesn't mediate transfers":"path: there's no direct channel with partner"}function Id(e,t,n){const{tokenNetwork:a,target:i,value:r}=e.meta;Me(Object.values(t.tokens).includes(a),[Ae.PFS_UNKNOWN_TOKEN_NETWORK,{tokenNetwork:a}]),Me(n.payload.available,[Ae.PFS_TARGET_OFFLINE,{target:i}]),Me(ia(n.payload.caps,pe.RECEIVE),[Ae.PFS_TARGET_NO_RECEIVE,{target:i}]),Me(Object.values(t.channels).some((e=>!0===Ad(e,r))),Ae.PFS_NO_ROUTES_BETWEEN_NODES)}function Rd(e,t){const n=null===e.payload.pfs,a=!e.payload.pfs&&t.pfsMode===ht.disabled;return n||a}function Dd(e,t){return es(e.payload.pfs,t).pipe((0,Z.P)(),_i((n=>Ed(n,e.meta.tokenNetwork,t))),(0,Sr.M)(t.config$),_i((([[n,a],i])=>Sd(n,a,e.meta,{address:t.address,config:i}))),(0,W.U)((([[[,n],a],{response:i,text:r}])=>{const o=Hn(r);if(!i.ok){const e=Fe(Dt,o,void 0,t.log.warn);return{iou:n,error:e}}return{iou:n,paths:xd(o,e.meta.value,a)}})))}function Cd([e,t],n,{address:a,log:i}){let r,o;const s=new Set,{tokenNetwork:c,value:l,target:d}=e.meta;return(0,U.D)(t).pipe((0,j.b)((e=>{let t;return(0,Wa.P)((()=>{if(Me(e.path.length>=2&&e.path[0]===a,"we are not the first address in path"),t=e.path[1],Me(!s.has(t),"already invalidated recipient"),r)Me(r.path[1]===t,"already selected another recipient"),Me(r.fee.gte(e.fee),"already selected a smaller fee");else{const a=n.channels[il({tokenNetwork:c,partner:t})],i=ks(e.address_metadata,t),r=Nd(a,i,d===t,l);if(!0!==r)throw new xe(r,{partnerPresence:i,channel:a});for(const[t,n]of Object.entries(e.path.slice(2,-1))){const a=ks(e.address_metadata,n);Me(ia(null===a||void 0===a?void 0:a.payload.caps,pe.MEDIATE),["path: hop doesn't mediate transfers",{hopIndex:t+2,hop:n,hopPresence:a}])}}return(0,P.of)(e)})).pipe((0,ti.b)((e=>{var t;return null!==(t=r)&&void 0!==t?t:r=e})),(0,K.K)((n=>{var a;return null!==(a=o)&&void 0!==a||(o=n),i.warn("Invalidated received route",{error:n,path:e}),t&&s.add(t),L.E})))})),(0,V.q)(),(0,W.U)((e=>{var t;if(!e.length)throw null!==(t=o)&&void 0!==t?t:new xe(Ae.PFS_NO_ROUTES_FOUND);return e})))}function Sd(e,t,{tokenNetwork:n,target:a,value:i},{address:r,config:o}){const{httpTimeout:s,pfsMaxPaths:c}=o,l=jn({from:r,to:a,value:je(32).encode(i),max_paths:c,iou:t?tt(St).encode(t):void 0});return(0,B.U)(`${e.url}/api/v1/${n}/paths`,{method:"POST",headers:{"Content-Type":"application/json"},body:l}).pipe((0,z.V)(s),pi(Li((0,P.of)(o)),{onErrors:[...Re,"TimeoutError"]}),(0,q.z)((async e=>({response:e,text:await e.text()}))))}function Od(e,t,{pfsSafetyMargin:n}){let a=0,i=0;"number"===typeof n?a=n-1:(a=n[0],i=n[1]);const r=new pc.Decimal(e.toHexString()).abs().mul(a).add(new pc.Decimal(t.toHexString()).mul(i));return Fe(At,e.add(r.toFixed(0,pc.Decimal.ROUND_CEIL)))}function Pd(e,t,n){return e.map((e=>{const a="path"in e?e.path:e.route,i=wd()(e,["path","route"]),r="fee"in e?e.fee:e.estimated_fee.isZero()?e.estimated_fee:Od(e.estimated_fee,t,n),o=wd()(i,["fee","estimated_fee"]);return{path:a,fee:r,...o}}))}function xd(e,t,n){return Pd(Fe(Rt,e).result,t,n).slice(0,n.pfsMaxPaths)}function Md(e){return"paths"in e||Ud(e.error)}function Ud(e){return 2201===(null===e||void 0===e?void 0:e.error_code)}function Ld(e,t,{state:n,config:a},i){Id(e,n,i);const{tokenNetwork:r,target:o,value:s}=e.meta;if(e.payload.paths)return(0,P.of)({paths:Pd(e.payload.paths,s,a),iou:void 0});if(!0===Nd(n.channels[il({tokenNetwork:r,partner:o})],i,!0,s)){const e={};var c;if(n.transport.setup)e[t.address]={user_id:n.transport.setup.userId,displayname:n.transport.setup.displayName,capabilities:na(null!==(c=a.caps)&&void 0!==c?c:{})};return(0,P.of)({paths:[{path:[t.address,o],fee:v._Y,...So()(e)?{}:{address_metadata:e}}],iou:void 0})}if(Rd(e,a))throw new xe(Ae.PFS_DISABLED);return Dd(e,t)}function Bd([e,t],n,a){const{tokenNetwork:i}=e.meta,{iou:r}=t;let o,s=L.E;if(r&&(s=(0,P.of)(Md(t)?Vi({iou:r},{tokenNetwork:i,serviceAddress:r.receiver}):Hi(void 0,{tokenNetwork:i,serviceAddress:r.receiver}))),"error"in t){const{error:e}=t;o=(0,Ka._)((()=>Ud(e)?new xe(Ae.PFS_NO_ROUTES_BETWEEN_NODES):new xe(Ae.PFS_ERROR_RESPONSE,{errorCode:e.error_code,errors:e.errors})))}else o=Cd([e,t.paths],n,a).pipe((0,W.U)((t=>Wi.success({paths:t},e.meta))));return(0,bl.z)(s,o)}function Fd(e,{},t){return e.pipe(bi(Qn,(n=>e.pipe((0,$.h)(On(Wi.request)),(0,j.b)((e=>n(Qn.request(void 0,{address:e.meta.target})).pipe((0,Sr.M)(t.latest$),(0,q.z)((([n,a])=>Ld(e,t,a,n))),(0,Sr.M)(t.latest$),(0,q.z)((([n,{state:a}])=>Bd([e,n],a,t))),(0,K.K)((t=>(0,P.of)(Wi.failure(t,e.meta)))))))))))}function Wd({},e,{log:t,address:n,network:a,signer:i,config$:r}){return e.pipe(cl(),(0,q.z)((e=>e.pipe((0,md.G)(),(0,Sr.M)(r),(0,$.h)((([[,e],{pfsMode:t}])=>e.state===Nr.open&&t!==ht.disabled)),(0,yd.D)((([[e,t],{httpTimeout:n}])=>t.own.locks.length>e.own.locks.length||t.partner.locks.length>e.partner.locks.length?(0,ja.H)(n):(0,P.of)(1))),(0,Ja.w)((([[,e],{revealTimeout:r}])=>{const o=e.tokenNetwork,s=e.partner.address,{ownCapacity:c,partnerCapacity:l}=ol(e),d={type:Ut.PFS_CAPACITY_UPDATE,canonical_identifier:{chain_identifier:g.O$.from(a.chainId),token_network_address:o,channel_identifier:g.O$.from(e.id)},updating_participant:n,other_participant:s,updating_nonce:e.own.balanceProof.nonce,other_nonce:e.partner.balanceProof.nonce,updating_capacity:c,other_capacity:l,reveal_timeout:g.O$.from(r)},p=cs().toString();return(0,Wa.P)((()=>Ta(i,d,{log:t}))).pipe((0,W.U)((e=>la.request({message:e},{service:mt.PFS,msgId:p}))),(0,K.K)((e=>(t.error("Error trying to generate & sign PFSCapacityUpdate",e),L.E))))}))))))}function $d({},e,{log:t,address:n,network:a,signer:i,config$:r,mediationFeeCalculator:o}){return e.pipe(cl(),(0,q.z)((e=>(0,gl.a)([e,r.pipe(si("caps")),r.pipe(si("mediationFees"))]).pipe((0,$.h)((([,e])=>!!ia(e,pe.MEDIATE))),(0,W.U)((([e,,t])=>{const n=o.schedule(t,e);return[e,n]})),(0,Ya.x)((([,e],[,t])=>_l()(e,t))),(0,Ja.w)((([e,r])=>{const o={type:Ut.PFS_FEE_UPDATE,canonical_identifier:{chain_identifier:g.O$.from(a.chainId),token_network_address:e.tokenNetwork,channel_identifier:g.O$.from(e.id)},updating_participant:n,timestamp:Td(),fee_schedule:r},s=cs().toString(),c={service:mt.PFS,msgId:s};return(0,U.D)(Ta(i,o,{log:t})).pipe((0,W.U)((e=>la.request({message:e},c))),(0,K.K)((e=>(t.error("Error trying to generate & sign PFSFeeUpdate",e),L.E))))})),(0,ei.R)(e.pipe((0,$.h)((e=>e.state!==Nr.open))))))),yi(e))}function Vd(e,t,{provider:n,serviceRegistryContract:a,contractsInfo:i,config$:r,init$:o}){const s=e.pipe((0,$.h)(Na.is),(0,H.j)("payload","blockNumber"));return t.pipe((0,Z.P)(),(0,Ja.w)((({services:c})=>{const l=new Br.c;return o.next(l),Sc(n,a.filters.RegisteredService(null,null,null,null),{fromBlock:So()(c)?i.TokenNetworkRegistry.block_number:void 0,confirmations:r.pipe((0,H.j)("confirmationBlocks")),blockNumber$:s,onPastCompleted:()=>{l.next(null),l.complete()}}).pipe((0,Sr.M)(t,r),(0,$.h)((([{blockNumber:e},{blockNumber:t},{confirmationBlocks:n}])=>!!e&&e+n<=t)),(0,H.j)(0),(0,W.U)(Oc(a)),(0,Sr.M)(t),(0,W.U)((([[e,t],{services:n}])=>({...n,[e]:1e3*t.toNumber()}))),(0,In.O)(c),(0,Ja.w)((t=>e.pipe((0,$.h)(Na.is),(0,In.O)(!0),(0,W.U)((()=>bd()(t,(e=>Date.now()<e))))))))})),(0,Ya.x)(_l()),(0,W.U)((e=>$i(e))),yi(e))}var Hd=n(81319);function jd(e,{},{address:t,latest$:n,config$:a,userDepositContract:i}){return e.pipe((0,$.h)(Na.is),(0,H.j)("payload","blockNumber"),(0,Sr.M)(a),(0,Fr.z)((([e,{confirmationBlocks:n}])=>(0,Wa.P)((async()=>Promise.all([i.callStatic.effectiveBalance(t,{blockTag:e-n}),i.callStatic.total_deposit(t,{blockTag:e-n})]))).pipe((0,K.K)(Ha()(L.E))))),(0,Sr.M)(n),(0,$.h)((([[e],{udcDeposit:t}])=>!t.balance.eq(e))),(0,W.U)((([[e,t]])=>ji.success({balance:e},{totalDeposit:t}))))}function zd([e,t],[n,a],i){const{address:r,log:o,config$:s,latest$:c}=i;let l;return ul(e,t.address,n,i).pipe((0,Sr.M)(c),(0,q.z)((([,{udcDeposit:e}])=>(Me(e.totalDeposit.add(n).eq(a),[Ae.UDC_DEPOSIT_OUTDATED,{requested:a,current:e.totalDeposit}]),l=e.balance.add(n),pl(t,"deposit",[r,a],i,{error:Ae.RDN_DEPOSIT_TRANSACTION_FAILED})))),pi(Li(s),{onErrors:Oe,log:o.debug}),(0,W.U)((([,e])=>ji.success({balance:l,txHash:e.transactionHash,txBlock:e.blockNumber,confirmed:void 0},{totalDeposit:a}))))}function qd(e,{},t){const{userDepositContract:n,getTokenContract:a,config$:i,log:r}=t;return e.pipe((0,$.h)(ji.request.is),(0,j.b)((e=>(0,Wa.P)((async()=>n.callStatic.token())).pipe(pi(Li(i),{onErrors:Re,log:r.debug}),(0,q.z)((i=>zd([a(i),n],[e.payload.deposit,e.meta.totalDeposit],t))),(0,K.K)((t=>(0,P.of)(ji.failure(t,e.meta))))))))}function Kd(e,{},t){const{userDepositContract:n,address:a,log:i,signer:r,config$:o}=t;return e.pipe((0,$.h)(qi.request.is),(0,j.b)((s=>{const c=jc(n,r),l=s.meta.amount;return(0,Wa.P)((async()=>n.callStatic.balances(a))).pipe((0,q.z)((e=>(Me(l.gt(v._Y),[Ae.UDC_PLAN_WITHDRAW_GT_ZERO,{amount:l.toString()}]),Me(l.lte(e),[Ae.UDC_PLAN_WITHDRAW_EXCEEDS_AVAILABLE,{balance:e.toString(),amount:l.toString()}]),pl(c,"planWithdraw",[l],t,{subkey:!0,error:Ae.UDC_PLAN_WITHDRAW_FAILED})))),pi(Li(o),{onErrors:Oe,log:i.info}),_i((()=>e.pipe((0,$.h)(Na.is),(0,In.O)(0),(0,Fr.z)((()=>(0,Wa.P)((async()=>n.callStatic.withdraw_plans(a))).pipe(gi({onErrors:Re,log:i.debug})))),(0,Z.P)((({amount:e})=>e.gte(s.meta.amount)))))),(0,W.U)((([[{hash:e},{blockNumber:t}],{withdrawable_after:n}])=>qi.success({withdrawableAfter:n.toNumber(),txHash:e,txBlock:t,confirmed:void 0},s.meta))),(0,K.K)((e=>(0,P.of)(qi.failure(e,s.meta)))))})))}function Zd(e,{},{userDepositContract:t,address:n,config$:a,log:i}){let r=0;const o=(0,Wa.P)((async()=>(await t.callStatic.withdraw_timeout()).toNumber())).pipe(pi(Li(a)),(0,Wr.d)({bufferSize:1,refCount:!1}));return e.pipe((0,$.h)(Na.is),(0,$.h)((()=>Date.now()>=r)),(0,Fr.z)((()=>(0,gl.a)([(0,Wa.P)((async()=>t.callStatic.withdraw_plans(n))),o]).pipe((0,q.z)((function*([{amount:t,withdrawable_after:n},a]){const i={amount:t};if(n.isZero())return void(r=Date.now()+1e3*a);const o=0===r;o&&(yield(0,P.of)(qi.success({withdrawableAfter:n.toNumber(),confirmed:!0},i))),n.gt(Math.round(Date.now()/1e3))?r=1e3*n.toNumber():yield Ri(e,Ki.request(void 0,i),Un(Ki,i))})),(0,Fo.J)(),gi({log:i.info})))),mi(a.pipe((0,H.j)("autoUDCWithdraw"),yi(e))))}function Gd(e,{},t){const{log:n,userDepositContract:a,address:i,config$:r,main:o}=t;return e.pipe((0,$.h)(Ki.request.is),(0,j.b)((s=>{let c,l;return(0,Hd.D)([(0,Wa.P)((async()=>a.callStatic.balances(i))),Uc(a,"withdrawToBeneficiary").pipe((0,K.K)(Ha()((0,P.of)(!1))))]).pipe((0,Sr.M)(r),(0,q.z)((([[e,n],{subkey:r}])=>{var d,p;Me(e.gt(v._Y),[Ae.UDC_WITHDRAW_NO_BALANCE,{balance:e.toString()}]),c=e;const u=n&&o&&!(null!==(d=null===(p=s.payload)||void 0===p?void 0:p.subkey)&&void 0!==d?d:r);return l=u?o.address:i,u?pl(a,"withdrawToBeneficiary",[s.meta.amount,o.address],t,{subkey:!0,error:Ae.UDC_WITHDRAW_FAILED}):pl(a,"withdraw",[s.meta.amount],t,{subkey:!0,error:Ae.UDC_WITHDRAW_FAILED})})),pi(Li(r),{onErrors:Oe,log:n.info}),(0,q.z)((([,{transactionHash:t,blockNumber:r}])=>e.pipe((0,$.h)(Na.is),(0,Fr.z)((()=>(0,Wa.P)((async()=>a.callStatic.balances(i))).pipe(gi({onErrors:Re,log:n.info})))),(0,$.h)((e=>e.lt(c))),(0,Cn.q)(1),(0,W.U)((e=>Ki.success({withdrawal:c.sub(e),beneficiary:l,txHash:t,txBlock:r,confirmed:void 0},s.meta)))))),(0,K.K)((e=>(0,P.of)(Ki.failure(e,s.meta)))))})))}function Yd(e,t,{caps:n}){const a=ia(n,pe.MEDIATE),i=e.meta.direction===wi.RECEIVED&&e.payload.message.target!==t;return!!a&&i}function Xd(e,t,n,{address:a,log:i,mediationFeeCalculator:r}){const o=e.payload.message,s=e.payload.partner,c=o.token_network_address,l=new Set(Object.values(t.channels).filter((e=>e.tokenNetwork===c)).filter((e=>e.state===Nr.open)).map((({partner:e})=>e.address)));let d={routes:[]};try{d=Fe(Yt,o.metadata)}catch(p){}for(const{route:m,address_metadata:y}of d.routes){const e=m[m.indexOf(a)+1];if(!e||!l.has(e))continue;const d=t.channels[il({tokenNetwork:c,partner:s})],p=t.channels[il({tokenNetwork:c,partner:e})];let f;try{f=r.fee(n.mediationFees,d,p)(o.lock.amount)}catch(u){i.warn("Mediation: could not calculate mediation fee, ignoring",{error:u});continue}const h=ks(y,e);let _=o.metadata;return ia(null===h||void 0===h?void 0:h.payload.caps,pe.IMMUTABLE_METADATA)||(_=bs(a,_)),{resolved:!0,partner:e,fee:f.mul(-1),userId:null===h||void 0===h?void 0:h.payload.userId,metadata:_}}i.warn("Mediation: could not find a suitable route, ignoring",{inputRoutes:d.routes,openPartners:l})}function Qd(e,t,n){const{address:a,config$:i}=n;return e.pipe((0,$.h)(Xi.is),(0,Sr.M)(i,t),(0,$.h)((([e,t])=>Yd(e,a,t))),(0,W.U)((([e,t,a])=>{const i=e.payload.message,r=e.meta.secrethash,o=Xd(e,a,t,n);if(o)return Yi.request({tokenNetwork:i.token_network_address,target:i.target,paymentId:i.payment_identifier,value:i.lock.amount,expiration:i.lock.expiration.toNumber(),initiator:i.initiator,...o},{secrethash:r,direction:wi.SENT})})),(0,$.h)(We))}var Jd=n(14648),ep=n.n(Jd);function tp(e,t,{log:n,getTokenNetworkContract:a}){return e.pipe((0,$.h)(ur.success.is),(0,$.h)((e=>e.meta.direction===wi.RECEIVED)),(0,Sr.M)(t),(0,q.z)((([e,t])=>{const i=a(e.meta.tokenNetwork);return Uc(i,"cooperativeSettle").pipe((0,q.z)((()=>{const n=t.channels[il(e.meta)];Me((null===n||void 0===n?void 0:n.state)===Nr.open,"channel not open");const a=n.partner.pendingWithdraws.find(Ci(Ut.WITHDRAW_REQUEST,e.payload.message));if(Me(a,"no matching WithdrawRequest found"),!a.coop_settle)return L.E;const{ownTotalWithdrawable:i}=ol(n);return(0,P.of)(pr.request({coopSettle:!1},{...e.meta,direction:wi.SENT,totalWithdraw:i}))})),(0,K.K)((t=>(n.warn("Could not reply to CoopSettle request, ignoring",{action:e,error:t}),L.E))))})))}function np(e,{},{latest$:t,config$:n,log:a}){return e.pipe(bi(Ba,(i=>e.pipe((0,$.h)(ur.success.is),(0,Cr.v)((e=>il(e.meta))),(0,q.z)((e=>e.pipe((0,j.b)((e=>(0,gl.a)([t,n]).pipe((0,Z.P)(),(0,q.z)((([{state:t},{revealTimeout:n}])=>{const a=t.channels[il(e.meta)];Me((null===a||void 0===a?void 0:a.state)===Nr.open,"channel not open");const{ownCapacity:r,partnerCapacity:o,ownTotalWithdrawable:s,partnerTotalWithdrawable:c}=ol(a);Me(!a.own.locks.length&&!a.partner.locks.length&&r.isZero()||o.isZero(),"");const l=a.own.pendingWithdraws.find((e=>e.type===Ut.WITHDRAW_REQUEST&&e.expiration.gte(Math.floor(Date.now()/1e3+n))&&e.total_withdraw.eq(s)&&!!e.coop_settle));Me(l,"own request not found");const d=a.own.pendingWithdraws.find(Ci(Ut.WITHDRAW_CONFIRMATION,l)),p=a.partner.pendingWithdraws.find((e=>e.type===Ut.WITHDRAW_REQUEST&&e.expiration.gte(Math.floor(Date.now()/1e3+n))&&e.total_withdraw.eq(c)));Me(p,"partner request not found");const u=a.partner.pendingWithdraws.find(Ci(Ut.WITHDRAW_CONFIRMATION,p));Me(d&&u,["no matching WithdrawConfirmations found",{ownConfirmation:d,partnerConfirmation:u}]);const m=Si(l,a);return i(Ba.request({coopSettle:[[l,d],[p,u]]},{tokenNetwork:m.tokenNetwork,partner:m.partner})).pipe((0,W.U)((e=>pr.success(ep()(e.payload,["txBlock","txHash","confirmed"]),m))),(0,K.K)((e=>(0,P.of)(pr.failure(e,m)))),(0,In.O)(mr(void 0,m)))})),(0,K.K)((e=>(e.message&&a.info(e.message,e.details),L.E)))))))))))))}var ap=n(83920);function ip({},e,{config$:t}){const n=({key:t})=>e.pipe((0,$.h)((({transfers:e})=>!(t in e))));return e.pipe((0,H.j)("transfers"),(0,q.z)((e=>Object.values(e))),(0,$.h)((({direction:e})=>e===wi.SENT)),(0,Cr.v)((({_id:e})=>e),{duration:n}),(0,q.z)((a=>a.pipe((0,Sr.M)(t),(0,Fr.z)((([{expiration:e,transfer:t},{httpTimeout:n}])=>{const a={secrethash:t.lock.secrethash,direction:wi.SENT};return(0,ja.H)(new Date(1e3*(e+1))).pipe((0,ii.j)((0,ja.H)(n).pipe((0,Or.h)(rr.request(void 0,a)),(0,In.O)(Yi.failure(new xe(Ae.XFER_EXPIRED,{expiration:e}),a)))))})),(0,ei.R)(a.pipe((0,$.h)((e=>!!(e.unlock||e.expired||e.secretRegistered||e.channelClosed))),(0,ap.b)(n(a)))),yi(e)))))}function rp({},e){return e.pipe((0,Z.P)(),(0,q.z)((({transfers:e})=>(0,U.D)(Object.values(e).filter((e=>e.direction===wi.SENT&&!e.unlockProcessed&&!e.expiredProcessed&&!e.secretRegistered&&!e.channelClosed))))),(0,q.z)((function*(e){const t={secrethash:e.transfer.lock.secrethash,direction:wi.SENT};yield Qn.request(void 0,{address:e.transfer.target}),e.transferProcessed||(yield Xi({message:et(e.transfer),fee:e.fee,partner:e.partner},t)),e.unlock&&(yield ar.success({message:et(e.unlock),partner:e.partner},t)),e.expired&&(yield rr.success({message:et(e.expired),partner:e.partner},t))})))}function op({},e,{config$:t}){return e.pipe((0,Z.P)(),(0,q.z)((({transfers:e})=>(0,U.D)(Object.values(e).filter((e=>e.direction===wi.RECEIVED&&!e.unlock&&!e.expired&&!e.secretRegistered&&!e.channelClosed))))),(0,q.z)((e=>{const n=e.transfer.lock.secrethash,a={secrethash:n,direction:wi.RECEIVED};return(0,Fa.T)((0,P.of)(Xi({message:et(e.transfer),fee:e.fee,partner:e.partner},a)),e.secret&&!e.secretReveal?(0,P.of)(Ji({secret:e.secret},a)):L.E,e.secretReveal?(0,P.of)(nr({message:et(e.secretReveal)},a)):L.E,!e.secret&&e.secretRequest?t.pipe((0,H.j)("caps"),(0,$.h)((e=>!!ia(e,pe.RECEIVE))),(0,Cn.q)(1),(0,ii.j)((0,P.of)(Qn.request(void 0,{address:e.transfer.initiator}),tr({message:et(e.secretRequest)},a)))):L.E)})))}function sp(e,{},{config$:t}){return e.pipe(bi(Wi,(n=>e.pipe((0,$.h)(Yi.request.is),(0,$.h)((e=>!e.payload.resolved)),(0,q.z)((a=>n(Wi.request(ep()(a.payload,["paths","pfs"]),ep()(a.payload,["tokenNetwork","target","value"]))).pipe((0,Sr.M)(e.pipe((0,$.h)(Qn.success.is),(0,$.h)((e=>e.meta.address===a.payload.target))),t),(0,W.U)((([e,t,{encryptSecret:n}])=>{var i;let r;(null!==(i=a.payload.encryptSecret)&&void 0!==i?i:n)&&a.payload.secret&&(r={secret:a.payload.secret,amount:a.payload.value,payment_identifier:a.payload.paymentId});const o=vs(e.payload.paths,t,r),s=wd()(a.payload,["paths","pfs","encryptSecret"]),c={...s,...o};return Yi.request(c,a.meta)})),(0,K.K)((e=>(0,P.of)(Yi.failure(e,a.meta)))))))))))}function cp(e){var t,n;return"meta"in e&&(null===(t=e.meta)||void 0===t?void 0:t.secrethash)&&(null===(n=e.meta)||void 0===n?void 0:n.direction)}function lp(e,t,{config$:n}){return t.pipe(si("transfers"),ci(),(0,Cr.v)((([e])=>e),{duration:({key:e})=>t.pipe((0,$.h)((({transfers:t})=>!(e in t))))}),(0,Sr.M)(n),(0,q.z)((([t,{httpTimeout:n}])=>t.pipe((0,$.h)((([,e])=>!!(e.unlockProcessed||e.expiredProcessed||e.channelSettled))),(0,Cn.q)(1),(0,q.z)((([,n])=>e.pipe((0,$.h)(cp),(0,$.h)((e=>ls(e.meta)===t.key)),(0,In.O)({meta:ep()(n,["secrethash","direction"])}),yi(t)))),(0,Dc.b)(3*n),(0,W.U)((({meta:e})=>sr(void 0,e)))))),yi(e))}function dp(e,t){const n=e.locks.filter((e=>e.secrethash!==t));return Me(n.length===e.locks.length-1,"invalid locks size"),n}function pp(e){return e.reduce(((e,{amount:t})=>e.add(t)),v._Y)}function up(e,t,n){const a=e.channels[il(t)];return Me((null===a||void 0===a?void 0:a.state)===Nr.open,"channel not open"),n&&(Me(n.chain_id.eq(e.chainId),"chainId mismatch"),Me(n.channel_identifier.eq(a.id),"channelId mismatch")),a}function mp(e){return e.payload.resolved}function yp(e,t,{config:n,settleTimeout:a},{log:i,address:r,network:o,signer:s}){var c;const{revealTimeout:l,expiryFactor:d}=n,{tokenNetwork:p,fee:u,partner:m,userId:y}=t.payload,f=up(e,{tokenNetwork:p,partner:m}),h=Math.round(Date.now()/1e3);let _;"expiration"in t.payload&&t.payload.expiration?_=t.payload.expiration:(_=h,"lockTimeout"in t.payload&&t.payload.lockTimeout?_+=t.payload.lockTimeout:_+=Math.min(l*d,a-1)),_=Fe(je(32),Math.ceil(_)),Me(_.gt(h+l),["expiration too soon",{expiration:_,blockNumber:e.blockNumber,settleTimeout:a,revealTimeout:l}]),Me(_.lt(h+a),["expiration too far in the future",{expiration:_,blockNumber:e.blockNumber,settleTimeout:a,revealTimeout:l}]);const b={amount:t.payload.value.add(u),expiration:_,secrethash:t.meta.secrethash},v=[...f.own.locks,b],w=pp(v);Me(je(32).is(f.own.balanceProof.transferredAmount.add(w)),"overflow on future transferredAmount");const T=ns(v);i.info("Signing transfer of value",t.payload.value.toString(),"of token",f.token,", to",t.payload.target,", through routes",t.payload.metadata,", paying",u.toString(),"in fees.");const k={type:Ut.LOCKED_TRANSFER,message_identifier:cs(),chain_id:g.O$.from(o.chainId),token_network_address:t.payload.tokenNetwork,channel_identifier:g.O$.from(f.id),nonce:f.own.nextNonce,transferred_amount:f.own.balanceProof.transferredAmount,locked_amount:w,locksroot:T,payment_identifier:t.payload.paymentId,token:f.token,recipient:m,lock:b,target:t.payload.target,initiator:null!==(c=t.payload.initiator)&&void 0!==c?c:r,metadata:t.payload.metadata};return(0,U.D)(Ta(s,k,{log:i})).pipe((0,q.z)((function*(e){yield Xi({message:e,fee:u,partner:m,userId:y},t.meta),t.payload.secret&&(yield Ji({secret:t.payload.secret},t.meta))})))}function fp(e,t,n){return(0,gl.a)([e,n.latest$]).pipe((0,Z.P)(),(0,q.z)((([e,a])=>n.db.storageKeys.has(ls(t.meta))?(n.log.warn("transfer already present",t.meta),L.E):yp(e,t,a,n))),(0,K.K)((e=>(0,P.of)(Yi.failure(e,t.meta)))))}function hp(e,t,n,a,{log:i,signer:r,db:o}){const s=n.meta.secrethash,c=a.transfer,l=c.token_network_address,d=a.partner,p=up(t,{tokenNetwork:l,partner:d});let u;if(a.unlock)u=(0,P.of)(a.unlock);else{Me(a.secret,"unknown secret"),Me(p.own.locks.find((e=>e.secrethash===s)),"transfer already unlocked or expired"),Me(a.secretRegistered||a.expiration>=Date.now()/1e3,"lock expired");const e={type:Ut.UNLOCK,message_identifier:cs(),chain_id:c.chain_id,token_network_address:c.token_network_address,channel_identifier:c.channel_identifier,nonce:p.own.nextNonce,transferred_amount:Fe(je(32),p.own.balanceProof.transferredAmount.add(c.lock.amount),"overflow on transferredAmount"),locked_amount:p.own.balanceProof.lockedAmount.sub(c.lock.amount),locksroot:ns(dp(p.own,s)),payment_identifier:c.payment_identifier,secret:a.secret};u=(0,U.D)(Ta(r,e,{log:i}))}return u.pipe(_i((async()=>_s(e,o,n.meta))),(0,Sr.M)(e),(0,W.U)((([[e,t],a])=>{var i;const r=up(a,{tokenNetwork:l,partner:d});return Me(t&&(t.expiration>Date.now()/1e3||t.secretRegistered||r.own.locks.find((e=>e.secrethash===s&&e.registered))),"lock expired"),ar.success({message:e,partner:d,userId:null===(i=n.payload)||void 0===i?void 0:i.userId},n.meta)})))}function _p(e,t,n){const{log:a,db:i}=n;return(0,Wa.P)((async()=>_s(e,i,t.meta))).pipe((0,Sr.M)(e),(0,q.z)((([a,i])=>hp(e,i,t,a,n))),(0,K.K)((e=>(a.warn("Error trying to unlock after SecretReveal",e),(0,P.of)(ar.failure(e,t.meta))))))}function gp(e,t,n,{signer:a,log:i}){const r=t.meta.secrethash,o=n.transfer,s=o.token_network_address,c=n.partner,l=up(e,{tokenNetwork:s,partner:c});let d;if(n.expired)d=(0,P.of)(n.expired);else{Me(o.lock.expiration.lt(Math.floor(Date.now()/1e3)),"lock not yet expired"),Me(l.own.locks.find((e=>e.secrethash===r))&&!n.unlock,"transfer already unlocked or expired");const e=ns(dp(l.own,r)),t={type:Ut.LOCK_EXPIRED,message_identifier:cs(),chain_id:o.chain_id,token_network_address:o.token_network_address,channel_identifier:o.channel_identifier,nonce:l.own.nextNonce,transferred_amount:l.own.balanceProof.transferredAmount,locked_amount:l.own.balanceProof.lockedAmount.sub(o.lock.amount),locksroot:e,recipient:c,secrethash:r};d=(0,U.D)(Ta(a,t,{log:i}))}return d.pipe((0,W.U)((e=>rr.success({message:e,partner:c},t.meta))))}function bp(e,t,{log:n,signer:a,db:i}){return(0,Wa.P)((()=>_s(e,i,t.meta))).pipe((0,Sr.M)(e),(0,q.z)((([e,i])=>gp(i,t,e,{signer:a,log:n}))),(0,K.K)((e=>(0,P.of)(rr.failure(e,t.meta)))))}function vp(e,t,{address:n,log:a,signer:i,config$:r,db:o,latest$:s}){const c=t.payload.message.lock.secrethash,l={secrethash:c,direction:wi.RECEIVED};return(0,gl.a)([e,r,s]).pipe((0,Z.P)(),(0,q.z)((([e,{revealTimeout:r,caps:s},{settleTimeout:d}])=>{const p=t.payload.message;if(o.storageKeys.has(ls(l))){a.warn("transfer already present",l);const n=p.message_identifier,i=e.transfers[ls(l)];return null!==i&&void 0!==i&&i.transferProcessed&&i.partner===t.meta.address&&n.eq(i.transfer.message_identifier)?(0,P.of)(Qi({message:et(i.transferProcessed),userId:t.payload.userId},l)):L.E}const u=p.token_network_address,m=t.meta.address,y=up(e,{tokenNetwork:u,partner:m},p);Me(p.nonce.eq(y.partner.nextNonce),["nonce mismatch",{expected:y.partner.nextNonce.toNumber(),received:p.nonce.toNumber()}]);const f=[...y.partner.locks,p.lock],h=ns(f);Me(p.locksroot===h,"locksroot mismatch"),Me(p.transferred_amount.eq(y.partner.balanceProof.transferredAmount),"transferredAmount mismatch");const _=pp(f);Me(p.locked_amount.eq(_),"lockedAmount mismatch"),Me(je(32).is(y.partner.balanceProof.transferredAmount.add(_)),"overflow on future transferredAmount");const{partnerCapacity:g}=ol(y);Me(p.lock.amount.lte(g),"balanceProof total amount bigger than capacity"),Me(p.lock.expiration.lt(Math.ceil(Date.now()/1e3+d)),["expiration too far in the future",{expiration:p.lock.expiration,blockNumber:e.blockNumber,settleTimeout:d,revealTimeout:r}]),Me(p.recipient===n,"Received transfer isn't for us"),a.info("Receiving transfer of value",p.lock.amount.toString(),"of token",y.token,", from",p.initiator,", through partner",m);let b=(0,P.of)(void 0);if(p.target===n){let e;const t=p.lock.expiration.sub(r);ia(s,pe.RECEIVE)?t.mul(1e3).gt(Date.now())||(e={reason:"lock expired or expires too soon",lockExpiration:p.lock.expiration,dangerZoneStart:t,revealTimeout:r}):e={reason:"receiving disabled"},e?a.warn("Ignoring received transfer",e):b=(0,Wa.P)((async()=>{const e=Ts(p.metadata,[c,p.lock.amount,p.payment_identifier],i);if(e)return e;const t={type:Ut.SECRET_REQUEST,payment_identifier:p.payment_identifier,secrethash:c,amount:p.lock.amount,expiration:p.lock.expiration,message_identifier:cs()};return Ta(i,t,{log:a})}))}const w=(0,Wa.P)((async()=>{const e={type:Ut.PROCESSED,message_identifier:p.message_identifier};return Ta(i,e,{log:a})}));return(0,gl.a)([w,b]).pipe((0,q.z)((function*([e,n]){yield Xi({message:p,fee:v._Y,partner:m},l),yield Qi({message:e,userId:t.payload.userId},l),Ke.is(n)?yield Ji({secret:n},l):n&&(yield Qn.request(void 0,{address:p.initiator}),yield tr({message:n,...Es(p.metadata,p.initiator)},l))})))})),(0,K.K)((e=>(0,P.of)(Yi.failure(e,l)))))}function wp(e,t,{log:n,signer:a,db:i}){const r=as(t.payload.message.secret),o={secrethash:r,direction:wi.RECEIVED};return(0,Wa.P)((()=>_s(e,i,o))).pipe((0,Sr.M)(e),(0,q.z)((([e,i])=>{Me(e,"unknown transfer");const s=t.payload.message,c=t.meta.address;if(Me(c===e.partner,"wrong partner"),Me(!e.expired,"already expired"),e.unlock)return n.warn("transfer already unlocked",t.meta),e.unlockProcessed&&s.message_identifier.eq(e.unlockProcessed.message_identifier)?(0,P.of)(ir({message:et(e.unlockProcessed),userId:t.payload.userId},o)):L.E;const l=e.transfer;Me(s.token_network_address===l.token_network_address,"wrong tokenNetwork");const d=s.token_network_address,p=up(i,{tokenNetwork:d,partner:c},s);Me(s.nonce.eq(p.partner.nextNonce),["nonce mismatch",{expected:p.partner.nextNonce.toNumber(),received:s.nonce.toNumber()}]);const u=l.lock.amount,m=dp(p.partner,r);Me(s.locksroot===ns(m),"locksroot mismatch"),Me(s.transferred_amount.eq(p.partner.balanceProof.transferredAmount.add(u)),"transferredAmount mismatch"),Me(s.locked_amount.eq(pp(m)),"lockedAmount mismatch");const y={type:Ut.PROCESSED,message_identifier:s.message_identifier};return(0,U.D)(Ta(a,y,{log:n})).pipe((0,q.z)((function*(n){e.secret||(yield Ji({secret:s.secret},o)),yield ar.success({message:s,partner:c},o),yield ir({message:n,userId:t.payload.userId},o),yield Yi.success({balanceProof:ba(s)},o)})))})),(0,K.K)((e=>(n.warn("Error trying to process received Unlock",e),(0,P.of)(ar.failure(e,o))))))}function Tp(e,t,{log:n,signer:a,db:i}){const r=t.payload.message.secrethash,o={secrethash:r,direction:wi.RECEIVED};return(0,Wa.P)((()=>_s(e,i,o))).pipe((0,Sr.M)(e),(0,q.z)((([e,i])=>{const s=t.payload.message,c=t.meta.address;if(Me(c===e.partner,"wrong partner"),Me(!e.unlock,"transfer unlocked"),e.expired)return n.warn("transfer already expired",t.meta),e.expiredProcessed&&s.message_identifier.eq(e.expiredProcessed.message_identifier)?(0,P.of)(or({message:et(e.expiredProcessed),userId:t.payload.userId},o)):L.E;const l=e.transfer;Me(l.lock.expiration.lt(Math.ceil(Date.now()/1e3)),"not expired yet"),Me(!e.secretRegistered,"secret registered onchain"),Me(s.token_network_address===l.token_network_address,"wrong tokenNetwork");const d=s.token_network_address,p=up(i,{tokenNetwork:d,partner:c},s);Me(s.nonce.eq(p.partner.nextNonce),["nonce mismatch",{expected:p.partner.nextNonce.toNumber(),received:s.nonce.toNumber()}]);const u=dp(p.partner,r);Me(s.locksroot===ns(u),"locksroot mismatch"),Me(s.locked_amount.eq(pp(u)),"lockedAmount mismatch"),Me(s.transferred_amount.eq(p.partner.balanceProof.transferredAmount),"transferredAmount mismatch");const m={type:Ut.PROCESSED,message_identifier:s.message_identifier};return(0,U.D)(Ta(a,m,{log:n})).pipe((0,q.z)((function*(e){yield rr.success({message:s,partner:c},o),yield or({message:e,userId:t.payload.userId},o),yield Yi.failure(new xe(Ae.XFER_EXPIRED,{block:l.lock.expiration.toString()}),o)})))})),(0,K.K)((e=>(n.warn("Error trying to process received LockExpired",e),(0,P.of)(rr.failure(e,o))))))}function kp(e){return e.type===Ut.WITHDRAW_CONFIRMATION}function Ep(e,t,{log:n,address:a,signer:i,network:r,config$:o}){return t.meta.direction!==wi.SENT?L.E:(0,gl.a)([e,o]).pipe((0,Z.P)(),(0,q.z)((([e,{revealTimeout:o}])=>{var s,c;const l=up(e,t.meta);if(l.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_REQUEST,t.meta)))return L.E;const d=l.own.pendingWithdraws.find(kp);if(d)return[ur.success({message:d},{direction:t.meta.direction,tokenNetwork:l.tokenNetwork,partner:l.partner.address,totalWithdraw:d.total_withdraw,expiration:d.expiration.toNumber()}),pr.failure(new xe(Ae.CNL_WITHDRAW_RETRY_CONFIRMATION),t.meta)];if(Me(!l.own.pendingWithdraws.length,[Ae.CNL_WITHDRAW_PENDING,{pendingWithdraws:l.own.pendingWithdraws}]),Me(t.meta.totalWithdraw.lte(ol(l).ownTotalWithdrawable),Ae.CNL_WITHDRAW_AMOUNT_TOO_HIGH),void 0!==(null===(s=t.payload)||void 0===s?void 0:s.coopSettle)){Me(t.meta.expiration>Date.now()/1e3,Ae.CNL_WITHDRAW_EXPIRES_SOON);const{ownLocked:e,partnerLocked:n,ownTotalWithdrawable:a,partnerCapacity:i}=ol(l);Me(!l.own.locks.length&&!l.partner.locks.length&&t.meta.totalWithdraw.eq(a)&&(t.payload.coopSettle||i.isZero()),[Ae.CNL_COOP_SETTLE_NOT_POSSIBLE,{ownLocked:e,partnerLocked:n,partnerCapacity:i}])}else Me(t.meta.totalWithdraw.gt(l.own.withdraw),Ae.CNL_WITHDRAW_AMOUNT_TOO_LOW),Me(t.meta.expiration>=Date.now()/1e3+o,Ae.CNL_WITHDRAW_EXPIRES_SOON);const p={type:Ut.WITHDRAW_REQUEST,message_identifier:cs(),chain_id:g.O$.from(r.chainId),token_network_address:t.meta.tokenNetwork,channel_identifier:g.O$.from(l.id),participant:a,total_withdraw:t.meta.totalWithdraw,nonce:l.own.nextNonce,expiration:g.O$.from(t.meta.expiration),...void 0!==(null===(c=t.payload)||void 0===c?void 0:c.coopSettle)?{coop_settle:t.payload.coopSettle}:null};return(0,U.D)(Ta(i,p,{log:n})).pipe((0,W.U)((e=>ur.request({message:e},t.meta))))})),(0,K.K)((e=>(0,P.of)(pr.failure(e,t.meta)))))}function Ap(e,t,{address:n}){const a=t.payload.message,i=a.token_network_address,r=t.meta.address;let o;try{o=a.expiration.toNumber()}catch(c){return L.E}const s={direction:wi.SENT,tokenNetwork:i,partner:r,totalWithdraw:a.total_withdraw,expiration:o};return e.pipe((0,Z.P)(),(0,W.U)((e=>(up(e,{tokenNetwork:i,partner:r},a),Me(a.participant===n,"participant mismatch"),ur.success({message:a},s)))),(0,K.K)((e=>(0,P.of)(ur.failure(e,s)))))}function Np(e,t,{log:n,address:a,signer:i}){return t.meta.direction!==wi.SENT?L.E:e.pipe((0,Z.P)(),(0,q.z)((e=>{const r=up(e,t.meta);Me(!r.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_EXPIRED,t.meta)),"already expired");const o=r.own.pendingWithdraws.find(Ci(Ut.WITHDRAW_REQUEST,t.meta));Me(o,"no matching WithdrawRequest found, maybe already confirmed"),Me(t.meta.expiration<Date.now()/1e3,"not expired yet");const s={type:Ut.WITHDRAW_EXPIRED,message_identifier:cs(),chain_id:o.chain_id,token_network_address:o.token_network_address,channel_identifier:o.channel_identifier,participant:a,total_withdraw:t.meta.totalWithdraw,nonce:r.own.nextNonce,expiration:o.expiration};return(0,U.D)(Ta(i,s,{log:n})).pipe((0,W.U)((e=>yr.success({message:e},t.meta))))})),(0,K.K)((e=>(0,P.of)(yr.failure(e,t.meta)))))}function Ip(e,t,{signer:n,log:a}){const i=t.payload.message,r=i.token_network_address,o=i.participant;let s;try{s=i.expiration.toNumber()}catch(l){return L.E}const c={direction:wi.RECEIVED,tokenNetwork:r,partner:o,totalWithdraw:i.total_withdraw,expiration:s};return e.pipe((0,Z.P)(),(0,q.z)((e=>{Me(i.participant===t.meta.address,"participant mismatch");const s=up(e,{tokenNetwork:r,partner:o},i);let l;const d=s.partner.pendingWithdraws.find(Ci(Ut.WITHDRAW_CONFIRMATION,i));if(d)l=(0,P.of)(d);else{Me(i.nonce.eq(s.partner.nextNonce),["nonce mismatch",{expected:s.partner.nextNonce.toNumber(),received:i.nonce.toNumber()}]),Me(i.total_withdraw.lte(ol(s).partnerTotalWithdrawable),"invalid total_withdraw");const e={type:Ut.WITHDRAW_CONFIRMATION,message_identifier:i.message_identifier,chain_id:i.chain_id,token_network_address:i.token_network_address,channel_identifier:i.channel_identifier,participant:i.participant,total_withdraw:i.total_withdraw,nonce:s.own.nextNonce,expiration:i.expiration};l=(0,U.D)(Ta(n,e,{log:a}))}return l.pipe((0,q.z)((function*(e){yield ur.request({message:i},c),yield ur.success({message:e},c),yield ca.request({message:e},{address:o,msgId:t.payload.message.message_identifier.toString()})})))})),(0,K.K)((e=>(0,P.of)(ur.failure(e,c)))))}function Rp(e,t,{signer:n,log:a},i){const r=t.payload.message,o=r.token_network_address,s=r.participant;let c;try{c=r.expiration.toNumber()}catch(d){return L.E}const l={direction:wi.RECEIVED,tokenNetwork:o,partner:s,totalWithdraw:r.total_withdraw,expiration:c};return e.pipe((0,Z.P)(),(0,q.z)((e=>{Me(s===t.meta.address,"participant mismatch");const c=up(e,{tokenNetwork:o,partner:s},r);let d;const p=`${rl(c)}+${r.message_identifier.toString()}`,u=i.get(p);if(u)d=(0,P.of)(u);else{Me(r.nonce.lte(c.partner.nextNonce),["nonce mismatch",{expected:c.partner.nextNonce.toNumber(),received:r.nonce.toNumber()}]),Me(l.expiration<=Date.now()/1e3,"not expired yet");const e={type:Ut.PROCESSED,message_identifier:r.message_identifier};d=(0,U.D)(Ta(n,e,{log:a})).pipe((0,ti.b)((e=>i.set(p,e))))}return d.pipe((0,q.z)((function*(e){yield yr.success({message:r},l),yield ca.request({message:e},{address:s,msgId:e.message_identifier.toString()}),yield fr(void 0,l)})))})),(0,K.K)((e=>(0,P.of)(yr.failure(e,l)))))}function Dp(e,{},t){const n=new Wo(32),a=t.latest$.pipe(si("state"),yi(e));return(0,Fa.T)(e.pipe((0,$.h)(On([Yi.request,ar.request,rr.request,pr.request,yr.request]))),e.pipe((0,$.h)(ka([tt(Jt),tt(tn),tt(an),tt(sn),tt(ln),tt(pn)])))).pipe((0,j.b)((e=>{let i;switch(e.type){case Yi.request.type:i=mp(e)?fp(a,e,t):L.E;break;case ar.request.type:i=_p(a,e,t);break;case rr.request.type:i=bp(a,e,t);break;case pr.request.type:i=Ep(a,e,t);break;case yr.request.type:i=Np(a,e,t);break;case da.type:switch(e.payload.message.type){case Ut.LOCKED_TRANSFER:i=vp(a,e,t);break;case Ut.UNLOCK:i=wp(a,e,t);break;case Ut.LOCK_EXPIRED:i=Tp(a,e,t);break;case Ut.WITHDRAW_REQUEST:i=Ip(a,e,t);break;case Ut.WITHDRAW_CONFIRMATION:i=Ap(a,e,t);break;case Ut.WITHDRAW_EXPIRED:i=Rp(a,e,t,n);break}break}return i})))}function Cp(e,t){return e.pipe((0,$.h)(ka(tt($t))),(0,Sr.M)(t),(0,q.z)((function*([e,{transfers:t}]){for(const o of Object.values(t)){var n,a,i,r;if(o.direction!==wi.SENT||o.partner!==e.meta.address)continue;const t={secrethash:o.secrethash,direction:wi.SENT};e.payload.message.message_identifier.eq(o.transfer.message_identifier)&&(yield Qi({message:e.payload.message},t)),e.payload.message.message_identifier.eq(null!==(n=null===(a=o.unlock)||void 0===a?void 0:a.message_identifier)&&void 0!==n?n:-1)&&(yield Yi.success({balanceProof:ba(o.unlock)},t),yield ir({message:e.payload.message},t)),e.payload.message.message_identifier.eq(null!==(i=null===(r=o.expired)||void 0===r?void 0:r.message_identifier)&&void 0!==i?i:-1)&&(yield or({message:e.payload.message},t))}})))}function Sp(e,t,{db:n}){return e.pipe((0,$.h)(On([Qi,ir,or])),(0,$.h)((e=>e.meta.direction===wi.RECEIVED)),(0,Sr.M)(t),(0,q.z)((([e,t])=>_s(t,n,e.meta).then((t=>[e,t])))),(0,W.U)((([e,t])=>ca.request(e.payload,{address:t.partner,msgId:e.payload.message.message_identifier.toString()}))))}function Op(e,t,{config$:n}){return e.pipe((0,$.h)(On([Xi,ar.success,rr.success,tr,nr])),(0,Sr.M)(t,n),(0,q.z)((([a,i,{revealTimeout:r}])=>{const o=i.transfers[ls(a.meta)],s=t.pipe(si("transfers",ls(a.meta)));let c,l,d;switch(a.type){case Xi.type:a.meta.direction===wi.SENT&&(c=a.payload.partner,l=a.payload.userId,d=s.pipe((0,$.h)((e=>!!(e.transferProcessed||e.unlockProcessed||e.expiredProcessed||e.channelClosed)))));break;case ar.success.type:a.meta.direction===wi.SENT&&(c=a.payload.partner,l=a.payload.userId,d=s.pipe((0,$.h)((e=>!(!e.unlockProcessed&&!e.channelClosed)))));break;case rr.success.type:a.meta.direction===wi.SENT&&(c=a.payload.partner,d=s.pipe((0,$.h)((e=>!(!e.expiredProcessed&&!e.channelClosed)))));break;case tr.type:a.meta.direction===wi.RECEIVED&&o&&(c=o.transfer.initiator,l=a.payload.userId,d=s.pipe((0,$.h)((e=>!(!e.secretReveal&&!e.channelClosed))),(0,ap.b)((0,ja.H)(new Date(1e3*(o.expiration-r))))));break;case nr.type:a.meta.direction===wi.RECEIVED&&o&&(c=o.partner,l=a.payload.userId,d=s.pipe((0,$.h)((e=>!(!e.unlock&&!e.channelClosed)))));break}return c&&d?Di(ca.request({message:a.payload.message,userId:l},{address:c,msgId:a.payload.message.message_identifier.toString()}),e,d,Li(n)):L.E})))}function Pp(e,t,{address:n,log:a}){return e.pipe((0,$.h)(ka(tt(Ht))),(0,Sr.M)(t),(0,q.z)((function*([e,t]){const i=e.payload.message,r=ls({secrethash:i.secrethash,direction:wi.SENT}),o=t.transfers[r];if(!o)return;const s=o.transfer;s.initiator===n&&s.target===e.meta.address&&s.payment_identifier.eq(i.payment_identifier)?yield tr({message:i,userId:e.payload.userId},{secrethash:i.secrethash,direction:wi.SENT}):a.warn("Invalid SecretRequest for transfer",i,s)})))}const xp=(e,{signer:t,log:n,latest$:a})=>{const i=e.payload.message;return a.pipe((0,Z.P)(),(0,q.z)((({state:a})=>{const r=a.transfers[ls(e.meta)];Me(null===r||void 0===r?void 0:r.secret,["SecretRequest for unknown secret",i]);const o=r.transfer,s=o.target,c=r.fee,l=o.lock.amount.sub(c);let d;if(Me(i.expiration.lte(o.lock.expiration)&&i.expiration.gt(Math.floor(Date.now()/1e3)),["SecretRequest for expired transfer",{request:i,lock:o.lock}]),Me(i.amount.gte(l),["SecretRequest for amount too small!",{request:i,value:l}]),i.amount.eq(l)||n.info("Accepted SecretRequest for amount greater than sent",i,o),r.secretReveal)d=(0,P.of)(r.secretReveal);else{const e={type:Ut.SECRET_REVEAL,message_identifier:cs(),secret:r.secret};d=(0,U.D)(Ta(t,e,{log:n}))}return d.pipe((0,q.z)((function*(t){yield nr({message:t},e.meta),yield ca.request({message:t,userId:e.payload.userId},{address:s,msgId:t.message_identifier.toString()})})))})),(0,K.K)((t=>(0,P.of)(Yi.failure(t,e.meta)))))};function Mp(e,{},t){return e.pipe((0,$.h)(On(tr)),(0,$.h)((e=>e.meta.direction===wi.SENT)),(0,j.b)((e=>xp(e,t))))}function Up(e,t,{config$:n}){return e.pipe((0,$.h)(ka(zt)),(0,Sr.M)(t,n),(0,q.z)((function*([e,t,{caps:n}]){const a=as(e.payload.message.secret),i=Object.values(wi).map((e=>t.transfers[ls({secrethash:a,direction:e})])).filter(We),r=e.payload.message;for(const o of i.filter((e=>e.direction===wi.SENT))){const t={secrethash:a,direction:wi.SENT};if(yield Ji({secret:r.secret},t),e.meta.address===o.partner&&!o.channelClosed){let n;"signature"in r&&(n={userId:e.payload.userId}),yield ar.request(n,t)}}if(ia(n,pe.RECEIVE))for(const o of i.filter((e=>e.direction===wi.RECEIVED)))yield Ji({secret:r.secret},{secrethash:a,direction:wi.RECEIVED})})))}function Lp(e,{},{log:t,signer:n,latest$:a}){return e.pipe((0,$.h)(On([Ji,er.success])),(0,$.h)((e=>e.meta.direction===wi.RECEIVED)),(0,$.h)((e=>Ji.is(e)||!!e.payload.confirmed)),(0,j.b)((e=>a.pipe(si("state"),(0,Z.P)(),(0,$.h)((({transfers:t})=>ls(e.meta)in t)),(0,q.z)((({transfers:a})=>{const i=a[ls(e.meta)],r=i.secretReveal;let o;if(r)o=(0,P.of)(et(r));else{const a={type:Ut.SECRET_REVEAL,message_identifier:cs(),secret:e.payload.secret};o=(0,U.D)(Ta(n,a,{log:t}))}const s=Es(i.transfer.metadata,i.partner);return o.pipe((0,W.U)((t=>nr({message:t,...s},e.meta))))})),(0,K.K)((n=>(t.warn("Error trying to sign SecretReveal - ignoring",n,e.meta),L.E)))))))}function Bp({},e,{provider:t,secretRegistryContract:n,config$:a,init$:i,getBlockTimestamp:r}){const o=new Br.c;return i.next(o),Sc(t,n.filters.SecretRevealed(null,null),{confirmations:a.pipe((0,H.j)("confirmationBlocks")),blockNumber$:e.pipe(si("blockNumber")),onPastCompleted:()=>{o.next(null),o.complete()}}).pipe(yi(e),(0,W.U)(Oc(n)),_i((([,,e])=>r(e.blockNumber))),(0,Sr.M)(e,a),(0,q.z)((function*([[[e,t,n],a],{transfers:i,blockNumber:r},{confirmationBlocks:o}]){for(const s of Object.values(wi)){const c=ls({secrethash:e,direction:s}),l=i[c];!l||l.expiration<=a||(yield er.success({secret:t,txTimestamp:a,txHash:n.transactionHash,txBlock:n.blockNumber,confirmed:n.blockNumber+o<=r?!n.removed:void 0},{secrethash:e,direction:s}))}})))}function Fp(e){return e.pipe((0,$.h)(er.success.is),(0,$.h)((e=>!!e.payload.confirmed)),(0,W.U)((e=>Yi.success({},e.meta))))}function Wp(e,t,{config$:n}){const a=({key:e})=>t.pipe((0,$.h)((({transfers:t})=>!(e in t))));return t.pipe((0,H.j)("transfers"),(0,q.z)((e=>Object.values(e))),(0,$.h)((({direction:e})=>e===wi.RECEIVED)),(0,Cr.v)((({_id:e})=>e),{duration:a}),(0,q.z)((i=>i.pipe((0,$.h)((({secret:e})=>!!e)),(0,Sr.M)(n),(0,Tl.j)((([{expiration:e},{revealTimeout:t}])=>(0,ja.H)(new Date(1e3*(e-t))))),(0,Fr.z)((([{secret:t,transfer:n}])=>{const a={secrethash:n.lock.secrethash,direction:wi.RECEIVED};return Ri(e,er.request({secret:t},a),Un(er,a))})),(0,ei.R)(i.pipe((0,$.h)((e=>!!(e.unlock||e.expired||e.secretRegistered||e.channelClosed||e.expiration<=Date.now()/1e3))),(0,ap.b)(a(i)))),yi(t)))))}function $p(e,{},t){const{log:n,secretRegistryContract:a,config$:i}=t;return e.pipe((0,$.h)(er.request.is),(0,q.z)((e=>pl(a,"registerSecret",[e.payload.secret],t,{error:Ae.XFER_REGISTERSECRET_TX_FAILED}).pipe(pi(Li(i),{onErrors:Oe,log:n.debug}),(0,$a.l)(),(0,K.K)((t=>(0,P.of)(er.failure(t,e.meta))))))))}function Vp({},e){return e.pipe((0,Z.P)(),(0,q.z)((function*(e){for(const t of Object.values(e.channels))if(t.state===Nr.open)for(const e of t.own.pendingWithdraws)e.type!==Ut.WITHDRAW_REQUEST||t.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_CONFIRMATION,e))?e.type===Ut.WITHDRAW_EXPIRED&&(yield yr.success({message:e},{direction:wi.SENT,tokenNetwork:t.tokenNetwork,partner:t.partner.address,totalWithdraw:e.total_withdraw,expiration:e.expiration.toNumber()})):yield ur.request({message:e},{direction:wi.SENT,tokenNetwork:t.tokenNetwork,partner:t.partner.address,totalWithdraw:e.total_withdraw,expiration:e.expiration.toNumber()})})))}function Hp(e,{},{getTokenNetworkContract:t}){return e.pipe(bi(Qn,(n=>e.pipe((0,$.h)(dr.is),(0,q.z)((e=>{var a;let i=(0,P.of)(!0);if(null!==(a=e.payload)&&void 0!==a&&a.coopSettle){const n=t(e.meta.tokenNetwork);i=Uc(n,"cooperativeSettle")}return i.pipe((0,ii.j)(n(Qn.request(void 0,{address:e.meta.partner}))),(0,W.U)((t=>(Me(t.payload.available,"partner offline"),pr.request(e.payload,e.meta)))),(0,K.K)((t=>(0,P.of)(pr.failure(t,e.meta)))))}))))))}function jp(e,t,{config$:n}){return e.pipe((0,$.h)(ur.request.is),(0,$.h)((e=>e.meta.direction===wi.SENT)),(0,q.z)((a=>{const i=a.payload.message,r=ca.request({message:i},{address:a.meta.partner,msgId:i.message_identifier.toString()}),o=t.pipe((0,$.h)((e=>{const t=e.channels[il(a.meta)];return(null===t||void 0===t?void 0:t.state)!==Nr.open||t.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_CONFIRMATION,a.meta))||!t.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_REQUEST,a.meta))})));return Di(r,e,o,Li(n))})))}function zp(e,{},t){const{address:n,log:a,getTokenNetworkContract:i,latest$:r,config$:o}=t;return e.pipe((0,$.h)(ur.success.is),(0,$.h)((e=>e.meta.direction===wi.SENT)),(0,Cr.v)((e=>il(e.meta))),(0,q.z)((s=>s.pipe((0,j.b)((c=>(0,gl.a)([r,o]).pipe((0,Z.P)(),(0,q.z)((([{state:r},{revealTimeout:l}])=>{const d=r.channels[s.key];Me((null===d||void 0===d?void 0:d.state)===Nr.open,"channel not open");const p=d.own.pendingWithdraws.find(Ci(Ut.WITHDRAW_REQUEST,c.payload.message));if(Me(p,"no matching WithdrawRequest found"),"coop_settle"in p)return L.E;Me(c.meta.totalWithdraw.gt(d.own.withdraw),"withdraw already performed"),Me(p.expiration.gte(Math.floor(Date.now()/1e3+l)),Ae.CNL_WITHDRAW_EXPIRES_SOON);const{tokenNetwork:u}=c.meta;return pl(i(u),"setTotalWithdraw",[d.id,n,c.meta.totalWithdraw,c.meta.expiration,p.signature,c.payload.message.signature],t,{error:Ae.CNL_WITHDRAW_TRANSACTION_FAILED}).pipe(pi(Li(o),{maxRetries:5,onErrors:Oe,log:a.info}),(0,q.z)((([,t])=>e.pipe((0,$.h)(Un(pr,c.meta)),(0,Cn.q)(1),(0,$a.l)(),(0,In.O)(pr.success({txHash:t.transactionHash,txBlock:t.blockNumber,confirmed:void 0},c.meta))))),(0,In.O)(mr(void 0,c.meta)))})),(0,K.K)((e=>(0,P.of)(pr.failure(e,c.meta)))))))))))}function qp(e,{},{signer:t,log:n}){const a=new Wo(32);return e.pipe((0,$.h)(On([ur.request,ur.success])),(0,$.h)((e=>e.meta.direction===wi.RECEIVED!==ur.success.is(e))),(0,Sr.M)(e.pipe(oa())),(0,j.b)((([e,i])=>(0,Wa.P)((()=>{if(sa(i[e.meta.partner]))return L.E;const r=e.payload.message;let o;const s=r.message_identifier.toString(),c=a.get(s);if(c)o=(0,P.of)(c);else{const e={type:Ut.PROCESSED,message_identifier:r.message_identifier};o=(0,U.D)(Ta(t,e,{log:n})).pipe((0,ti.b)((e=>a.set(s,e))))}return o.pipe((0,W.U)((t=>ca.request({message:t},{address:e.meta.partner,msgId:t.message_identifier.toString()}))))})).pipe((0,K.K)((e=>(n.info("Signing Processed message for Withdraw message failed, ignoring",e),L.E)))))))}function Kp(e){return`${il(e)}|${e.expiration}|${e.totalWithdraw.toString()}`}function Zp(e,{},{config$:t,latest$:n}){const a=new Set;return e.pipe((0,$.h)(ur.request.is),(0,$.h)((({meta:e})=>e.direction===wi.SENT)),(0,jl.E)((({payload:e})=>e.message.message_identifier.toHexString())),(0,Sr.M)(t,e.pipe((0,$.h)(On([mr,pr.success,pr.failure])),(0,Nn.R)(((e,t)=>{const n=Kp(t.meta);return mr.is(t)?e.add(n):e.delete(n),e}),a),(0,In.O)(a))),(0,q.z)((([t,{httpTimeout:a,revealTimeout:i},r])=>{const o=Kp(t.meta);return(0,Fa.T)((0,ja.H)(new Date(1e3*(t.meta.expiration-i)),a).pipe((0,$.h)((()=>!r.has(o))),(0,Cn.q)(1),(0,Or.h)(pr.failure(new xe(Ae.CNL_WITHDRAW_EXPIRED),t.meta))),(0,ja.H)(new Date(1e3*t.meta.expiration+a),a).pipe((0,$.h)((()=>!r.has(Kp(t.meta)))),(0,Or.h)(yr.request(void 0,t.meta)))).pipe((0,ei.R)(n.pipe((0,$.h)((({state:e})=>{const n=e.channels[il(t.meta)];return(null===n||void 0===n?void 0:n.state)!==Nr.open||n.own.pendingWithdraws.some(Ci(Ut.WITHDRAW_EXPIRED,t.meta))})),(0,ap.b)(e.pipe((0,$.h)(pr.success.is),(0,$.h)((e=>Kp(e.meta)===o)))))))})))}function Gp(e,{},{config$:t}){return e.pipe((0,$.h)(yr.success.is),(0,$.h)((e=>e.meta.direction===wi.SENT)),(0,q.z)((n=>{const a=n.payload.message,i=ca.request({message:a},{address:n.meta.partner,msgId:a.message_identifier.toString()}),r=e.pipe((0,$.h)(ka(tt($t))),(0,$.h)((e=>e.meta.address===n.meta.partner&&e.payload.message.message_identifier.eq(a.message_identifier))),(0,Cn.q)(1),(0,Or.h)(fr(void 0,n.meta)),(0,oi.B)());return(0,Fa.T)(Di(i,e,r,Li(t)),r)})))}var Yp=n(33217),Xp=n(93249),Qp=n(44789);const Jp="m.notice";var eu;(function(e){e["offer"]="offer",e["answer"]="answer",e["candidates"]="candidates",e["hangup"]="hangup"})(eu||(eu={}));const tu=X.OT(X.jV([X.dt({type:X.i0(eu.offer),sdp:X.Z_}),X.r$({call_id:X.Z_})])),nu=X.OT(X.jV([X.dt({type:X.i0(eu.answer),sdp:X.Z_}),X.r$({call_id:X.Z_})])),au=X.OT(X.jV([X.dt({type:X.i0(eu.candidates),candidates:X.Bk(X._4)}),X.r$({call_id:X.Z_})])),iu=X.OT(X.jV([X.dt({type:X.i0(eu.hangup)}),X.r$({call_id:X.Z_})])),ru={[eu.offer]:tu,[eu.answer]:nu,[eu.candidates]:au,[eu.hangup]:iu};function ou(e){var t;return Array.isArray(e)&&3===e.length&&(null===(t=e[1])||void 0===t?void 0:t.readyState)}const su="peer hung up",cu="channel closed",lu="ping",du=["failed","closed","disconnected"],pu=new WeakMap;async function uu(e){const t=pu.get(e);if(t&&Date.now()<t[0])return t[1];const n=await e.turnServer().catch((()=>{}));let a=Date.now()+36e5;const i=[];return n&&"uris"in n&&(i.push({urls:n.uris,username:n.username,credentialType:"password",credential:n.password}),a=Date.now()+1e3*n.ttl),pu.set(e,[a,i]),i}function mu(e,t,{peer:n,callId:a},{log:i}={}){return e.pipe((0,$.h)(da.is),(0,$.h)((({meta:e,payload:t})=>e.address===n.meta.address&&t.msgtype===Jp)),(0,q.z)((function*(e){try{const n=Hn(e.payload.text);n["type"]===t&&(yield Fe(ru[t],n))}catch(n){null===i||void 0===i||i.info("Failed to decode WebRTC signaling message, ignoring",{text:e.payload.text,peerAddr:e.meta.address,peerId:e.payload.userId,error:n})}})),(0,$.h)((e=>!a||e.call_id===a)))}function yu(e,t,n,{log:a}){return(0,Fa.T)(mu(t,eu.candidates,n,{log:a}).pipe((0,ti.b)((e=>a.debug("RTC: received candidates",n.callId,e.candidates))),(0,q.z)((e=>{var t;return(0,U.D)(null!==(t=e.candidates)&&void 0!==t?t:[])})),(0,q.z)((async t=>{try{await e.addIceCandidate(t)}catch(i){a.warn("RTC: error setting candidate, ignoring",n.callId,e.connectionState,t,i)}})),(0,$a.l)()),(0,Io.R)(e,"icecandidate").pipe((0,H.j)("candidate"),(0,Qa.o)(We),(0,Xp.e)(10),(0,$.h)((e=>e.length>0)),(0,ti.b)((e=>a.debug("RTC: got candidates",n.callId,e))),(0,W.U)((e=>{const t={type:eu.candidates,candidates:e,call_id:n.callId};return ca.request({message:jn(t),msgtype:Jp,userId:n.peer.payload.userId},{address:n.peer.meta.address,msgId:cs().toString()})}))))}function fu([e,t,n],[a,i],{httpTimeout:r},o){return(0,Fa.T)((0,Io.R)(e,"connectionstatechange").pipe((0,In.O)(null),(0,q.z)((()=>{if(du.includes(e.connectionState))throw new Error("RTC: connection failed");return L.E}))),(0,Io.R)(t,"close").pipe((0,W.U)((()=>{throw new Error(cu)}))),(0,Io.R)(t,"error").pipe((0,H.j)("error"),(0,q.z)(Ka._)),mu(a,eu.hangup,n,o).pipe((0,W.U)((()=>{throw new Error(su)}))),(0,Io.R)(t,"open").pipe((0,Cn.q)(1),hi(r),(0,W.U)((()=>(o.log.info("RTC: dataChannel open",t.label),n.callId=t.label,t.send(lu),i.next(!0),i.complete(),Jn(t,n.peer.meta))))),(0,Io.R)(t,"message").pipe((0,ti.b)((e=>o.log.debug("RTC: dataChannel message",t.label,e))),(0,H.j)("data"),(0,$.h)((e=>"string"===typeof e)),(0,$.h)((e=>e!==lu)),(0,q.z)((e=>(0,U.D)(e.split("\n")))),(0,Qp.Q)(Yp.E),(0,W.U)((e=>da({text:e,message:Ea(e,n.peer,o),ts:Date.now(),userId:n.peer.payload.userId},n.peer.meta))))).pipe((0,ri.x)((()=>e.close())))}function hu(e,t){const{config$:n}=t;return a=>{let i;return(0,Wa.P)((()=>(i=new Br.c,a.pipe((0,ei.R)(i))))).pipe(vi(ou,(0,An.z)((0,Sr.M)(n),(0,Ja.w)((([n,a])=>fu(n,[e,i],a,t))))))}}function _u(e,[t,n],a){const{matrix$:i,config$:r,log:o}=a,s={callId:n.call_id,peer:t};o.info("RTC: callee answering",s);const c=new Br.c;return i.pipe((0,q.z)((async e=>uu(e))),(0,Sr.M)(r),(0,q.z)((([i,{fallbackIceServers:r}])=>{const o=new RTCPeerConnection({iceServers:i.concat(r)});let l=0;return(0,Fa.T)(yu(o,e,s,a).pipe((0,Tl.j)(Ha()(c))),(0,Wa.P)((async()=>o.setRemoteDescription(n))).pipe((0,q.z)((async()=>o.createAnswer())),_i((async e=>o.setLocalDescription(e))),(0,q.z)((([n])=>{const a={type:n.type,sdp:n.sdp,call_id:s.callId},i=ca.request({message:jn(a),msgtype:Jp,userId:t.payload.userId},{...t.meta,msgId:cs().toString()});return Ri(e,i,Mn(ca,i.meta))})),(0,ri.x)((()=>(c.next(!0),c.complete())))),(0,Io.R)(o,"datachannel").pipe((0,W.U)((({channel:e})=>(++l,[o,e,s]))),(0,Cn.q)(1),(0,ri.x)((()=>l?null:o.close()))))})),hu(e,a))}function gu(e,t,[n,a],i){return(0,Fa.T)(mu(n,eu.answer,t[2],i).pipe((0,Cn.q)(1),(0,q.z)((async e=>(i.log.info("RTC: got answer",e.call_id),await t[0].setRemoteDescription(e),t))),(0,ri.x)((()=>(a.next(!0),a.complete())))),Ri(n,e,Mn(ca,e.meta)).pipe((0,kl.l)(t)))}function bu(e,t,n){const{matrix$:a,config$:i,log:r,address:o}=n;return a.pipe((0,q.z)((async e=>uu(e))),(0,Sr.M)(i),(0,q.z)((([a,{fallbackIceServers:i}])=>{const s={callId:`${o}|${e.meta.address}|${Date.now()}`,peer:e};r.info("RTC: caller calling",s);const c=new RTCPeerConnection({iceServers:a.concat(i)}),l=c.createDataChannel(s.callId,{ordered:!1}),d=new Br.c;let p=0;return(0,Fa.T)(yu(c,t,s,n).pipe((0,Tl.j)(Ha()(d))),(0,Wa.P)((async()=>c.createOffer())).pipe((0,q.z)((async e=>(await c.setLocalDescription(e),e))),(0,q.z)((e=>{const a={type:e.type,sdp:e.sdp,call_id:s.callId},i=ca.request({message:jn(a),msgtype:Jp,userId:s.peer.payload.userId},{address:s.peer.meta.address,msgId:cs().toString()});return gu(i,[c,l,s],[t,d],n)})))).pipe((0,$.h)((e=>!ou(e)||!p++)),(0,ri.x)((()=>p?null:c.close())))})),hu(t,n))}function vu(e,t,n){return e.pipe(bi(Qn,(a=>a(Qn.request(void 0,{address:t})).pipe((0,q.z)((t=>(Me(ia(t.payload.caps,pe.WEBRTC),"peer doesn't support RTC"),bu(t,e,n))))))))}function wu(e,t,{log:n,config$:a}){return(0,An.z)((0,Ja.w)((([,,i])=>{let r,o;return i.pipe((0,ti.b)((e=>{!r&&Jn.is(e)&&e.payload&&t.next([!0,r=e.payload])})),(0,K.K)((t=>(n.info("RTC: callee channel error",e,t.message),o=t,L.E))),(0,ei.R)(a.pipe((0,Ya.x)((({caps:e},{caps:t})=>_l()(e,t))),(0,F.T)(1),(0,Tl.j)((({pollingInterval:e})=>(0,ja.H)(e))))),(0,ri.x)((()=>{n.info("RTC: callee disconnecting",e),r&&t.next([!1,r,o])})),(0,ei.R)(t.pipe((0,$.h)((([e,t])=>e&&t!==r)))))})))}function Tu(e,t,{log:n,config$:a}){return(0,An.z)((0,Fr.z)((([,,i])=>{let r,o;return(0,Wa.P)((()=>(r=void 0,o=void 0,i.pipe((0,ti.b)({next(e){!r&&Jn.is(e)&&e.payload&&t.next([!0,r=e.payload])},error(t){n.info("RTC: caller channel error",e,t.message),o=t}}),(0,ei.R)(a.pipe((0,Ya.x)((({caps:e},{caps:t})=>_l()(e,t))),(0,F.T)(1),(0,Tl.j)((({pollingInterval:e})=>(0,ja.H)(e))))),(0,ri.x)((()=>{r&&t.next([!1,r,o])})))))).pipe((0,ni.a)((0,An.z)((0,Sr.M)(a),(0,q.z)((([,{pollingInterval:t,httpTimeout:a}],i)=>{if(i>=5)return(0,P.of)(!0);const r=Math.min(t*Math.pow(2,i),2*a);return n.info("RTC: caller retrying in",r,e,i),(0,ja.H)(r)})),(0,Qa.o)((e=>!0!==e)),(0,ri.x)((()=>n.info("RTC: caller giving up",e))))),(0,ei.R)(t.pipe((0,$.h)((([e,t])=>e&&t!==r)))))})))}function ku(){return e=>e.pipe((0,$.h)(da.is),(0,Sr.M)(e.pipe(ra())),(0,$.h)((([e,t])=>e.payload.msgtype===Jp&&!!e.payload.userId&&e.payload.userId in t)),(0,q.z)((function*([e,t]){try{const n=Hn(e.payload.text);n["type"]===eu.offer&&(yield[t[e.payload.userId],Fe(ru[eu.offer],n)])}catch(n){}})))}function Eu(e,{address:t,config$:n}){let a=L.E;return Oa.is(e)?a=(0,P.of)(e.meta.partner):Xi.is(e)?e.meta.direction!==wi.RECEIVED||e.payload.message.target!==t||"secret"in e.payload.message.metadata||(a=(0,P.of)(e.payload.message.initiator)):ca.request.is(e)&&e.payload.msgtype!==Jp?a=(0,P.of)(e.meta.address):Jn.is(e)&&!e.payload&&(a=n.pipe((0,Z.P)(),(0,q.z)((({pollingInterval:e})=>(0,ja.H)(e))),(0,Or.h)(e.meta.address))),a}function Au(e,t){return(0,An.z)((0,q.z)((function*([n,a,i]){if(n)t.push(a);else{if(at(t)===a)t.pop(),yield Jn(at(t),{address:e});else{const e=t.indexOf(a);e>=0&&t.splice(e,1)}if(!Ne([su,cu],i)){const t={type:eu.hangup,call_id:a.label};yield ca.request({message:jn(t),msgtype:Jp},{address:e,msgId:cs().toString()})}}})))}function Nu(e,{},t){const n=e.pipe(ku(),(0,W.U)((([n,a])=>[n.meta.address,"callee",_u(e,[n,a],t)]))),a=e.pipe((0,q.z)((e=>Eu(e,t))),(0,W.U)((n=>[n,"caller",vu(e,n,t)])));return(0,Fa.T)(n,a).pipe((0,Cr.v)((([e])=>e)),(0,q.z)((n=>{const a=n.key,i=[],r=new za.x;return(0,Fa.T)(n.pipe((0,Cr.v)((([,e])=>e)),(0,q.z)((e=>"callee"===e.key?e.pipe(wu(a,r,t)):e.pipe((0,$.h)((()=>!i.length)),Tu(a,r,t)))),yi(e),(0,ri.x)((()=>setTimeout((()=>r.complete()),10)))),r.pipe(Au(a,i)))})),mi(t.config$.pipe((0,H.j)("caps",pe.WEBRTC),yi(e))))}var Iu=n(74783);n(93322);function Ru(e){const t=/^(?:\w*:?\/\/)?([^/#?&]+)/.exec(e);return t&&t[1]}async function Du(e,t=[]){const n={not_rooms:t,ephemeral:{not_types:["m.receipt","m.typing"]},timeline:{limit:0,not_senders:[e.getUserId()]}},a={room:n};return e.createFilter(a)}function Cu(e,t,{matrix$:n,config$:a,init$:i}){return e.pipe((0,$.h)(Xn.is),(0,Cn.q)(1),(0,ti.b)((()=>{n.next(t),n.complete()})),(0,q.z)((()=>(0,Wa.P)((async()=>Promise.all([Du(t),t.setPushRuleEnabled("global",h.PushRuleKind.Override,".m.rule.master",!0)]))).pipe((0,Tl.j)((()=>i.pipe((0,$a.l)(),(0,kl.l)(!0)))),(0,q.z)((async([e])=>t.startClient({filter:e}))),pi(Li(a),{onErrors:Re,maxRetries:3})))),(0,$a.l)())}function Su(e,t){return e.includes("://")||(e="https://"+e),(0,Wa.P)((()=>{const n=Date.now();return(0,B.U)(e+"/_matrix/client/versions").pipe((0,z.V)(t),(0,W.U)((({ok:e})=>e?Date.now():NaN)),(0,K.K)((()=>(0,P.of)(NaN))),(0,W.U)((t=>({server:e,rtt:t-n}))))}))}const Ou=X.dt({active_servers:X.IX(X.Z_),all_servers:X.IX(X.Z_)});function Pu(e,t){return(0,B.U)(e).pipe((0,q.z)((async t=>(Me(t.ok,`Could not fetch server list from "${e}" => ${t.status}`),t.json()))),(0,z.V)(t),(0,q.z)((e=>Fe(Ou,e).active_servers)),(0,q.z)((e=>Su(e,t))),(0,V.q)(),(0,q.z)((e=>Hl()(e,["rtt"]))),(0,$.h)((({rtt:e})=>!isNaN(e))),(0,Lo.T)((()=>new xe(Ae.TRNS_NO_MATRIX_SERVERS))))}function xu(e,t,{address:n,signer:a,config$:i}){const r=Ru(e);return Me(r,[Ae.TRNS_NO_SERVERNAME,{server:e}]),i.pipe((0,Z.P)(),(0,q.z)((({pollingInterval:o})=>{if(t){const n=(0,h.createClient)({baseUrl:e,userId:t.userId,accessToken:t.accessToken,deviceId:t.deviceId});return(0,P.of)({matrix:n,server:e,setup:t,pollingInterval:o})}{const t=(0,h.createClient)({baseUrl:e}),o=n.toLowerCase(),s=`@${o}:${r}`;return(0,U.D)(a.signMessage(r)).pipe((0,q.z)((e=>(0,Wa.P)((async()=>t.login("m.login.password",{identifier:{type:"m.id.user",user:o},password:e,device_id:me}))).pipe((0,K.K)((async n=>{const a={username:o,password:e,device_id:me};try{return await t.registerRequest(a)}catch(i){throw n}})),pi(Li(i),{onErrors:Re,maxRetries:3})))),(0,q.z)((({access_token:n,device_id:i,user_id:r})=>(Me(r===s,["Wrong login/register user_id",{user_id:r,userId:s}]),t.deviceId=i,t.http.opts.accessToken=n,t.credentials={userId:s},(0,U.D)(a.signMessage(s)).pipe((0,W.U)((a=>({matrix:t,server:e,setup:{userId:s,accessToken:n,deviceId:i,displayName:a}}))))))))}})),(0,q.z)((({matrix:e,server:t,setup:n})=>(0,Wa.P)((async()=>e.setDisplayName(n.displayName))).pipe(pi(Li(i),{onErrors:Re}),(0,Or.h)({matrix:e,server:t,setup:n})))))}function Mu(e,{},t){const{matrix$:n,latest$:a,config$:i,init$:r}=t;return(0,gl.a)([a,i]).pipe((0,Z.P)(),(0,q.z)((([{state:e},{matrixServer:a,matrixServerLookup:i,httpTimeout:o}])=>{const s=e.transport.server,c=e.transport.setup;r.next(n);const l=[];let d;a?(a===s&&l.push((0,P.of)({server:s,setup:c})),l.push((0,P.of)({server:a}))):(s&&l.push((0,P.of)({server:s,setup:c})),l.push(es(void 0,t,!0).pipe((0,W.U)((({matrixServer:e})=>({server:e}))))),l.push(Pu(i,o)));const p=e=>(d=e,L.E);return(0,Wa.P)((()=>l.shift()||L.E)).pipe((0,K.K)(p),(0,j.b)((({server:e,setup:n})=>xu(e,n,t).pipe((0,K.K)(p)))),(0,Z.P)(),(0,ti.b)((({matrix:e})=>e.setMaxListeners(30))),(0,ni.a)((e=>e.pipe((0,q.z)((()=>{if(l.length)return(0,P.of)(null);throw d}))))))})),(0,q.z)((({matrix:n,server:a,setup:r})=>(0,Fa.T)(Cu(e,n,t),(0,P.of)(Xn({server:a,setup:r})),i.pipe(si("logger"),(0,ti.b)((e=>Iu.logger.setLevel(e||"silent",!1))),(0,$a.l)())))),yi(e))}function Uu(e,{},{matrix$:t}){return e.pipe((0,Sr.M)(t),fi((async e=>{if(!e)return;const t=e[1];t.stopClient();try{await t.setPresence({presence:"offline",status_msg:""})}catch(n){}})),(0,$a.l)())}var Lu=n(83766),Bu=n.n(Lu),Fu=n(59349);function Wu(e){return"string"===typeof e?e:va(e)}const $u="m.text";function Vu(e){var t;return null!==(t=e.payload.msgtype)&&void 0!==t?t:$u}function Hu(e,t){let n=0;const a=new Map;for(let i=0;i<e.length&&n<t;i++){const t=e[i],r=t.payload.userId,o=a.get(r),s=o&&Vu(t)!==Vu(o[0]);s||(e.splice(i--,1),o?o.push(t):a.set(r,[t]),n++)}return a}function ju(e,t){if(!e.length)return L.E;const n=Date.now(),a=Hu(e,20),i={};for(const[o,s]of a){const e=s.map((e=>Wu(e.payload.message))).join("\n"),t={msgtype:Vu(s[0]),body:e};i[o]={["*"]:t}}let r=-1;return t.matrix$.pipe((0,q.z)((async e=>(r++,e.sendToDevice("m.room.message",i)))),pi(Li(t.config$),{maxRetries:3,onErrors:Re,log:t.log.warn}),(0,q.z)((function*(){const e=Date.now()-n;for(const[t,n]of a)for(const a of n)yield(0,P.of)(ca.success({via:t,tookMs:e,retries:r},a.meta))})),(0,K.K)((function*(e){for(const[,t]of a)for(const n of t)yield(0,P.of)(ca.failure(e,n.meta))})))}function zu(e,t){const n=[];return e.pipe((0,ti.b)((([e,t])=>n.push({...e,payload:{...e.payload,userId:t}}))),(0,j.b)((()=>(0,Wa.P)((()=>ju(n,t))))),(0,q.z)((t=>t.pipe(yi(e,10)))))}function qu(e){return e.pipe((0,W.U)((([e,t])=>{try{const n=Date.now();t.send(Wu(e.payload.message));const a={via:t.label,tookMs:Date.now()-n,retries:0};return ca.success(a,e.meta)}catch(n){return ca.failure(n,e.meta)}})))}function Ku(e,{},t){return e.pipe(bi(Qn,(n=>{const a=e.pipe((0,$.h)(ca.request.is),_i((a=>{const i=a.meta.address,r=Vu(a)!==$u?L.E:t.latest$.pipe((0,H.j)("rtc",i),(0,$.h)(We),(0,$.h)((({readyState:e})=>"open"===e))),o=a.payload.userId?(0,P.of)(a.payload.userId):n(Qn.request(void 0,{address:i})).pipe((0,H.j)("payload","userId"),(0,K.K)((e=>(0,P.of)(e))));return(0,Fa.T)(r,o).pipe((0,Cn.q)(1),yi(e))})),(0,oi.B)()),[i,r]=(0,Ga.u)(a,(([,e])=>!!e&&(null===e||void 0===e?void 0:e.readyState))),[o,s]=(0,Ga.u)(r,(([,e])=>"string"===typeof e)),c=qu(i),l=zu(o,t),d=s.pipe((0,W.U)((([e,t])=>ca.failure(t,e.meta))));return(0,Fa.T)(d,c,l)}),void 0,(({meta:e})=>e.address)))}function Zu(e,t){const{matrix$:n,config$:a,latest$:i}=t;return n.pipe((0,Sr.M)(i,a),_i((([,,{additionalServices:e}])=>(0,U.D)(e).pipe((0,q.z)((e=>Xe.is(e)?(0,P.of)(e):(0,Wa.P)((async()=>Ko(e,t))).pipe((0,K.K)(Ha()(L.E)))),5),(0,V.q)()))),(0,q.z)((([[t,{state:n}],i])=>{const r=Bu()(i.concat(Object.keys(n.services)));Me(r.length,"no services to messageServiceSend to");const o=Ru(t.getHomeserverUrl()),s=r.map((e=>`@${e.toLowerCase()}:${o}`)),c={msgtype:"m.text",body:Wu(e.payload.message)},l=Object.fromEntries(s.map((t=>[t,{[ft[e.meta.service]]:c}]))),d=Date.now();let p=-1;return(0,Wa.P)((async()=>(p++,await t.sendToDevice("m.room.message",l),la.success({via:s,tookMs:Date.now()-d,retries:p},e.meta)))).pipe(pi(Li(a),{maxRetries:3,onErrors:Re}))})),(0,K.K)((t=>(0,P.of)(la.failure(t,e.meta)))))}function Gu(e,{},t){return e.pipe((0,$.h)(On(la.request)),(0,Tl.j)((()=>t.init$.pipe((0,$a.l)(),(0,kl.l)(!0)))),(0,q.z)((e=>Zu(e,t)),5))}function Yu(e,{},{log:t,matrix$:n,config$:a,latest$:i}){return e.pipe(bi(Qn,(r=>n.pipe(_i((e=>(0,Io.R)(e,"toDeviceEvent"))),(0,$.h)((([e,t])=>"m.room.message"===t.getType()&&t.getSender()!==e.getUserId())),(0,H.j)(1),(0,Sr.M)(a,e.pipe(ra())),_i((([e,{httpTimeout:t},n])=>{const a=e.getSender(),o=n[a];return o?(0,P.of)(o):i.pipe(si("whitelisted"),(0,W.U)((e=>{const t=ta(a);if(t&&e.includes(t))return t})),(0,$.h)(We),(0,Cn.q)(1),(0,ei.R)((0,ja.H)(t)),(0,q.z)((e=>r(Qn.request(void 0,{address:e})))),(0,K.K)(Ha()(L.E)))})),yi(e),(0,q.z)((([[e],n])=>{var a;const i=(null!==(a=e.getContent()["body"])&&void 0!==a?a:"").split("\n");return(0,Fu.x)(i,Yp.E).pipe((0,W.U)((a=>{let i;return e.getContent().msgtype===$u&&(i=Ea(a,n,{log:t})),da({text:a,...i?{message:i}:{},ts:Date.now(),userId:e.getSender(),...e.getContent().msgtype?{msgtype:e.getContent().msgtype}:{}},n.meta)})))}))))))}function Xu(e,{},{log:t,signer:n}){const a=new Wo(32);return e.pipe((0,$.h)(ka([tt($t),tt(Ht),tt(zt)])),(0,Sr.M)(e.pipe(oa())),(0,$.h)((([e,t])=>!sa(t[e.meta.address]))),(0,j.b)((([e])=>{const i=e.payload.message;return(0,Wa.P)((()=>{const r=i.message_identifier,o=r.toString(),s=a.get(o);if(s)return(0,P.of)(ca.request({message:s},{address:e.meta.address,msgId:o}));const c={type:Ut.DELIVERED,delivered_message_identifier:r};return t.info(`Signing "${c.type}" for "${i.type}" with id=${r.toString()}`),(0,U.D)(Ta(n,c,{log:t})).pipe((0,ti.b)((e=>a.set(o,e))),(0,W.U)((t=>ca.request({message:t},{address:e.meta.address,msgId:o}))))}))})))}function Qu(e,t,n){return t.pipe((0,Sr.M)(n.config$),(0,j.b)((([{url:t},{httpTimeout:a}])=>Xo(e,t,n).pipe((0,z.V)(a),gi({onErrors:Re,log:n.log.debug},"Error fetching presence from service",e,t)))),(0,Z.P)(),(0,K.K)((t=>(0,P.of)(Qn.failure(t,{address:e})))))}function Ju(e,{},t){const{latest$:n,config$:a}=t,i=new Map,r=es(void 0,t,!0).pipe((0,Wr.d)());return e.pipe((0,ti.b)((e=>{Qn.success.is(e)?i.set(e.meta.address,e):Qn.failure.is(e)&&i.delete(e.meta.address)})),(0,$.h)(On(Qn.request)),(0,Cr.v)((e=>e.meta.address)),(0,q.z)((e=>e.pipe((0,Sr.M)(n,a),(0,Fr.z)((([e,{rtc:n},{pollingInterval:a}])=>{const{address:o}=e.meta,s=i.get(o);return s&&(Date.now()-s.payload.ts<a||o in n)?(0,P.of)(s):Qu(o,r,t)}))))))}function em(e){return e.pipe((0,$.h)(Oa.is),(0,W.U)((e=>Qn.request(void 0,{address:e.meta.partner}))))}function tm(e,{},{matrix$:t,config$:n,init$:a}){return n.pipe(yi(e),(0,H.j)("caps"),(0,Ya.x)(_l()),(0,Sr.M)(a.pipe((0,$a.l)(),(0,In.O)(!1),(0,kl.l)(!0))),(0,Ja.w)((([e,a])=>t.pipe(_i((async t=>t.setAvatarUrl(e&&!So()(e)?na(e):""))),(0,$.h)((()=>a)),_i((async([e])=>e.setPresence({presence:"offline",status_msg:""}))),_i((async([[e]])=>e.setPresence({presence:"online",status_msg:Date.now().toString()}))),pi(Li(n))))),(0,$a.l)())}function nm({},e,{log:t,matrix$:n,config$:a}){return n.pipe(_i((e=>(0,Io.R)(e,"Room"))),(0,Sr.M)(a),(0,Tl.j)((([,{httpTimeout:e}])=>(0,ja.H)(Math.round((.5+.5*Math.random())*e)))),yi(e),(0,$.h)((([[,e]])=>{const t=e.getMyMembership();return!(!t||"leave"===t)})),(0,q.z)((async([[e,n]])=>(t.warn("Unknown room in matrix, leaving",n.roomId),e.leave(n.roomId).catch((e=>t.error("Error leaving unknown room, ignoring",e)))))),(0,$a.l)())}function am({stale:e,udcDeposit:t,config:{monitoringReward:n}}){return{[pe.RECEIVE]:!e&&null!==n&&void 0!==n&&n.gt(0)&&n.lte(t.balance)?1:0,[pe.WEBRTC]:"RTCPeerConnection"in globalThis?1:0}}function im(e,t,n){return null===n?n:void 0!==n?{...e,...t,...n}:null===t?t:{...e,...t}}function rm({},e,{defaultConfig:t,latest$:n}){return(0,gl.a)([e.pipe(si("config","caps")),n]).pipe((0,W.U)((([e,n])=>im(am(n),t.caps,e))),(0,Ya.x)(_l()),(0,W.U)((e=>gr({caps:e}))),yi(e))}function om(e,{},{config$:t,log:n,provider:a}){return(0,Fa.T)(t.pipe(si("logger"),(0,ti.b)((e=>n.setLevel(e||"silent",!1)))),t.pipe(si("pollingInterval"),(0,ti.b)((e=>a.pollingInterval=e)))).pipe((0,$a.l)(),yi(e))}const sm={configCapsEpic:rm,configReactEpic:om};function cm(e,t,{defaultConfig:n,mediationFeeCalculator:a}){const i={balance:v.Bz,totalDeposit:v.Bz},r=!1,o=e.pipe((0,$.h)(ji.success.is),(0,$.h)((e=>!("confirmed"in e.payload)||!!e.payload.confirmed)),(0,W.U)((e=>({balance:e.payload.balance,totalDeposit:e.meta.totalDeposit}))),(0,In.O)(i),(0,Ya.x)((({balance:e},{balance:t})=>e.eq(t)))),s=e.pipe((0,$.h)(Ia.is),(0,H.j)("payload","blockTime"),(0,In.O)(15e3)),c=e.pipe((0,$.h)(Ra.is),(0,H.j)("payload","stale"),(0,In.O)(r)),l=e.pipe((0,$.h)(Da.is),(0,H.j)("payload"),(0,In.O)(15e3)),d=(0,Fa.T)(t.pipe((0,Cn.q)(1),(0,H.j)("config"),(0,W.U)((({caps:e,monitoringReward:t})=>im(am({udcDeposit:i,stale:r,config:{monitoringReward:null!==t&&void 0!==t?t:n.monitoringReward}}),n.caps,e)))),e.pipe((0,$.h)(gr.is),(0,H.j)("payload","caps"))),p=(0,gl.a)([t.pipe(si("config")),d]).pipe((0,W.U)((([e,t])=>({...n,...e,caps:t,mediationFees:a.decodeConfig(e.mediationFees,n.mediationFees)})))),u=t.pipe((0,Cn.q)(1),(0,q.z)((t=>{const n=(0,ml.uniq)(Object.values(t.channels).map((({partner:e})=>e.address)));return e.pipe((0,$.h)(Qn.request.is),(0,Nn.R)(((e,t)=>e.includes(t.meta.address)?e:[...e,t.meta.address]),n),(0,In.O)(n),(0,Ya.x)())}))),m=e.pipe((0,$.h)(Jn.is),(0,Nn.R)(((e,t)=>t.payload?{...e,[t.meta.address]:t.payload}:fl()(t.meta.address,e)),{}),(0,In.O)({}));return(0,gl.a)([e,t,p,u,m,o,s,c,l]).pipe((0,W.U)((([e,t,n,a,i,r,o,s,c])=>({action:e,state:t,config:n,whitelisted:a,rtc:i,udcDeposit:r,blockTime:o,stale:s,settleTimeout:c}))))}function lm(e,t,n){return cm(e,t,n).pipe((0,ti.b)(n.latest$),(0,ri.x)(n.latest$.complete.bind(n.latest$)),(0,$a.l)())}const dm={...sm,...c,...p,...d,...u,...l};function pm(e=Object.values(dm)){return function(t,n,a){const i=t.pipe((0,$.h)(hr.is)),r=new No.X([]),o=(0,U.D)(e).pipe((0,In.O)(lm),(0,q.z)((e=>{e===lm?r.next(r.value.concat(e)):r.next(r.value.slice(0,-1).concat(e,at(r.value)));const o=r.pipe((0,vl.V)(i),(0,wl.u)(i),(0,$.h)((([t])=>t[0]===e)));return e(t.pipe((0,ei.R)(o)),n.pipe((0,ei.R)(o)),a).pipe((0,K.K)((t=>(a.log.error("Epic error",e.name,e,t),(0,P.of)(hr({reason:t}))))),(0,ei.R)(o.pipe((0,Sr.M)(a.config$),(0,Tl.j)((([e,{httpTimeout:t}])=>(0,ja.H)(t))),(0,ti.b)((()=>a.log.warn("Epic stuck:",e.name,e))))),(0,ri.x)((()=>{r.next(r.value.filter((t=>t!==e)))})))})),(0,ei.R)(i.pipe((0,F.T)(1)))),s=a.db.busy$.pipe((0,Z.P)((e=>!e)),(0,ti.b)((()=>a.db.busy$.next(!0))),(0,K.K)((()=>(0,P.of)(null))),(0,q.z)((async()=>a.db.close())),(0,$a.l)(),(0,ri.x)((()=>{a.db.busy$.next(!1),a.db.busy$.complete()})));return(0,bl.z)(o,s)}}function um(e){let t={};const n=async()=>{await e.info(),Me(!e.__opts.versionchanged,Ae.RDN_DATABASE_DELETED);while(!So()(t)){const n=t;t={};const a=Object.keys(n),i=await e.allDocs({keys:a}),r=e=>{const t=i.rows.find((t=>t.id===e));return null!==t&&void 0!==t&&t.value.deleted?{_rev:t.value.rev,deleted:!1}:t&&!("error"in t)?{_rev:t.value.rev}:void 0},o=await e.bulkDocs(Object.entries(n).map((([e,t])=>({...t,_id:e,...r(e)}))));for(const e of o)"error"in e&&e.error&&e.id&&!(e.id in t)&&(t[e.id]=n[e.id])}};return a=>i=>r=>{const o=a.getState(),s=i(r),c=a.getState();if(c===o)return s;for(const n in c){const a=n;if(c[a]!==o[a])if("channels"===a||"oldChannels"===a)for(const n in c[a]){if(c[a][n]===o[a][n])continue;const i=`channels.${c[a][n]._id}`;e.storageKeys.add(i),t[i]=c[a][n]}else if("transfers"===a){for(const n in c.transfers)c.transfers[n]!==o.transfers[n]&&(e.storageKeys.add(n),t[n]=c.transfers[n]);for(const e in o.transfers)e in c.transfers||(t[e]={...o.transfers[e],cleared:Date.now()})}else{const n=`state.${a}`;e.storageKeys.add(n),t[n]={value:c[a]}}}return e.busy$.value||(e.busy$.next(!0),n().then((()=>e.busy$.next(!1)),(t=>e.busy$.error(t)))),s}}function mm(e,t){return function(n=t,a){for(const r in e){var i;const o=e[r];if(!o)continue;const s=null!==(i=n[r])&&void 0!==i?i:t[r],c=o(s,a);c!==s&&(n={...n,[r]:c})}return n}}const ym=Bn(dc.blockNumber).handle(Na,(({},{payload:e})=>e.blockNumber)),fm=Bn(dc.tokens).handle(Ca,((e,{payload:{token:t,tokenNetwork:n}})=>e[t]===n?e:{...e,[t]:n}));function hm(e,t){return e.filter((e=>e.type!==t.type||t.payload.txHash!==e.payload.txHash))}const _m=(e=dc.pendingTxs,t)=>{if(Ar.is(t)){if(void 0===t.payload.confirmed)return[...hm(e,t),t];{const n=hm(e,t);return n.length!==e.length?n:e}}return e},gm={address:b.d,deposit:v._Y,withdraw:v._Y,locks:[],balanceProof:dt,pendingWithdraws:[],nextNonce:v.fh};function bm(e,t){var n,a;const i=il(t.meta),r=e.channels[i];if((null!==(n=null===r||void 0===r?void 0:r.openBlock)&&void 0!==n?n:0)>=t.payload.txBlock||(null!==(a=null===r||void 0===r?void 0:r.id)&&void 0!==a?a:0)>=t.payload.id||!t.payload.confirmed)return e;const o={_id:rl({...t.meta,id:t.payload.id}),id:t.payload.id,state:Nr.open,token:t.payload.token,tokenNetwork:t.meta.tokenNetwork,isFirstParticipant:t.payload.isFirstParticipant,openBlock:t.payload.txBlock,own:{...gm,address:e.address},partner:{...gm,address:t.meta.partner}};return{...e,channels:{...e.channels,[i]:o}}}function vm(e,t){var n;if(!t.payload.confirmed)return e;const a=il(t.meta);let i=e.channels[a];if((null===(n=i)||void 0===n?void 0:n.state)!==Nr.open||i.id!==t.payload.id)return e;const r=t.payload.participant===i.partner.address?"partner":"own",[o,s,c]=xa.is(t)?["withdraw",t.payload.totalWithdraw,i[r].pendingWithdraws.filter((e=>e.total_withdraw.gt(t.payload.totalWithdraw)))]:["deposit",t.payload.totalDeposit,i[r].pendingWithdraws];return s.lte(i[r][o])?e:(i={...i,[r]:{...i[r],[o]:s,pendingWithdraws:c}},{...e,channels:{...e.channels,[a]:i}})}function wm(e,t){var n;const a=il(t.meta);let i=e.channels[a];if((null===(n=i)||void 0===n?void 0:n.id)!==t.payload.id)return e;if(void 0===t.payload.confirmed&&i.state===Nr.open)i={...i,state:Nr.closing};else{if("closeBlock"in i||!t.payload.confirmed)return e;i={...i,state:Nr.closed,closeBlock:t.payload.txBlock,closeParticipant:t.payload.participant}}return{...e,channels:{...e.channels,[a]:i}}}function Tm(e,t){const n=il(t.meta);let a=e.channels[n];if(!a)return e;if(Ma.request.is(t)&&a.state===Nr.open)a={...a,state:Nr.closing};else if(Ma.failure.is(t)&&a.state===Nr.closing)a={...a,state:Nr.open};else if(Ba.request.is(t)&&a.state===Nr.settleable)a={...a,state:Nr.settling};else{if(!Ua.is(t)||a.state!==Nr.closed)return e;a={...a,state:Nr.settleable}}return{...e,channels:{...e.channels,[n]:a}}}function km(e,t){const n=il(t.meta),a=e.channels[n];if((null===a||void 0===a?void 0:a.id)!==t.payload.id)return e;const i={closeBlock:"closeBlock"in a?a.closeBlock:0,closeParticipant:"closeParticipant"in a?a.closeParticipant:b.d};if(void 0===t.payload.confirmed&&a.state!==Nr.settling)return{...e,channels:{...e.channels,[n]:{...a,...i,state:Nr.settling}}};if(t.payload.confirmed){const{[n]:r,...o}=e.channels;return{...e,channels:o,oldChannels:{...e.oldChannels,[rl(a)]:{...a,...i,state:Nr.settled,settleBlock:t.payload.txBlock}}}}return e}function Em(e,t,n){let a=!1;const i=e.map((e=>e.secrethash!==t||e.registered||e.expiration.lte(n)?e:(a=!0,{...e,registered:!0})));return a?i:e}function Am(e,t){if(!t.payload.confirmed)return e;const n=t.meta.direction===wi.SENT?"own":"partner";for(const[a,i]of Object.entries(e.channels)){const r=Em(i[n].locks,t.meta.secrethash,t.payload.txTimestamp);r!==i[n].locks&&(e={...e,channels:{...e.channels,[a]:{...i,[n]:{...i[n],locks:r}}}})}return e}const Nm=Bn(dc).handle(Sa.success,bm).handle([Pa.success,xa],vm).handle([Ma.request,Ma.failure,Ua,Ba.request],Tm).handle(Ma.success,wm).handle(Ba.success,km).handle(er.success,Am),Im=mm({blockNumber:ym,tokens:fm,pendingTxs:_m},dc),Rm=(e=dc,t)=>[Im,Nm].reduce(((e,n)=>n(e,t)),e),Dm=Rm,Cm=Bn(dc.iou).handle(Vi,((e,t)=>({...e,[t.meta.tokenNetwork]:{...e[t.meta.tokenNetwork],[t.meta.serviceAddress]:t.payload.iou}}))).handle(Hi,((e,t)=>fl()([t.meta.tokenNetwork,t.meta.serviceAddress],e))),Sm=Bn(dc.services).handle($i,((e,t)=>t.payload)),Om=mm({iou:Cm,services:Sm},dc),Pm=Om;var xm=n(45005),Mm=n.n(xm);const Um={[wi.SENT]:"own",[wi.RECEIVED]:"partner"};function Lm(e,t){var n;const a=ls(t.meta),i=e.transfers[a];return i?(i.secret||(e={...e,transfers:{...e.transfers,[a]:{...e.transfers[a],secret:t.payload.secret}}}),er.success.is(t)&&t.payload.confirmed&&t.payload.txBlock!==(null===(n=i.secretRegistered)||void 0===n?void 0:n.txBlock)&&t.payload.txTimestamp<i.expiration&&(e={...e,transfers:{...e.transfers,[a]:{...e.transfers[a],secretRegistered:Je({txHash:t.payload.txHash,txBlock:t.payload.txBlock},1e3*t.payload.txTimestamp)}}}),e):e}function Bm(e,t){var n;const a=t.payload.message,i=ls(t.meta),r=t.payload.partner,o=il({tokenNetwork:a.token_network_address,partner:r}),s=Um[t.meta.direction];let c=e.channels[o],l=e.transfers[i];const d=ar.success.is(t)?"unlock":"expired",p=Xi.is(t)&&l,u=!Xi.is(t)&&(!l||d in l);if(p||u||(null===(n=c)||void 0===n?void 0:n.state)!==Nr.open||!a.nonce.eq(c[s].nextNonce))return e;let m;switch(t.type){case Xi.type:m=[...c[s].locks,t.payload.message.lock],l={_id:i,channel:rl(c),...t.meta,transfer:Je(t.payload.message),fee:t.payload.fee,expiration:t.payload.message.lock.expiration.toNumber(),partner:r,cleared:0};break;case ar.success.type:case rr.success.type:m=c[s].locks.filter((e=>e.secrethash!==t.meta.secrethash)),l={[d]:Je(t.payload.message),...l};break}return c={...c,[s]:{...c[s],locks:m,balanceProof:ba(a),nextNonce:c[s].nextNonce.add(1)}},{...e,channels:{...e.channels,[o]:c},transfers:{...e.transfers,[i]:l}}}const Fm={[tr.type]:"secretRequest",[nr.type]:"secretReveal",[Qi.type]:"transferProcessed",[ir.type]:"unlockProcessed",[or.type]:"expiredProcessed"};function Wm(e,t){const n=ls(t.meta),a=Fm[t.type],i=e.transfers[n];return!i||!tr.is(t)&&a in i||(e={...e,transfers:{...e.transfers,[n]:{...i,[a]:Je(t.payload.message)}}}),e}function $m(e,t){const n=ls(t.meta);if(n in e.transfers){const{[n]:t,...a}=e.transfers;e={...e,transfers:a}}return e}function Vm(e,t){const n=ls(t.meta);return n in e.transfers||(e={...e,transfers:{...e.transfers,[n]:{...t.payload,cleared:0}}}),e}function Hm(e,t){if(!t.payload.confirmed)return e;const n=Ma.success.is(t)?"channelClosed":"channelSettled",a=rl({id:t.payload.id,...t.meta});for(const i of Object.values(e.transfers))i.channel===a&&(e={...e,transfers:{...e.transfers,[ls(i)]:{...i,[n]:Je(Mm()(["txHash","txBlock"],t.payload))}}});return e}function jm(e,t){var n;const a=t.payload.message,i=il(t.meta);let r=e.channels[i];const o=t.meta.direction===wi.RECEIVED!==ur.success.is(t)?"partner":"own";if((null===(n=r)||void 0===n?void 0:n.state)!==Nr.open||!a.nonce.eq(r[o].nextNonce))return e;r={...r,[o]:{...r[o],nextNonce:r[o].nextNonce.add(1)}};const s=t.meta.direction===wi.RECEIVED?"partner":"own",c=[...r[s].pendingWithdraws,t.payload.message];return r={...r,[s]:{...r[s],pendingWithdraws:c}},{...e,channels:{...e.channels,[i]:r}}}function zm(e,t){var n;const a=il(t.meta);let i=e.channels[a];if((null===(n=i)||void 0===n?void 0:n.state)!==Nr.open)return e;const r=t.meta.direction===wi.RECEIVED?"partner":"own",o=i[r].pendingWithdraws.filter((e=>!e.expiration.eq(t.meta.expiration)||!e.total_withdraw.eq(t.meta.totalWithdraw)));return i={...i,[r]:{...i[r],pendingWithdraws:o}},{...e,channels:{...e.channels,[a]:i}}}const qm=Bn(dc).handle([Ji,er.success],Lm).handle([Xi,ar.success,rr.success],Bm).handle([Qi,ir,or,tr,nr],Wm).handle(sr,$m).handle(cr,Vm).handle([Ma.success,Ba.success],Hm).handle([ur.request,ur.success,yr.success],jm).handle(fr,zm),Km=qm,Zm=Bn(dc.transport).handle(Xn,((e,t)=>(_l()(e,t.payload)||(e=t.payload),e))),Gm=mm({transport:Zm},dc),Ym=Gm,Xm=Bn(dc).handle(_r,((e,{payload:t})=>{let n=e.config;for(const[a,i]of Object.entries(t))void 0!==i?n={...n,[a]:i}:a in n&&(n=fl()(a,n));return n===e.config?e:{...e,config:n}})).handle(br,(e=>({...e}))),Qm={configReducer:Xm,channelsReducer:Dm,transportReducer:Ym,transfersReducer:Km,servicesReducer:Pm},Jm=(e=dc,t)=>Object.values(Qm).reduce(((e,n)=>n(e,t)),e),ey=JSON.parse('{"S":"3.1.1","r":"0.50.1"}');var ty=n(27061);class ny{constructor(e,t,n=pm(),a=Jm){this.deps=t,this.epic=n,this.action$=this.deps.latest$.pipe(si("action"),(0,F.T)(1)),this.state$=this.deps.latest$.pipe(si("state")),this.channels$=this.state$.pipe(si("channels"),(0,W.U)(Vc)),this.events$=this.action$.pipe((0,$.h)(On(Tr))),this.transfers$=$c(this.deps.db),this.config$=this.deps.config$,this.blockTime$=this.deps.latest$.pipe(si("blockTime")),this.synced=Zc(this.action$),this.getTokenInfo=Gc(this.deps),this.resolveName=this.deps.provider.resolveName.bind(this.deps.provider),this.userDepositTokenAddress=N()((async()=>this.deps.userDepositContract.callStatic.token())),t.provider.resetEventsBlock(e.blockNumber+1);const i=!(null===globalThis||void 0===globalThis||!globalThis.location),r=(0,S.createLogger)({predicate:()=>this.log.getLevel()<=y().levels.INFO,logger:this.log,level:{prevState:!1,action:"info",error:"error",nextState:"debug"},...i?{}:{colors:!1}});this.epicMiddleware=(0,O.k)({dependencies:t});const o=um(t.db);this.store=(0,D.MT)(a,e,(0,C.Uo)((0,D.md)(r,o,this.epicMiddleware))),t.config$.subscribe((e=>this.config=e)),cm((0,P.of)(_r({})),(0,P.of)(this.store.getState()),t).subscribe((e=>t.latest$.next(e)))}static async create(e,t,n,a,i,r,o){let s;s="string"===typeof e?new w.r(e):e instanceof w.r?e:new T.Q(e);const c=await s.getNetwork(),{signer:l,address:d,main:p}=await Wc(t,s,r,o),{state:u,db:m}=await Qc({provider:s,network:c,address:d,log:y().getLogger(`raiden:${d}`)},a,n),f=u.contracts;Me(d===u.address,[Ae.RDN_STATE_ADDRESS_MISMATCH,{account:d,state:u.address}]),Me(c.chainId===u.chainId,[Ae.RDN_STATE_NETWORK_MISMATCH,{network:c.chainId,contracts:f,stateNetwork:u.chainId}]);const h=i&&Fe(xi,R()(i,E())),_=al(u,h,{signer:l,contractsInfo:f,db:m,main:p});return new this(u,_)}async start(){Me(this.epicMiddleware,Ae.RDN_ALREADY_STARTED,this.log.info),this.log.info("Starting Raiden Light-Client",{prevBlockNumber:this.state.blockNumber,address:this.address,contracts:this.deps.contractsInfo,network:this.deps.network,"raiden-ts":ny.version,"raiden-contracts":ny.contractVersion,config:this.config,versions:null===ty||void 0===ty?void 0:ty.versions}),this.deps.latest$.subscribe({complete:()=>this.epicMiddleware=null}),this.epicMiddleware.run(this.epic),this.epicMiddleware=void 0,this.store.dispatch(br()),await this.synced}get started(){if(!this.epicMiddleware)return void 0===this.epicMiddleware}async stop(){this.started&&this.store.dispatch(hr({reason:de.STOP})),void 0!==this.started&&await(0,x.n)(this.deps.db.busy$,{defaultValue:void 0})}get log(){return this.deps.log}get state(){return this.store.getState()}get provider(){return this.deps.provider}get address(){return this.deps.address}get mainAddress(){var e;return null===(e=this.deps.main)||void 0===e?void 0:e.address}get network(){return this.deps.network}async getBlockNumber(){const e=this.deps.provider.blockNumber;return e&&e>=this.deps.contractsInfo.TokenNetworkRegistry.block_number?e:await this.deps.provider.getBlockNumber()}static get version(){return ey.S}static get contractVersion(){return ey.r}get contractsInfo(){return this.deps.contractsInfo}updateConfig(e){"mediationFees"in e&&this.deps.mediationFeeCalculator.decodeConfig(e.mediationFees,this.deps.defaultConfig.mediationFees),this.store.dispatch(_r(Fe(xi,e)))}async*dumpDatabase(){yield*Ks(this.deps.db)}getBalance(e){var t;return e=null!==(t=e)&&void 0!==t?t:Hc(this.deps,this.config.subkey).address,Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{address:e}],this.log.info),this.deps.provider.getBalance(e)}async getTokenBalance(e,t){var n;t=null!==(n=t)&&void 0!==n?n:Hc(this.deps,this.config.subkey).address,Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{address:t}],this.log.info),Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info);const a=this.deps.getTokenContract(e);return a.callStatic.balanceOf(t)}async getTokenList(e=!1){return e?await(0,x.n)(Cc(this.deps.provider,{...this.deps.registryContract.filters.TokenNetworkCreated(),fromBlock:this.deps.contractsInfo.TokenNetworkRegistry.block_number,toBlock:await this.getBlockNumber()}).pipe((0,W.U)((e=>this.deps.registryContract.interface.parseLog(e))),(0,$.h)((e=>!!e.args["token_address"])),(0,W.U)((e=>e.args["token_address"])),(0,V.q)())):Object.keys(this.state.tokens)}async monitorToken(e){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info);let t=this.state.tokens[e];return t||(t=await this.deps.registryContract.token_to_token_networks(e),Me(t&&t!==b.d,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info),this.store.dispatch(Ca({token:e,tokenNetwork:t,fromBlock:this.deps.contractsInfo.TokenNetworkRegistry.block_number})),t)}async openChannel(e,t,n={},a){var i;Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{partner:t}],this.log.info);const r=await this.monitorToken(e),o=n.deposit?Fe(je(32),n.deposit,Ae.DTA_INVALID_DEPOSIT,this.log.info):void 0,s=null!==(i=n.confirmConfirmation)&&void 0!==i?i:!!this.config.confirmationBlocks,c={tokenNetwork:r,partner:t},l=Ln(Sa,c,this.action$).then((({txHash:e})=>(null===a||void 0===a||a({type:oc.OPENED,payload:{txHash:e}}),e))),d=Ln(Sa,c,this.action$,!0).then((({txHash:e})=>(null===a||void 0===a||a({type:oc.CONFIRMED,payload:{txHash:e}}),e)));let p;null!==o&&void 0!==o&&o.gt(0)&&(p=Ln(Pa,c,this.action$.pipe((0,$.h)((e=>!Pa.success.is(e)||e.payload.participant===this.address))),!0).then((({txHash:e})=>(null===a||void 0===a||a({type:oc.DEPOSITED,payload:{txHash:e}}),e)))),this.store.dispatch(Sa.request({...n,deposit:o},c));const[,u,m]=await Promise.all([l,d,p]);return s&&await zc(await this.deps.provider.getTransactionReceipt(null!==m&&void 0!==m?m:u),this.deps,2*this.config.confirmationBlocks),u}async depositChannel(e,t,n,{confirmConfirmation:a=!!this.config.confirmationBlocks}={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{partner:t}],this.log.info);const i=this.state,r=i.tokens[e];Me(r,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const o=Fe(je(32),n,Ae.DTA_INVALID_DEPOSIT,this.log.info),s={tokenNetwork:r,partner:t},c=Ln(Pa,s,this.action$.pipe((0,$.h)((e=>!Pa.success.is(e)||e.payload.participant===this.address))),!0).then((({txHash:e})=>e));this.store.dispatch(Pa.request({deposit:o},s));const l=await c;return a&&await zc(await this.deps.provider.getTransactionReceipt(l),this.deps,2*this.config.confirmationBlocks),l}async closeChannel(e,t){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{partner:t}],this.log.info);const n=this.state,a=n.tokens[e];Me(a,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);try{const e=this.state.channels[il({tokenNetwork:a,partner:t})];Me(e,"channel not found");const{ownTotalWithdrawable:n}=ol(e),i=Math.ceil(Date.now()/1e3+this.config.revealTimeout*this.config.expiryFactor),r={direction:wi.SENT,tokenNetwork:a,partner:t,totalWithdraw:n,expiration:i},o=Ln(pr,r,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(dr({coopSettle:!0},r)),await o}catch(o){this.log.info("Could not settle cooperatively, performing uncooperative close",o)}const i={tokenNetwork:a,partner:t},r=Ln(Ma,i,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(Ma.request(void 0,i)),r}async settleChannel(e,t){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{partner:t}],this.log.info);const n=this.state,a=n.tokens[e];Me(a,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info),Me(!this.config.autoSettle,Ae.CNL_SETTLE_AUTO_ENABLED,this.log.info);const i={tokenNetwork:a,partner:t};await(0,x.n)(tl(this.state$,i));const r=Ln(Ba,i,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(Ba.request(void 0,i)),r}async getAvailability(e){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{address:e}],this.log.info);const t={address:e},n=Ln(Qn,t,this.action$);return this.store.dispatch(Qn.request(void 0,t)),n}async getTransfers(e,t){return Gs(this.deps.db,e,t)}async transfer(e,t,n,a={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{target:t}],this.log.info);const i=this.state.tokens[e];Me(i,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const r=Fe(je(32),n,Ae.DTA_INVALID_AMOUNT,this.log.info),o=void 0!==a.paymentId?Fe(je(8),a.paymentId,Ae.DTA_INVALID_PAYMENT_ID,this.log.info):os(),s=a.paths&&Fe(It,a.paths,Ae.DTA_INVALID_PATH,this.log.info),c=a.pfs&&Fe(Ct,a.pfs,Ae.DTA_INVALID_PFS,this.log.info);Me(void 0===a.secret||Ke.is(a.secret),Ae.RDN_INVALID_SECRET,this.log.info),Me(void 0===a.secrethash||qe.is(a.secrethash),Ae.RDN_INVALID_SECRETHASH,this.log.info);const l=a.secret||(a.secrethash?void 0:is()),d=a.secrethash||as(l);Me(!l||as(l)===d,Ae.RDN_SECRET_SECRETHASH_MISMATCH,this.log.info);const p=(0,M.z)(this.action$.pipe((0,$.h)(On([Xi,Yi.failure])),(0,$.h)((({meta:e})=>e.direction===wi.SENT&&e.secrethash===d)),(0,W.U)((e=>{if(Yi.failure.is(e))throw e.payload;return ls(e.meta)}))));return this.store.dispatch(Yi.request({tokenNetwork:i,target:t,value:r,paymentId:o,secret:l,resolved:!1,paths:s,pfs:c,lockTimeout:a.lockTimeout,encryptSecret:a.encryptSecret},{secrethash:d,direction:wi.SENT})),p}async waitTransfer(e){var t;const{direction:n,secrethash:a}=ps(e);let i=this.state.transfers[e];if(!i)try{i=Fe(Ei,await this.deps.db.get(e))}catch(s){}Me(i,Ae.RDN_UNKNOWN_TRANSFER,this.log.info);const r=fs(i);if(r.completed){if(r.success)return r;throw new xe(Ae.XFER_ALREADY_COMPLETED,{status:r.status})}await Ln(Yi,{secrethash:a,direction:n},this.action$);const o=await(0,M.z)(this.state$.pipe((0,H.j)("transfers",e),(0,$.h)((e=>!!e.unlockProcessed))));return this.log.info("Transfer successful",{key:e,partner:o.partner,initiator:o.transfer.initiator,target:o.transfer.target,fee:o.fee.toString(),lockAmount:o.transfer.lock.amount.toString(),targetReceived:null===(t=o.secretRequest)||void 0===t?void 0:t.amount.toString(),transferTime:o.unlockProcessed.ts-o.transfer.ts}),fs(o)}async findRoutes(e,t,n,a={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{target:t}],this.log.info);const i=this.state.tokens[e];Me(i,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const r=Fe(je(32),n),o=a.pfs?Fe(Ct,a.pfs):void 0,s={tokenNetwork:i,target:t,value:r},c=Ln(Wi,s,this.action$).then((({paths:e})=>e));return this.store.dispatch(Wi.request({pfs:o},s)),c}async directRoute(e,t,n){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{target:t}],this.log.info);const a=this.state.tokens[e];Me(a,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const i=Fe(je(32),n),r={tokenNetwork:a,target:t,value:i},o=Ln(Wi,r,this.action$).then((({paths:e})=>e),(()=>{}));return this.store.dispatch(Wi.request({pfs:null},r)),o}async findPFS(){Me(this.config.pfsMode!==ht.disabled,Ae.PFS_DISABLED,this.log.info),await this.synced;const e=[...this.config.additionalServices];return this.config.pfsMode===ht.auto&&e.push(...Object.keys(this.state.services)),(0,x.n)(Zo(e,this.deps))}async mint(e,t,{to:n}={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(1!==this.deps.network.chainId,Ae.RDN_MINT_MAINNET,this.log.info);const{signer:a,address:i}=Hc(this.deps,this.config.subkey),r=qr.connect(e,a),o=null!==n&&void 0!==n?n:i;Me(Xe.is(o),[Ae.DTA_INVALID_ADDRESS,{beneficiary:o}],this.log.info);const s=Fe(je(32),t,Ae.DTA_INVALID_AMOUNT),[,c]=await(0,x.n)(pl(r,"mintFor",[s,o],this.deps,{error:Ae.RDN_MINT_FAILED}));return await zc(c,this.deps,1),c.transactionHash}async registerToken(e,t=v.Bz,n=v.Bz){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(1!==this.deps.network.chainId,Ae.RDN_REGISTER_TOKEN_MAINNET,this.log.info);const{signer:a}=Hc(this.deps,this.config.subkey),i=jc(this.deps.registryContract,a);await this.monitorToken(e).then((e=>{throw new xe(Ae.RDN_REGISTER_TOKEN_REGISTERED,{tokenNetwork:e})}),(()=>{}));const[,r]=await(0,x.n)(pl(i,"createERC20TokenNetwork",[e,t,n],this.deps,{error:Ae.RDN_REGISTER_TOKEN_FAILED}));return await zc(r,this.deps),await this.monitorToken(e)}async getUDCCapacity(){const e=await Kc(this.deps.latest$),t=Math.round(Date.now()/1e3),n=Object.values(this.state.iou).reduce(((e,n)=>[...e,...Object.values(n).filter((e=>e.claimable_until.gte(t)))]),[]).reduce(((e,t)=>e.add(t.amount)),v._Y);return e.sub(n)}async getUDCTotalDeposit(){return(0,M.z)(this.deps.latest$.pipe((0,H.j)("udcDeposit","totalDeposit"),(0,$.h)((e=>!!e&&e.lt(v.Bz)))))}async depositToUDC(e,t){const n=Fe(je(32),e,Ae.DTA_INVALID_DEPOSIT,this.log.info);Me(n.gt(v._Y),Ae.DTA_NON_POSITIVE_NUMBER,this.log.info);const a=await this.deps.userDepositContract.callStatic.total_deposit(this.address),i={totalDeposit:a.add(n)},r=Ln(ji,i,this.action$,!1).then((({txHash:e})=>null===t||void 0===t?void 0:t({type:oc.DEPOSITED,payload:{txHash:e}})));this.store.dispatch(ji.request({deposit:n},i));const o=Ln(ji,i,this.action$,!0).then((({txHash:e})=>(null===t||void 0===t||t({type:oc.CONFIRMED,payload:{txHash:e}}),e))),[,s]=await Promise.all([r,o]);return s}async transferOnchainBalance(e,t=v.Bz,{subkey:n,gasPrice:a}={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{to:e}],this.log.info);const{signer:i,address:r}=Hc(this.deps,null!==n&&void 0!==n?n:this.config.subkey),o=a?g.O$.from(a):await this.deps.provider.getGasPrice();let s,c;for(let y=0;!s||!c;y++)try{s=await this.getBalance(r),c=await this.deps.provider.estimateGas({from:r,to:e,value:s})}catch(m){if(y>=5)throw m}const l=s.sub(o.mul(c));Me(l.gt(v._Y),[Ae.RDN_INSUFFICIENT_BALANCE,{transferableBalance:l}],this.log.warn);const d=l.lte(t)?l:g.O$.from(t),p=await i.sendTransaction({to:e,value:d,gasPrice:o,gasLimit:c}),u=await p.wait();return Me(u.status,Ae.RDN_TRANSFER_ONCHAIN_BALANCE_FAILED,this.log.info),p.hash}async transferOnchainTokens(e,t,n=v.Bz,{subkey:a}={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{to:t}],this.log.info);const{address:i}=Hc(this.deps,null!==a&&void 0!==a?a:this.config.subkey),r=await this.getTokenBalance(e,i),o=r.lte(n)?r:g.O$.from(n),[,s]=await(0,x.n)(pl(this.deps.getTokenContract(e),"transfer",[t,o],this.deps,{subkey:a,error:Ae.RDN_TRANSFER_ONCHAIN_TOKENS_FAILED}).pipe(pi(Li(this.deps.config$),{maxRetries:3,onErrors:Oe,log:this.log.info})));return s.transactionHash}async getUDCWithdrawPlan(){const e=await this.deps.userDepositContract.withdraw_plans(this.address);if(!e.withdrawable_after.isZero())return{amount:e.amount,withdrawableAfter:e.withdrawable_after.toNumber(),ready:e.withdrawable_after.lte(Math.ceil(Date.now()/1e3))}}async planUDCWithdraw(e=v.Bz){const t=await Kc(this.deps.latest$);Me(t.gt(0),"nothing to withdraw from UDC");const n=t.lte(e)?t:Fe(je(32),e,Ae.DTA_INVALID_AMOUNT,this.log.error),a={amount:n},i=Ln(qi,a,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(qi.request(void 0,a)),i}async withdrawFromUDC(e,t){Me(!this.config.autoUDCWithdraw,Ae.UDC_WITHDRAW_AUTO_ENABLED,this.log.warn);const n=await this.getUDCWithdrawPlan();Me(n,Ae.UDC_WITHDRAW_NO_PLAN,this.log.warn),e?Me(n.amount.gte(e),Ae.UDC_WITHDRAW_TOO_LARGE,this.log.warn):e=n.amount;const a={amount:Fe(je(32),e,Ae.DTA_INVALID_AMOUNT,this.log.error)};n.ready||await new Promise((e=>setTimeout(e,1e3*n.withdrawableAfter-Date.now())));const i=Ln(Ki,a,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(Ki.request(t,a)),i}async withdrawChannel(e,t,n){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info),Me(Xe.is(t),[Ae.DTA_INVALID_ADDRESS,{partner:t}],this.log.info);const a=this.state.tokens[e];Me(a,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const i=this.state.channels[il({tokenNetwork:a,partner:t})];Me((null===i||void 0===i?void 0:i.state)===Nr.open,Ae.CNL_NO_OPEN_CHANNEL_FOUND,this.log.error);const{ownWithdrawable:r,ownWithdraw:o}=ol(i),s=Fe(je(32),null!==n&&void 0!==n?n:r,Ae.DTA_INVALID_AMOUNT,this.log.info),c=o.add(s),l=Math.ceil(Date.now()/1e3+this.config.expiryFactor*this.config.revealTimeout),d={direction:wi.SENT,tokenNetwork:a,partner:t,totalWithdraw:c,expiration:l},p=Ln(pr,d,this.action$,!0).then((({txHash:e})=>e));return this.store.dispatch(dr(void 0,d)),p}async suggestPartners(e,t={}){Me(Xe.is(e),[Ae.DTA_INVALID_ADDRESS,{token:e}],this.log.info);const n=this.state.tokens[e];Me(n,Ae.RDN_UNKNOWN_TOKEN_NETWORK,this.log.info);const a=t.pfs?[Fe(Ct,t.pfs)]:await this.findPFS();let i;return(0,M.z)((0,U.D)(a).pipe((0,j.b)((e=>(0,B.U)(`${e.url}/api/v1/${n}/suggest_partner`,{method:"GET",headers:{"Content-Type":"application/json"}}).pipe((0,z.V)(this.config.httpTimeout),(0,q.z)((async e=>e.text())),(0,W.U)((e=>{const t=Fe(xt,Hn(e));if(!t.length)throw i=[],new Error("PFS returned no suggested partners");return t})),(0,K.K)((t=>(this.log.info("Could not fetch PFS suggested partners",e,t),i||(i=t),L.E)))))),(0,Z.P)(),(0,K.K)((e=>{if(Array.isArray(i))return(0,P.of)(i);var t;throw null!==(t=i)&&void 0!==t?t:e}))))}get settleTimeout(){let e;return this.deps.latest$.pipe((0,Z.P)()).subscribe((({settleTimeout:t})=>e=t)),e}}},8714:(e,t,n)=>{var a={"./backup_state_info.svg":36862,"./channels_info.svg":97047,"./open_channel_info.svg":87318,"./select_hub_info.svg":87253,"./transfer_eth_info.svg":38476,"./transfer_info.svg":35097,"./transfer_steps_info.svg":10126,"./udc_info.svg":99553,"./withdraw_tokens_info.svg":11649};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id=8714},3631:(e,t,n)=>{var a={"./en.json":20790};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id=3631},77828:(e,t,n)=>{"use strict";e.exports=n.p+"img/back_arrow.ad309c77.svg"},28095:(e,t,n)=>{"use strict";e.exports=n.p+"img/info.127d0088.svg"},36862:(e,t,n)=>{"use strict";e.exports=n.p+"img/backup_state_info.5f319c4b.svg"},97047:(e,t,n)=>{"use strict";e.exports=n.p+"img/channels_info.9a467ea1.svg"},87318:(e,t,n)=>{"use strict";e.exports=n.p+"img/open_channel_info.3d732c8a.svg"},87253:(e,t,n)=>{"use strict";e.exports=n.p+"img/select_hub_info.6447fe9f.svg"},38476:(e,t,n)=>{"use strict";e.exports=n.p+"img/transfer_eth_info.43ddb2a9.svg"},35097:(e,t,n)=>{"use strict";e.exports=n.p+"img/transfer_info.663c0062.svg"},10126:(e,t,n)=>{"use strict";e.exports=n.p+"img/transfer_steps_info.63c2b863.svg"},99553:(e,t,n)=>{"use strict";e.exports=n.p+"img/udc_info.75430f51.svg"},11649:(e,t,n)=>{"use strict";e.exports=n.p+"img/withdraw_tokens_info.14b3e183.svg"},69574:(e,t,n)=>{"use strict";e.exports=n.p+"img/logo.412481b0.svg"},24209:(e,t,n)=>{"use strict";e.exports=n.p+"img/notification_block.aa4b2fb7.svg"},38300:(e,t,n)=>{"use strict";e.exports=n.p+"img/notifications.4abe21f5.svg"},48405:()=>{},38873:()=>{},11966:()=>{},45545:()=>{},46047:()=>{},78028:()=>{},50695:()=>{},35352:()=>{},96553:()=>{},50471:()=>{},71632:()=>{},26829:()=>{},26868:()=>{},20790:e=>{"use strict";e.exports=JSON.parse('{"disclaimer":{"user-info":{"header":"Important Information for Users","body":"The Raiden Light Client  is an application that allows you to interact with the Raiden network. If you haven\'t used Raiden before we recommend that you:","bullet-points":{"portal":{"text":"Checkout the","link":"developer portal"},"docs":{"text":"Look at the","link":"documentation"},"videos":{"text":"Learn more by watching","link":"explanatory videos"},"medium":{"text":"Read blog posts on","link":"Medium"}}},"terms":{"header":"Terms of Use","body":"By accessing the Raiden Light Client through our website you agree to the {0} and {1}.","link-name-terms":"Terms of Use","link-name-policy":"Privacy Policy"},"disclaimer":{"header":"Disclaimer","body":"The Raiden Light Client is a beta version of experimental open source software released as a test version under an MIT license and may contain errors and/or bugs. No guarantee or representation whatsoever is made regarding its suitability (or its use) for any purpose or regarding its compliance with any applicable laws and regulations. Use of the Raiden Light Client is at your own risk and discretion and by using the software you warrant and represent that you have read this disclaimer, understand its contents, assume all risk related thereto and hereby release, waive, discharge and covenant not to hold us or any of our officers, employees or affiliates from and for any direct or indirect damage resulting from the Raiden Light Client or the use thereof. Such to the extent as permissible by applicable laws and regulations."},"privacy":{"header":"Privacy Warning","body":["Please be aware, that by using the Raiden Light Client, among others your Ethereum address, channels, channel deposits, settlements and the Ethereum address of your channel counterparty will be stored on the Ethereum chain, i.e. on servers of Ethereum node operators and ergo are to a certain extent publicly available. The same might also be stored on systems of parties running Raiden nodes connected to the same token network. Data present in the Ethereum chain is very unlikely to be able to be changed, removed or deleted from the public arena.","Also be aware, that data on individual Raiden token transfers will be made available via the Matrix protocol to the recipient, intermediating nodes of a specific transfer as well as to the Matrix server operators, see Raiden Transport Specification."]},"accept-checkbox":"I have read, understood and hereby agree to the above Terms of Use, Privacy Policy including the Disclaimer and Privacy Warning","persist-checkbox":"Don’t display this message on start up","accept-button":"Accept"},"info-overlay":{"done":"Close","transfer":{"header":"About Transfer","body":"Enter a recipient address and a token amount to make a transfer. You need to have an open channel with the recipient or with a hub that is connected to the recipient."},"transfer-steps":{"header":"About Direct and Mediated Transfers","body":"A direct transfer will be possible if you have an open channel with the recipient. In any other case, the PFS will try to find the best way to route your transfer to the recipient."},"select-hub":{"header":"About Selecting a Hub","body":"A Hub is a well-connected node. You can connect to a hub or to any other node. Make sure you have enough service tokens to pay for the monitoring and pathfinding service as well as a balance of your selected token."},"open-channel":{"header":"About Opening a Channel","body":"Opening a channel will connect you to your selected hub or node. You need to choose an amount to deposit in the channel. Later you can transfer small amounts of this deposit to any recipient in the network."},"channels":{"header":"About Channels","body":"This is an overview of all your open channels for the selected token. You can choose to close and settle any channel to withdraw your tokens."},"account-backup":{"header":"About Backing Up the State","body":"Your state is stored in the browser. You should continuously keep a backup of your state by downloading the latest JSON file and storing it somewhere safe."},"account-raiden":{"header":"About Transferring ETH","body":"You need ETH on your Raiden Account to withdraw your tokens. You can add ETH by transferring it from your main account."},"account-withdrawal":{"header":"About Withdrawing Tokens","body":"Withdraw tokens from your Raiden account back to your main account."},"account-udc":{"header":"About UDC","body":"Your User Deposit Contract stores the utility tokens necessary for paying the Pathfinding and Monitoring Service."}},"home":{"welcome":"Welcome to the Raiden dApp","disclaimer":"The Raiden dApp is a reference implementation of the Raiden Light Client SDK. As this release still has its limitations and is a beta release, it is crucial to read the documentation with the security notes before using the software.","getting-started":{"description":"Read the {0} for detailed information on how to use the Raiden dApp.","link-name":"getting started guide"}},"notifications":{"no-notifications":"No notifications","clear":"Clear","block-count-progress":"Blocks until confirmation: ","tx-reorged-failure-reason":"The transaction could not get confirmed due to a reorg of the blockchain!","tx-state-confirmed":"confirmed","tx-state-pending":"not confirmed yet","backup-state":{"icon":"notification_state_backup","title":"Backup your state!","description":"Backup your state to not risk losing funds","link":"Click here to go to the backup state menu"},"ms-balance-proof":{"title":"Balance proof submitted","description":"A monitoring service successfully submitted a balance proof for a channel claiming a reward of {reward} {symbol}. Service: {monitoringService}, Partner: {partner}, Transaction: {txHash}"},"no-receive":{"icon":"notification_receive","title":"Receiving transfers disabled","description":"Check configuration and/or UDC balance"},"withdrawal":{"success":{"title":"User Deposit Withdraw Planned","description":"A planned withdrawal of {amount} {symbol} was successfully completed withdrawing {withdrawal} {symbol}"},"failure":{"title":"User Deposit Withdrawal","description":"The planned withdrawal of {amount} {symbol} failed: {message}","descriptions":{"UDC_WITHDRAW_NO_BALANCE":"We could not complete the withdrawal of {amount} {symbol} because there was not enough balance.","UDC_WITHDRAW_FAILED":"We could not complete the withdrawal of {amount} {symbol} because the transaction failed."}}},"withdrawn":{"icon":"notification_withdrawn","title":"User Deposit Tokens Withdrawn","description":"{withdrawnAmount} {symbol} ({plannedAmount} planned) have been withdrawn from the user deposit contract.","link":"Click here to transfer them to your main account."},"settlement":{"icon":"notification_settle","success":{"title":"Channel Settlement","description":"Channel with {partner} was settled."},"failure":{"title":"Channel Settlement","description":"Channel settlement with {partner} failed."}},"channel-open":{"icon":"notification_channels","success":{"title":"Channel Open","description":"Open channel with {partner} is {state}."},"failure":{"title":"Channel Open Failure","description":"{reason}"}}},"general":{"buttons":{"cancel":"Cancel","transfer":"Transfer","continue":"Continue","confirm":"Confirm"},"offline":"Please connect to the internet.","raiden-account":"Raiden Account","main-account":"Main Account"},"account-content":{"account-details":"Account Details","address":"Address:","disconnect-button":"Disconnect","account":{"main":"Main ETH:","raiden":"Raiden ETH:"},"menu-items":{"settings":{"title":"Settings","subtitle":"Change how you interact with the dApp"},"backup-state":{"title":"Backup State","subtitle":"Download or upload your state"},"report-bugs":{"title":"Download Logs","subtitle":"Download your logs"},"raiden-account":{"title":"Transfer ETH","subtitle":"Transfer ETH between main and Raiden account"},"withdrawal":{"title":"Withdraw Tokens","subtitle":"Transfer tokens from your Raiden account to your main account"},"udc":{"title":"Manage UDC Tokens","subtitle":"Transfer tokens from or to your User Deposit Contract"}}},"withdrawal":{"title":"Transfer tokens to your main Ethereum account.","navigation-link-title":"For service tokens, make sure you withdrew them at the UDC screen first.","dialog":{"title":"Withdraw {0}","body":"You are about to withdraw {0} from your Raiden account.","progress":"Withdrawing...","button":"Confirm","no-eth":"Your Raiden account does not have sufficient ETH to withdraw."},"blockie-alt":"Token address blockie","no-tokens":"The Raiden account has no tokens"},"udc":{"balance":"User Deposit Contract Balance","balance-too-low":"Balance is too low for services. Deposit at least {minAmount} {tokenSymbol} to enable receiving.","withdrawal-header":"Withdrawal in progress","withdrawal":"Withdrawal","deposit":"Deposit","asterisk":"*","withdrawal-footnote":"Actual withdrawal amount might vary","withdrawal-planned":"The withdrawal from the user deposit has been planned. You will get notified when the withdrawal is complete.","information":{"no-withdrawal-in-progress":"No withdrawal in progress","pending-message":"Withdraw pending until {0}","ready-message":"Ready, tokens get claimed automatically"}},"backup-state":{"description":"The state holds all account information except the private key. You can backup your state to make sure the dApp is kept in sync when switching between browsers.","disabled-download":"Downloading the state is only possible when connected to the dApp","disabled-upload":"Uploading the state is only possible when the dApp is disconnected","download":"Download State","download-warning":"Keep your state backup private and safe","download-button":"Download","upload":"Upload State and Connect","upload-drag-and-drop":"Drag and drop state file","upload-divider":"or","upload-button":"Browse files","upload-error":"Only one state file in valid JSON format can be uploaded"},"raiden-account":{"in-progress":"Transfer in progress","transfer-from-main-account":"Transfer ETH from Main Account to Raiden Account","transfer-from-raiden-account":"Transfer ETH from Raiden Account to Main Account"},"update":{"updateAvailable":"A new version is available. Please make sure to withdraw your funds before updating!","updateMandatory":"Something happened to the local cached version. Perhaps the browser storage got cleared. You must update to get the app working again. You will not lose your current state.","update":"Update","updateInProgress":"Please wait for the update to finish."},"address-input":{"input":{"placeholder":"Address / ENS name"},"blockie-alt":"Selected token address blockie","error":{"invalid-address":"Enter a valid address or ENS name","no-checksum":"Please enter an address in checksum format. You can convert your address on {ethsum}.","empty":"Enter an address or ENS name","ens-resolve-failed":"Please enter a resolvable ENS name","invalid-excluded-address":"Please enter a different address or ENS name. You can\'t use your own address or the address of the token network.","invalid-restricted-address":"Address not allowed, please enter a different address or ENS name.","target-offline":"Target is offline."}},"amount-input":{"input":{"hint":"Please enter an amount"},"error":{"empty":"Please enter an amount","too-many-decimals":"Please use only up to {decimals} decimals for this token","not-enough-funds":"Your maximum usable amount is {funds} {symbol}","less-than-minimum":"Enter an amount larger than {funds}","invalid":"Please enter a valid amount"}},"address-display":{"copy":"Click to copy","copied":"Copied!"},"app-header":{"currency":"ETH"},"channel-actions":{"open":"Open","deposit":"Deposit","withdraw":"Withdraw","close":"Close","settle":"Settle"},"channel-deposit":{"title":"Channel Deposit","restricted-partner-error":"You can only use addresses you have an open channel with.","partner":"Channel Partner","buttons":{"confirm":"Deposit"},"input":{"label":"Amount"}},"mediated-transfer-action":{"confirm-button-label":"Confirm Payment","steps":{"transfer":{"title":"Transfering tokens via route","description":"Transfer in progress"}}},"direct-transfer-action":{"confirm-button-label":"Confirm Payment","no-route-error":"Please verify that the recipient is online and receives payments before trying again.","steps":{"transfer":{"title":"Transfering tokens directly","description":"Transfer in progress"}}},"channel-deposit-and-transfer-action":{"confirm-button-label":"Deposit and Pay","steps":{"deposit":{"title":"Depositing tokens to channel","description":"Please do not close the browser and confirm the transaction with your wallet."},"transfer":{"title":"Transfering tokens","description":"Please wait until tokens have ben successfully sent."}}},"channel-open-and-transfer-action":{"confirm-button-label":"Open Channel and Pay","steps":{"open":{"title":"Opening new channel with target","description":"Please do not close the browser and confirm the transaction with your wallet."},"deposit":{"title":"Depositing tokens into channel","description":"Please confirm the transaction with your wallet."},"transfer":{"title":"Transfering tokens","description":"Please wait until tokens have ben successfully sent."}}},"channel-withdraw":{"buttons":{"confirm":"Withdraw"},"input":{"label":"Amount"},"dialog":{"label":"Withdraw","title":"Withdrawing Tokens","description":"Sign the transaction in MetaMask and close this dialogue to continue using the dApp."},"done":{"label":"Done","title":"Withdraw Successful","description":"Your tokens have been successfully withdrawn."}},"channel-action-form":{"partner":"Partner","amount":"Amount","restricted-partner-address-error":"Please enter the address of an existing channel partner.","exclude-partner-address-error":"You can\'t select an already existing channel partner."},"find-routes":{"hops":"Hops","price":"Price","sub-title":"Route(s) provided by {subdomain} including number of hops and estimated fee","error":{"title":"Oops, something went wrong"}},"stepper":{"steps":{"open":{"title":"Open","description":"You can deposit more tokens \\n or close the channel."},"closed":{"title":"Closed","description":"Please wait until your channel is settleable. \\nthis may take some time."},"settleable":{"title":"Settleable","description":"Settle your channel to transfer \\n your tokens back to your account."}}},"channels":{"open":{"header":"Open"},"closed":{"header":"Closed"},"settleable":{"header":"Settleable"},"snackbar-close":"Close","token-info":"{symbol} | {name}","title":"Channels on"},"channel-list":{"channel":{"blockie_alt":"Partner address blockie","capacity":"Capacity: {value}","close_dialog":{"title":"Close Channel","description":"Are you sure you want to close this channel? This action cannot be undone."},"settle_dialog":{"title":"Settle Channel","description":"Are you sure you want to settle the channel with hub {partner} for token {token}?"}},"messages":{"close":{"success":"Channel closed successfully","failure":"Channel close failed"},"deposit":{"success":"Deposit was successful","failure":"Deposit failed"},"withdraw":{"success":"Withdraw was successful","failure":"Withdraw failed"},"settle":{"success":"Channel settle was successful","failure":"Channel settle failed"}}},"confirmation":{"buttons":{"cancel":"Cancel","close":"Close","settle":"Settle"}},"confirmation-dialog":{"buttons":{"cancel":"Cancel","confirm":"Confirm"}},"error-screen":{"title":"Error"},"error-codes":{"deployment-info-parsing-failed":"Failed to read the contract or service deployment information file!","unsupported-network":"The current network is unsupported. Please choose a different network.","sdk-initialization-failed":"SDK initialization failed. Please check the console for more information.","state-migration-failed":"Cannot replace state with older uploaded state."},"tokens":{"connected-tokens":"Connected Tokens","connect-new":"Connect new token","disconnect-dialog":{"header":"Disconnect token","confirmation-message":"This action will close all channels for the {symbol} token! {address}"},"leave-progress":{"label":"Disconnect","title":"Disconnecting from the token network","description":"Closing the channels"},"leave-done":{"label":"Done","title":"Disconnected from the token network","description":"All your channels were successfully closed"}},"application":{"privacy-policy":"Privacy Policy, Disclaimer & Imprint.","terms":"Terms."},"udc-deposit-dialog":{"title":"Deposit to UDC","button":"Mint and deposit","button-main":"Deposit","uniswap-url-title":"Click here to purchase RDN","available-utility-token":"Available {utilityTokenSymbol} to deposit: {utilityTokenBalance}","available-eth":"Available ETH for on-chain transaction: {balance} {currency}","error":"The mint and deposit operation failed.","error-main":"The deposit operation failed.","progress":{"mint":"Minting {currency} tokens","approve":"Allow UDC to access {currency} tokens","deposit":"Deposit {currency} tokens to the UDC"}},"transfer":{"receiving-transfer-snackbar":"Receiving transfer, do not close browser.","capacity-label":"Capacity","recipient-label":"Recipient","amount-label":"Amount","amount-placeholder":"Amount","error":{"button":"Dismiss","title":"Token transfer unsuccessful","deposit-title":"Deposit failed, please try again."},"transfer-menus":{"select-token-title":"Select Token","deposit-button":"Deposit","channel-button":"Channels","no-channels":"No open channels"},"transfer-inputs":{"title":"Transfer"},"no-channels-dialog":{"title":"No open channels for the selected token","button":"Connect new token"},"steps":{"request-route":{"title":"Request Route","tooltip":"Mint and deposit {token} to the User Deposit Contract to pay for PFS requests","tooltip-main":"Deposit {token} to the User Deposit Contract to pay for PFS requests","udc-description":"Balance to pay the Pathfinding Service","udc-description-low-balance":"Your {token} token balance is too low to pay for the Pathfinding Service. Use the button above to mint and deposit more tokens.","in-progress":"Paying for the route request","searching-for-route":"Searching for route...","done":"Route request payment complete"},"select-route":{"title":"Select Route"},"confirm-transfer":{"title":"Confirm Transfer","total-amount":"Total Amount"},"call-to-action":{"1":{"default":"Transfer Route Request","amount":"Confirm PFS Fee of {amount} {symbol}"},"2":{"default":"Confirm Mediation Fees","amount":"Confirm Mediation Fee of {amount} {symbol}"},"3":{"amount":"Transfer {amount} {symbol}"}},"transfer":{"title":"Transferring Tokens"},"done":{"title":"Send Successful","description":"Your transfer was successful."},"deposit":{"label":"Deposit","title":"Depositing Tokens","description":"Sign the transaction in MetaMask and close this dialogue to continue using the dApp."},"deposit-done":{"label":"Done","title":"Deposit Successful","description":"Your tokens have been successfully deposited."},"summary":{"headline":"Summary","route-request":"Route Request","pfs":"Pathfinding Service","service-fee":"Service Fee","mediated-transfer":"Mediated Transfer","direct-transfer":"Direct Transfer","target":"Target","transfer-amount":"Transfer Amount","total-amount":"Total Amount","mediation-fee":"Mediation Fee","identifier":"Identifier","footnotes":{"one":"1","direct-transfer":"Route request and selection skipped, because you are performing a direct transfer.","route-selection-skipped":"Automatically skipped route selection, because there was only a single route with zero fees."}}}},"transfer-history":{"title":"History","pending-transfer":"PENDING","successful-transfer":"CONFIRMED","failed-transfer":"FAILED"},"select-token":{"header":"Available Tokens"},"select-hub":{"select-button":"Select Hub","service-token-tooltip":"Mint and deposit {token} to the User Deposit Contract to pay for the Monitoring Service.","service-token-tooltip-main":"Deposit {token} to the User Deposit Contract to pay for the Monitoring Service.","service-token-description":"balance for monitoring service"},"hub-list":{"header":"Current top 3 suggested hubs (best first)","error":"Error: List of hubs cannot be fetched from the Pathfinding Service.","no-results":"In this token network, the Pathfinding Service does not find a node which is online. Try again later.","select-button":"Select"},"open-channel":{"error":{"title":"Ops, something went wrong","button":"Dismiss","deposit-failed":"Could not deposit to the channel.","open-failed":"Channel open failed."},"title":"Open Channel","open-button":"Open Channel","partner":"Channel Partner","deposit":"Initial Deposit","excluded-partner-error":"You already have an open channel with the address for this token.","steps":{"open":{"label":"Open","title":"Opening a new channel","description":"Please do not close the browser and confirm the transaction with MetaMask."},"transfer":{"label":"Transfer","title":"Transferring tokens to the network","description":"Please do not close the browser and confirm two (2) transactions with MetaMask."},"deposit":{"label":"Deposit","title":"Deposit tokens into the channel","description":"Wait until tokens are confirmed to be deposited in the channel"},"done":{"label":"Done","title":"New Channel opened","description":"A new channel was successfully opened. You can now start making transfers."}},"confirmation":"Channel opening is in progress, are you sure you want to leave?"},"token-information":{"title":"Token","description":"{symbol} | {name}","balance":"Balance"},"pathfinding-services":{"title":"Select Pathfinding Service","rtt":"{time} ms","headers":{"host":"Pathfinding Service","rtt":"Ping","price":"Price"}},"mint-dialog":{"title":"Mint {symbol}","description":"If you continue, you will get prompted by MetaMask to sign off a minting transaction. In order to mint tokens, you need test net ETH in your wallet."},"error-message":{"problem":"Problem:","solution":"Solution:"},"errors":{"RDN_GENERAL_ERROR":{"title":"An error occurred","problem":"We do not know this error, sorry.","solution":["Please help us and report the issue","Click on your identicon in the top right corner","Click on Report Bugs / Download logs","File a new issue on https://github.com/raiden-network/light-client","Upload logs to the issue"]},"RDN_MINT_FAILED":{"title":"Could not mint token","problem":"It looks like the Light Client does not support minting out-of-the-box for this token contract.","solution":"You may try to mint manually via MetaMask and Etherscan. You can find a step-by-step guide on https://github.com/raiden-network/light-client#minting-manually."},"PFS_UNKNOWN_TOKEN_NETWORK":{"title":"No open channels","problem":"You don\'t seem to have open channels on this token network.","solution":["Hit the ← button in the top left","Click on the current token network","Select Connect new token","Select the token you want to transfer","Proceed with the flow to open a new channel"]},"PFS_INVALID_INFO":{"title":"Couldn\'t understand Pathfinding Service","problem":"The Light Client has received a response from the Pathfinding Service that it couldn\'t understand. It\'s possible that the current Light Client version is out-of-sync with the Pathfinding Service.","solution":["Update the dApp by reloading the page","Attempt a new transfer","If the problem persists, please help us and report the issue","Click on your identicon in the top right corner","Click on Report Bugs / Download logs","File a new issue on https://github.com/raiden-network/light-client","Upload logs to the issue"]},"PFS_NO_ROUTES_FOUND":{"title":"No routes found","problem":"Pathfinding Service wasn\'t able to find a route in the Raiden Network to perform your transfer.","solution":"Make sure that you either have a direct channel with the target or that both of you are connected to a well-connected hub."},"PFS_ERROR_RESPONSE":{"title":"Pathfinding replied with an error","problem":"While communicating with the Pathfinding Service, you have received an error response that we don\'t actively handle yet.","solution":["Simply retry your last action","If the problem persists, please help us and report the issue","Click on your identicon in the top right corner","Click on Report Bugs / Download logs","File a new issue on https://github.com/raiden-network/light-client","Upload logs to the issue"]},"PFS_DISABLED":{"title":"Pathfinding Service disabled","problem":"You tried to find a route in the Raiden Network but Pathfinding was either disabled in your configuration or you did not select a valid Pathfinding Service.","solution":"Try to restart the Light Client by reloading the page and attempt a new transfer."},"PFS_TARGET_OFFLINE":{"title":"Target address is offline","problem":"You are trying to send tokens to an offline target.","solution":"Hit the ← button and verify that the address is online or choose a different target address."},"PFS_LAST_IOU_REQUEST_FAILED":{"title":"Error while depositing tokens for Pathfinding Service","problem":"While trying to deposit tokens for route requests, the Pathfinding Service returned an error.","solution":["This should happen very rarely, please retry to deposit","If the problem persists, please help us and report the issue","Click on your identicon in the top right corner","Click on Report Bugs / Download logs","File a new issue on https://github.com/raiden-network/light-client","Upload logs to the issue"]},"PFS_IOU_SIGNATURE_MISMATCH":{"title":"Error while depositing tokens for Pathfinding Service","problem":"While trying to deposit tokens for route requests, the Pathfinding Service encountered mismatching signatures.","solution":["This should happen very rarely, please retry to deposit","If the problem persists, please help us and report the issue","Click on your identicon in the top right corner","Click on Report Bugs / Download logs","File a new issue on https://github.com/raiden-network/light-client","Upload logs to the issue"]},"PFS_NO_ROUTES_BETWEEN_NODES":{"title":"No route between you and your target","problem":"The Pathfinding Service was not able to find a usable route between you and the target you want to transfer tokens to.","solution":["Hit the ← button in the top left","Click on the current token network","Select Connect new token","Select the token you want to transfer","Connect with a more popular hub, e.g. hub.raiden.eth. That way, Pathfinding Service is more likely to find a route between you and the target","Retry your transfer"]},"PFS_TARGET_NO_RECEIVE":{"title":"Target does not receive payments","problem":"The target is online but does not seem to receive payments.","solution":"Please contact the payment target to make sure he can receive payments and try again."}},"versions":{"sdk":"Raiden SDK: {version}","contracts":"Raiden Contracts: {version}"},"scan":{"permission":{"title":"Grant Camera Access","description":"In order to scan QR codes, you will need to allow camera access."}},"progress-steps":{"transfer":{"PENDING":"Transfer sent","RECEIVED":"Transfer acknowledged by partner","REFUNDED":"Transfer refunded","CLOSED":"Channel closed early","REVEALED":"Secret revealed to target","UNLOCKING":"Unlock sent to partner","EXPIRING":"Lock expired","UNLOCKED":"Unlock acknowledged","EXPIRED":"Lock expired acknowledged","REQUESTED":"Secret requested by target","REGISTERED":"Secret registered on-chain"}},"settings":{"raiden-account":{"title":"Use Raiden Account","description":"By default the dApp uses a generated Raiden account to sign messages. Disable the Raiden account to use your Web3 provider account. All messages will then have to be signed manually."}},"token-list":{"item":{"blockie-alt":"Token address blockie","information-template":"{symbol} | {name}"}},"install-banner":{"install":"Install","dismiss":"Dismiss","message-mobile":"Add the Raiden dApp to your Home screen","message-desktop":"Install the Raiden dApp on your desktop"},"connection-manager":{"dialogs":{"base":{"link-button":"Connect"},"direct-rpc-provider":{"header":"Private Key","description":"Connect directly to an Ethereum node and use your accounts private key. This approach is NOT RECOMMENDED for security concerns.","error-message":"Failed to link to configured provider. Please make sure the given paramaters and the service is available.","options":{"rpc-url":{"name":"RPC","details":"Provide the URL for an RPC endpoint","placeholder":"https://"},"private-key":{"name":"Private Key","details":"Hex encoded private key of your Ethereum account.","placeholder":"f0a78..."}}},"injected-provider":{"header":"Browser Extension","description":"Connect with a provider in your web browser.","error-message":"Failed to link to provider. Please make sure to grant the requested permissions."},"wallet-connect-provider":{"header":"WalletConnect","description":"Connect with any mobile wallet app that supports WalletConnect.","error-message":"Failed to link via WalletConnect. Please make sure the given parmaters are correct and confirm the connection in the wallet.","options":{"bridge-url":{"name":"Bridge Server","details":"Provide the URL for an alternative bridge server","placeholder":"https://"},"infura-id":{"name":"Infura","details":"Provide the ID for an Infura project","placeholder":"Project ID"},"rpc-url":{"name":"RPC","details":"Provide the URL for an RPC endpoint","placeholder":"https://"}}},"connection-pending":{"title":"Connecting","text":"Please check if any actions are required in your wallet.","button":"Cancel"}}},"quick-pay":{"transfer-information":{"header":"Payment Information","target-address":"Receiver","token-amount":"Payment amount","pathfinding-service-price":"Mediation possible, price for requesting route","fetch-route-trigger":"Pay to find route","fetch-route-error-too-expensive":"UDC balance too low","fetch-route-error-no-route":"No route available"},"action-titles":{"channel-deposit":"Channel Deposit","channel-open":"Open Channel","channel-deposit-and-transfer":"Channel Deposit and Pay","channel-open-and-transfer":"Channel Open and Pay"},"action-messages":{"direct-transfer":"Please confirm the above payment information.","mediated-transfer":"Please confirm the above payment information including the mediation fees for the to use route.","channel-deposit-and-transfer":"{deposit} will be deposited into the existing channel and {payment} will be paid out.","channel-open-and-transfer":"{deposit} will be deposited into a new channel and {payment} will be paid out."},"invalid-parameter-error":"Some payment parameters are invalid. Please verify the link is correct."}}')}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,(()=>{n.amdO={}})(),(()=>{var e=[];n.O=(t,a,i,r)=>{if(!a){var o=1/0;for(d=0;d<e.length;d++){for(var[a,i,r]=e[d],s=!0,c=0;c<a.length;c++)(!1&r||o>=r)&&Object.keys(n.O).every((e=>n.O[e](a[c])))?a.splice(c--,1):(s=!1,r<o&&(o=r));if(s){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,i,r]}})(),(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return n.d(t,{a:t}),t}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(a,i){if(1&i&&(a=this(a)),8&i)return a;if("object"===typeof a&&a){if(4&i&&a.__esModule)return a;if(16&i&&"function"===typeof a.then)return a}var r=Object.create(null);n.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&a;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>a[e]));return o["default"]=()=>a,n.d(r,o),r}})(),(()=>{n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,a)=>(n.f[a](e,t),t)),[]))})(),(()=>{n.u=e=>"js/"+e+"."+{42:"2953d35a",43:"bcaf8d22",56:"9d28bc9d",122:"d1fe3dfd",132:"2bc4c4ab",194:"341fbe5f",256:"a526cdea",336:"7673934e",368:"9206c5a5",370:"dc63496f",467:"a280df8a",501:"3612d217",560:"df830440",598:"feaade30",672:"4a1b454e",678:"03231a93",719:"da0235b8",768:"a6d9f9d3",781:"c868b591",786:"a5907a2e",826:"6ac8b18f",856:"69461e97",865:"2f245275",870:"ce259d34",904:"43317163",945:"f56d9a2b",950:"7adf64df",957:"673aedb1",967:"9ca23230"}[e]+".js"})(),(()=>{n.miniCssF=e=>"css/"+e+"."+{43:"a37f4446",56:"1705714e",122:"8cfceb97",132:"aa82c834",194:"79db850a",256:"557aaaf3",336:"e001f247",467:"776b7903",672:"256ba2f2",678:"7caec962",719:"ca83ea0e",768:"c2a14a23",781:"52ff5915",786:"a9424cc5",826:"147aa44a",904:"6755c694",945:"cff8c271",957:"00a3f01c",967:"00a57e3a"}[e]+".css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="raiden-dapp:";n.l=(a,i,r,o)=>{if(e[a])e[a].push(i);else{var s,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var p=l[d];if(p.getAttribute("src")==a||p.getAttribute("data-webpack")==t+r){s=p;break}}s||(c=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+r),s.src=a),e[a]=[i];var u=(t,n)=>{s.onerror=s.onload=null,clearTimeout(m);var i=e[a];if(delete e[a],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{n.p="/"})(),(()=>{var e=(e,t,n,a)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=r=>{if(i.onerror=i.onload=null,"load"===r.type)n();else{var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=o,c.request=s,i.parentNode.removeChild(i),a(c)}};return i.onerror=i.onload=r,i.href=t,document.head.appendChild(i),i},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var i=n[a],r=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(r===e||r===t))return i}var o=document.getElementsByTagName("style");for(a=0;a<o.length;a++){i=o[a],r=i.getAttribute("data-href");if(r===e||r===t)return i}},a=a=>new Promise(((i,r)=>{var o=n.miniCssF(a),s=n.p+o;if(t(o,s))return i();e(a,s,i,r)})),i={143:0};n.f.miniCss=(e,t)=>{var n={43:1,56:1,122:1,132:1,194:1,256:1,336:1,467:1,672:1,678:1,719:1,768:1,781:1,786:1,826:1,904:1,945:1,957:1,967:1};i[e]?t.push(i[e]):0!==i[e]&&n[e]&&t.push(i[e]=a(e).then((()=>{i[e]=0}),(t=>{throw delete i[e],t})))}})(),(()=>{var e={143:0};n.f.j=(t,a)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var r=new Promise(((n,a)=>i=e[t]=[n,a]));a.push(i[2]=r);var o=n.p+n.u(t),s=new Error,c=a=>{if(n.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var r=a&&("load"===a.type?"missing":a.type),o=a&&a.target&&a.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,i[1](s)}};n.l(o,c,"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,a)=>{var i,r,[o,s,c]=a,l=0;if(o.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)var d=c(n)}for(t&&t(a);l<o.length;l++)r=o[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},a=globalThis["webpackChunkraiden_dapp"]=globalThis["webpackChunkraiden_dapp"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=n.O(void 0,[998],(()=>n(43257)));a=n.O(a)})();